<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ddd-guide</title>
    <style>

/* Professional Document Styling */
@page {
    size: A4;
    margin: 2cm;
    @bottom-right {
        content: "Page " counter(page) " of " counter(pages);
        font-size: 9pt;
        color: #666;
    }
}

body {
    font-family: 'Georgia', 'Times New Roman', serif;
    font-size: 11pt;
    line-height: 1.6;
    color: #333;
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

h1 {
    color: #2c3e50;
    font-size: 28pt;
    border-bottom: 3px solid #3498db;
    padding-bottom: 10px;
    margin-top: 0;
    margin-bottom: 20px;
    page-break-after: avoid;
}

h2 {
    color: #34495e;
    font-size: 22pt;
    border-bottom: 2px solid #95a5a6;
    padding-bottom: 8px;
    margin-top: 30px;
    margin-bottom: 15px;
    page-break-after: avoid;
}

h3 {
    color: #34495e;
    font-size: 18pt;
    margin-top: 25px;
    margin-bottom: 12px;
    page-break-after: avoid;
}

h4 {
    color: #555;
    font-size: 14pt;
    margin-top: 20px;
    margin-bottom: 10px;
    page-break-after: avoid;
}

h5, h6 {
    color: #666;
    font-size: 12pt;
    margin-top: 15px;
    margin-bottom: 8px;
}

p {
    margin-bottom: 12px;
    text-align: justify;
    orphans: 3;
    widows: 3;
}

a {
    color: #3498db;
    text-decoration: none;
}

a:hover {
    text-decoration: underline;
}

code {
    background-color: #f4f4f4;
    padding: 2px 6px;
    border-radius: 3px;
    font-family: 'Monaco', 'Courier New', monospace;
    font-size: 10pt;
    color: #c7254e;
}

pre {
    background-color: #f8f8f8;
    border: 1px solid #ddd;
    border-left: 4px solid #3498db;
    padding: 15px;
    overflow-x: auto;
    border-radius: 4px;
    margin: 15px 0;
    page-break-inside: avoid;
}

pre code {
    background-color: transparent;
    padding: 0;
    color: #333;
    font-size: 9pt;
    line-height: 1.4;
}

blockquote {
    border-left: 4px solid #3498db;
    padding-left: 20px;
    margin-left: 0;
    color: #555;
    font-style: italic;
    background-color: #f9f9f9;
    padding: 10px 20px;
    margin: 15px 0;
}

table {
    border-collapse: collapse;
    width: 100%;
    margin: 20px 0;
    page-break-inside: avoid;
}

th, td {
    border: 1px solid #ddd;
    padding: 12px;
    text-align: left;
}

th {
    background-color: #3498db;
    color: white;
    font-weight: bold;
}

tr:nth-child(even) {
    background-color: #f2f2f2;
}

ul, ol {
    margin: 12px 0;
    padding-left: 30px;
}

li {
    margin-bottom: 6px;
}

img {
    max-width: 100%;
    height: auto;
    display: block;
    margin: 20px auto;
    border-radius: 4px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

hr {
    border: none;
    border-top: 2px solid #e0e0e0;
    margin: 30px 0;
}

.toc {
    background-color: #f9f9f9;
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 20px;
    margin: 30px 0;
    page-break-inside: avoid;
}

.toc h2 {
    margin-top: 0;
    border-bottom: none;
}

.toc ul {
    list-style-type: none;
    padding-left: 0;
}

.toc li {
    margin-bottom: 8px;
}

.toc a {
    color: #2c3e50;
}

/* Syntax highlighting for code blocks */
.codehilite {
    background: #f8f8f8;
    border-radius: 4px;
}

.codehilite .hll { background-color: #ffffcc }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .s { color: #BA2121 } /* String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .nf { color: #0000FF } /* Name.Function */

/* Print-specific styles */
@media print {
    body {
        font-size: 10pt;
    }

    a {
        color: #000;
        text-decoration: underline;
    }

    pre, blockquote {
        page-break-inside: avoid;
    }
}

    </style>
</head>
<body>

                <div class="toc">
                    <h2>Table of Contents</h2>
                    <div class="toc">
<ul>
<li><a href="#domain-driven-design-comprehensive-guide">Domain-Driven Design: Comprehensive Guide</a><ul>
<li><a href="#table-of-contents">Table of Contents</a><ul>
<li><a href="#part-i-foundations">Part I: Foundations</a></li>
<li><a href="#part-ii-discovery-modeling">Part II: Discovery &amp; Modeling</a></li>
<li><a href="#part-iii-tactical-implementation">Part III: Tactical Implementation</a></li>
<li><a href="#part-iv-integration-patterns">Part IV: Integration &amp; Patterns</a></li>
<li><a href="#part-v-reference">Part V: Reference</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#part-i-foundations_1">Part I: Foundations</a><ul>
<li><a href="#1-introduction-ddd-philosophy">1. Introduction &amp; DDD Philosophy</a><ul>
<li><a href="#11-what-problem-does-ddd-solve">1.1 What Problem Does DDD Solve?</a></li>
<li><a href="#12-why-does-ddd-exist">1.2 Why Does DDD Exist?</a></li>
<li><a href="#13-core-ddd-principles">1.3 Core DDD Principles</a><ul>
<li><a href="#principle-1-ubiquitous-language">Principle 1: Ubiquitous Language</a><ul>
<li><a href="#definition">Definition</a></li>
<li><a href="#why-it-matters">Why It Matters</a></li>
<li><a href="#implementation-in-code">Implementation in Code</a></li>
<li><a href="#building-the-language">Building the Language</a></li>
</ul>
</li>
<li><a href="#principle-2-model-driven-design">Principle 2: Model-Driven Design</a></li>
<li><a href="#principle-3-continuous-learning-and-refinement">Principle 3: Continuous Learning and Refinement</a></li>
</ul>
</li>
<li><a href="#14-the-strategic-tactical-divide">1.4 The Strategic-Tactical Divide</a><ul>
<li><a href="#strategic-patterns-part-i-ii-of-this-guide">Strategic Patterns (Part I &amp; II of this guide)</a></li>
<li><a href="#tactical-patterns-part-iii-of-this-guide">Tactical Patterns (Part III of this guide)</a></li>
</ul>
</li>
<li><a href="#15-when-to-use-ddd">1.5 When to Use DDD</a><ul>
<li><a href="#use-ddd-when">Use DDD When:</a></li>
<li><a href="#skip-ddd-when">Skip DDD When:</a></li>
</ul>
</li>
<li><a href="#16-the-ddd-journey">1.6 The DDD Journey</a></li>
</ul>
</li>
<li><a href="#2-strategic-design-patterns">2. Strategic Design Patterns</a><ul>
<li><a href="#21-overview">2.1 Overview</a></li>
<li><a href="#22-system">2.2 System</a></li>
<li><a href="#23-domains-and-subdomains">2.3 Domains and Subdomains</a></li>
<li><a href="#24-bounded-contexts">2.4 Bounded Contexts</a></li>
<li><a href="#25-context-mapping">2.5 Context Mapping</a></li>
<li><a href="#26-integration-patterns-in-detail">2.6 Integration Patterns in Detail</a></li>
</ul>
</li>
<li><a href="#3-ubiquitous-language">3. Ubiquitous Language</a><ul>
<li><a href="#31-purpose-and-benefits">3.1 Purpose and Benefits</a></li>
<li><a href="#32-development-process">3.2 Development Process</a></li>
<li><a href="#33-language-in-code">3.3 Language in Code</a></li>
<li><a href="#34-language-evolution">3.4 Language Evolution</a></li>
<li><a href="#35-integration-with-other-ddd-patterns">3.5 Integration with Other DDD Patterns</a></li>
<li><a href="#36-common-pitfalls">3.6 Common Pitfalls</a></li>
<li><a href="#37-practical-techniques">3.7 Practical Techniques</a></li>
<li><a href="#38-cross-context-term-mapping">3.8 Cross-Context Term Mapping</a></li>
<li><a href="#39-success-metrics">3.9 Success Metrics</a></li>
</ul>
</li>
<li><a href="#part-i-summary">Part I Summary</a></li>
</ul>
</li>
<li><a href="#part-ii-discovery-modeling_1">Part II: Discovery &amp; Modeling</a><ul>
<li><a href="#4-domain-storytelling">4. Domain Storytelling</a><ul>
<li><a href="#41-what-is-domain-storytelling">4.1 What is Domain Storytelling?</a></li>
<li><a href="#42-core-notation-actor-activity-work-object">4.2 Core Notation: Actor-Activity-Work Object</a><ul>
<li><a href="#actors-who-performs-actions">Actors: Who Performs Actions</a></li>
<li><a href="#activities-what-actions-occur">Activities: What Actions Occur</a></li>
<li><a href="#work-objects-what-is-manipulated">Work Objects: What Is Manipulated</a></li>
<li><a href="#sequence-the-order-of-events">Sequence: The Order of Events</a></li>
</ul>
</li>
<li><a href="#43-commands-queries-events-and-policies">4.3 Commands, Queries, Events, and Policies</a></li>
<li><a href="#44-workshop-facilitation">4.4 Workshop Facilitation</a></li>
<li><a href="#45-from-stories-to-bounded-contexts">4.5 From Stories to Bounded Contexts</a></li>
<li><a href="#46-integration-with-event-storming">4.6 Integration with Event Storming</a></li>
<li><a href="#47-schema-reference">4.7 Schema Reference</a><ul>
<li><a href="#top-level-structure">Top-Level Structure</a></li>
<li><a href="#id-conventions">ID Conventions</a></li>
<li><a href="#causal-chain-in-schema">Causal Chain in Schema</a></li>
<li><a href="#aggregate-integration">Aggregate Integration</a></li>
</ul>
</li>
<li><a href="#48-best-practices">4.8 Best Practices</a></li>
<li><a href="#49-example-complete-domain-story">4.9 Example: Complete Domain Story</a></li>
</ul>
</li>
<li><a href="#part-ii-summary">Part II Summary</a></li>
</ul>
</li>
<li><a href="#part-iii-tactical-implementation_1">Part III: Tactical Implementation</a><ul>
<li><a href="#5-tactical-design-patterns">5. Tactical Design Patterns</a><ul>
<li><a href="#51-overview-and-building-blocks">5.1 Overview and Building Blocks</a></li>
<li><a href="#52-entities">5.2 Entities</a></li>
<li><a href="#53-value-objects">5.3 Value Objects</a></li>
<li><a href="#54-aggregates">5.4 Aggregates</a><ul>
<li><a href="#vaughn-vernons-aggregate-design-rules">Vaughn Vernon's Aggregate Design Rules</a><ul>
<li><a href="#rule-1-protect-true-invariants-in-consistency-boundaries">Rule 1: Protect True Invariants in Consistency Boundaries</a></li>
<li><a href="#rule-2-design-small-aggregates">Rule 2: Design Small Aggregates</a></li>
<li><a href="#rule-3-reference-other-aggregates-by-identity-only">Rule 3: Reference Other Aggregates by Identity Only</a></li>
<li><a href="#rule-4-update-other-aggregates-via-domain-events">Rule 4: Update Other Aggregates via Domain Events</a></li>
</ul>
</li>
<li><a href="#aggregate-root">Aggregate Root</a></li>
<li><a href="#one-aggregate-per-transaction">One Aggregate Per Transaction</a></li>
<li><a href="#identifying-aggregates">Identifying Aggregates</a></li>
<li><a href="#aggregate-examples">Aggregate Examples</a></li>
</ul>
</li>
<li><a href="#55-repositories">5.5 Repositories</a></li>
<li><a href="#56-domain-services">5.6 Domain Services</a></li>
<li><a href="#57-domain-events">5.7 Domain Events</a></li>
<li><a href="#58-id-types-and-conventions">5.8 ID Types and Conventions</a></li>
</ul>
</li>
<li><a href="#6-application-layer">6. Application Layer</a><ul>
<li><a href="#61-overview">6.1 Overview</a></li>
<li><a href="#62-application-layer-position">6.2 Application Layer Position</a><ul>
<li><a href="#four-layer-architecture">Four-Layer Architecture</a></li>
<li><a href="#dependency-direction">Dependency Direction</a></li>
<li><a href="#application-layer-responsibilities">Application Layer Responsibilities</a></li>
</ul>
</li>
<li><a href="#63-application-service-pattern">6.3 Application Service Pattern</a><ul>
<li><a href="#what-is-an-application-service">What is an Application Service?</a></li>
<li><a href="#application-service-vs-domain-service">Application Service vs Domain Service</a></li>
<li><a href="#application-service-structure-knight-pattern">Application Service Structure (Knight Pattern)</a></li>
<li><a href="#coordination-vs-business-logic">Coordination vs Business Logic</a></li>
<li><a href="#granularity-and-operations">Granularity and Operations</a></li>
<li><a href="#validation-in-application-services">Validation in Application Services</a></li>
</ul>
</li>
<li><a href="#64-commandquery-separation-cqrs">6.4 Command/Query Separation (CQRS)</a><ul>
<li><a href="#pattern-definition">Pattern Definition</a></li>
<li><a href="#commands-vs-queries">Commands vs Queries</a></li>
<li><a href="#when-to-use-cqrs-vs-simple-crud">When to Use CQRS vs Simple CRUD</a></li>
<li><a href="#command-side-write-model">Command Side (Write Model)</a></li>
<li><a href="#query-side-read-model">Query Side (Read Model)</a></li>
<li><a href="#cqrs-lite-same-database">CQRS-Lite (Same Database)</a></li>
<li><a href="#eventual-consistency-in-cqrs">Eventual Consistency in CQRS</a></li>
</ul>
</li>
<li><a href="#65-transaction-boundaries">6.5 Transaction Boundaries</a><ul>
<li><a href="#fundamental-rule-one-aggregate-per-transaction">Fundamental Rule: One Aggregate Per Transaction</a></li>
<li><a href="#why-one-aggregate-per-transaction">Why One Aggregate Per Transaction?</a></li>
<li><a href="#single-transaction-per-use-case">Single Transaction Per Use Case</a></li>
<li><a href="#consistency-types-transactional-vs-eventual">Consistency Types: Transactional vs Eventual</a></li>
<li><a href="#when-to-use-eventual-consistency">When to Use Eventual Consistency</a></li>
<li><a href="#sagas-for-complex-workflows">Sagas for Complex Workflows</a></li>
</ul>
</li>
<li><a href="#66-application-service-orchestration">6.6 Application Service Orchestration</a><ul>
<li><a href="#applicationserviceoperation-structure">ApplicationServiceOperation Structure</a></li>
<li><a href="#workflow-structure">Workflow Structure</a></li>
<li><a href="#complete-workflow-example">Complete Workflow Example</a></li>
<li><a href="#domain-event-publishing-patterns">Domain Event Publishing Patterns</a></li>
</ul>
</li>
<li><a href="#67-read-models-and-dtos">6.7 Read Models and DTOs</a><ul>
<li><a href="#read-model-purpose">Read Model Purpose</a></li>
<li><a href="#denormalization-strategies">Denormalization Strategies</a></li>
<li><a href="#read-model-update-via-projections">Read Model Update via Projections</a></li>
<li><a href="#dtos-vs-domain-objects">DTOs vs Domain Objects</a></li>
<li><a href="#flat-dto-pattern-knight">Flat DTO Pattern (Knight)</a></li>
<li><a href="#string-serialization-for-complex-types">String Serialization for Complex Types</a></li>
<li><a href="#bypasses-domain-model-flag">Bypasses Domain Model Flag</a></li>
</ul>
</li>
<li><a href="#68-best-practices-and-anti-patterns">6.8 Best Practices and Anti-Patterns</a><ul>
<li><a href="#best-practices">Best Practices</a></li>
<li><a href="#anti-patterns-to-avoid">Anti-Patterns to Avoid</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#7-backend-for-frontend-bff-pattern">7. Backend-for-Frontend (BFF) Pattern</a><ul>
<li><a href="#71-overview">7.1 Overview</a><ul>
<li><a href="#pattern-definition_1">Pattern Definition</a></li>
<li><a href="#origin-and-history">Origin and History</a></li>
<li><a href="#core-principle-one-experience-one-bff">Core Principle: "One Experience, One BFF"</a></li>
<li><a href="#bff-in-the-schema">BFF in the Schema</a></li>
</ul>
</li>
<li><a href="#72-bff-scope-one-experience-one-bff">7.2 BFF Scope: One Experience, One BFF</a><ul>
<li><a href="#single-ui-focus">Single UI Focus</a></li>
<li><a href="#multiple-bounded-context-aggregation">Multiple Bounded Context Aggregation</a></li>
<li><a href="#core-responsibilities">Core Responsibilities</a></li>
<li><a href="#team-ownership-and-conways-law">Team Ownership and Conway's Law</a></li>
</ul>
</li>
<li><a href="#73-bff-vs-api-gateway">7.3 BFF vs API Gateway</a><ul>
<li><a href="#api-gateway-pattern">API Gateway Pattern</a></li>
<li><a href="#bff-pattern">BFF Pattern</a></li>
<li><a href="#decision-matrix">Decision Matrix</a></li>
<li><a href="#hybrid-approach-recommended">Hybrid Approach (Recommended)</a></li>
<li><a href="#key-distinctions">Key Distinctions</a></li>
</ul>
</li>
<li><a href="#74-bff-interface-design">7.4 BFF Interface Design</a><ul>
<li><a href="#bffinterface-vs-bffscope">BFFInterface vs BFFScope</a></li>
<li><a href="#rest-resource-mapping">REST Resource Mapping</a></li>
<li><a href="#http-verb-to-commandquery-mapping">HTTP Verb to Command/Query Mapping</a></li>
<li><a href="#value-object-conversion">Value Object Conversion</a></li>
</ul>
</li>
<li><a href="#75-data-aggregation-and-transformation">7.5 Data Aggregation and Transformation</a><ul>
<li><a href="#data-aggregation-strategies">Data Aggregation Strategies</a></li>
<li><a href="#data-transformation-types">Data Transformation Types</a></li>
<li><a href="#client-specific-optimizations">Client-Specific Optimizations</a></li>
</ul>
</li>
<li><a href="#76-integration-with-application-services">7.6 Integration with Application Services</a><ul>
<li><a href="#bff-delegates-to-application-services">BFF Delegates to Application Services</a></li>
<li><a href="#no-business-logic-in-bff">No Business Logic in BFF</a></li>
</ul>
</li>
<li><a href="#77-best-practices-and-anti-patterns">7.7 Best Practices and Anti-Patterns</a><ul>
<li><a href="#best-practices_1">Best Practices</a></li>
<li><a href="#anti-patterns-to-avoid_1">Anti-Patterns to Avoid</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#part-iii-summary">Part III Summary</a></li>
</ul>
</li>
<li><a href="#part-iv-integration-patterns_1">Part IV: Integration &amp; Patterns</a><ul>
<li><a href="#8-integration-with-patterns-of-enterprise-application-architecture-poeaa">8. Integration with Patterns of Enterprise Application Architecture (PoEAA)</a><ul>
<li><a href="#81-overview">8.1 Overview</a></li>
<li><a href="#82-domain-logic-patterns">8.2 Domain Logic Patterns</a><ul>
<li><a href="#domain-model-poeaa-domain-layer-ddd">Domain Model (PoEAA) = Domain Layer (DDD)</a></li>
<li><a href="#service-layer-poeaa-application-service-ddd">Service Layer (PoEAA) = Application Service (DDD)</a></li>
</ul>
</li>
<li><a href="#83-data-source-patterns">8.3 Data Source Patterns</a><ul>
<li><a href="#repository-poeaa-vs-repository-ddd">Repository (PoEAA) vs Repository (DDD)</a></li>
<li><a href="#data-mapper-poeaa">Data Mapper (PoEAA)</a></li>
<li><a href="#unit-of-work-poeaa">Unit of Work (PoEAA)</a></li>
</ul>
</li>
<li><a href="#84-presentation-patterns">8.4 Presentation Patterns</a><ul>
<li><a href="#presentation-model-view-models">Presentation Model / View Models</a></li>
<li><a href="#mvc-integration">MVC Integration</a></li>
</ul>
</li>
<li><a href="#85-layered-architecture-integration">8.5 Layered Architecture Integration</a><ul>
<li><a href="#four-layer-architecture-poeaa-ddd">Four-Layer Architecture (PoEAA + DDD)</a></li>
<li><a href="#pattern-allocation-by-layer">Pattern Allocation by Layer</a></li>
</ul>
</li>
<li><a href="#86-pattern-combinations-and-best-practices">8.6 Pattern Combinations and Best Practices</a><ul>
<li><a href="#repository-data-mapper">Repository + Data Mapper</a></li>
<li><a href="#service-layer-domain-model-repository">Service Layer + Domain Model + Repository</a></li>
<li><a href="#complementary-patterns-summary">Complementary Patterns Summary</a></li>
<li><a href="#integration-guidelines">Integration Guidelines</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#part-iv-summary-section-8">Part IV Summary (Section 8)</a></li>
</ul>
</li>
<li><a href="#part-v-reference_1">Part V: Reference</a><ul>
<li><a href="#9-schema-reference-guide">9. Schema Reference Guide</a><ul>
<li><a href="#91-overview">9.1 Overview</a></li>
<li><a href="#92-strategic-schema">9.2 Strategic Schema</a><ul>
<li><a href="#921-root-object-system">9.2.1 Root Object: System</a></li>
<li><a href="#922-domain-type">9.2.2 Domain Type</a></li>
<li><a href="#923-bounded-context-type">9.2.3 Bounded Context Type</a></li>
<li><a href="#924-context-mapping-type">9.2.4 Context Mapping Type</a></li>
<li><a href="#925-bff-scope-type">9.2.5 BFF Scope Type</a></li>
<li><a href="#926-bff-interface-type">9.2.6 BFF Interface Type</a></li>
<li><a href="#927-strategic-schema-id-patterns">9.2.7 Strategic Schema ID Patterns</a></li>
<li><a href="#928-strategic-design-rules">9.2.8 Strategic Design Rules</a></li>
</ul>
</li>
<li><a href="#93-tactical-schema">9.3 Tactical Schema</a><ul>
<li><a href="#931-root-object-boundedcontext">9.3.1 Root Object: BoundedContext</a></li>
<li><a href="#932-aggregate-type">9.3.2 Aggregate Type</a></li>
<li><a href="#933-entity-type">9.3.3 Entity Type</a></li>
<li><a href="#934-value-object-type">9.3.4 Value Object Type</a></li>
<li><a href="#935-repository-type">9.3.5 Repository Type</a></li>
<li><a href="#936-application-service-type">9.3.6 Application Service Type</a></li>
<li><a href="#937-command-interface-type-knight-pattern">9.3.7 Command Interface Type (Knight Pattern)</a></li>
<li><a href="#938-query-interface-type-knight-pattern">9.3.8 Query Interface Type (Knight Pattern)</a></li>
<li><a href="#939-domain-event-type">9.3.9 Domain Event Type</a></li>
<li><a href="#9310-tactical-schema-id-patterns">9.3.10 Tactical Schema ID Patterns</a></li>
<li><a href="#9311-tactical-design-rules">9.3.11 Tactical Design Rules</a></li>
</ul>
</li>
<li><a href="#94-domain-stories-schema">9.4 Domain Stories Schema</a><ul>
<li><a href="#941-overview">9.4.1 Overview</a></li>
<li><a href="#942-actor-type">9.4.2 Actor Type</a></li>
<li><a href="#943-work-object-type">9.4.3 Work Object Type</a></li>
<li><a href="#944-command-type">9.4.4 Command Type</a></li>
<li><a href="#945-query-type">9.4.5 Query Type</a></li>
<li><a href="#946-activity-type">9.4.6 Activity Type</a></li>
<li><a href="#947-event-type">9.4.7 Event Type</a></li>
<li><a href="#948-policy-type">9.4.8 Policy Type</a></li>
<li><a href="#949-causal-chain-in-schema">9.4.9 Causal Chain in Schema</a></li>
<li><a href="#9410-domain-stories-schema-id-patterns">9.4.10 Domain Stories Schema ID Patterns</a></li>
</ul>
</li>
<li><a href="#95-comprehensive-id-convention-table">9.5 Comprehensive ID Convention Table</a></li>
<li><a href="#96-design-rules-summary">9.6 Design Rules Summary</a><ul>
<li><a href="#strategic-design-rules">Strategic Design Rules</a></li>
<li><a href="#tactical-design-rules">Tactical Design Rules</a></li>
<li><a href="#domain-stories-design-rules">Domain Stories Design Rules</a></li>
</ul>
</li>
<li><a href="#97-codifying-ddd-best-practices">9.7 Codifying DDD Best Practices</a><ul>
<li><a href="#immutability-requirements">Immutability Requirements</a></li>
<li><a href="#one-aggregate-per-transaction_1">One Aggregate Per Transaction</a></li>
<li><a href="#bff-responsibilities">BFF Responsibilities</a></li>
<li><a href="#application-service-characteristics">Application Service Characteristics</a></li>
<li><a href="#query-side-effects">Query Side Effects</a></li>
</ul>
</li>
<li><a href="#98-using-the-schemas">9.8 Using the Schemas</a><ul>
<li><a href="#validation-with-json-schema-validators">Validation with JSON Schema Validators</a></li>
<li><a href="#ide-integration">IDE Integration</a></li>
<li><a href="#code-generation">Code Generation</a></li>
<li><a href="#llm-reasoning">LLM Reasoning</a></li>
</ul>
</li>
<li><a href="#99-schema-best-practices">9.9 Schema Best Practices</a><ul>
<li><a href="#when-modeling-strategic-patterns">When Modeling Strategic Patterns</a></li>
<li><a href="#when-modeling-tactical-patterns">When Modeling Tactical Patterns</a></li>
<li><a href="#when-modeling-domain-stories">When Modeling Domain Stories</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#part-v-summary-section-9">Part V Summary (Section 9)</a></li>
<li><a href="#10-bibliography-further-reading">10. Bibliography &amp; Further Reading</a><ul>
<li><a href="#101-primary-ddd-sources">10.1 Primary DDD Sources</a><ul>
<li><a href="#foundational-books">Foundational Books</a></li>
<li><a href="#complementary-books">Complementary Books</a></li>
</ul>
</li>
<li><a href="#102-backend-for-frontend-bff-pattern">10.2 Backend-for-Frontend (BFF) Pattern</a></li>
<li><a href="#103-cqrs-and-event-sourcing">10.3 CQRS and Event Sourcing</a></li>
<li><a href="#104-domain-storytelling">10.4 Domain Storytelling</a></li>
<li><a href="#105-the-knight-pattern-commandquery-with-nested-records">10.5 The Knight Pattern (Command/Query with Nested Records)</a></li>
<li><a href="#106-ubiquitous-language-and-knowledge-crunching">10.6 Ubiquitous Language and Knowledge Crunching</a></li>
<li><a href="#107-aggregates-and-consistency">10.7 Aggregates and Consistency</a></li>
<li><a href="#108-architecture-and-layering">10.8 Architecture and Layering</a></li>
<li><a href="#109-value-objects-and-immutability">10.9 Value Objects and Immutability</a></li>
<li><a href="#1010-domain-events">10.10 Domain Events</a></li>
<li><a href="#1011-repositories-and-persistence">10.11 Repositories and Persistence</a></li>
<li><a href="#1012-strategic-design-and-context-mapping">10.12 Strategic Design and Context Mapping</a></li>
<li><a href="#1013-schemas-and-formal-methods">10.13 Schemas and Formal Methods</a></li>
<li><a href="#1014-conways-law-and-team-topologies">10.14 Conway's Law and Team Topologies</a></li>
<li><a href="#1015-ddd-schema-references">10.15 DDD Schema References</a></li>
<li><a href="#1016-online-communities-and-resources">10.16 Online Communities and Resources</a></li>
<li><a href="#1017-related-patterns-and-practices">10.17 Related Patterns and Practices</a></li>
<li><a href="#1018-additional-reading">10.18 Additional Reading</a></li>
<li><a href="#1019-historical-context">10.19 Historical Context</a></li>
<li><a href="#1020-recommended-reading-order">10.20 Recommended Reading Order</a></li>
</ul>
</li>
<li><a href="#guide-summary-and-conclusion">Guide Summary and Conclusion</a><ul>
<li><a href="#what-weve-covered">What We've Covered</a></li>
<li><a href="#key-ddd-patterns-covered">Key DDD Patterns Covered</a></li>
<li><a href="#using-this-guide">Using This Guide</a></li>
<li><a href="#next-steps">Next Steps</a></li>
<li><a href="#final-thoughts">Final Thoughts</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>

                </div>
                
<h1 id="domain-driven-design-comprehensive-guide">Domain-Driven Design: Comprehensive Guide<a class="headerlink" href="#domain-driven-design-comprehensive-guide" title="Permanent link">&para;</a></h1>
<p><strong>Last Updated:</strong> 2025-01-24<br />
<strong>Target Length:</strong> 50,000-70,000 words (~140-180 pages)<br />
<strong>Target Audience:</strong> Software architects and developers implementing Domain-Driven Design</p>
<hr />
<h2 id="table-of-contents">Table of Contents<a class="headerlink" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<h3 id="part-i-foundations"><a href="#part-i-foundations">Part I: Foundations</a><a class="headerlink" href="#part-i-foundations" title="Permanent link">&para;</a></h3>
<ol>
<li><a href="#1-introduction--ddd-philosophy">Introduction &amp; DDD Philosophy</a></li>
<li><a href="#2-strategic-design-patterns">Strategic Design Patterns</a></li>
<li><a href="#3-ubiquitous-language">Ubiquitous Language</a></li>
</ol>
<h3 id="part-ii-discovery-modeling"><a href="#part-ii-discovery--modeling">Part II: Discovery &amp; Modeling</a><a class="headerlink" href="#part-ii-discovery-modeling" title="Permanent link">&para;</a></h3>
<ol start="4">
<li><a href="#4-domain-storytelling">Domain Storytelling</a></li>
</ol>
<h3 id="part-iii-tactical-implementation"><a href="#part-iii-tactical-implementation">Part III: Tactical Implementation</a><a class="headerlink" href="#part-iii-tactical-implementation" title="Permanent link">&para;</a></h3>
<ol start="5">
<li><a href="#5-tactical-design-patterns">Tactical Design Patterns</a></li>
<li><a href="#6-application-layer">Application Layer</a></li>
<li><a href="#7-backend-for-frontend-bff-pattern">Backend for Frontend (BFF) Pattern</a></li>
</ol>
<h3 id="part-iv-integration-patterns"><a href="#part-iv-integration--patterns">Part IV: Integration &amp; Patterns</a><a class="headerlink" href="#part-iv-integration-patterns" title="Permanent link">&para;</a></h3>
<ol start="8">
<li><a href="#8-integration-with-patterns-of-enterprise-application-architecture">Integration with Patterns of Enterprise Application Architecture</a></li>
</ol>
<h3 id="part-v-reference"><a href="#part-v-reference">Part V: Reference</a><a class="headerlink" href="#part-v-reference" title="Permanent link">&para;</a></h3>
<ol start="9">
<li><a href="#9-schema-reference-guide">Schema Reference Guide</a></li>
<li><a href="#10-bibliography--further-reading">Bibliography &amp; Further Reading</a></li>
</ol>
<hr />
<h1 id="part-i-foundations_1">Part I: Foundations<a class="headerlink" href="#part-i-foundations_1" title="Permanent link">&para;</a></h1>
<h2 id="1-introduction-ddd-philosophy">1. Introduction &amp; DDD Philosophy<a class="headerlink" href="#1-introduction-ddd-philosophy" title="Permanent link">&para;</a></h2>
<h3 id="11-what-problem-does-ddd-solve">1.1 What Problem Does DDD Solve?<a class="headerlink" href="#11-what-problem-does-ddd-solve" title="Permanent link">&para;</a></h3>
<p>Domain-Driven Design addresses the fundamental challenge of managing complexity in software systems by centering development on a rich domain model that reflects deep understanding of the business domain.</p>
<p><strong>The Core Problems:</strong></p>
<p>Traditional software development approaches often create a dangerous gap between business experts and technical implementation. This gap manifests in several critical ways:</p>
<p><strong>Translation Errors</strong>: Business concepts get lost or distorted in translation to code. A "Policy" in insurance means something specific to domain experts, but developers might implement it as a generic "Contract" class, losing essential business meaning.</p>
<p><strong>Model Fragmentation</strong>: Different parts of the system use inconsistent models for the same concepts. The Sales team's "Order" means something different from Fulfillment's "Order", yet the codebase treats them as the same thing, leading to confused logic and brittle integrations.</p>
<p><strong>Maintenance Burden</strong>: When business rules change (and they always do), developers must engage in extensive "code archeology" to find where rules are implemented, understand their current logic, and modify them without breaking other parts of the system.</p>
<p><strong>Communication Breakdown</strong>: Developers and domain experts speak fundamentally different languages. Business meetings use domain terminology while code reviews use technical jargon. This linguistic divide prevents effective collaboration and hides misunderstandings until they become expensive production bugs.</p>
<p><strong>The DDD Solution:</strong></p>
<p>DDD solves these problems through a systematic approach built on three pillars:</p>
<ol>
<li>
<p><strong>Model-Driven Design</strong>: The domain model becomes the heart of the software. Code structure directly reflects business concepts, not technical abstractions. If experts talk about "Policies", "Claims", and "Coverage", those exact terms appear as primary classes in the codebase.</p>
</li>
<li>
<p><strong>Ubiquitous Language</strong>: A common, rigorous language shared by all stakeholders - developers, domain experts, product managers, and even documentation. This language evolves as understanding deepens, and changes to the language drive changes to both the model and the code.</p>
</li>
<li>
<p><strong>Strategic and Tactical Patterns</strong>: A catalog of proven patterns for managing complexity at multiple levels - from organizing large systems into Bounded Contexts (strategic) to implementing rich domain models (tactical).</p>
</li>
</ol>
<h3 id="12-why-does-ddd-exist">1.2 Why Does DDD Exist?<a class="headerlink" href="#12-why-does-ddd-exist" title="Permanent link">&para;</a></h3>
<p>DDD emerged from Eric Evans' experiences in the early 2000s working on complex enterprise systems. Through projects across insurance, finance, shipping, and other domains, he observed recurring patterns in successful projects and consistent pitfalls in unsuccessful ones.</p>
<p><strong>Key Observations:</strong></p>
<p><strong>1. Complexity is Inevitable</strong></p>
<p>Complex business domains require complex models. Attempts to simplify lose essential knowledge. A shipping logistics system that treats all packages the same will fail when hazardous materials, temperature-sensitive cargo, or customs requirements enter the picture. The complexity exists in the domain - the question is whether we model it explicitly or let it emerge as bugs.</p>
<p><strong>2. Model Quality Directly Impacts Software Quality</strong></p>
<p>Projects with poor domain models become increasingly difficult to maintain. Each new feature requires understanding existing spaghetti code, making changes feels like walking through a minefield, and regression bugs proliferate. Conversely, projects with rich, well-understood domain models remain malleable even as they grow in size and complexity.</p>
<p><strong>3. Knowledge Crunching is Essential</strong></p>
<p>The knowledge needed to build effective software exists primarily in domain experts' heads, not in requirements documents. Effective design requires continuous collaboration between developers and experts, with both sides learning and refining the model over time. This "knowledge crunching" process cannot be rushed or automated - it is the heart of DDD.</p>
<p><strong>4. Patterns Accelerate Learning</strong></p>
<p>While each domain is unique, certain structural patterns recur across domains. Entities with identity, Value Objects defined by attributes, Aggregates as consistency boundaries, Repositories for persistence abstraction - these patterns appear again and again. Recognizing and applying them accelerates development and improves communication.</p>
<p><strong>Historical Context:</strong></p>
<p>In the early 2000s, software development was dominated by two extremes:<br />
- <strong>Anemic domain models</strong>: Objects that were pure data structures with all logic in service layers<br />
- <strong>Smart UI anti-pattern</strong>: Business logic embedded in user interface code</p>
<p>Both approaches failed for complex domains. DDD provided a third way: rich domain models that captured business complexity explicitly, supported by strategic patterns for organizing large systems.</p>
<h3 id="13-core-ddd-principles">1.3 Core DDD Principles<a class="headerlink" href="#13-core-ddd-principles" title="Permanent link">&para;</a></h3>
<h4 id="principle-1-ubiquitous-language">Principle 1: Ubiquitous Language<a class="headerlink" href="#principle-1-ubiquitous-language" title="Permanent link">&para;</a></h4>
<h5 id="definition">Definition<a class="headerlink" href="#definition" title="Permanent link">&para;</a></h5>
<p>A common, rigorous language built up between developers and domain experts, based on the domain model used in the software.</p>
<h5 id="why-it-matters">Why It Matters<a class="headerlink" href="#why-it-matters" title="Permanent link">&para;</a></h5>
<p>Software cannot cope with ambiguity - it requires precision. Translation between "business speak" and "tech speak" introduces errors with each conversion.</p>
<p>A shared language ensures everyone discusses the same concepts with the same meaning. The language evolves as understanding deepens, creating a feedback loop that strengthens both the model and the team's shared understanding.</p>
<h5 id="implementation-in-code">Implementation in Code<a class="headerlink" href="#implementation-in-code" title="Permanent link">&para;</a></h5>
<p>Domain terminology must be embedded directly in code:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// GOOD: Uses ubiquitous language</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Order</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OrderId</span><span class="w"> </span><span class="n">orderId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Customer</span><span class="w"> </span><span class="n">customer</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ShippingAddress</span><span class="w"> </span><span class="n">shippingAddress</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderLine</span><span class="o">&gt;</span><span class="w"> </span><span class="n">orderLines</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">submit</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">hasMinimumOrderValue</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BelowMinimumOrderException</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">SUBMITTED</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// ... submission logic</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// BAD: Uses technical abstractions</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Transaction</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Data</span><span class="w"> </span><span class="n">transactionData</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">params</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ... generic update logic</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>The good example uses terms domain experts recognize: Order, Customer, ShippingAddress, OrderLine, submit, hasMinimumOrderValue. The bad example uses generic terms that could mean anything: Transaction, Data, amount, update.</p>
<h5 id="building-the-language">Building the Language<a class="headerlink" href="#building-the-language" title="Permanent link">&para;</a></h5>
<p>The language emerges through systematic collaboration:</p>
<ol>
<li>Developers and experts meet regularly</li>
<li>Explore domain through concrete scenarios</li>
<li>Surface terminology and test it with examples</li>
<li>Challenge vague or ambiguous terms</li>
<li>Refine definitions collaboratively</li>
<li>Update code to match evolved language</li>
<li>Repeat as understanding deepens</li>
</ol>
<p><strong>Example Conversation</strong>:</p>
<div class="codehilite"><pre><span></span><code>Expert: &quot;When an order is abandoned, we need to send a reminder email.&quot;
Developer: &quot;What exactly is &#39;abandoned&#39;?&quot;
Expert: &quot;It means the customer added items to their cart but didn&#39;t complete checkout within 24 hours.&quot;
Developer: &quot;Is that different from &#39;cancelled&#39;?&quot;
Expert: &quot;Yes! Cancelled means the customer explicitly cancelled. Abandoned means they never finished.&quot;
Developer: &quot;So we have two distinct concepts: Abandoned and Cancelled?&quot;
Expert: &quot;Exactly. And they have different recovery strategies.&quot;

→ New terms discovered: Abandoned, Cancelled, Recovery Strategy, Checkout
→ Code will have distinct AbandonedCart and CancelledOrder classes
</code></pre></div>

<h4 id="principle-2-model-driven-design">Principle 2: Model-Driven Design<a class="headerlink" href="#principle-2-model-driven-design" title="Permanent link">&para;</a></h4>
<p><strong>Definition</strong>: The software model is tightly linked to the domain model. Code structure directly reflects domain concepts.</p>
<p><strong>Rationale</strong>:<br />
- Keeps code aligned with business reality<br />
- Makes changes to business logic straightforward (change the model, code follows)<br />
- Allows domain experts to understand code structure conceptually<br />
- Preserves design decisions in code itself, not separate documents</p>
<p><strong>In Practice</strong>:</p>
<p>Models are not just diagrams - they are executable code:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// The Model IS the code</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Order</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Value Objects expressing business concepts</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OrderTotal</span><span class="w"> </span><span class="n">total</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Customer</span><span class="w"> </span><span class="n">customer</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderLine</span><span class="o">&gt;</span><span class="w"> </span><span class="n">orderLines</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">InventoryReservation</span><span class="w"> </span><span class="n">inventoryReservation</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Business method using ubiquitous language</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">submit</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">hasMinimumOrderValue</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BelowMinimumOrderException</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">customer</span><span class="p">.</span><span class="na">hasOutstandingBalance</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CustomerCreditHoldException</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">inventoryReservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reserveInventory</span><span class="p">(</span><span class="n">orderLines</span><span class="p">);</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">SUBMITTED</span><span class="p">;</span>
<span class="w">        </span><span class="n">raiseEvent</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">OrderSubmitted</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">total</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>The code reads like business logic because it IS the business logic. Methods like <code>submit()</code>, <code>hasMinimumOrderValue()</code>, and <code>hasOutstandingBalance()</code> directly express business rules.</p>
<p><strong>Architecture Serves the Domain</strong>:</p>
<div class="codehilite"><pre><span></span><code>┌─────────────────────────────────────┐
│     User Interface Layer            │
│     (REST APIs, Controllers)        │  ← Technical concerns
├─────────────────────────────────────┤
│     Application Layer               │
│     (Use Case Orchestration)        │  ← Coordination
├─────────────────────────────────────┤
│     DOMAIN LAYER ← THE CORE        │
│     (Business Logic &amp; Rules)        │  ← Business essence
├─────────────────────────────────────┤
│     Infrastructure Layer            │
│     (Persistence, External Services)│  ← Technical details
└─────────────────────────────────────┘
</code></pre></div>

<p>The domain layer is protected at the center. Infrastructure and UI concerns don't leak in. The model can be understood and tested without databases, web servers, or external services.</p>
<h4 id="principle-3-continuous-learning-and-refinement">Principle 3: Continuous Learning and Refinement<a class="headerlink" href="#principle-3-continuous-learning-and-refinement" title="Permanent link">&para;</a></h4>
<p><strong>Definition</strong>: Understanding of the domain deepens continuously through collaboration and reflection.</p>
<p><strong>Rationale</strong>:<br />
- Initial understanding is ALWAYS incomplete (this is not a failure, it's reality)<br />
- Hidden complexity emerges during implementation<br />
- Domain knowledge exists in experts' experience, not requirements documents<br />
- Breakthrough insights reshape the model fundamentally</p>
<p><strong>The Breakthrough Concept</strong>:</p>
<p>DDD embraces the idea of "breakthroughs" - moments when the team suddenly realizes a better way to model the domain. These breakthroughs often come after weeks of struggling with a clunky model.</p>
<p><strong>Example Breakthrough</strong>:</p>
<p><em>Before</em>: An e-commerce system modeled <code>Product</code> as a single class with complex conditional logic handling different product types (digital downloads, perishable goods, custom-made items, hazardous materials).</p>
<p><em>Breakthrough</em>: Product itself is not the central concept - it's the <code>FulfillmentStrategy</code> that matters! Different products need different fulfillment approaches. The model shifted to:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// After breakthrough</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Product</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ProductId</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">FulfillmentStrategy</span><span class="w"> </span><span class="n">fulfillmentStrategy</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Shipment</span><span class="w"> </span><span class="nf">prepareForShipment</span><span class="p">(</span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">fulfillmentStrategy</span><span class="p">.</span><span class="na">createShipment</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">order</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">FulfillmentStrategy</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Shipment</span><span class="w"> </span><span class="nf">createShipment</span><span class="p">(</span><span class="n">Product</span><span class="w"> </span><span class="n">product</span><span class="p">,</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DigitalDownloadStrategy</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">FulfillmentStrategy</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Instant delivery via download link</span>
<span class="p">}</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">StandardShippingStrategy</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">FulfillmentStrategy</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Physical shipping with carrier</span>
<span class="p">}</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MadeToOrderStrategy</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">FulfillmentStrategy</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Production before shipment</span>
<span class="p">}</span>
</code></pre></div>

<p>This breakthrough simplified the model dramatically. The conditional complexity disappeared, replaced by polymorphism that matched the business reality.</p>
<p><strong>Refactoring Towards Deeper Insight</strong>:</p>
<p>As understanding deepens, the model must evolve. This is not "rework" - it's essential:</p>
<ol>
<li><strong>Initial Model</strong>: First attempt based on initial understanding</li>
<li><strong>Implementation</strong>: Building reveals gaps and awkwardness</li>
<li><strong>Conversation</strong>: Discussing difficulties with domain experts</li>
<li><strong>Insight</strong>: Sudden clarity about better model</li>
<li><strong>Refactoring</strong>: Restructuring code to match new understanding</li>
<li><strong>Repeat</strong>: Continuous cycle as domain knowledge deepens</li>
</ol>
<h3 id="14-the-strategic-tactical-divide">1.4 The Strategic-Tactical Divide<a class="headerlink" href="#14-the-strategic-tactical-divide" title="Permanent link">&para;</a></h3>
<p>DDD provides patterns at two distinct levels:</p>
<h4 id="strategic-patterns-part-i-ii-of-this-guide">Strategic Patterns (Part I &amp; II of this guide)<a class="headerlink" href="#strategic-patterns-part-i-ii-of-this-guide" title="Permanent link">&para;</a></h4>
<p><strong>Purpose</strong>: Organize large systems and manage complexity at the system level</p>
<p><strong>Key Patterns</strong>:<br />
- <strong>Domains &amp; Subdomains</strong>: Identifying major areas of business capability<br />
- <strong>Bounded Contexts</strong>: Explicit boundaries where models apply<br />
- <strong>Context Mapping</strong>: Relationships and integrations between contexts<br />
- <strong>Ubiquitous Language</strong>: Shared terminology within context boundaries</p>
<p><strong>Questions Answered</strong>:<br />
- How do we break down a large system?<br />
- Where are the natural boundaries?<br />
- How do different parts relate?<br />
- What should we invest most effort in?</p>
<h4 id="tactical-patterns-part-iii-of-this-guide">Tactical Patterns (Part III of this guide)<a class="headerlink" href="#tactical-patterns-part-iii-of-this-guide" title="Permanent link">&para;</a></h4>
<p><strong>Purpose</strong>: Implement rich domain models within a Bounded Context</p>
<p><strong>Key Patterns</strong>:<br />
- <strong>Entities</strong>: Objects with identity and lifecycle<br />
- <strong>Value Objects</strong>: Objects defined by attributes<br />
- <strong>Aggregates</strong>: Consistency boundaries<br />
- <strong>Repositories</strong>: Persistence abstraction<br />
- <strong>Domain Services</strong>: Operations not belonging to entities<br />
- <strong>Domain Events</strong>: Facts about what happened<br />
- <strong>Application Services</strong>: Use case orchestration</p>
<p><strong>Questions Answered</strong>:<br />
- How do we structure the domain model?<br />
- Where does logic belong?<br />
- How do we maintain invariants?<br />
- How do we persist aggregates?</p>
<p><strong>The Relationship</strong>:</p>
<div class="codehilite"><pre><span></span><code>Strategic Design (Context organization)
    ↓
Defines boundaries for
    ↓
Tactical Design (Rich models within contexts)
</code></pre></div>

<p>You typically start strategic (identify contexts) then go tactical (implement models within contexts). But it's not strictly sequential - insights from tactical modeling might reveal better strategic boundaries.</p>
<h3 id="15-when-to-use-ddd">1.5 When to Use DDD<a class="headerlink" href="#15-when-to-use-ddd" title="Permanent link">&para;</a></h3>
<p>DDD is powerful but not appropriate for every project.</p>
<h4 id="use-ddd-when">Use DDD When:<a class="headerlink" href="#use-ddd-when" title="Permanent link">&para;</a></h4>
<p><strong>✓ Complex Business Logic</strong><br />
- Rules that change frequently<br />
- Domain expertise required to understand logic<br />
- Business decisions embedded in software<br />
- Example: Insurance underwriting, loan approval, supply chain optimization</p>
<p><strong>✓ Long-Lived System</strong><br />
- Project expected to last years<br />
- Will evolve as business evolves<br />
- Investment in model pays off over time<br />
- Example: Core banking systems, ERP systems</p>
<p><strong>✓ Domain Experts Available</strong><br />
- Business experts can participate in modeling<br />
- Knowledge exists in people's heads<br />
- Continuous collaboration possible<br />
- Example: Most enterprise projects with engaged business stakeholders</p>
<p><strong>✓ Team Committed to DDD</strong><br />
- Team willing to invest in learning<br />
- Organization supports iterative design<br />
- Refactoring is acceptable<br />
- Example: Teams with architectural focus and quality emphasis</p>
<h4 id="skip-ddd-when">Skip DDD When:<a class="headerlink" href="#skip-ddd-when" title="Permanent link">&para;</a></h4>
<p><strong>✗ Simple CRUD Applications</strong><br />
- Mostly data entry and retrieval<br />
- Little business logic<br />
- Generic operations suffice<br />
- Example: Simple content management, basic user registration</p>
<p><strong>✗ Pure Technical Domains</strong><br />
- No business domain to model<br />
- Purely algorithmic<br />
- Experts are developers<br />
- Example: Compilers, network protocols, image processing algorithms</p>
<p><strong>✗ Short-Lived Projects</strong><br />
- Prototype or proof of concept<br />
- Expected lifetime &lt; 6 months<br />
- Investment not worth return<br />
- Example: Hackathon projects, one-time data migrations</p>
<p><strong>✗ Insufficient Domain Expertise</strong><br />
- No experts available<br />
- Requirements fully specified<br />
- No exploration needed<br />
- Example: Building to exact specifications with no business input</p>
<p><strong>✗ Team Not Ready</strong><br />
- Team unfamiliar with OOP/design<br />
- No mentoring available<br />
- Organization wants quick code, no design<br />
- Example: Startups in extreme time pressure with no design experience</p>
<h3 id="16-the-ddd-journey">1.6 The DDD Journey<a class="headerlink" href="#16-the-ddd-journey" title="Permanent link">&para;</a></h3>
<p>Adopting DDD is a journey, not a destination:</p>
<p><strong>Phase 1: Learning (3-6 months)</strong><br />
- Read foundational books (Evans, Vernon)<br />
- Understand strategic and tactical patterns<br />
- Practice with small models<br />
- <strong>Goal</strong>: Team fluent in DDD vocabulary</p>
<p><strong>Phase 2: First Context (6-12 months)</strong><br />
- Pick one Bounded Context to model deeply<br />
- Apply tactical patterns<br />
- Develop Ubiquitous Language<br />
- Refactor towards deeper insight<br />
- <strong>Goal</strong>: One well-modeled context in production</p>
<p><strong>Phase 3: Strategic Design (12+ months)</strong><br />
- Map full system into contexts<br />
- Define context boundaries<br />
- Implement context mappings<br />
- <strong>Goal</strong>: Clear system architecture with explicit boundaries</p>
<p><strong>Phase 4: Maturity (ongoing)</strong><br />
- Continuous refinement<br />
- New insights reshape models<br />
- Strategic and tactical in balance<br />
- <strong>Goal</strong>: DDD as natural way of working</p>
<p><strong>Reality Check</strong>: Most teams take 1-2 years to become truly proficient with DDD. The investment pays off in maintainable, evolvable systems that stay aligned with business needs.</p>
<hr />
<h2 id="2-strategic-design-patterns">2. Strategic Design Patterns<a class="headerlink" href="#2-strategic-design-patterns" title="Permanent link">&para;</a></h2>
<h3 id="21-overview">2.1 Overview<a class="headerlink" href="#21-overview" title="Permanent link">&para;</a></h3>
<p>Strategic Design addresses the challenge of organizing large, complex systems. While tactical patterns focus on implementation details within a Bounded Context, strategic patterns focus on context boundaries, team organization, integration patterns, and investment decisions.</p>
<blockquote>
<p>"Strategic design is essential for maintaining order in large systems and systems that are critical to the enterprise."<br />
— Eric Evans</p>
</blockquote>
<p><strong>Strategic Design Solves:</strong><br />
- System overwhelm: "This system is too big to understand"<br />
- Model confusion: "Same word means different things"<br />
- Integration chaos: "Everything depends on everything"<br />
- Investment waste: "We're polishing the wrong things"</p>
<p><strong>Strategic Patterns Catalog:</strong><br />
1. <strong>System</strong> (Root Object) - Overall system organization<br />
2. <strong>Domain &amp; Subdomain</strong> - Areas of business capability<br />
3. <strong>Bounded Context</strong> - Explicit model boundaries<br />
4. <strong>Context Mapping</strong> - Integration between contexts<br />
5. <strong>BFF Scope</strong> - Client-specific aggregation</p>
<h3 id="22-system">2.2 System<a class="headerlink" href="#22-system" title="Permanent link">&para;</a></h3>
<p>Having identified the strategic patterns DDD provides, we begin with the foundational concept: the System. Just as a building needs a foundation before walls, DDD modeling needs a root container before identifying domains and contexts.</p>
<p>When modeling a software system with Domain-Driven Design, we need a clear starting point—a way to establish the boundary and scope of what we're designing. The <strong>System</strong> serves as this root concept, representing the entire software system and providing a container for all strategic DDD elements.</p>
<p><strong>Definition</strong>: The System is the top-level organizational concept representing the complete software system being modeled. It contains all domains, Bounded Contexts, their relationships, and integration patterns.</p>
<p><strong>Purpose and Rationale</strong></p>
<p>The System concept addresses fundamental organizational questions:</p>
<p><strong>1. Single Source of Truth</strong></p>
<p>Complex systems involve multiple domains, numerous Bounded Contexts, and various integration patterns. Without a clear root concept, it becomes ambiguous which elements belong together:</p>
<ul>
<li>Which Bounded Contexts are part of this system?</li>
<li>How do domains relate to each other?</li>
<li>What integration patterns connect these contexts?</li>
</ul>
<p>The System establishes clear ownership: every domain, context, and mapping exists within one specific system.</p>
<p><strong>2. System Boundaries</strong></p>
<p>The System defines explicit boundaries:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">system</span><span class="p">:</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sys_ecommerce</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">E-Commerce System</span>
<span class="w">  </span><span class="nt">domains</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dom_sales</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Sales</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dom_catalog</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Product Catalog</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dom_fulfillment</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Order Fulfillment</span>

<span class="w">  </span><span class="nt">bounded_contexts</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_shopping_cart</span>
<span class="w">      </span><span class="nt">domain_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dom_sales</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_order_management</span>
<span class="w">      </span><span class="nt">domain_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dom_sales</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_inventory</span>
<span class="w">      </span><span class="nt">domain_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dom_fulfillment</span>
</code></pre></div>

<p>This hierarchical organization makes it clear that Shopping Cart and Order Management belong to the Sales domain, while Inventory belongs to Fulfillment.</p>
<p><strong>3. System Identity and Metadata</strong></p>
<p>Systems need identity and descriptive information:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">system</span><span class="p">:</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sys_healthcare_platform</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Patient Care Management Platform</span>
<span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0.0</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Comprehensive platform for managing patient records, appointments, and billing</span>
</code></pre></div>

<p>This metadata provides:<br />
- <strong>Unique identification</strong> for the system<br />
- <strong>Human-readable name</strong> for documentation and communication<br />
- <strong>Version tracking</strong> for evolution over time<br />
- <strong>Description</strong> that captures system purpose</p>
<p><strong>4. Strategic Elements Container</strong></p>
<p>The System organizes all strategic DDD patterns in one place:</p>
<table>
<thead>
<tr>
<th>Element</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Domains</strong></td>
<td>Business areas the system addresses</td>
</tr>
<tr>
<td><strong>Bounded Contexts</strong></td>
<td>Explicit model boundaries within domains</td>
</tr>
<tr>
<td><strong>Context Mappings</strong></td>
<td>Integration relationships between contexts</td>
</tr>
<tr>
<td><strong>BFF Scopes</strong></td>
<td>Client-specific aggregation patterns</td>
</tr>
<tr>
<td><strong>BFF Interfaces</strong></td>
<td>Concrete integration implementations</td>
</tr>
</tbody>
</table>
<p><strong>5. Benefits of System-Centric Organization</strong></p>
<p>Organizing around a System concept provides several advantages:</p>
<ul>
<li><strong>Clarity</strong>: Immediate understanding of system scope and composition</li>
<li><strong>Navigation</strong>: All elements accessible from single starting point</li>
<li><strong>Validation</strong>: Completeness checks (all contexts reference valid domains)</li>
<li><strong>Documentation</strong>: Natural structure for system architecture documents</li>
<li><strong>Tooling</strong>: Consistent entry point for code generation and analysis</li>
</ul>
<p><strong>When to Use</strong></p>
<p>Use the System concept when:<br />
- Modeling a complete software system architecture<br />
- Documenting strategic DDD patterns<br />
- Creating comprehensive system documentation<br />
- Establishing boundaries for multi-domain systems<br />
- Coordinating multiple bounded contexts</p>
<p><strong>Example: Job Seeker Platform</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">system</span><span class="p">:</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sys_job_seeker</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Job Seeker Application</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Platform connecting job seekers with employers</span>

<span class="w">  </span><span class="nt">domains</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dom_talent</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Talent Management</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">core</span>
<span class="w">      </span><span class="nt">strategic_importance</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dom_matching</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Job Matching</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">core</span>
<span class="w">      </span><span class="nt">strategic_importance</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dom_communication</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Communications</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">supporting</span>
<span class="w">      </span><span class="nt">strategic_importance</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">important</span>

<span class="w">  </span><span class="nt">bounded_contexts</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_candidate_profiles</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Candidate Profiles</span>
<span class="w">      </span><span class="nt">domain_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dom_talent</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_job_search</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Job Search</span>
<span class="w">      </span><span class="nt">domain_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dom_matching</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_messaging</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Messaging</span>
<span class="w">      </span><span class="nt">domain_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dom_communication</span>

<span class="w">  </span><span class="nt">context_mappings</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cm_search_to_profiles</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Search to Profiles Integration</span>
<span class="w">      </span><span class="nt">upstream_context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_candidate_profiles</span>
<span class="w">      </span><span class="nt">downstream_context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_job_search</span>
<span class="w">      </span><span class="nt">relationship_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customer_supplier</span>
</code></pre></div>

<p><strong>System as Architectural Foundation</strong></p>
<p>The System concept provides the architectural foundation for strategic DDD modeling. By establishing clear boundaries, organizing related concepts, and providing identity, it enables coherent design of complex software systems. Every strategic design discussion begins with understanding which system we're modeling and what lies within its boundaries.</p>
<h3 id="23-domains-and-subdomains">2.3 Domains and Subdomains<a class="headerlink" href="#23-domains-and-subdomains" title="Permanent link">&para;</a></h3>
<p>Strategic DDD begins with understanding the business <strong>domain</strong>—the entire problem space the software addresses. For most organizations, this domain is far too large and complex for a single unified model. The solution is <strong>subdomain classification</strong>, which guides investment decisions and architectural choices.</p>
<p><strong>Domain Definition</strong></p>
<p>A <strong>domain</strong> is the sphere of knowledge and activity around which the system is organized. It encompasses all business activities, processes, and rules that the software must support.</p>
<p><strong>Example domains:</strong><br />
- E-commerce company: Product catalog, shopping, order fulfillment, customer service, marketing, analytics, billing<br />
- Healthcare provider: Patient care, appointments, medical records, billing, insurance claims, pharmacy<br />
- Financial services: Account management, transactions, loans, investments, fraud detection, reporting</p>
<p>The domain is typically too large for effective modeling as a single unit. This is where subdomain classification becomes critical.</p>
<p><strong>Subdomain Classification</strong></p>
<p>Every domain decomposes into <strong>subdomains</strong> that fall into three categories, each demanding different investment strategies:</p>
<p><strong>2.3.1 Core Domain</strong></p>
<p>The core domain is where you must excel to succeed in business. This is your competitive advantage.</p>
<p><strong>Characteristics:</strong><br />
- <strong>Strategic importance</strong>: If this fails, the business fails<br />
- <strong>Competitive differentiation</strong>: What makes this business unique<br />
- <strong>Complex business logic</strong>: Sophisticated rules and processes<br />
- <strong>High investment required</strong>: Best developers, rigorous DDD, continuous iteration<br />
- <strong>Custom-built</strong>: Never outsourced or bought off-the-shelf<br />
- <strong>Frequent evolution</strong>: Business innovation happens here</p>
<p><strong>Identification criteria:</strong><br />
- Generates revenue or saves significant costs<br />
- Competitors cannot easily replicate<br />
- Domain experts are most engaged here<br />
- Frequent feature requests and refinements<br />
- Executive-level attention to this area</p>
<p><strong>Investment strategy:</strong><br />
- Assign the strongest developers<br />
- Apply DDD tactical patterns rigorously<br />
- Invest in deep domain modeling<br />
- Iterate and refine continuously<br />
- Protect aggressively from technical debt<br />
- Extensive testing and quality measures</p>
<p><strong>Real-world examples:</strong><br />
- <strong>Netflix</strong>: Recommendation algorithm, content personalization<br />
- <strong>Amazon</strong>: Product search ranking, one-click ordering<br />
- <strong>Uber</strong>: Real-time ride matching and dynamic pricing<br />
- <strong>Airbnb</strong>: Trust and safety scoring, search quality<br />
- <strong>Google</strong>: Search algorithm, ad auction system</p>
<p><strong>2.3.2 Supporting Subdomain</strong></p>
<p>Supporting subdomains are necessary for the core domain to function but don't provide competitive advantage. They're business-specific but not differentiating.</p>
<p><strong>Characteristics:</strong><br />
- <strong>Necessary but not strategic</strong>: Required for operations<br />
- <strong>No differentiation</strong>: Competitors have similar solutions<br />
- <strong>Moderate complexity</strong>: Some custom logic needed<br />
- <strong>Moderate investment</strong>: Adequate resources<br />
- <strong>Build vs. buy decision</strong>: Could outsource but might customize<br />
- <strong>Stable</strong>: Changes less frequently than core</p>
<p><strong>Identification criteria:</strong><br />
- Necessary for core domain to function<br />
- No competitive advantage if done exceptionally well<br />
- Some business-specific requirements exist<br />
- Moderate complexity, not trivial</p>
<p><strong>Investment strategy:</strong><br />
- Adequate quality, not perfection<br />
- Consider buying and customizing<br />
- Simpler modeling than core domain<br />
- "Good enough" is good enough<br />
- May use mid-level developers</p>
<p><strong>Examples:</strong><br />
- <strong>E-commerce</strong>: Order management, basic inventory tracking<br />
- <strong>SaaS Product</strong>: User account management, billing and invoicing<br />
- <strong>Healthcare</strong>: Appointment scheduling, basic patient registration<br />
- <strong>Logistics</strong>: Route planning, driver scheduling</p>
<p><strong>2.3.3 Generic Subdomain</strong></p>
<p>Generic subdomains are necessary but completely generic across industries. No customization provides business value—standard solutions are best.</p>
<p><strong>Characteristics:</strong><br />
- <strong>Commodity functionality</strong>: Same across all companies<br />
- <strong>No customization value</strong>: Standard solution is optimal<br />
- <strong>Well-understood problems</strong>: Solved problems with proven solutions<br />
- <strong>Minimal investment</strong>: Lowest resource allocation<br />
- <strong>Buy don't build</strong>: Strong candidate for off-the-shelf<br />
- <strong>Very stable</strong>: Rarely changes</p>
<p><strong>Identification criteria:</strong><br />
- Every company in any industry needs this<br />
- No business-specific requirements<br />
- Established off-the-shelf solutions exist<br />
- No competitive advantage in customization</p>
<p><strong>Investment strategy:</strong><br />
- Buy commercial off-the-shelf (COTS) solutions<br />
- Use open-source libraries<br />
- Minimize customization<br />
- Assign minimal team attention<br />
- Isolate from core domain to prevent contamination</p>
<p><strong>Examples:</strong><br />
- Authentication and authorization (unless security IS your core business)<br />
- Email sending and templates<br />
- Payment processing (Stripe, PayPal, etc.)<br />
- PDF generation and reporting<br />
- Time zone handling<br />
- Currency conversion<br />
- Logging and monitoring (use standard tools)</p>
<p><strong>2.3.4 Distillation: Finding the Core</strong></p>
<p><strong>Distillation</strong> is the process of identifying and isolating the core domain from supporting and generic subdomains.</p>
<p><strong>Process steps:</strong><br />
1. <strong>Map the entire domain</strong>: List all major capabilities and areas<br />
2. <strong>Classify each area</strong>: Core, Supporting, or Generic<br />
3. <strong>Validate with stakeholders</strong>: Do business leaders agree on what's core?<br />
4. <strong>Refine boundaries</strong>: Separate core concerns from non-core<br />
5. <strong>Protect the core</strong>: Prevent generic concerns from contaminating core domain<br />
6. <strong>Document the vision</strong>: Make core domain explicit and visible</p>
<p><strong>Distillation yields:</strong><br />
- Clear investment priorities<br />
- Architectural boundaries<br />
- Team organization guidance<br />
- Make vs. buy decisions<br />
- Focus for DDD tactical patterns</p>
<p><strong>Common Mistakes:</strong><br />
- <strong>Everything is core</strong>: Team believes all work is strategic (dilutes effort)<br />
- <strong>Nothing is core</strong>: Team treats everything as commodity (misses differentiation)<br />
- <strong>Core contaminated</strong>: Generic concerns mixed into core domain<br />
- <strong>Supporting treated as core</strong>: Over-investing in non-differentiating areas</p>
<p>The subdomain classification directly influences where to apply DDD rigorously. Core domains demand full tactical DDD. Supporting subdomains get simpler models. Generic subdomains get isolated and often replaced with third-party solutions.</p>
<h3 id="24-bounded-contexts">2.4 Bounded Contexts<a class="headerlink" href="#24-bounded-contexts" title="Permanent link">&para;</a></h3>
<p>If subdomains answer "what parts of the business exist?", then <strong>Bounded Contexts</strong> answer "where do our models apply?" A Bounded Context is the strategic pattern at the heart of DDD's approach to managing complexity.</p>
<p><strong>Definition</strong></p>
<p>A <strong>Bounded Context</strong> is an explicit boundary within which a particular domain model is defined and applicable. It defines the scope where a specific Ubiquitous Language and model are consistently used.</p>
<p><strong>Core Insight</strong>: You cannot create one unified model for a large system. Different parts need different models. Bounded Contexts make these boundaries explicit.</p>
<p><strong>Why Bounded Contexts Are Necessary</strong></p>
<p>The problems they solve:</p>
<ol>
<li>
<p><strong>Polysemic terms</strong>: The same word means different things in different parts of the organization<br />
   - "Customer" in Sales vs. "Customer" in Support<br />
   - "Order" in Sales vs. "Order" in Fulfillment<br />
   - "Product" in Catalog vs. "Product" in Inventory</p>
</li>
<li>
<p><strong>Competing perspectives</strong>: Different stakeholders need different views<br />
   - Sales sees products as items to sell (price, features, promotions)<br />
   - Inventory sees products as stock to manage (SKU, location, quantity)<br />
   - Shipping sees products as items to ship (weight, dimensions, fragility)</p>
</li>
<li>
<p><strong>Model confusion</strong>: Without explicit boundaries, models become muddled<br />
   - Concepts leak between contexts<br />
   - Teams talk past each other using same words with different meanings<br />
   - Code becomes confused trying to serve all perspectives</p>
</li>
<li>
<p><strong>Scale</strong>: Large systems cannot have a single model satisfying all stakeholders</p>
</li>
</ol>
<p><strong>Characteristics of a Bounded Context</strong></p>
<ol>
<li><strong>Explicit Boundary</strong>: The context has a clearly defined boundary (team, codebase, database schema, service boundary)</li>
<li><strong>Unified Model</strong>: Within the boundary, the model is unified and consistent—no contradictions</li>
<li><strong>Ubiquitous Language</strong>: Has its own language that may differ from other contexts</li>
<li><strong>Team Ownership</strong>: Typically owned by a single team with clear responsibility</li>
<li><strong>Independence</strong>: Can evolve somewhat independently of other contexts</li>
<li><strong>Clear Interfaces</strong>: Defines explicitly how it interacts with other contexts</li>
</ol>
<p><strong>How to Identify Boundaries</strong></p>
<p><strong>Linguistic Boundaries:</strong><br />
- Listen for when the same word means different things<br />
- Notice when definitions become complex: "Well, it depends on whether you mean..."<br />
- Pay attention to phrases like "in this context" or "from our perspective"<br />
- Experts from different areas define terms differently</p>
<p><strong>Example linguistic boundary:</strong></p>
<div class="codehilite"><pre><span></span><code>In Sales Context:
- &quot;Order&quot; = Customer purchase request with pricing and payment
- Focus: Products, prices, discounts, customer information

In Fulfillment Context:
- &quot;Order&quot; = Shipping instructions with items to pick and pack
- Focus: Warehouse location, package dimensions, shipping carrier

→ Same word, completely different models → Two bounded contexts
</code></pre></div>

<p><strong>Organizational Boundaries:</strong><br />
- Department boundaries often indicate context boundaries<br />
- Different business processes<br />
- Separate budget authorities and decision-making<br />
- Different compliance or regulatory requirements<br />
- Different stakeholders with competing priorities</p>
<p><strong>Technical Boundaries:</strong><br />
- Different databases or schemas<br />
- Different deployment schedules or release cycles<br />
- Different technology stacks<br />
- Different scalability or performance requirements<br />
- Legacy system boundaries</p>
<p><strong>Process for Defining Bounded Contexts:</strong></p>
<ol>
<li><strong>Map the domain</strong> with domain experts using techniques like Event Storming or Domain Storytelling</li>
<li><strong>Identify linguistic discontinuities</strong>: Where do terms change meaning?</li>
<li><strong>Look for natural seams</strong>: Where do business processes naturally separate?</li>
<li><strong>Consider team structure</strong>: Can one team own this context?</li>
<li><strong>Examine existing system boundaries</strong>: What boundaries already exist?</li>
<li><strong>Test proposed boundaries</strong>: Walk through scenarios—does the boundary make sense?</li>
<li><strong>Validate with stakeholders</strong>: Do they recognize these as natural divisions?</li>
</ol>
<p><strong>When to Create Separate Bounded Contexts</strong></p>
<p>✓ Different teams have different understandings of a concept<br />
✓ The same term means different things in different areas<br />
✓ Different business processes require different models<br />
✓ Scalability requires separating concerns<br />
✓ Legacy systems need isolation from new development<br />
✓ Different update frequencies or consistency requirements exist</p>
<p><strong>Relationships with Other Patterns</strong></p>
<ul>
<li><strong>Contains</strong>: Aggregates, Entities, Value Objects, Repositories, Domain Services</li>
<li><strong>Defined by</strong>: Ubiquitous Language (each context has its own)</li>
<li><strong>Part of</strong>: Domain or Subdomain (contexts belong to subdomains)</li>
<li><strong>Related through</strong>: Context Mapping patterns</li>
<li><strong>Protects</strong>: Model integrity and consistency</li>
</ul>
<p><strong>Common Mistakes</strong></p>
<ol>
<li><strong>Too Large</strong>: Context encompasses too much, model becomes confused and contradictory</li>
<li><strong>Too Small</strong>: Over-fragmentation leads to excessive integration complexity</li>
<li><strong>Fuzzy Boundaries</strong>: Unclear where one context ends and another begins</li>
<li><strong>Ignored Boundaries</strong>: Contexts defined on paper but not enforced in code</li>
<li><strong>Premature Decomposition</strong>: Creating many contexts before understanding the domain</li>
<li><strong>Technical Boundaries Only</strong>: Ignoring linguistic and organizational factors</li>
</ol>
<p><strong>Example: E-Commerce Bounded Contexts</strong></p>
<p><strong>Sales Context:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">bounded_context</span><span class="p">:</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_sales</span>
<span class="w">  </span><span class="nt">domain_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dom_ecommerce</span>

<span class="nt">Model within this context</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Product</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Item for sale (price, description, images, reviews, availability)</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Customer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Buyer (shipping address, payment method, order history)</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Order</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Purchase transaction (items, prices, discounts, total, payment status)</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">ShoppingCart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Draft order being composed</span>
</code></pre></div>

<p><strong>Inventory Context:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">bounded_context</span><span class="p">:</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_inventory</span>
<span class="w">  </span><span class="nt">domain_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dom_warehouse</span>

<span class="nt">Model within this context</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Product</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Stock item (SKU, quantity on hand, warehouse location, reorder point)</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Supplier</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Vendor (lead times, minimum order quantity, pricing tiers)</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">InventoryMovement</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Stock in/out transactions (receiving, picking, transfers)</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Warehouse</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Physical location (zones, bins, capacity)</span>
</code></pre></div>

<p><strong>Shipping Context:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">bounded_context</span><span class="p">:</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_shipping</span>
<span class="w">  </span><span class="nt">domain_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dom_fulfillment</span>

<span class="nt">Model within this context</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Shipment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Package to deliver (tracking number, carrier, delivery status)</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Validated shipping destination</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Package</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Physical container (dimensions, weight, contents, label)</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Carrier</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Shipping company (rates, service levels, delivery estimates)</span>
</code></pre></div>

<p>Notice: "Product" appears in all three contexts but with completely different attributes and behaviors relevant to each context. This is not duplication—it's appropriate modeling. Trying to unify these into one "Product" class would create an incoherent mess.</p>
<p><strong>Decision Tree for Bounded Contexts</strong></p>
<div class="codehilite"><pre><span></span><code>Does the team use the same terms with different meanings?
├─ YES → Separate contexts needed
└─ NO → Could different business processes need different models?
    ├─ YES → Separate contexts likely beneficial
    └─ NO → Do teams have different priorities or schedules?
        ├─ YES → Consider separate contexts for independence
        └─ NO → Single context may be appropriate
</code></pre></div>

<p>Bounded Contexts are not just about code organization—they're about recognizing that different parts of the business see the world differently, and that's okay. The key is making those boundaries explicit, protecting model integrity within each context, and managing integration between contexts deliberately through Context Mapping patterns.</p>
<h3 id="25-context-mapping">2.5 Context Mapping<a class="headerlink" href="#25-context-mapping" title="Permanent link">&para;</a></h3>
<p>Once you've identified multiple Bounded Contexts, the next challenge is managing their relationships and integrations. <strong>Context Mapping</strong> makes these relationships explicit.</p>
<p><strong>Definition</strong></p>
<p>A <strong>Context Map</strong> is a document that describes the relationships between different Bounded Contexts, showing how they integrate, depend on each other, and how teams coordinate around those integrations.</p>
<p><strong>Purpose of Context Mapping</strong></p>
<ol>
<li><strong>Global view</strong>: Provides a system-wide perspective beyond individual contexts</li>
<li><strong>Explicit integration patterns</strong>: Documents how contexts actually relate</li>
<li><strong>Team coordination</strong>: Helps teams understand dependencies and responsibilities</li>
<li><strong>Problem identification</strong>: Reveals integration bottlenecks and issues</li>
<li><strong>Refactoring guidance</strong>: Informs decisions about context boundaries</li>
</ol>
<p><strong>Context Map Components</strong></p>
<ol>
<li><strong>Bounded Contexts</strong>: Boxes or bubbles representing each context</li>
<li><strong>Relationships</strong>: Lines showing connections and dependencies</li>
<li><strong>Integration Patterns</strong>: Labels indicating the type of relationship (Partnership, Customer/Supplier, etc.)</li>
<li><strong>Directionality</strong>: Upstream/downstream flow of influence</li>
<li><strong>Teams</strong>: Which teams own which contexts</li>
<li><strong>Communication patterns</strong>: How teams coordinate</li>
</ol>
<p><strong>The Name Field in Context Mappings</strong></p>
<p>Context mappings include a <strong>required <code>name</code> field</strong> to improve clarity and documentation:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">context_mappings</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cm_sales_to_inventory</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Sales</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">Inventory</span><span class="nv"> </span><span class="s">Product</span><span class="nv"> </span><span class="s">Synchronization&quot;</span>
<span class="w">    </span><span class="nt">upstream_context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_sales</span>
<span class="w">    </span><span class="nt">downstream_context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_inventory</span>
<span class="w">    </span><span class="nt">relationship_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customer_supplier</span>
</code></pre></div>

<p>The <code>name</code> field serves multiple purposes:<br />
- <strong>Human-readable description</strong>: Explains what this integration does<br />
- <strong>Documentation anchor</strong>: Referenced in architecture docs and diagrams<br />
- <strong>Search and navigation</strong>: Easier to find relevant mappings<br />
- <strong>Communication</strong>: Teams can refer to integrations by name</p>
<p><strong>Power Dynamics: Upstream and Downstream</strong></p>
<p>Context relationships have <strong>power dynamics</strong>:</p>
<p><strong>Upstream Context (Supplier)</strong>:<br />
- Provides services or data to others<br />
- Controls the model and interface<br />
- Changes potentially impact downstream<br />
- Has more power in the relationship</p>
<p><strong>Downstream Context (Customer)</strong>:<br />
- Depends on upstream<br />
- Must adapt to upstream changes<br />
- Has less power but can influence<br />
- Must protect itself if needed</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code>[Payment Service] (Upstream)
       ↓ provides payment processing
[Sales Context] (Downstream)
</code></pre></div>

<p>Sales depends on Payment Service. Payment Service controls the integration contract.</p>
<p><strong>Integration Pattern Overview</strong></p>
<p>Different relationship patterns require different strategies:</p>
<p><strong>Cooperative Patterns</strong> (both sides invested in success):<br />
- <strong>Partnership</strong>: Joint planning, coordinated development, mutual commitment<br />
- <strong>Shared Kernel</strong>: Small shared model subset, both teams maintain<br />
- <strong>Customer/Supplier</strong>: Downstream needs factor into upstream planning</p>
<p><strong>Upstream-Driven Patterns</strong>:<br />
- <strong>Open Host Service</strong>: Generalized API serving many consumers<br />
- <strong>Published Language</strong>: Standard data format for exchanges</p>
<p><strong>Downstream-Protection Patterns</strong>:<br />
- <strong>Conformist</strong>: Accept upstream model as-is (simplicity over protection)<br />
- <strong>Anti-Corruption Layer</strong>: Translation layer protecting downstream model</p>
<p><strong>No-Integration Patterns</strong>:<br />
- <strong>Separate Ways</strong>: Explicit decision not to integrate<br />
- <strong>Big Ball of Mud</strong>: Isolate legacy mess from clean contexts</p>
<p>These patterns will be detailed in Section 2.6.</p>
<p><strong>Creating a Context Map</strong></p>
<p><strong>Process:</strong><br />
1. <strong>Identify all bounded contexts</strong>: List every context in the system<br />
2. <strong>Map dependencies</strong>: Who needs what from whom?<br />
3. <strong>Assess power dynamics</strong>: Which contexts are upstream, which downstream?<br />
4. <strong>Choose integration patterns</strong>: Select appropriate pattern for each relationship<br />
5. <strong>Document in Context Map</strong>: Create visual diagram with annotations<br />
6. <strong>Review and update regularly</strong>: Context Maps evolve with the system</p>
<p><strong>Visual Notation Example</strong></p>
<div class="codehilite"><pre><span></span><code>[Sales Context] --Customer/Supplier--&gt; [Inventory Context]
      |
      |--Conformist--&gt; [Legacy Billing System]
      |
      |--ACL--&gt; [External Payment Gateway]

[Shipping Context] &lt;--Shared Kernel--&gt; [Inventory Context]
      |
      |--Open Host Service--&gt; [Multiple Tracking Apps]

[Analytics Context] --Separate Ways-- (no direct integration with Sales)
</code></pre></div>

<p><strong>Context Map Documentation</strong></p>
<p>Beyond the diagram, document:<br />
- <strong>Pattern rationale</strong>: Why this pattern was chosen<br />
- <strong>Team responsibilities</strong>: Who maintains what<br />
- <strong>Integration details</strong>: APIs, message formats, schedules<br />
- <strong>Known issues</strong>: Current pain points<br />
- <strong>Future plans</strong>: Planned changes to relationships</p>
<p><strong>Example Schema</strong> (strategic-example.yaml):</p>
<div class="codehilite"><pre><span></span><code><span class="nt">context_mappings</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cm_profile_to_matching</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Candidate</span><span class="nv"> </span><span class="s">Profile</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">Job</span><span class="nv"> </span><span class="s">Matching</span><span class="nv"> </span><span class="s">Data</span><span class="nv"> </span><span class="s">Flow&quot;</span>
<span class="w">    </span><span class="nt">upstream_context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_profile</span>
<span class="w">    </span><span class="nt">downstream_context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_matching</span>
<span class="w">    </span><span class="nt">relationship_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customer_supplier</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;</span>
<span class="w">      </span><span class="no">Matching context consumes candidate profile data via events.</span>
<span class="w">      </span><span class="no">Profile context publishes CandidateProfileUpdated events.</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cm_job_catalog_to_matching</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Job</span><span class="nv"> </span><span class="s">Catalog</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">Matching</span><span class="nv"> </span><span class="s">Integration&quot;</span>
<span class="w">    </span><span class="nt">upstream_context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_job_catalog</span>
<span class="w">    </span><span class="nt">downstream_context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_matching</span>
<span class="w">    </span><span class="nt">relationship_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customer_supplier</span>
</code></pre></div>

<p><strong>Benefits of Explicit Context Mapping</strong></p>
<ul>
<li><strong>Clarity</strong>: Everyone sees the system structure</li>
<li><strong>Communication</strong>: Common language for discussing integration</li>
<li><strong>Problem detection</strong>: Highlights bottlenecks and dependencies</li>
<li><strong>Team coordination</strong>: Clear ownership and responsibilities</li>
<li><strong>Architecture decisions</strong>: Informs where to invest in refactoring</li>
</ul>
<p><strong>Common Anti-Patterns</strong></p>
<ol>
<li><strong>No Context Map</strong>: Teams work independently without global view</li>
<li><strong>Stale Map</strong>: Map exists but doesn't reflect reality</li>
<li><strong>Pattern Mismatch</strong>: Documented pattern doesn't match actual integration</li>
<li><strong>Over-complication</strong>: Too many integration patterns, excessive complexity</li>
<li><strong>Ignoring Patterns</strong>: Map exists but teams don't follow documented patterns</li>
</ol>
<p>Context Mapping brings discipline to integration. Rather than ad-hoc connections, teams explicitly choose how contexts relate, document those choices, and coordinate around them. The Context Map becomes a living architectural document guiding system evolution.</p>
<h3 id="26-integration-patterns-in-detail">2.6 Integration Patterns in Detail<a class="headerlink" href="#26-integration-patterns-in-detail" title="Permanent link">&para;</a></h3>
<p>Section 2.5 introduced the Context Map as a tool for documenting relationships. Now we'll examine each integration pattern in detail, exploring when to use each, how to implement them, and their trade-offs.</p>
<p>Context Mapping patterns provide a vocabulary for describing how Bounded Contexts relate and integrate. Each pattern addresses specific forces and trade-offs. Understanding when to apply each pattern is crucial for effective strategic design.</p>
<p><strong>Pattern Categories</strong></p>
<p><strong>By Power Dynamic:</strong><br />
- Upstream patterns (supplier controls)<br />
- Downstream patterns (customer adapts)<br />
- Symmetric patterns (equal power or no integration)</p>
<p><strong>By Integration Strategy:</strong><br />
- Shared model (common code or schema)<br />
- Translation (one side translates)<br />
- Isolated (no translation needed)</p>
<p>Let's examine each pattern systematically:</p>
<hr />
<p><strong>2.6.1 Partnership</strong></p>
<p><strong>When to Use</strong>: Two contexts are tightly coupled such that the success of one depends on the success of the other.</p>
<p><strong>Context</strong>:<br />
- Two teams need each other to succeed<br />
- Failure in either context causes failure in both<br />
- Strong interdependence, typically for core domain integration<br />
- Teams can coordinate effectively</p>
<p><strong>Solution</strong>: Form a partnership with joint planning and coordinated development.</p>
<p><strong>Implementation</strong>:<br />
- Regular joint planning sessions<br />
- Coordinated sprint schedules and releases<br />
- Shared integration tests<br />
- Cross-team pair programming<br />
- Mutual commitment to success</p>
<p><strong>Consequences</strong>:</p>
<p>Benefits:<br />
- Strong alignment between teams<br />
- Quick issue resolution<br />
- Shared understanding of requirements<br />
- Coordinated evolution of both contexts</p>
<p>Drawbacks:<br />
- High coordination overhead<br />
- Meeting fatigue<br />
- Slower independent progress<br />
- Difficult with distributed or remote teams</p>
<p><strong>Example</strong>: Shopping cart and payment processing contexts in e-commerce must work together seamlessly. Changes to payment flow require coordinated changes in shopping cart UI and logic.</p>
<hr />
<p><strong>2.6.2 Shared Kernel</strong></p>
<p><strong>When to Use</strong>: Two contexts need to share a small subset of the domain model.</p>
<p><strong>Context</strong>:<br />
- Both teams contribute to shared elements<br />
- Tight integration required<br />
- Truly shared concepts exist<br />
- Teams can coordinate changes</p>
<p><strong>Solution</strong>: Designate a small, well-defined shared subset of the model that both teams maintain jointly.</p>
<p><strong>Critical Constraint</strong>: Keep the shared kernel SMALL (5-10% of total model). Only truly shared, stable core concepts belong here.</p>
<p><strong>Implementation</strong>:<br />
- Shared code repository or module<br />
- Both teams approve changes (joint ownership)<br />
- Continuous integration of shared code<br />
- Automated tests prevent breakage<br />
- Version together, release together</p>
<p><strong>Examples of Appropriate Shared Kernel</strong>:<br />
- <code>Address</code> value object shared between Shipping and Billing contexts<br />
- <code>Money</code> type shared across financial contexts<br />
- <code>ProductId</code> shared between Catalog and Inventory (just the ID, not full Product model)</p>
<p><strong>Consequences</strong>:</p>
<p>Benefits:<br />
- Eliminates duplication for truly shared concepts<br />
- Ensures consistency<br />
- Reduces translation overhead<br />
- Easier integration</p>
<p>Drawbacks:<br />
- Coordination overhead for changes<br />
- Slower independent development<br />
- Risk of uncontrolled growth<br />
- Requires discipline to keep small</p>
<p><strong>Common Mistakes</strong>:<br />
1. <strong>Kernel Too Large</strong>: Shared area grows until contexts effectively merge<br />
2. <strong>Unilateral Changes</strong>: One team changes without consulting other<br />
3. <strong>No Governance</strong>: No clear process for managing changes</p>
<hr />
<p><strong>2.6.3 Customer/Supplier Development</strong></p>
<p><strong>When to Use</strong>: Clear upstream (supplier) and downstream (customer) relationship where both teams want to succeed.</p>
<p><strong>Context</strong>:<br />
- Downstream depends on upstream<br />
- Upstream is willing to support downstream<br />
- Both teams invested in relationship<br />
- Downstream has some influence</p>
<p><strong>Power Dynamic</strong>:<br />
- <strong>Upstream (Supplier)</strong>: Controls the model and interface<br />
- <strong>Downstream (Customer)</strong>: Influences but doesn't control<br />
- <strong>Balance</strong>: Negotiated relationship, not dictated</p>
<p><strong>Solution</strong>:<br />
- Downstream expresses needs to upstream<br />
- Upstream budgets time for downstream support<br />
- Automated acceptance tests define the contract (downstream writes, upstream ensures they pass)<br />
- Regular planning meetings<br />
- SLAs or agreements on support levels</p>
<p><strong>Implementation</strong>:<br />
- Downstream writes acceptance tests expressing their needs<br />
- Upstream ensures tests pass and stay passing<br />
- Regular joint planning: downstream presents requirements, upstream allocates capacity<br />
- API contracts with versioning<br />
- Deprecation process for changes</p>
<p><strong>Consequences</strong>:</p>
<p>Benefits:<br />
- Clear responsibilities<br />
- Downstream has influence on upstream roadmap<br />
- Predictable evolution<br />
- Quality interfaces</p>
<p>Drawbacks:<br />
- Coordination overhead<br />
- Upstream workload for downstream support<br />
- Potential delays for downstream</p>
<p><strong>Example</strong>: Internal platform team (upstream) serving application feature teams (downstream). Platform team allocates sprint capacity for feature team requests, and feature teams write acceptance tests for the platform APIs they depend on.</p>
<hr />
<p><strong>2.6.4 Conformist</strong></p>
<p><strong>When to Use</strong>: Downstream team conforms to upstream model despite that model not being ideal for downstream needs.</p>
<p><strong>Context</strong>:<br />
- Upstream has all the power (external system, vendor API, uninterested internal team)<br />
- Downstream cannot influence upstream<br />
- Translation layer would be expensive relative to benefit<br />
- Upstream model is "good enough"</p>
<p><strong>Solution</strong>:<br />
- Accept upstream model as-is<br />
- Conform downstream design to upstream<br />
- Eliminate translation layer for simplicity<br />
- Stay current with upstream changes automatically</p>
<p><strong>Implementation</strong>:<br />
- Use upstream model directly in downstream code<br />
- Minimal or no transformation<br />
- Wrapper classes at most<br />
- Track upstream changes and adapt</p>
<p><strong>Consequences</strong>:</p>
<p>Benefits:<br />
- Simple, low-maintenance integration<br />
- Automatically stay current with upstream<br />
- No translation bugs or overhead<br />
- Reduced development effort</p>
<p>Drawbacks:<br />
- Suboptimal model in downstream context<br />
- No control over upstream changes<br />
- Upstream problems propagate to downstream<br />
- Potential impedance mismatch with domain</p>
<p><strong>When to Use</strong>:<br />
✓ Upstream is unchangeable (vendor, SaaS, external system)<br />
✓ Translation cost exceeds benefits<br />
✓ Upstream model is adequate (not terrible)<br />
✓ Simple integration is higher priority than perfect model</p>
<p><strong>When to Avoid</strong>:<br />
✗ Downstream is core domain (needs protection via ACL)<br />
✗ Upstream model is very poor fit<br />
✗ Have resources for Anti-Corruption Layer</p>
<p><strong>Example</strong>: Using Stripe's payment API model directly rather than translating to internal payment domain model. Stripe's model is adequate, and translation would add complexity without significant benefit.</p>
<hr />
<p><strong>2.6.5 Anti-Corruption Layer (ACL)</strong></p>
<p><strong>When to Use</strong>: Downstream context needs protection from upstream model that doesn't fit downstream domain.</p>
<p><strong>Context</strong>:<br />
- Upstream model is poor fit for downstream needs<br />
- Downstream is core domain requiring protection<br />
- Upstream changes frequently or unpredictably<br />
- Translation cost is justified by model integrity</p>
<p><strong>Solution</strong>: Create an isolating translation layer that translates between upstream and downstream models.</p>
<p><strong>Components</strong>:<br />
1. <strong>Facade</strong>: Simplified interface presented to downstream domain<br />
2. <strong>Adapter</strong>: Implements facade using upstream API<br />
3. <strong>Translator</strong>: Converts between upstream and downstream models<br />
4. <strong>DTOs</strong>: Data transfer objects for boundary crossing</p>
<p><strong>Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code>Downstream Domain Model (protected, clean)
         ↓
     [ACL Layer]
     ├─ Facades (clean interface)
     ├─ Adapters (implementation)
     └─ Translators (model conversion)
         ↓
    Upstream API (external, messy)
</code></pre></div>

<p><strong>Implementation Example</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Facade: Clean interface for downstream</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">CustomerDataProvider</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Customer</span><span class="w"> </span><span class="nf">findCustomerById</span><span class="p">(</span><span class="n">CustomerId</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Adapter: Implements using upstream API</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">LegacyCustomerAdapter</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">CustomerDataProvider</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">LegacySystemClient</span><span class="w"> </span><span class="n">legacyClient</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">CustomerTranslator</span><span class="w"> </span><span class="n">translator</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Customer</span><span class="w"> </span><span class="nf">findCustomerById</span><span class="p">(</span><span class="n">CustomerId</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">LegacyCustomerRecord</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">legacyClient</span><span class="p">.</span><span class="na">getCustomer</span><span class="p">(</span><span class="n">id</span><span class="p">.</span><span class="na">value</span><span class="p">());</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">translator</span><span class="p">.</span><span class="na">toDomainModel</span><span class="p">(</span><span class="n">record</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Translator: Converts models</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CustomerTranslator</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Customer</span><span class="w"> </span><span class="nf">toDomainModel</span><span class="p">(</span><span class="n">LegacyCustomerRecord</span><span class="w"> </span><span class="n">record</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Customer</span><span class="p">(</span>
<span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">CustomerId</span><span class="p">(</span><span class="n">record</span><span class="p">.</span><span class="na">cust_id</span><span class="p">),</span>
<span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">CustomerName</span><span class="p">(</span><span class="n">record</span><span class="p">.</span><span class="na">first_name</span><span class="p">,</span><span class="w"> </span><span class="n">record</span><span class="p">.</span><span class="na">last_name</span><span class="p">),</span>
<span class="w">            </span><span class="n">Email</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="n">record</span><span class="p">.</span><span class="na">email_addr</span><span class="p">)</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Consequences</strong>:</p>
<p>Benefits:<br />
- Protects downstream domain model integrity<br />
- Isolates from upstream changes<br />
- Maintains Ubiquitous Language in downstream<br />
- Freedom to optimize downstream model independently<br />
- Testable isolation (mock upstream for tests)</p>
<p>Drawbacks:<br />
- Development and maintenance effort<br />
- Performance overhead (translation cost)<br />
- Added complexity<br />
- Can mask upstream problems</p>
<p><strong>When to Use</strong>:<br />
✓ Downstream is core domain needing protection<br />
✓ Upstream model is poor fit<br />
✓ Long-term integration expected<br />
✓ Frequent upstream changes anticipated</p>
<p><strong>When to Avoid</strong>:<br />
✗ Upstream model is good fit (use Conformist)<br />
✗ Resources are very limited<br />
✗ Short-term or temporary integration<br />
✗ Downstream is generic subdomain</p>
<p><strong>Example</strong>: Modern e-commerce platform integrating with legacy mainframe inventory system. ACL translates COBOL data structures into clean domain objects, protecting the modern platform from legacy complexity.</p>
<hr />
<p><strong>2.6.6 Open Host Service</strong></p>
<p><strong>When to Use</strong>: Upstream context serves multiple downstream consumers with varying needs.</p>
<p><strong>Context</strong>:<br />
- Multiple downstream contexts depend on upstream<br />
- Each downstream has different requirements<br />
- Point-to-point customization doesn't scale<br />
- Upstream wants to serve many clients efficiently</p>
<p><strong>Solution</strong>: Define a generalized, well-documented API that serves common needs of all consumers.</p>
<p><strong>Implementation</strong>:<br />
- RESTful API, GraphQL, or gRPC services<br />
- Comprehensive documentation (OpenAPI/Swagger)<br />
- Versioning strategy with clear version management<br />
- Standard protocols (HTTP, gRPC, AMQP)<br />
- SDKs for common languages<br />
- Backward compatibility guarantees<br />
- Clear deprecation process</p>
<p><strong>Characteristics</strong>:<br />
- <strong>Well-documented</strong>: Comprehensive API docs<br />
- <strong>Versioned</strong>: Explicit versions with migration paths<br />
- <strong>Comprehensive</strong>: Covers common use cases<br />
- <strong>Stable</strong>: Doesn't change frequently; when it does, versioned changes<br />
- <strong>Standard protocols</strong>: Uses industry-standard formats</p>
<p><strong>Consequences</strong>:</p>
<p>Benefits:<br />
- Scales to many consumers<br />
- Reduced custom integration work<br />
- Clear contracts and expectations<br />
- Self-service integration<br />
- Standard tooling support</p>
<p>Drawbacks:<br />
- Must satisfy diverse client needs (can't optimize for one)<br />
- Versioning and deprecation complexity<br />
- Documentation overhead<br />
- Breaking changes affect many clients</p>
<p><strong>Example</strong>: Platform authentication service providing Open Host Service to dozens of internal applications. Uses standard OAuth2 protocol, comprehensive docs, versioned API, and SDKs for multiple languages.</p>
<hr />
<p><strong>2.6.7 Published Language</strong></p>
<p><strong>When to Use</strong>: Need for well-documented shared language for information exchange.</p>
<p><strong>Context</strong>:<br />
- Multiple parties exchange information<br />
- Standard data format exists or can be created<br />
- Translation is necessary anyway<br />
- Clarity and precision are priorities</p>
<p><strong>Solution</strong>: Use or create a well-documented shared language (data format or protocol) for all exchanges.</p>
<p><strong>Format Types</strong>:<br />
- <strong>Data schemas</strong>: JSON Schema, XML Schema, Protocol Buffers, Avro<br />
- <strong>Message standards</strong>: CloudEvents, AsyncAPI<br />
- <strong>Industry standards</strong>: FHIR (healthcare), FIX (finance), EDI (logistics), SWIFT (banking)<br />
- <strong>Internal standards</strong>: Company-wide canonical data models</p>
<p><strong>Implementation</strong>:<br />
- Formal schema definitions<br />
- Schema versioning<br />
- Comprehensive documentation<br />
- Validation tools<br />
- Schema registry (for distributed systems)<br />
- Backward compatibility rules</p>
<p><strong>Consequences</strong>:</p>
<p>Benefits:<br />
- Clarity in communication (no ambiguity)<br />
- Reusable across multiple integrations<br />
- Well-understood if industry standard<br />
- Tooling support for validation and code generation<br />
- Reduces translation errors</p>
<p>Drawbacks:<br />
- Overhead of schema maintenance<br />
- May not fit all contexts perfectly<br />
- Versioning challenges<br />
- Learning curve for new standards</p>
<p><strong>Examples</strong>:<br />
- <strong>Healthcare</strong>: HL7 FHIR for health records exchange<br />
- <strong>Finance</strong>: FIX protocol for securities trading<br />
- <strong>E-commerce</strong>: Google Shopping Product Feed format<br />
- <strong>Events</strong>: CloudEvents standard for event metadata</p>
<p><strong>Often Combined With</strong>: Open Host Service (upstream provides API using Published Language for data format)</p>
<hr />
<p><strong>2.6.8 Separate Ways</strong></p>
<p><strong>When to Use</strong>: Integration between two contexts provides little value; better to go separate ways.</p>
<p><strong>Context</strong>:<br />
- Integration cost exceeds benefit<br />
- Contexts address different concerns with minimal overlap<br />
- Duplication is acceptable<br />
- Teams work more effectively independently</p>
<p><strong>Solution</strong>: Explicitly declare the contexts have no relationship. Solve overlapping problems independently.</p>
<p><strong>Implementation</strong>:<br />
- Document the decision not to integrate (make it explicit, not accidental)<br />
- No shared code, no API integration<br />
- Independent roadmaps and planning<br />
- Accept some duplication of functionality or data<br />
- Separate teams with no coordination overhead</p>
<p><strong>Consequences</strong>:</p>
<p>Benefits:<br />
- No integration complexity<br />
- Complete independence<br />
- Faster progress independently<br />
- No coordination overhead<br />
- Simpler architecture</p>
<p>Drawbacks:<br />
- Duplication of effort or data<br />
- Potentially inconsistent user experience<br />
- May need integration later (technical debt if assumption was wrong)<br />
- Lost opportunities for synergy</p>
<p><strong>When to Use</strong>:<br />
✓ Minimal overlap between contexts<br />
✓ Integration cost is very high<br />
✓ Different lifecycles or evolution speeds<br />
✓ Different business areas with no shared users<br />
✓ Temporary duplication is acceptable</p>
<p><strong>Examples</strong>:<br />
- HR training platform and customer-facing product (different users, no integration value)<br />
- Internal wiki and product documentation (separate audiences, separate concerns)<br />
- Marketing website and operational inventory system (different purposes, integration not needed)</p>
<p><strong>Common Mistake</strong>: Choosing Separate Ways to avoid integration work when integration is actually needed. This creates long-term problems.</p>
<hr />
<p><strong>2.6.9 Big Ball of Mud</strong></p>
<p><strong>When to Use</strong>: Recognize when a context (typically legacy) has no useful model; isolate it from clean contexts.</p>
<p><strong>Context</strong>:<br />
- Legacy system exists that is a mess (spaghetti code, no coherent model)<br />
- Replacement is not feasible (too risky, too expensive, too critical to business)<br />
- System must continue operating<br />
- New development is happening in clean contexts</p>
<p><strong>Solution</strong>:<br />
- <strong>Recognize it for what it is</strong>: Don't pretend it's well-modeled<br />
- <strong>Isolate it</strong>: Prevent contamination of clean contexts<br />
- <strong>Wrap it with ACL</strong>: Protect new contexts from the mess<br />
- <strong>Don't expand it</strong>: New features go in clean contexts, not in the mud<br />
- <strong>Accept it</strong>: It works even if ugly; pragmatism over purity</p>
<p><strong>Implementation</strong>:<br />
- Anti-Corruption Layer around legacy system<br />
- No direct access from clean contexts<br />
- API façade hiding internal mess<br />
- Separate maintenance team<br />
- Minimal new development (keep it running, don't expand it)<br />
- Gradual extraction via Strangler Fig Pattern (optional)</p>
<p><strong>Strangler Fig Pattern</strong> (for gradual migration):<br />
1. Identify capability to extract from legacy<br />
2. Build clean version in new bounded context<br />
3. Route new traffic to new version<br />
4. Gradually migrate existing traffic<br />
5. Eventually retire old functionality</p>
<p><strong>Consequences</strong>:</p>
<p>Benefits:<br />
- Realistic acknowledgment of reality<br />
- Protects clean contexts from contamination<br />
- Pragmatic approach (works with what you have)<br />
- Allows progress in new contexts while legacy continues</p>
<p>Drawbacks:<br />
- Continued maintenance burden<br />
- Technical debt persists<br />
- May be difficult to extend or modify<br />
- Team morale (nobody wants to work in the mud)</p>
<p><strong>Example</strong>: Decades-old mainframe system handling critical transactions. Too risky to replace all at once. Wrapped with API façade and Anti-Corruption Layer. New features built in modern microservices that integrate via the façade. Over time, capabilities gradually extracted using Strangler Fig.</p>
<hr />
<p><strong>Pattern Selection Guide</strong></p>
<p><strong>When you control both sides:</strong><br />
- High interdependence + equal power → <strong>Partnership</strong><br />
- High interdependence + shared model → <strong>Shared Kernel</strong><br />
- One-way dependency + negotiation possible → <strong>Customer/Supplier</strong></p>
<p><strong>When upstream has power:</strong><br />
- Downstream needs protection (core domain) → <strong>Anti-Corruption Layer</strong><br />
- Upstream model is adequate → <strong>Conformist</strong></p>
<p><strong>When serving many clients:</strong><br />
- Multiple consumers with varying needs → <strong>Open Host Service</strong><br />
- Standard data format needed → <strong>Published Language</strong></p>
<p><strong>When integration value is low:</strong><br />
- Minimal overlap, high integration cost → <strong>Separate Ways</strong><br />
- Legacy mess → <strong>Big Ball of Mud</strong> (with ACL protection)</p>
<p><strong>Integration Complexity Matrix</strong></p>
<table>
<thead>
<tr>
<th>Upstream Situation</th>
<th>Downstream Need</th>
<th>Best Pattern</th>
</tr>
</thead>
<tbody>
<tr>
<td>Willing partner</td>
<td>Equal partner</td>
<td>Partnership</td>
</tr>
<tr>
<td>Willing partner</td>
<td>Needs protection</td>
<td>Customer/Supplier + ACL</td>
</tr>
<tr>
<td>Unwilling to change</td>
<td>Can accept model</td>
<td>Conformist</td>
</tr>
<tr>
<td>Unwilling to change</td>
<td>Needs protection</td>
<td>Anti-Corruption Layer</td>
</tr>
<tr>
<td>Many clients</td>
<td>Various needs</td>
<td>Open Host Service</td>
</tr>
<tr>
<td>Legacy mess</td>
<td>Clean context</td>
<td>Big Ball of Mud + ACL</td>
</tr>
<tr>
<td>No overlap</td>
<td>No overlap</td>
<td>Separate Ways</td>
</tr>
</tbody>
</table>
<p>Context Mapping patterns provide the vocabulary for discussing integration strategy. Rather than ad-hoc integrations, teams choose patterns deliberately based on power dynamics, model fit, and cost-benefit analysis. The pattern choice should be explicit, documented in the Context Map, and understood by all teams involved.</p>
<h2 id="3-ubiquitous-language">3. Ubiquitous Language<a class="headerlink" href="#3-ubiquitous-language" title="Permanent link">&para;</a></h2>
<p>Strategic patterns provide structure—Domains, Bounded Contexts, Context Mappings. But what brings these structures to life is language. <strong>Ubiquitous Language</strong> is the common, rigorous language built collaboratively between developers and domain experts, based on the domain model used in the software.</p>
<p><strong>Key Insight</strong>: The language should be "ubiquitous"—used everywhere by everyone involved in the software. Not "business language" and "technical language," but one unified language.</p>
<h3 id="31-purpose-and-benefits">3.1 Purpose and Benefits<a class="headerlink" href="#31-purpose-and-benefits" title="Permanent link">&para;</a></h3>
<p><strong>Why Ubiquitous Language Matters</strong></p>
<ol>
<li>
<p><strong>Eliminates Translation</strong>: No gap between how experts talk and how code is written. When an expert says "Customer submits Order," the code has a <code>Customer</code> class with a <code>submitOrder()</code> method.</p>
</li>
<li>
<p><strong>Precision</strong>: Software requires unambiguous terminology. Vague terms like "process" or "handle" create confusion. Precise terms like "submit," "approve," "cancel" have clear meaning.</p>
</li>
<li>
<p><strong>Shared Understanding</strong>: Everyone discusses the same concepts consistently—developers, domain experts, product managers, testers.</p>
</li>
<li>
<p><strong>Living Documentation</strong>: Code itself documents the domain. Reading method names like <code>authorizePayment()</code>, <code>reserveInventory()</code>, <code>shipOrder()</code> tells the domain story.</p>
</li>
<li>
<p><strong>Discovery Tool</strong>: Language evolution reveals deeper domain insights. Struggling to name something often indicates incomplete understanding.</p>
</li>
</ol>
<p><strong>Problems Solved</strong></p>
<p><strong>Without Ubiquitous Language:</strong><br />
- Developers use technical terms ("persist entity," "update status")<br />
- Experts use business terms ("submit order," "approve request")<br />
- Constant mental translation introduces errors<br />
- Requirements documents use different language than code<br />
- Subtle concept differences get lost in translation<br />
- Communication breakdowns between teams</p>
<p><strong>With Ubiquitous Language:</strong><br />
- Everyone uses the same terms<br />
- Code is conceptually readable by domain experts<br />
- Changes map directly from conversation to code<br />
- Precision in communication<br />
- Shared mental model across teams</p>
<p><strong>Example of the Problem:</strong></p>
<div class="codehilite"><pre><span></span><code>Meeting discussion:
Expert: &quot;When a policy lapses, we need to notify the agent.&quot;
Developer: &quot;OK, so when the contract expires, we send an email.&quot;

Later, in code:
class Contract {
    void expire() {
        emailService.send(...);
    }
}

Problem: &quot;Lapse&quot; and &quot;expire&quot; are different concepts! A lapse means non-payment. An expire means reaching the end date. The translation lost critical meaning.
</code></pre></div>

<p><strong>With Ubiquitous Language:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nl">Meeting</span><span class="p">:</span>
<span class="nl">Expert</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;When a policy lapses due to non-payment...&quot;</span>
<span class="nl">Developer</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;What exactly is a &#39;lapse&#39;?&quot;</span>
<span class="nl">Expert</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;It means the premium wasn&#39;t paid by the grace period end.&quot;</span>
<span class="nl">Developer</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Is that different from &#39;expiration&#39;?&quot;</span>
<span class="nl">Expert</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Yes! Expiration is reaching the policy end date. Lapse is automatic due to non-payment.&quot;</span>

<span class="nl">Code</span><span class="p">:</span>
<span class="kd">class</span> <span class="nc">Policy</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">lapse</span><span class="p">(</span><span class="n">NonPaymentReason</span><span class="w"> </span><span class="n">reason</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Lapse-specific logic</span>
<span class="w">        </span><span class="n">notifyAgent</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">PolicyLapsed</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="p">,</span><span class="w"> </span><span class="n">reason</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">expire</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Expiration-specific logic</span>
<span class="w">        </span><span class="n">archivePolicy</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="32-development-process">3.2 Development Process<a class="headerlink" href="#32-development-process" title="Permanent link">&para;</a></h3>
<p>Ubiquitous Language is not created upfront in requirements. It emerges and evolves through continuous collaboration.</p>
<p><strong>Phase 1: Discovery</strong></p>
<p><strong>Activities:</strong><br />
1. <strong>Domain Exploration Sessions</strong>: Developers and domain experts meet regularly to explore the domain through concrete scenarios.</p>
<ol start="2">
<li>
<p><strong>Listen for Terms</strong>: Pay attention to expert vocabulary. Note when experts correct you. Identify ambiguous terms. Find synonyms that might indicate different concepts.</p>
</li>
<li>
<p><strong>Model Sketching</strong>: Draw simple diagrams using terms experts recognize. Test understanding with examples. Refine based on feedback.</p>
</li>
</ol>
<p><strong>Example Discovery Session:</strong></p>
<div class="codehilite"><pre><span></span><code>Developer: &quot;So when a customer places an order...&quot;
Expert: &quot;Well, actually we don&#39;t call it &#39;placing&#39;—we say the customer &#39;submits&#39; an order.&quot;
Developer: &quot;Okay, when they submit an order, how do we handle inventory?&quot;
Expert: &quot;We &#39;reserve&#39; inventory for the order. It&#39;s not &#39;allocated&#39; until the order is &#39;confirmed&#39;.&quot;
Developer: &quot;What&#39;s the difference between &#39;reserved&#39; and &#39;allocated&#39;?&quot;
Expert: &quot;Reserved means we&#39;ve set it aside temporarily. Allocated means it&#39;s definitely going to that order and can&#39;t be used elsewhere.&quot;

New terms discovered:
- Submit (not &quot;place&quot;)
- Reserve (temporary)
- Allocate (committed)
- Confirm (distinct state transition)
</code></pre></div>

<p><strong>Phase 2: Refinement</strong></p>
<p><strong>Activities:</strong><br />
1. <strong>Challenge Terminology</strong>: Is this term precise enough? Does it mean one thing? Is it used consistently? Does it work in code?</p>
<ol start="2">
<li>
<p><strong>Resolve Ambiguities</strong>: When experts use the same word differently, when one concept needs multiple terms, when existing terms are vague.</p>
</li>
<li>
<p><strong>Test with Scenarios</strong>: Walk through business processes using only defined terms. Identify gaps. Refine definitions.</p>
</li>
</ol>
<p><strong>Example Refinement:</strong></p>
<div class="codehilite"><pre><span></span><code>Initial: &quot;Process the payment&quot;

Problems:
- &quot;Process&quot; is vague—what does it actually mean?
- Too generic for precise implementation

Refined terms discovered through questioning:
- &quot;Authorize&quot; the payment: Check that funds are available
- &quot;Capture&quot; the payment: Actually charge the card
- &quot;Settle&quot; the payment: Transfer funds from processor to merchant account
- &quot;Refund&quot; the payment: Return funds to customer

Code now has precise methods:
payment.authorize()
payment.capture()
payment.settle()
payment.refund(amount)
</code></pre></div>

<p><strong>Phase 3: Documentation</strong></p>
<p>Document the language in a <strong>Glossary</strong> that evolves with the model.</p>
<p><strong>Glossary Template:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="gu">## Term: Order</span>

<span class="gs">**Definition**</span>: A customer&#39;s request to purchase one or more products

<span class="gs">**Description**</span>:
An Order represents a customer&#39;s intention to buy products.
Orders progress through states: Draft → Submitted → Paid → Fulfilled → Completed.
Each state transition has specific business rules.

<span class="gs">**Synonyms**</span>: None (previously called &quot;Shopping Transaction&quot;—deprecated)

<span class="gs">**Related Terms**</span>:
<span class="k">-</span><span class="w"> </span>OrderLine: Order contains multiple OrderLines
<span class="k">-</span><span class="w"> </span>Customer: Order belongs to a Customer
<span class="k">-</span><span class="w"> </span>Payment: Order associated with Payment

<span class="gs">**States**</span>:
<span class="k">-</span><span class="w"> </span>Draft: Being composed, can be modified
<span class="k">-</span><span class="w"> </span>Submitted: Customer has submitted, awaiting payment
<span class="k">-</span><span class="w"> </span>Paid: Payment confirmed
<span class="k">-</span><span class="w"> </span>Fulfilled: Products shipped
<span class="k">-</span><span class="w"> </span>Completed: Customer received products
<span class="k">-</span><span class="w"> </span>Cancelled: Order cancelled

<span class="gs">**Code Representation**</span>:
<span class="k">-</span><span class="w"> </span>Class: <span class="sb">`Order`</span> (Aggregate Root)
<span class="k">-</span><span class="w"> </span>Methods: <span class="sb">`submit()`</span>, <span class="sb">`addLine()`</span>, <span class="sb">`cancel()`</span>
<span class="k">-</span><span class="w"> </span>Events: <span class="sb">`OrderSubmitted`</span>, <span class="sb">`OrderPaid`</span>, <span class="sb">`OrderFulfilled`</span>

<span class="gs">**Business Rules**</span>:
<span class="k">-</span><span class="w"> </span>Order must have at least one OrderLine to be submitted
<span class="k">-</span><span class="w"> </span>Order cannot be modified after submission (except cancellation)
<span class="k">-</span><span class="w"> </span>Total equals sum of all OrderLine subtotals

<span class="gs">**Last Updated**</span>: 2025-01-24
<span class="gs">**Changed By**</span>: Development Team
<span class="gs">**Reason**</span>: Added &quot;Fulfilled&quot; state to distinguish from &quot;Completed&quot;
</code></pre></div>

<p><strong>Phase 4: Maintenance</strong></p>
<p><strong>Keep Language Alive:</strong><br />
1. <strong>Regular Review</strong>: Language evolves as understanding deepens<br />
2. <strong>Update Code</strong>: Refactor when language changes (rename classes, methods)<br />
3. <strong>Onboard New Members</strong>: Teach the language explicitly to new team members<br />
4. <strong>Challenge Staleness</strong>: Remove obsolete terms<br />
5. <strong>Document Changes</strong>: Track language evolution in glossary</p>
<h3 id="33-language-in-code">3.3 Language in Code<a class="headerlink" href="#33-language-in-code" title="Permanent link">&para;</a></h3>
<p>The power of Ubiquitous Language is realized when it's embedded directly in code structure.</p>
<p><strong>Classes Match Terms</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Domain term: &quot;Customer&quot;</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Customer</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>

<span class="c1">// Domain term: &quot;Order&quot;</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Order</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>

<span class="c1">// Domain term: &quot;Payment Authorization&quot;</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PaymentAuthorization</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>

<span class="c1">// NOT technical abstractions:</span>
<span class="c1">// Bad: public class CustomerEntity { }</span>
<span class="c1">// Bad: public class OrderDTO { }</span>
<span class="c1">// Bad: public class PaymentData { }</span>
</code></pre></div>

<p><strong>Methods Use Domain Verbs</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Experts say &quot;submit an order&quot;</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">submit</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>

<span class="c1">// Experts say &quot;approve a loan application&quot;</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">approve</span><span class="p">(</span><span class="n">ApprovalDecision</span><span class="w"> </span><span class="n">decision</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>

<span class="c1">// Experts say &quot;authorize payment&quot;</span>
<span class="kd">public</span><span class="w"> </span><span class="n">PaymentAuthorization</span><span class="w"> </span><span class="nf">authorize</span><span class="p">(</span><span class="n">Money</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>

<span class="c1">// NOT technical jargon:</span>
<span class="c1">// Bad: public void persist() { }</span>
<span class="c1">// Bad: public void setStatus(int code) { }</span>
<span class="c1">// Bad: public void updateRecord() { }</span>
</code></pre></div>

<p><strong>Avoid Technical Jargon in Domain Layer</strong></p>
<p>Keep technical concerns out of the domain model:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Bad: Technical language leaking into domain</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">persist</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setStatusCode</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">statusCode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<span class="kd">public</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getData</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>

<span class="c1">// Good: Domain language</span>
<span class="n">customerRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">customer</span><span class="p">);</span><span class="w">  </span><span class="c1">// Persistence is infrastructure concern</span>
<span class="n">order</span><span class="p">.</span><span class="na">submit</span><span class="p">();</span><span class="w">  </span><span class="c1">// Use actual business action</span>
<span class="n">product</span><span class="p">.</span><span class="na">specifications</span><span class="p">();</span><span class="w">  </span><span class="c1">// Return domain concept</span>
</code></pre></div>

<p><strong>Package/Module Names Use Domain Terms</strong></p>
<div class="codehilite"><pre><span></span><code>com.company.ecommerce.sales      // &quot;Sales&quot; is domain term
com.company.ecommerce.inventory  // &quot;Inventory&quot; is domain term
com.company.ecommerce.shipping   // &quot;Shipping&quot; is domain term

// NOT technical categories:
// Bad: com.company.ecommerce.entities
// Bad: com.company.ecommerce.services
// Bad: com.company.ecommerce.managers
</code></pre></div>

<p><strong>Value Objects for Domain Concepts</strong></p>
<p>Make concepts explicit as types rather than primitives:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Bad: Primitive obsession</span>
<span class="n">String</span><span class="w"> </span><span class="n">email</span><span class="p">;</span>
<span class="kt">double</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span>
<span class="n">String</span><span class="w"> </span><span class="n">currency</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">zipCode</span><span class="p">;</span>

<span class="c1">// Good: Domain concepts explicit</span>
<span class="n">Email</span><span class="w"> </span><span class="n">email</span><span class="p">;</span><span class="w">           </span><span class="c1">// &quot;Email&quot; is a domain concept with validation</span>
<span class="n">Money</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span><span class="w">          </span><span class="c1">// &quot;Money&quot; combines amount + currency</span>
<span class="n">ZipCode</span><span class="w"> </span><span class="n">zipCode</span><span class="p">;</span><span class="w">       </span><span class="c1">// &quot;ZipCode&quot; has format validation</span>
</code></pre></div>

<p><strong>Enums for Fixed Sets</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">enum</span><span class="w"> </span><span class="n">OrderStatus</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">DRAFT</span><span class="p">,</span><span class="w">      </span><span class="c1">// Customer composing order</span>
<span class="w">    </span><span class="n">SUBMITTED</span><span class="p">,</span><span class="w">  </span><span class="c1">// Awaiting payment</span>
<span class="w">    </span><span class="n">PAID</span><span class="p">,</span><span class="w">       </span><span class="c1">// Payment confirmed</span>
<span class="w">    </span><span class="n">FULFILLED</span><span class="p">,</span><span class="w">  </span><span class="c1">// Products shipped</span>
<span class="w">    </span><span class="n">COMPLETED</span><span class="p">,</span><span class="w">  </span><span class="c1">// Customer received products</span>
<span class="w">    </span><span class="n">CANCELLED</span><span class="w">   </span><span class="c1">// Order cancelled</span>
<span class="p">}</span>

<span class="c1">// NOT generic codes:</span>
<span class="c1">// Bad: public enum Status { STATUS_1, STATUS_2, STATUS_3 }</span>
</code></pre></div>

<p><strong>Comments in Domain Language</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Business rule: Orders below minimum must be rejected</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">total</span><span class="p">.</span><span class="na">isLessThan</span><span class="p">(</span><span class="n">Money</span><span class="p">.</span><span class="na">minimumOrder</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BelowMinimumOrderException</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// Policy: Customers with overdue invoices cannot place new orders</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">customer</span><span class="p">.</span><span class="na">hasOverdueInvoices</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CustomerCreditHoldException</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// NOT technical comments:</span>
<span class="c1">// Bad: // Check if value is less than constant</span>
<span class="c1">// Bad: // Throw exception if condition is true</span>
</code></pre></div>

<h3 id="34-language-evolution">3.4 Language Evolution<a class="headerlink" href="#34-language-evolution" title="Permanent link">&para;</a></h3>
<p>Ubiquitous Language is not static—it evolves as domain understanding deepens.</p>
<p><strong>Recognizing Need for Change</strong></p>
<p>Signs that language needs refinement:<br />
- Team members use different terms for the same concept<br />
- Developers translate between code terms and conversation terms<br />
- Expert corrections are frequent<br />
- Terms are ambiguous or overloaded<br />
- New understanding of the domain emerges<br />
- Code becomes awkward or convoluted</p>
<p><strong>Managing Change</strong></p>
<p><strong>Process:</strong><br />
1. <strong>Identify Issue</strong>: Term is unclear, incorrect, or causing confusion<br />
2. <strong>Propose Change</strong>: Suggest better term based on expert input<br />
3. <strong>Validate with Experts</strong>: Does the new term work? Do they use it naturally?<br />
4. <strong>Update Glossary</strong>: Document the change with rationale<br />
5. <strong>Refactor Code</strong>: Rename classes, methods, variables to match<br />
6. <strong>Communicate</strong>: Tell the team about the change<br />
7. <strong>Deprecate Old Term</strong>: Mark old usage as deprecated</p>
<p><strong>Example Evolution:</strong></p>
<div class="codehilite"><pre><span></span><code>Version 1: &quot;Transaction&quot; (too vague, could mean anything)
   ↓ Team realizes this is unclear
Version 2: &quot;Sale&quot; (closer, but experts correct this)
   ↓ Experts say &quot;we call them orders, not sales&quot;
Version 3: &quot;Order&quot; (correct term experts actually use)

Code evolution:
class Transaction { }  → class Sale { }  → class Order { }
processTransaction()   → completeSale()  → submitOrder()
</code></pre></div>

<p><strong>Deprecation Process</strong></p>
<p>When removing terms:<br />
1. Mark as deprecated in glossary<br />
2. Note replacement term<br />
3. Set deadline for migration<br />
4. Track remaining usages<br />
5. Remove from glossary when fully migrated</p>
<div class="codehilite"><pre><span></span><code><span class="gu">## Term: Shopping Transaction [DEPRECATED]</span>

<span class="gs">**Status**</span>: Deprecated as of 2025-01-10
<span class="gs">**Replacement**</span>: Use &quot;Order&quot; instead
<span class="gs">**Reason**</span>: Domain experts consistently use &quot;Order&quot;, not &quot;Transaction&quot;
<span class="gs">**Migration Deadline**</span>: 2025-02-01
<span class="gs">**Remaining Usages**</span>: 3 (see ticket <span class="ni">#1234</span>)
</code></pre></div>

<h3 id="35-integration-with-other-ddd-patterns">3.5 Integration with Other DDD Patterns<a class="headerlink" href="#35-integration-with-other-ddd-patterns" title="Permanent link">&para;</a></h3>
<p><strong>With Bounded Contexts</strong></p>
<ul>
<li>Each Bounded Context has its own Ubiquitous Language</li>
<li>The same term may mean different things in different contexts (and that's OK!)</li>
<li>Explicitly document translations between contexts</li>
</ul>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code>In Sales Context:
- &quot;Product&quot; = Item for sale (price, description, promotions)

In Inventory Context:
- &quot;Product&quot; = Stock item (SKU, quantity, warehouse location)

In Shipping Context:
- &quot;Product&quot; = Item to ship (weight, dimensions, fragility)

→ Same word, three different models in three contexts
→ Context boundaries make this explicit and manageable
</code></pre></div>

<p><strong>With Aggregates</strong></p>
<ul>
<li>Aggregate names come from ubiquitous language</li>
<li>Methods on aggregates use domain verbs</li>
<li>Events raised are named in domain terms (past tense)</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Order</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// &quot;Order&quot; from ubiquitous language</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">submit</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// &quot;submit&quot; from ubiquitous language</span>
<span class="w">        </span><span class="c1">// ... business logic</span>
<span class="w">        </span><span class="n">events</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">OrderSubmitted</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="p">));</span><span class="w">  </span><span class="c1">// &quot;OrderSubmitted&quot; event</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>With Domain Events</strong></p>
<ul>
<li>Event names are past-tense domain actions</li>
<li>Use domain language, not technical language</li>
<li>Include domain-relevant data, not technical IDs</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="c1">// Good: Domain language</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderSubmitted</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">DomainEvent</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">OrderId</span><span class="w"> </span><span class="n">orderId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">CustomerId</span><span class="w"> </span><span class="n">customerId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="n">totalAmount</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Bad: Technical language</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderSubmitEvent</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">entityId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">statusCode</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>With Testing</strong></p>
<p>Tests should read like business specifications using ubiquitous language:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Test</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">customer_cannot_submit_empty_order</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Given</span>
<span class="w">    </span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Order</span><span class="p">(</span><span class="n">customerId</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// No lines added</span>

<span class="w">    </span><span class="c1">// When/Then</span>
<span class="w">    </span><span class="n">assertThrows</span><span class="p">(</span><span class="n">EmptyOrderException</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">submit</span><span class="p">());</span>
<span class="p">}</span>

<span class="nd">@Test</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">order_reserves_inventory_when_submitted</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Given</span>
<span class="w">    </span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createOrderWith</span><span class="p">(</span><span class="n">product</span><span class="p">,</span><span class="w"> </span><span class="n">quantity</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// When</span>
<span class="w">    </span><span class="n">order</span><span class="p">.</span><span class="na">submit</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Then</span>
<span class="w">    </span><span class="n">verify</span><span class="p">(</span><span class="n">inventoryService</span><span class="p">).</span><span class="na">reserve</span><span class="p">(</span><span class="n">product</span><span class="p">,</span><span class="w"> </span><span class="n">quantity</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="36-common-pitfalls">3.6 Common Pitfalls<a class="headerlink" href="#36-common-pitfalls" title="Permanent link">&para;</a></h3>
<p><strong>1. Technical Terms in Domain</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Bad: Don&#39;t do this:</span>
<span class="n">customer</span><span class="p">.</span><span class="na">persist</span><span class="p">();</span>
<span class="n">order</span><span class="p">.</span><span class="na">setStatusCode</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="n">product</span><span class="p">.</span><span class="na">getData</span><span class="p">();</span>
<span class="n">entity</span><span class="p">.</span><span class="na">update</span><span class="p">(</span><span class="n">map</span><span class="p">);</span>

<span class="c1">// Good: Do this:</span>
<span class="n">customerRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">customer</span><span class="p">);</span><span class="w">  </span><span class="c1">// Persistence is infrastructure</span>
<span class="n">order</span><span class="p">.</span><span class="na">submit</span><span class="p">();</span><span class="w">  </span><span class="c1">// Domain action</span>
<span class="n">product</span><span class="p">.</span><span class="na">specifications</span><span class="p">();</span><span class="w">  </span><span class="c1">// Domain concept</span>
<span class="n">order</span><span class="p">.</span><span class="na">changeAddress</span><span class="p">(</span><span class="n">newAddress</span><span class="p">);</span><span class="w">  </span><span class="c1">// Specific domain operation</span>
</code></pre></div>

<p><strong>2. Ambiguous Terms</strong></p>
<p>Problem: "Process" the order (what does "process" mean exactly?)</p>
<p>Solution: Be specific:<br />
- submit the order<br />
- fulfill the order<br />
- ship the order<br />
- complete the order<br />
- cancel the order</p>
<p>Each has distinct meaning and different business rules.</p>
<p><strong>3. Developer-Only Language</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ❌ Bad: Terms experts don&#39;t recognize</span>
<span class="kd">class</span> <span class="nc">OrderDTO</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<span class="kd">class</span> <span class="nc">OrderEntity</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<span class="kd">class</span> <span class="nc">OrderManager</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<span class="kd">class</span> <span class="nc">OrderHelper</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>

<span class="c1">// ✓ Good: Domain terms</span>
<span class="kd">class</span> <span class="nc">Order</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w">  </span><span class="c1">// The concept itself</span>
<span class="kd">class</span> <span class="nc">OrderRepository</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w">  </span><span class="c1">// DDD pattern name</span>
<span class="kd">class</span> <span class="nc">OrderService</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w">  </span><span class="c1">// If &quot;service&quot; is a domain term</span>
</code></pre></div>

<p><strong>4. Expert Jargon Without Clarity</strong></p>
<p>Problem: Using insider terms without defining them clearly</p>
<p>Solution: Define even "obvious" terms:<br />
- What exactly is a "submission"? (When does it happen? What changes?)<br />
- When is an order "confirmed" vs "completed"? (Distinct states? Same thing?)<br />
- What makes inventory "available" vs "reserved"? (Clear criteria needed)</p>
<p><strong>5. Stale Language</strong></p>
<p>Problem: Code uses old terms after domain understanding has evolved</p>
<p>Solution: Continuous refactoring to match current understanding. Language evolution is normal and healthy—embrace it.</p>
<h3 id="37-practical-techniques">3.7 Practical Techniques<a class="headerlink" href="#37-practical-techniques" title="Permanent link">&para;</a></h3>
<p><strong>Event Storming</strong></p>
<p>Process:<br />
1. Gather domain experts and developers<br />
2. Identify Domain Events (things that happen): "OrderSubmitted," "PaymentAuthorized"<br />
3. Place events on timeline<br />
4. Identify commands that trigger events: "SubmitOrder," "AuthorizePayment"<br />
5. Identify Aggregates that handle commands: "Order," "Payment"<br />
6. Group into Bounded Contexts</p>
<p>Output: Events, commands, and Aggregates are all named using Ubiquitous Language.</p>
<p><strong>Domain Storytelling</strong></p>
<p>Process:<br />
1. Expert tells story of a domain process<br />
2. Developers illustrate with simple icons<br />
3. Identify actors, work objects, activities<br />
4. Map out the sequence</p>
<p>Example:</p>
<div class="codehilite"><pre><span></span><code>&quot;A Customer browses the Catalog and adds Products to their Shopping Cart.
When ready, they submit their Order. The system reserves Inventory and
authorizes Payment. Once authorized, the Order is confirmed and sent to
the Warehouse for fulfillment.&quot;

Terms discovered:
- Actors: Customer, System, Warehouse
- Work Objects: Catalog, Product, Shopping Cart, Order, Inventory, Payment
- Actions: browse, add, submit, reserve, authorize, confirm, fulfill
</code></pre></div>

<p><strong>Example Mapping</strong></p>
<p>Process:<br />
1. Start with user story or feature<br />
2. Provide concrete examples<br />
3. Identify business rules<br />
4. Surface questions</p>
<div class="codehilite"><pre><span></span><code>Story: Customer submits order

Examples:
- Happy path: Customer submits order with valid payment → Order confirmed
- Alternative: Customer submits but payment fails → Order remains in Submitted state
- Edge case: Customer submits at exactly midnight → Use submission timestamp

Rules:
- Order must have at least one item
- Payment must be authorized
- Inventory must be available

Questions:
- What happens if inventory becomes unavailable after payment authorization?
- Can customer modify order after submission? (Answer: No, must cancel and resubmit)
</code></pre></div>

<h3 id="38-cross-context-term-mapping">3.8 Cross-Context Term Mapping<a class="headerlink" href="#38-cross-context-term-mapping" title="Permanent link">&para;</a></h3>
<p>When the same term appears in multiple contexts with different meanings, document the translations:</p>
<div class="codehilite"><pre><span></span><code><span class="gh"># Term Translations Between Contexts</span>

<span class="gu">## &quot;Product&quot;</span>

<span class="gs">**In Sales Context:**</span>
<span class="k">-</span><span class="w"> </span>Meaning: Item for sale, customer-facing view
<span class="k">-</span><span class="w"> </span>Attributes: name, price, description, category, images, reviews
<span class="k">-</span><span class="w"> </span>Focus: Marketing and selling

<span class="gs">**In Inventory Context:**</span>
<span class="k">-</span><span class="w"> </span>Meaning: Physical stock item with location tracking
<span class="k">-</span><span class="w"> </span>Attributes: SKU, quantity_on_hand, warehouse_location, reorder_point
<span class="k">-</span><span class="w"> </span>Focus: Stock management

<span class="gs">**In Shipping Context:**</span>
<span class="k">-</span><span class="w"> </span>Meaning: Item to ship with physical dimensions
<span class="k">-</span><span class="w"> </span>Attributes: dimensions, weight, fragility, hazard_class
<span class="k">-</span><span class="w"> </span>Focus: Logistics and shipping

<span class="gs">**Translation**</span>:
<span class="k">-</span><span class="w"> </span>Sales.Product.id maps to Inventory.Product.sku
<span class="k">-</span><span class="w"> </span>Different models for different purposes
<span class="k">-</span><span class="w"> </span>Integration via Context Mapping patterns
</code></pre></div>

<h3 id="39-success-metrics">3.9 Success Metrics<a class="headerlink" href="#39-success-metrics" title="Permanent link">&para;</a></h3>
<p><strong>Language is working when:</strong></p>
<p>✓ Domain experts recognize code structure conceptually<br />
✓ Developers and experts use same terminology in meetings<br />
✓ No translation needed in conversations between teams<br />
✓ New team members learn language quickly (onboarding includes glossary)<br />
✓ Code changes map directly to business changes<br />
✓ Tests read like business specifications<br />
✓ Feature discussions reference actual class/method names</p>
<p><strong>Language needs work when:</strong></p>
<p>✗ Frequent misunderstandings in meetings<br />
✗ Code uses different terms than spoken conversations<br />
✗ Glossary is out of date or ignored<br />
✗ Multiple terms exist for the same concept<br />
✗ Terms are ambiguous or overloaded<br />
✗ Developers avoid using domain terms in code</p>
<p><strong>The Ultimate Test</strong>: Can a domain expert read the test suite and understand what the system does? If yes, you have achieved ubiquitous language.</p>
<hr />
<h2 id="part-i-summary">Part I Summary<a class="headerlink" href="#part-i-summary" title="Permanent link">&para;</a></h2>
<p>Part I established the <strong>strategic foundations</strong> of Domain-Driven Design:</p>
<p><strong>Section 1: Introduction &amp; DDD Philosophy</strong><br />
- DDD solves complexity through model-driven design<br />
- Ubiquitous language bridges business and code<br />
- Strategic and tactical patterns work together<br />
- Use DDD for complex domains with engaged experts</p>
<p><strong>Section 2: Strategic Design Patterns</strong><br />
- <strong>System</strong>: Root object organizing all strategic elements<br />
- <strong>Domains &amp; Subdomains</strong>: Core, Supporting, Generic classification drives investment<br />
- <strong>Bounded Contexts</strong>: Explicit boundaries where models apply<br />
- <strong>Context Mapping</strong>: Integration patterns for managing relationships<br />
- <strong>Integration Patterns</strong>: Partnership, Shared Kernel, Customer/Supplier, Conformist, ACL, Open Host Service, Published Language, Separate Ways, Big Ball of Mud</p>
<p><strong>Section 3: Ubiquitous Language</strong><br />
- Common language shared by developers and experts<br />
- Embedded directly in code structure<br />
- Evolves as understanding deepens<br />
- One language per Bounded Context<br />
- Enables precision and shared understanding</p>
<p><strong>What's Next</strong>: Part II introduces <strong>Domain Storytelling</strong>, a collaborative discovery technique that helps teams identify Bounded Contexts, surface Ubiquitous Language, and understand business processes before diving into tactical implementation.</p>
<hr />
<h1 id="part-ii-discovery-modeling_1">Part II: Discovery &amp; Modeling<a class="headerlink" href="#part-ii-discovery-modeling_1" title="Permanent link">&para;</a></h1>
<h2 id="4-domain-storytelling">4. Domain Storytelling<a class="headerlink" href="#4-domain-storytelling" title="Permanent link">&para;</a></h2>
<p>Before diving into tactical implementation patterns (Aggregates, Entities, Repositories), we need to understand the domain deeply. <strong>Domain Storytelling</strong> is a collaborative technique that helps teams discover domain knowledge, surface Ubiquitous Language, and identify Bounded Context boundaries through narrative.</p>
<blockquote>
<p>"Domain Storytelling is a collaborative Domain-Driven Design technique used to capture and visualize business processes as stories involving actors, activities, and work objects."<br />
— Stefan Hofer and Henning Schwentner, <em>Domain Storytelling</em> (2021)</p>
</blockquote>
<p><strong>Positioning in DDD Practice:</strong></p>
<div class="codehilite"><pre><span></span><code>Discovery → Strategic → Tactical
   ↓           ↓          ↓
Domain     Bounded     Aggregates
Storytelling Contexts  &amp; Entities
</code></pre></div>

<p>Domain Storytelling occurs <strong>early</strong> in the DDD journey, before you've identified Bounded Contexts or modeled Aggregates. It's a discovery technique that feeds into strategic design.</p>
<h3 id="41-what-is-domain-storytelling">4.1 What is Domain Storytelling?<a class="headerlink" href="#41-what-is-domain-storytelling" title="Permanent link">&para;</a></h3>
<p><strong>Definition</strong>: Domain Storytelling is a workshop-based technique where domain experts tell stories about their work, and developers capture those stories using a simple visual notation.</p>
<p><strong>Core Philosophy:</strong></p>
<p>People naturally think and communicate in stories, not in abstract models. When you ask a domain expert "How does order processing work?", they don't give you a class diagram—they tell you a story:</p>
<div class="codehilite"><pre><span></span><code>&quot;A Customer selects products from the catalog, adds them to their shopping cart,
reviews the cart, and submits the order. The system validates inventory availability,
reserves the items, and sends the order to the payment system. Once payment is
authorized, we confirm the order and send it to the warehouse for fulfillment...&quot;
</code></pre></div>

<p>This narrative reveals:<br />
- <strong>Actors</strong>: Customer, System, Payment System, Warehouse<br />
- <strong>Activities</strong>: selects, adds, reviews, submits, validates, reserves, sends, authorizes, confirms<br />
- <strong>Work Objects</strong>: products, catalog, shopping cart, order, inventory, payment<br />
- <strong>Sequence</strong>: natural flow of events<br />
- <strong>Rules</strong>: implied constraints (inventory must be available, payment must be authorized)</p>
<p>Domain Storytelling formalizes this natural storytelling into a structured technique that produces artifacts useful for DDD.</p>
<p><strong>Why It Works:</strong></p>
<ol>
<li>
<p><strong>Natural Communication</strong>: Stories are how humans share knowledge. Domain experts are comfortable telling stories about their work.</p>
</li>
<li>
<p><strong>Concrete Over Abstract</strong>: Stories use concrete scenarios, not abstract concepts. "Customer submits order" is easier to discuss than "Order aggregate state transitions."</p>
</li>
<li>
<p><strong>Reveals Hidden Knowledge</strong>: The act of telling a story surfaces details experts take for granted but developers need to know.</p>
</li>
<li>
<p><strong>Shared Understanding</strong>: Everyone (experts and developers) can follow a story. It creates common ground.</p>
</li>
<li>
<p><strong>Discovery Tool</strong>: Stories reveal domain structure—what the actors are, what they do, what they work with, and how things relate.</p>
</li>
</ol>
<p><strong>Relationship to Other Discovery Techniques:</strong></p>
<table>
<thead>
<tr>
<th>Technique</th>
<th>Focus</th>
<th>Output</th>
<th>Best For</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Domain Storytelling</strong></td>
<td>Actor-centered narratives</td>
<td>Stories with sequence</td>
<td>Understanding processes and workflows</td>
</tr>
<tr>
<td><strong>Event Storming</strong></td>
<td>Event-centered exploration</td>
<td>Timeline of events</td>
<td>Discovering Domain Events and commands</td>
</tr>
<tr>
<td><strong>Example Mapping</strong></td>
<td>Rule-centered</td>
<td>Examples and rules</td>
<td>Refining specific behaviors and edge cases</td>
</tr>
<tr>
<td><strong>User Story Mapping</strong></td>
<td>User journey-centered</td>
<td>Journey maps</td>
<td>Product planning and feature prioritization</td>
</tr>
</tbody>
</table>
<p>Domain Storytelling and Event Storming are complementary. Domain Storytelling provides narrative structure; Event Storming focuses on temporal flow and events. Many teams use both.</p>
<h3 id="42-core-notation-actor-activity-work-object">4.2 Core Notation: Actor-Activity-Work Object<a class="headerlink" href="#42-core-notation-actor-activity-work-object" title="Permanent link">&para;</a></h3>
<p>Now that we understand what Domain Storytelling is and why it works, let's explore the notation used to capture these stories. The notation is deliberately simple so that both domain experts and developers can use it effectively without training.</p>
<p>Domain Storytelling uses a simple pictographic notation that's easy to learn and doesn't require special tools.</p>
<p><strong>Basic Pattern:</strong></p>
<div class="codehilite"><pre><span></span><code>[Actor] → [Activity] → [Work Object]
</code></pre></div>

<p>An <strong>Actor</strong> performs an <strong>Activity</strong> on/with a <strong>Work Object</strong>.</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code>Customer → submits → Order
   ↓
System → validates → Order
   ↓
System → reserves → Inventory
</code></pre></div>

<p><strong>Visual Representation:</strong></p>
<p>In practice, teams use:<br />
- <strong>Sticky notes</strong> on a whiteboard (different colors for actors, activities, work objects)<br />
- <strong>Drawing tools</strong> like Miro, Mural, or draw.io<br />
- <strong>Specialized tools</strong> like Egon.io (built specifically for Domain Storytelling)</p>
<p>The notation has four core elements that work together to capture complete business processes.</p>
<h4 id="actors-who-performs-actions">Actors: Who Performs Actions<a class="headerlink" href="#actors-who-performs-actions" title="Permanent link">&para;</a></h4>
<p>Actors are people, systems, or roles that perform actions.</p>
<p><strong>Types of Actors</strong> (from schema <code>kind</code> field):<br />
- <strong>Person</strong>: Individual humans (Customer, Manager, Operator)<br />
- <strong>System</strong>: Automated systems (Payment System, Notification Service)<br />
- <strong>Role</strong>: Generic actor type by permission (Administrator, Guest)</p>
<p><strong>Visual Convention</strong>:<br />
- Persons: Stick figure<br />
- Systems: Rectangle or computer icon<br />
- Roles: Stick figure with label or badge</p>
<p><strong>Naming</strong>: Use terms from ubiquitous language. If domain experts say "Customer," use Customer (not User or Client).</p>
<p><strong>Schema Representation</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">actors</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">actor_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">act_customer</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Customer&quot;</span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">person</span>
<span class="w">    </span><span class="c1"># ...</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">actor_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">act_payment_system</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Payment</span><span class="nv"> </span><span class="s">System&quot;</span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">system</span>
<span class="w">    </span><span class="c1"># ...</span>
</code></pre></div>

<p>With actors defined, we can now describe what actions they perform.</p>
<h4 id="activities-what-actions-occur">Activities: What Actions Occur<a class="headerlink" href="#activities-what-actions-occur" title="Permanent link">&para;</a></h4>
<p>Activities are actions that change state or produce results.</p>
<p><strong>Naming Convention</strong>:<br />
- <strong>Verb or verb phrase</strong><br />
- <strong>Present tense</strong>: "submits" not "submitted"<br />
- <strong>Active voice</strong>: "Customer submits" not "order is submitted"<br />
- <strong>Domain language</strong>: Use exact terms experts use</p>
<p><strong>Examples</strong>: submits order, approves loan, calculates price, sends notification, reserves inventory, authorizes payment</p>
<p><strong>Schema Representation</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">activities</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">activity_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actv_submit_order</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Submit</span><span class="nv"> </span><span class="s">Order&quot;</span>
<span class="w">    </span><span class="nt">initiated_by_actor_ids</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">act_customer</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">uses_work_object_ids</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">wobj_shopping_cart</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">wobj_order</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="c1"># ...</span>
</code></pre></div>

<p>Activities connect actors to work objects and produce events. They may also trigger commands or call application services.</p>
<h4 id="work-objects-what-is-manipulated">Work Objects: What Is Manipulated<a class="headerlink" href="#work-objects-what-is-manipulated" title="Permanent link">&para;</a></h4>
<p>Work Objects are domain artifacts that actors manipulate.</p>
<p><strong>Characteristics</strong>:<br />
- <strong>Nouns</strong> from ubiquitous language<br />
- Can be tangible (Product, Invoice, Package) or abstract (Order, Approval, Reservation)<br />
- May evolve into <strong>Entities</strong> or <strong>Value Objects</strong> during tactical modeling<br />
- May map to <strong>Aggregates</strong></p>
<p><strong>Examples</strong>: Order, Invoice, Contract, Product, Shopping Cart, Customer Profile, Payment, Shipment</p>
<p><strong>Schema Representation</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">work_objects</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">work_object_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wobj_order</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Order&quot;</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Customer</span><span class="nv"> </span><span class="s">purchase</span><span class="nv"> </span><span class="s">request&quot;</span>
<span class="w">    </span><span class="nt">attributes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">order_id</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">uuid</span>
<span class="w">      </span><span class="c1"># ...</span>
<span class="w">    </span><span class="nt">aggregate_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agg_order</span><span class="w">  </span><span class="c1"># May reference future aggregate</span>
</code></pre></div>

<p><strong>Attributes</strong> capture what's important about the work object in the story context. Don't over-specify—enough to understand the object, not full implementation.</p>
<p>Finally, we need to capture the order in which activities occur.</p>
<h4 id="sequence-the-order-of-events">Sequence: The Order of Events<a class="headerlink" href="#sequence-the-order-of-events" title="Permanent link">&para;</a></h4>
<p>Stories have sequence: one thing happens, then another.</p>
<p><strong>Notation</strong>:<br />
- Number the activities: 1, 2, 3, 4...<br />
- Arrows show flow<br />
- Branches show alternatives ("If payment fails...")</p>
<p><strong>Example Sequence</strong>:</p>
<div class="codehilite"><pre><span></span><code>1. Customer → selects → Product
2. Customer → adds to → Shopping Cart
3. Customer → reviews → Shopping Cart
4. Customer → submits → Order
5. System → validates → Order
6. System → reserves → Inventory
7. System → requests → Payment Authorization
8. Payment System → authorizes → Payment
9. System → confirms → Order
10. System → sends to → Warehouse
</code></pre></div>

<p><strong>Branching for Alternatives</strong>:</p>
<div class="codehilite"><pre><span></span><code>5. System → validates → Order
   ├─ If valid:
   │  6. System → reserves → Inventory
   └─ If invalid:
      6. System → rejects → Order
</code></pre></div>

<h3 id="43-commands-queries-events-and-policies">4.3 Commands, Queries, Events, and Policies<a class="headerlink" href="#43-commands-queries-events-and-policies" title="Permanent link">&para;</a></h3>
<p>Domain Storytelling integrates naturally with CQRS (Command Query Responsibility Segregation) concepts.</p>
<p><strong>4.3.1 Commands</strong></p>
<p><strong>Commands</strong> express user intent—requests that change state.</p>
<p><strong>Characteristics</strong>:<br />
- <strong>Imperative</strong>: "Submit Order," "Approve Loan," "Cancel Reservation"<br />
- <strong>Initiated by actors</strong>: Commands come from people or systems<br />
- <strong>May fail</strong>: Business rules can reject commands<br />
- <strong>Target aggregates</strong>: Commands operate on domain objects</p>
<p><strong>Schema Representation</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">commands</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmd_submit_order</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Submit</span><span class="nv"> </span><span class="s">Order&quot;</span>
<span class="w">    </span><span class="nt">actor_ids</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">act_customer</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">target_aggregate_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agg_order</span>
<span class="w">    </span><span class="nt">parameters</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">order_id</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">uuid</span>
<span class="w">        </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">payment_method</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ref</span>
<span class="w">        </span><span class="nt">ref_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wobj_payment_method</span>
<span class="w">    </span><span class="nt">emits_events</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">evt_order_submitted</span><span class="p p-Indicator">]</span>
</code></pre></div>

<p><strong>In Stories</strong>: Commands are the activities that actors initiate.</p>
<div class="codehilite"><pre><span></span><code>Customer → submits → Order
   ↓ (This activity corresponds to SubmitOrder command)
</code></pre></div>

<p><strong>4.3.2 Queries</strong></p>
<p><strong>Queries</strong> request information without changing state.</p>
<p><strong>Characteristics</strong>:<br />
- <strong>Interrogative or declarative</strong>: "Get Order Status," "View Product Catalog"<br />
- <strong>Read-only</strong>: No side effects<br />
- <strong>Return data</strong>: Return read models or DTOs<br />
- <strong>May join data</strong>: Can aggregate from multiple sources</p>
<p><strong>Schema Representation</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">queries</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">query_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qry_get_order_status</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Get</span><span class="nv"> </span><span class="s">Order</span><span class="nv"> </span><span class="s">Status&quot;</span>
<span class="w">    </span><span class="nt">actor_ids</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">act_customer</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">parameters</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">order_id</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">uuid</span>
<span class="w">        </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">returns_read_model_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rmdl_order_summary</span>
</code></pre></div>

<p><strong>In Stories</strong>: Query activities are reads, not writes.</p>
<div class="codehilite"><pre><span></span><code>Customer → views → Order Status
   ↓ (This corresponds to GetOrderStatus query)
</code></pre></div>

<p><strong>4.3.3 Events</strong></p>
<p><strong>Events</strong> represent facts—things that have happened.</p>
<p><strong>Characteristics</strong>:<br />
- <strong>Past tense</strong>: "Order Submitted," "Payment Authorized," "Inventory Reserved"<br />
- <strong>Immutable</strong>: Events cannot be changed (they're historical facts)<br />
- <strong>Caused by activities</strong>: Events result from successful commands<br />
- <strong>Trigger reactions</strong>: May trigger policies or other processes</p>
<p><strong>Schema Representation</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">events</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">event_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">evt_order_submitted</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Order</span><span class="nv"> </span><span class="s">Submitted&quot;</span>
<span class="w">    </span><span class="nt">caused_by</span><span class="p">:</span>
<span class="w">      </span><span class="nt">command_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmd_submit_order</span>
<span class="w">    </span><span class="nt">affected_aggregate_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agg_order</span>
<span class="w">    </span><span class="nt">data_attributes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">order_id</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">uuid</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customer_id</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">uuid</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">total_amount</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">money</span>
<span class="w">    </span><span class="nt">policies_triggered</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">pol_send_confirmation_email</span><span class="p p-Indicator">]</span>
</code></pre></div>

<p><strong>In Stories</strong>: Events are outcomes of activities.</p>
<div class="codehilite"><pre><span></span><code>Customer → submits → Order
   ↓ (Results in event)
[OrderSubmitted] event published
   ↓ (Triggers policy)
System → sends → Confirmation Email
</code></pre></div>

<p><strong>4.3.4 Policies</strong></p>
<p><strong>Policies</strong> create reactive rules: "When [Event] happens, do [Action]."</p>
<p><strong>Pattern</strong>: "When X, do Y"</p>
<p><strong>Examples</strong>:<br />
- "When Order Submitted, send confirmation email"<br />
- "When Payment Failed, notify customer"<br />
- "When Inventory Low, create reorder request"</p>
<p><strong>Schema Representation</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">policies</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">policy_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pol_send_confirmation</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Send</span><span class="nv"> </span><span class="s">Order</span><span class="nv"> </span><span class="s">Confirmation</span><span class="nv"> </span><span class="s">Email&quot;</span>
<span class="w">    </span><span class="nt">when_event_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">evt_order_submitted</span>
<span class="w">    </span><span class="nt">issues_command_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmd_send_email</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Automatically</span><span class="nv"> </span><span class="s">send</span><span class="nv"> </span><span class="s">confirmation</span><span class="nv"> </span><span class="s">when</span><span class="nv"> </span><span class="s">order</span><span class="nv"> </span><span class="s">submitted&quot;</span>
</code></pre></div>

<p><strong>In Stories</strong>: Policies connect events to subsequent actions.</p>
<div class="codehilite"><pre><span></span><code>[OrderSubmitted] → triggers → Send Confirmation Policy
   ↓
System → sends → Confirmation Email (via SendEmail command)
</code></pre></div>

<p><strong>Causal Chain</strong>:</p>
<p>The complete flow:</p>
<div class="codehilite"><pre><span></span><code>Actor → initiates Command
   ↓
Command → produces Event
   ↓
Event → triggers Policy
   ↓
Policy → issues new Command
   ↓
(Cycle continues...)
</code></pre></div>

<p>This creates a <strong>causal chain</strong> that traces through the entire system.</p>
<h3 id="44-workshop-facilitation">4.4 Workshop Facilitation<a class="headerlink" href="#44-workshop-facilitation" title="Permanent link">&para;</a></h3>
<p>Domain Storytelling happens in facilitated workshops with domain experts and developers.</p>
<p><strong>Workshop Setup</strong></p>
<p><strong>Duration</strong>: 2-4 hours per domain area (may require multiple sessions for complex domains)</p>
<p><strong>Participants</strong>:<br />
- <strong>Domain Experts</strong>: 2-3 people with deep domain knowledge<br />
- <strong>Developers</strong>: 2-4 developers who will implement the system<br />
- <strong>Facilitator</strong>: 1 person (ideally experienced with Domain Storytelling)<br />
- <strong>Stakeholders</strong>: 0-2 (optional, for context)</p>
<p><strong>Materials</strong>:<br />
- <strong>Whiteboard</strong> or digital board (Miro, Mural, Egon.io)<br />
- <strong>Sticky notes</strong> in 3 colors (actors, activities, work objects)<br />
- <strong>Markers</strong><br />
- <strong>Camera</strong> for documentation<br />
- <strong>Laptop</strong> for notes</p>
<p><strong>Workshop Flow</strong></p>
<p><strong>Phase 1: Warm-Up (15 minutes)</strong></p>
<ol>
<li><strong>Explain the notation</strong>: Show examples of Actor → Activity → Work Object</li>
<li><strong>Pick simple example</strong>: "Customer buys coffee" or similar trivial story</li>
<li><strong>Practice together</strong>: Have the group walk through the simple story</li>
<li><strong>Answer questions</strong>: Make sure everyone understands the notation</li>
</ol>
<p><strong>Phase 2: Story Discovery (60-90 minutes)</strong></p>
<ol>
<li>
<p><strong>Pick a business scenario</strong>: Start with a core, common process<br />
   - "How does a customer place an order?"<br />
   - "What happens when a loan application is submitted?"<br />
   - "How do we onboard a new employee?"</p>
</li>
<li>
<p><strong>Start with the actor</strong>: "Who initiates this process?"<br />
   - Expert: "The Customer starts by..."</p>
</li>
<li>
<p><strong>Follow the flow</strong>: Ask "Then what?" repeatedly<br />
   - "What does the Customer do first?"<br />
   - "What happens to the Order?"<br />
   - "Then what?"<br />
   - "Who does that?"<br />
   - "What are they working with?"</p>
</li>
<li>
<p><strong>Capture on board</strong> as you go:<br />
   - Place actor sticky note<br />
   - Add activity<br />
   - Add work object<br />
   - Draw arrow showing flow<br />
   - Number the sequence</p>
</li>
<li>
<p><strong>Clarify terminology</strong>: When a new term appears, ask:<br />
   - "What exactly is an 'Order'?"<br />
   - "Is 'reserved' different from 'allocated'?"<br />
   - "When you say 'submit,' what changes?"</p>
</li>
<li>
<p><strong>Capture exceptions and variations</strong>:<br />
   - "What if payment fails?"<br />
   - "Are there different types of orders?"<br />
   - "Can this step be skipped?"</p>
</li>
</ol>
<p><strong>Phase 3: Refinement (30-45 minutes)</strong></p>
<ol>
<li><strong>Review the story flow</strong>: Read it back to experts</li>
<li><strong>Add missing details</strong>: Identify gaps</li>
<li><strong>Clarify work object definitions</strong>: What attributes matter?</li>
<li><strong>Identify events</strong>: What facts does the story produce?</li>
<li><strong>Discover policies and rules</strong>: What happens automatically?</li>
<li><strong>Consistent naming</strong>: Ensure terms match expert language</li>
</ol>
<p><strong>Phase 4: Analysis (30-45 minutes)</strong></p>
<ol>
<li><strong>Identify linguistic boundaries</strong>: Where do terms change meaning?</li>
<li><strong>Look for context candidates</strong>: Natural groupings of concepts</li>
<li><strong>Find natural seams</strong>: Where could the system be separated?</li>
<li><strong>Discuss groupings</strong>: Which activities belong together?</li>
</ol>
<p><strong>Facilitation Tips</strong></p>
<p><strong>DO:</strong><br />
- ✓ Let domain experts lead the narrative<br />
- ✓ Focus on real, concrete scenarios (not hypotheticals)<br />
- ✓ Use exact terminology from experts<br />
- ✓ Ask "then what?" repeatedly to surface sequence<br />
- ✓ Capture exceptions and edge cases<br />
- ✓ Look for event triggers and policies</p>
<p><strong>DON'T:</strong><br />
- ✗ Jump to implementation details<br />
- ✗ Use technical jargon or UML notation<br />
- ✗ Rush through the story<br />
- ✗ Ignore edge cases or alternatives<br />
- ✗ Impose your understanding on the experts<br />
- ✗ Skip variations ("usually" means there are exceptions!)</p>
<p><strong>Key Questions to Ask</strong></p>
<p><strong>Discovery Questions:</strong><br />
- "Who can initiate this process?"<br />
- "What happens first?"<br />
- "What does [actor] need to do that?"<br />
- "When does [event] trigger?"<br />
- "What are the exceptions or variations?"<br />
- "Who needs to know about this?"<br />
- "What can go wrong?"</p>
<p><strong>Refinement Questions:</strong><br />
- "Is [term] the right word experts use?"<br />
- "Does [term] mean the same thing here as over there?"<br />
- "What makes [work object] valid or complete?"<br />
- "When can this NOT happen?"<br />
- "Are these really the same thing, or are they different?"</p>
<h3 id="45-from-stories-to-bounded-contexts">4.5 From Stories to Bounded Contexts<a class="headerlink" href="#45-from-stories-to-bounded-contexts" title="Permanent link">&para;</a></h3>
<p>Domain Storytelling reveals Bounded Context boundaries through linguistic and organizational patterns.</p>
<p><strong>Step 1: Identify Linguistic Boundaries</strong></p>
<p><strong>Signs of Different Contexts:</strong></p>
<ol>
<li><strong>Same word, different meanings</strong>:</li>
</ol>
<div class="codehilite"><pre><span></span><code>   In Sales: &quot;Order&quot; = Customer purchase request (pricing, payment)
   In Fulfillment: &quot;Order&quot; = Picking/packing instruction (location, packaging)
   → Two Bounded Contexts!
   ```

2. **Different words, same concept**:
```text
   In HR: &quot;Employee&quot;
   In Payroll: &quot;Pay Subject&quot;
   → Likely same entity in different contexts
   ```

3. **Experts disagree on terminology**:
```text
   Sales expert: &quot;We &#39;submit&#39; orders&quot;
   Warehouse expert: &quot;We &#39;receive&#39; orders&quot;
   → Different perspectives, potentially different contexts
   ```

4. **Natural organizational boundaries**:
```text
   Marketing talks about &quot;campaigns&quot;
   Sales talks about &quot;opportunities&quot;
   → Different domains with different languages
   ```

**Example from Story**:

```text
Story: E-commerce Checkout

Activities:
1. Customer → selects → Product (in Catalog)
2. Customer → adds → Shopping Cart
3. Customer → submits → Order
4. System → validates → Order (pricing, availability)
5. System → reserves → Inventory (warehouse location, quantity)
6. System → sends → Order to Warehouse (pick list, package instructions)

Linguistic Analysis:
- &quot;Order&quot; in steps 3-4: Sales perspective (price, payment)
- &quot;Order&quot; in step 6: Fulfillment perspective (packing, shipping)
- &quot;Inventory&quot; in step 5: Stock management perspective
→ Suggests 3 Bounded Contexts: Sales, Inventory, Fulfillment
</code></pre></div>

<p><strong>Step 2: Map Stories to Context Candidates</strong></p>
<div class="codehilite"><pre><span></span><code>Stories about customer purchases → Sales Context
Stories about stock management → Inventory Context
Stories about packing and shipping → Fulfillment Context
Stories about payment processing → Payment Context
</code></pre></div>

<p><strong>Step 3: Identify Aggregate Candidates</strong></p>
<p>Work objects that are always modified together → likely same Aggregate</p>
<p><strong>Example</strong>:</p>
<div class="codehilite"><pre><span></span><code>Order and OrderLine are always changed together
→ Order is Aggregate Root, OrderLine is entity within aggregate

Shopping Cart and Cart Items are always changed together
→ ShoppingCart is Aggregate Root
</code></pre></div>

<p>Work objects that serve as entry points → likely Aggregate Roots</p>
<p><strong>Step 4: Extract Events</strong></p>
<p>Activity results → Domain Events</p>
<div class="codehilite"><pre><span></span><code>Activity: Customer submits Order
→ Event: OrderSubmitted

Activity: System authorizes Payment
→ Event: PaymentAuthorized
</code></pre></div>

<p>Cross-boundary triggers → Integration Events</p>
<div class="codehilite"><pre><span></span><code>OrderSubmitted in Sales Context
→ Triggers InventoryReservation in Inventory Context
→ Integration event crosses context boundary
</code></pre></div>

<p><strong>Step 5: Define Context Boundaries</strong></p>
<p>Combine linguistic, organizational, and technical boundaries:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">bounded_contexts</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_sales</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Sales</span><span class="nv"> </span><span class="s">Context&quot;</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Customer-facing</span><span class="nv"> </span><span class="s">order</span><span class="nv"> </span><span class="s">management&quot;</span>
<span class="w">    </span><span class="nt">ubiquitous_language_terms</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Order (purchase request)</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Customer</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Product (catalog item with price)</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Shopping Cart</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_inventory</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Inventory</span><span class="nv"> </span><span class="s">Context&quot;</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Stock</span><span class="nv"> </span><span class="s">level</span><span class="nv"> </span><span class="s">management&quot;</span>
<span class="w">    </span><span class="nt">ubiquitous_language_terms</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Product (stock item with location)</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Inventory</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Warehouse</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Reorder Point</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_fulfillment</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Fulfillment</span><span class="nv"> </span><span class="s">Context&quot;</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Order</span><span class="nv"> </span><span class="s">picking,</span><span class="nv"> </span><span class="s">packing,</span><span class="nv"> </span><span class="s">shipping&quot;</span>
<span class="w">    </span><span class="nt">ubiquitous_language_terms</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Order (pick list)</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Shipment</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Package</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Carrier</span>
</code></pre></div>

<p><strong>Example Transformation: Story → DDD Model</strong></p>
<p><strong>Domain Story</strong>:</p>
<div class="codehilite"><pre><span></span><code>1. Customer → selects → Product
2. Customer → adds to → ShoppingCart
3. Customer → submits → Order
4. System → validates → Order
5. System → reserves → Inventory
6. System → publishes → OrderPlaced Event
</code></pre></div>

<p><strong>Strategic DDD (Bounded Contexts)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">system</span><span class="p">:</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sys_ecommerce</span>

<span class="w">  </span><span class="nt">bounded_contexts</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_shopping</span>
<span class="w">      </span><span class="nt">domain_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dom_sales</span>
<span class="w">      </span><span class="nt">aggregates</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">agg_shopping_cart</span><span class="p p-Indicator">]</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_order_management</span>
<span class="w">      </span><span class="nt">domain_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dom_sales</span>
<span class="w">      </span><span class="nt">aggregates</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">agg_order</span><span class="p p-Indicator">]</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_inventory</span>
<span class="w">      </span><span class="nt">domain_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dom_warehouse</span>
<span class="w">      </span><span class="nt">aggregates</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">agg_inventory</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="nt">context_mappings</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cm_order_to_inventory</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Order</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">Inventory</span><span class="nv"> </span><span class="s">Integration&quot;</span>
<span class="w">      </span><span class="nt">upstream_context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_order_management</span>
<span class="w">      </span><span class="nt">downstream_context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_inventory</span>
<span class="w">      </span><span class="nt">relationship_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customer_supplier</span>
</code></pre></div>

<p><strong>Tactical DDD (Aggregates)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">bounded_context</span><span class="p">:</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_order_management</span>

<span class="w">  </span><span class="nt">aggregates</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agg_order</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Order</span>
<span class="w">      </span><span class="nt">root_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ent_order</span>
<span class="w">      </span><span class="nt">entities</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ent_order</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">ent_line_item</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">value_objects</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">vo_money</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">vo_address</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">invariants</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;Order</span><span class="nv"> </span><span class="s">total</span><span class="nv"> </span><span class="s">must</span><span class="nv"> </span><span class="s">equal</span><span class="nv"> </span><span class="s">sum</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">line</span><span class="nv"> </span><span class="s">items&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;Order</span><span class="nv"> </span><span class="s">must</span><span class="nv"> </span><span class="s">have</span><span class="nv"> </span><span class="s">at</span><span class="nv"> </span><span class="s">least</span><span class="nv"> </span><span class="s">one</span><span class="nv"> </span><span class="s">line</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">submitted&quot;</span>

<span class="w">  </span><span class="nt">domain_events</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">evt_order_placed</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OrderPlaced</span>
<span class="w">      </span><span class="nt">aggregate_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agg_order</span>
<span class="w">      </span><span class="nt">data_attributes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">order_id</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">uuid</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customer_id</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">uuid</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">total_amount</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">money</span>
</code></pre></div>

<h3 id="46-integration-with-event-storming">4.6 Integration with Event Storming<a class="headerlink" href="#46-integration-with-event-storming" title="Permanent link">&para;</a></h3>
<p>Domain Storytelling and Event Storming are complementary discovery techniques.</p>
<p><strong>Comparison</strong>:</p>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Domain Storytelling</th>
<th>Event Storming</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Focus</strong></td>
<td>Actor-centered narratives</td>
<td>Event-centered exploration</td>
</tr>
<tr>
<td><strong>Structure</strong></td>
<td>Sequential, linear</td>
<td>Temporal, chaotic then organized</td>
</tr>
<tr>
<td><strong>Notation</strong></td>
<td>Actor → Activity → Work Object</td>
<td>Events (orange), Commands (blue), Aggregates (yellow)</td>
</tr>
<tr>
<td><strong>Facilitation</strong></td>
<td>Guided storytelling</td>
<td>Big Picture, Process Modeling</td>
</tr>
<tr>
<td><strong>Output</strong></td>
<td>Stories with clear sequence</td>
<td>Timeline of Domain Events</td>
</tr>
<tr>
<td><strong>Best For</strong></td>
<td>Understanding processes and workflows</td>
<td>Discovering events and invariants</td>
</tr>
<tr>
<td><strong>Workshop Energy</strong></td>
<td>Calm, narrative</td>
<td>High-energy, post-it explosion</td>
</tr>
</tbody>
</table>
<p><strong>Combined Approach</strong>:</p>
<p><strong>Phase 1: Domain Storytelling</strong> (Start here)<br />
- Understand core business processes<br />
- Identify actors, activities, work objects<br />
- Surface ubiquitous language<br />
- Create structured narratives</p>
<p><strong>Phase 2: Event Storming</strong> (Build on stories)<br />
- Identify ALL Domain Events from stories<br />
- Add events not captured in stories<br />
- Find hotspots (conflicts, questions)<br />
- Identify Aggregates</p>
<p><strong>Phase 3: Validation</strong> (Circle back)<br />
- Use stories to validate event flows<br />
- Ensure events support actual processes<br />
- Refine both stories and event model</p>
<p><strong>Example: Combined Use</strong></p>
<p><strong>Domain Story</strong>:</p>
<div class="codehilite"><pre><span></span><code>Customer submits Order
→ System validates Order
→ System reserves Inventory
→ System sends Order to Fulfillment
</code></pre></div>

<p><strong>From Event Storming</strong> (add events missed in story):</p>
<div class="codehilite"><pre><span></span><code>OrderSubmitted
OrderValidated
InventoryReserved
InventoryReservationFailed ← Discovered in Event Storming!
FulfillmentRequestSent
</code></pre></div>

<p><strong>Refined Story</strong> (incorporating Event Storming insights):</p>
<div class="codehilite"><pre><span></span><code>Customer submits Order
→ OrderSubmitted event
→ System validates Order
→ OrderValidated event
→ System attempts to reserve Inventory
  ├─ Success: InventoryReserved event
  └─ Failure: InventoryReservationFailed event → Order moves to &quot;Pending&quot; state
</code></pre></div>

<h3 id="47-schema-reference">4.7 Schema Reference<a class="headerlink" href="#47-schema-reference" title="Permanent link">&para;</a></h3>
<p>The <code>domain-stories-schema.yaml</code> formalizes Domain Storytelling artifacts for validation, tool support, and code generation. Use this schema when you need to capture domain stories in a machine-readable format, validate story completeness, or enable automated reasoning and code generation from domain knowledge.</p>
<p>This schema bridges the gap between workshop outputs (sticky notes and diagrams) and formal DDD implementation (aggregates, commands, events). It ensures consistency, enables tooling, and creates a single source of truth for domain knowledge.</p>
<p><strong>Schema Purpose</strong>:<br />
- <strong>Validation</strong>: Ensure story structure is correct<br />
- <strong>Tool Support</strong>: Enable LLM reasoning about stories<br />
- <strong>Documentation</strong>: Machine-readable domain knowledge<br />
- <strong>Code Generation</strong>: Generate code from stories</p>
<h4 id="top-level-structure">Top-Level Structure<a class="headerlink" href="#top-level-structure" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2.0.0&quot;</span>
<span class="nt">domain_stories</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">domain_story_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dst_checkout_process</span>
<span class="w">    </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;E-commerce</span><span class="nv"> </span><span class="s">Checkout</span><span class="nv"> </span><span class="s">Process&quot;</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Complete</span><span class="nv"> </span><span class="s">flow</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">product</span><span class="nv"> </span><span class="s">selection</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">order</span><span class="nv"> </span><span class="s">confirmation&quot;</span>

<span class="w">    </span><span class="nt">actors</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span><span class="w">           </span><span class="c1"># Who performs actions</span>
<span class="w">    </span><span class="nt">work_objects</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span><span class="w">     </span><span class="c1"># What they work with</span>
<span class="w">    </span><span class="nt">commands</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span><span class="w">         </span><span class="c1"># State-changing requests</span>
<span class="w">    </span><span class="nt">queries</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span><span class="w">          </span><span class="c1"># Information requests</span>
<span class="w">    </span><span class="nt">activities</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span><span class="w">       </span><span class="c1"># Actions in sequence</span>
<span class="w">    </span><span class="nt">events</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span><span class="w">           </span><span class="c1"># Facts that happened</span>
<span class="w">    </span><span class="nt">policies</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span><span class="w">         </span><span class="c1"># Reactive rules</span>

<span class="w">    </span><span class="c1"># DDD Integration:</span>
<span class="w">    </span><span class="nt">aggregates</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span><span class="w">       </span><span class="c1"># Aggregate mappings</span>
<span class="w">    </span><span class="nt">repositories</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span><span class="w">     </span><span class="c1"># Repository references</span>
<span class="w">    </span><span class="nt">application_services</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="c1"># Service references</span>
<span class="w">    </span><span class="nt">domain_services</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># Domain service references</span>
<span class="w">    </span><span class="nt">read_models</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span><span class="w">      </span><span class="c1"># Query model references</span>
<span class="w">    </span><span class="nt">business_rules</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span><span class="w">   </span><span class="c1"># Rule definitions</span>
</code></pre></div>

<p>The top-level structure contains all story elements and their relationships. Each domain story includes actors, work objects, commands, queries, activities, events, and policies, along with optional DDD integration points like aggregates and services.</p>
<h4 id="id-conventions">ID Conventions<a class="headerlink" href="#id-conventions" title="Permanent link">&para;</a></h4>
<p>All IDs follow consistent prefixes for clarity and type safety:</p>
<table>
<thead>
<tr>
<th>Concept</th>
<th>Prefix</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>Domain Story</td>
<td><code>dst_</code></td>
<td><code>dst_checkout_process</code></td>
</tr>
<tr>
<td>Actor</td>
<td><code>act_</code></td>
<td><code>act_customer</code></td>
</tr>
<tr>
<td>Work Object</td>
<td><code>wobj_</code></td>
<td><code>wobj_order</code></td>
</tr>
<tr>
<td>Activity</td>
<td><code>actv_</code></td>
<td><code>actv_submit_order</code></td>
</tr>
<tr>
<td>Command</td>
<td><code>cmd_</code></td>
<td><code>cmd_place_order</code></td>
</tr>
<tr>
<td>Query</td>
<td><code>qry_</code></td>
<td><code>qry_get_order_status</code></td>
</tr>
<tr>
<td>Event</td>
<td><code>evt_</code></td>
<td><code>evt_order_placed</code></td>
</tr>
<tr>
<td>Policy</td>
<td><code>pol_</code></td>
<td><code>pol_send_confirmation</code></td>
</tr>
<tr>
<td>Business Rule</td>
<td><code>rle_</code></td>
<td><code>rle_order_minimum</code></td>
</tr>
<tr>
<td>Aggregate</td>
<td><code>agg_</code></td>
<td><code>agg_order</code></td>
</tr>
<tr>
<td>Repository</td>
<td><code>repo_</code></td>
<td><code>repo_order</code></td>
</tr>
<tr>
<td>Application Service</td>
<td><code>svc_app_</code></td>
<td><code>svc_app_order_management</code></td>
</tr>
<tr>
<td>Domain Service</td>
<td><code>svc_dom_</code></td>
<td><code>svc_dom_pricing</code></td>
</tr>
<tr>
<td>Read Model</td>
<td><code>rmdl_</code></td>
<td><code>rmdl_order_summary</code></td>
</tr>
</tbody>
</table>
<p>These prefixes enable unambiguous references across the schema and support validation tooling.</p>
<h4 id="causal-chain-in-schema">Causal Chain in Schema<a class="headerlink" href="#causal-chain-in-schema" title="Permanent link">&para;</a></h4>
<p>The schema captures complete causality from user actions through system reactions. This traceability is essential for understanding system behavior and debugging complex workflows.</p>
<div class="codehilite"><pre><span></span><code>Actor (act_customer)
  ↓ initiates
Command (cmd_submit_order)
  ↓ triggers
Activity (actv_submit_order)
  ↓ uses
Work Objects (wobj_shopping_cart, wobj_order)
  ↓ produces
Event (evt_order_submitted)
  ↓ triggers
Policy (pol_send_confirmation)
  ↓ issues
Command (cmd_send_email)
  ↓ (continues...)
</code></pre></div>

<p>This creates a traceable chain from actor intent to system reactions. Each element references related elements by ID, enabling validation and automated analysis.</p>
<h4 id="aggregate-integration">Aggregate Integration<a class="headerlink" href="#aggregate-integration" title="Permanent link">&para;</a></h4>
<p>Work objects can reference aggregates, bridging discovery and tactical design:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">work_objects</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">work_object_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wobj_order</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Order&quot;</span>
<span class="w">    </span><span class="nt">aggregate_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agg_order</span><span class="w">  </span><span class="c1"># Links to tactical model</span>
<span class="w">    </span><span class="nt">attributes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">order_id</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">uuid</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">total</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">money</span>
</code></pre></div>

<p>This bridges discovery (domain stories) and tactical design (aggregates).</p>
<h3 id="48-best-practices">4.8 Best Practices<a class="headerlink" href="#48-best-practices" title="Permanent link">&para;</a></h3>
<p><strong>Story Discovery</strong></p>
<p>✅ <strong>DO:</strong><br />
- Start with the happy path (most common, successful flow)<br />
- Add variations incrementally after happy path is clear<br />
- Use real examples from actual business operations<br />
- Capture exact terminology experts use<br />
- Note exceptions and edge cases<br />
- Follow complete flows end-to-end</p>
<p>❌ <strong>DON'T:</strong><br />
- Jump to edge cases first (get the normal flow first)<br />
- Use hypothetical scenarios ("what if aliens attacked?")<br />
- Translate expert terminology into "better" terms<br />
- Skip "obvious" steps (they're often critical)<br />
- Ignore variations ("we usually do X" means sometimes you don't!)</p>
<p><strong>Notation Usage</strong></p>
<p>✅ <strong>DO:</strong><br />
- Keep notation simple (actor, activity, work object, arrows)<br />
- Use color coding consistently (same color = same type)<br />
- Show sequence clearly with numbers<br />
- Label relationships and flows<br />
- Capture both human and system actors</p>
<p>❌ <strong>DON'T:</strong><br />
- Over-complicate with UML or detailed diagrams<br />
- Use technical notation experts don't understand<br />
- Skip intermediate steps for "simplicity"<br />
- Hide automated system actors</p>
<p><strong>Workshop Dynamics</strong></p>
<p>✅ <strong>DO:</strong><br />
- Let domain experts lead and tell the story<br />
- Ask clarifying questions, don't assume<br />
- Pause for deep discussions when terms are unclear<br />
- Validate understanding by reading the story back<br />
- Capture glossary terms as they emerge</p>
<p>❌ <strong>DON'T:</strong><br />
- Dominate the conversation as a developer<br />
- Rush experts through their explanation<br />
- Impose technical solutions during discovery<br />
- Argue about terminology (if experts use it, capture it)<br />
- Skip edge cases because "we'll handle that later"</p>
<p><strong>Context Identification</strong></p>
<p>✅ <strong>DO:</strong><br />
- Look for linguistic boundaries (same word, different meanings)<br />
- Notice where expert terminology changes<br />
- Identify organizational seams (different teams, different priorities)<br />
- Find natural process boundaries</p>
<p>❌ <strong>DON'T:</strong><br />
- Force artificial boundaries based on technical architecture<br />
- Create too many tiny contexts (over-fragmentation)<br />
- Ignore obvious linguistic boundaries<br />
- Let technical concerns drive context boundaries</p>
<h3 id="49-example-complete-domain-story">4.9 Example: Complete Domain Story<a class="headerlink" href="#49-example-complete-domain-story" title="Permanent link">&para;</a></h3>
<p><strong>Story: E-Commerce Order Placement</strong></p>
<p><strong>Happy Path Narrative:</strong></p>
<div class="codehilite"><pre><span></span><code>1. Customer → browses → Product Catalog
2. Customer → selects → Product
3. Customer → adds to → Shopping Cart
4. Customer → updates quantity in → Shopping Cart
5. Customer → reviews → Shopping Cart
6. Customer → submits → Order
7. System → validates → Order (checks: items in stock, payment method valid)
8. System → reserves → Inventory
9. System → requests → Payment Authorization from Payment System
10. Payment System → authorizes → Payment
11. System → confirms → Order
12. System → publishes → OrderPlaced event
13. System → sends → Order to Warehouse
14. System → sends → Confirmation Email to Customer
</code></pre></div>

<p><strong>Alternative Flows:</strong></p>
<p><strong>Payment Fails:</strong></p>
<div class="codehilite"><pre><span></span><code>9. System → requests → Payment Authorization
10. Payment System → declines → Payment
11. System → marks → Order as &quot;Payment Failed&quot;
12. System → sends → Payment Failure Notification to Customer
</code></pre></div>

<p><strong>Inventory Unavailable:</strong></p>
<div class="codehilite"><pre><span></span><code>8. System → checks → Inventory
9. System → detects → Insufficient Inventory
10. System → marks → Order as &quot;Pending Inventory&quot;
11. System → sends → Backorder Notification to Customer
</code></pre></div>

<p><strong>Actors Identified:</strong><br />
- <code>act_customer</code> (Person)<br />
- <code>act_system</code> (System - main application)<br />
- <code>act_payment_system</code> (System - external)<br />
- <code>act_warehouse</code> (System - fulfillment)</p>
<p><strong>Work Objects Identified:</strong><br />
- <code>wobj_product</code><br />
- <code>wobj_product_catalog</code><br />
- <code>wobj_shopping_cart</code><br />
- <code>wobj_order</code><br />
- <code>wobj_inventory</code><br />
- <code>wobj_payment</code><br />
- <code>wobj_confirmation_email</code></p>
<p><strong>Commands:</strong><br />
- <code>cmd_add_to_cart</code><br />
- <code>cmd_submit_order</code><br />
- <code>cmd_authorize_payment</code></p>
<p><strong>Events:</strong><br />
- <code>evt_product_added_to_cart</code><br />
- <code>evt_order_submitted</code><br />
- <code>evt_order_validated</code><br />
- <code>evt_inventory_reserved</code><br />
- <code>evt_payment_authorized</code><br />
- <code>evt_order_placed</code></p>
<p><strong>Policies:</strong><br />
- <code>pol_send_order_confirmation</code> (When OrderPlaced, send confirmation email)<br />
- <code>pol_notify_warehouse</code> (When OrderPlaced, send to warehouse)</p>
<p><strong>Bounded Context Candidates:</strong><br />
- Sales Context (Shopping Cart, Order submission)<br />
- Inventory Context (Stock management, reservations)<br />
- Payment Context (Payment authorization, processing)<br />
- Fulfillment Context (Warehouse operations, shipping)</p>
<hr />
<h2 id="part-ii-summary">Part II Summary<a class="headerlink" href="#part-ii-summary" title="Permanent link">&para;</a></h2>
<p>Part II introduced <strong>Domain Storytelling</strong> as the discovery technique that bridges business understanding and strategic design:</p>
<p><strong>Section 4: Domain Storytelling</strong><br />
- <strong>Collaborative technique</strong>: Experts tell stories, developers capture them<br />
- <strong>Simple notation</strong>: Actor → Activity → Work Object<br />
- <strong>Commands and Events</strong>: CQRS concepts emerge naturally from stories<br />
- <strong>Policies</strong>: Reactive rules connect events to actions<br />
- <strong>Workshop facilitation</strong>: Structured process for knowledge discovery<br />
- <strong>Boundary discovery</strong>: Stories reveal bounded context candidates<br />
- <strong>Integration with Event Storming</strong>: Complementary techniques<br />
- <strong>Schema formalization</strong>: Machine-readable domain stories</p>
<p><strong>Key Insights:</strong><br />
- Discovery before design: Understand the domain through stories first<br />
- Linguistic boundaries: Where terms change meaning, contexts emerge<br />
- Causal chains: Actor → Command → Event → Policy creates traceable flows<br />
- Ubiquitous language surfaces: Stories reveal the exact terms experts use</p>
<p><strong>What's Next</strong>: With domain understanding from storytelling and strategic boundaries from bounded contexts, Part III dives into <strong>Tactical Implementation</strong>—how to build rich domain models using aggregates, entities, value objects, and the patterns that bring them to life.</p>
<hr />
<h1 id="part-iii-tactical-implementation_1">Part III: Tactical Implementation<a class="headerlink" href="#part-iii-tactical-implementation_1" title="Permanent link">&para;</a></h1>
<p>With strategic boundaries established and domain knowledge captured through storytelling, we now turn to <strong>tactical patterns</strong>—the building blocks for implementing rich domain models within bounded contexts.</p>
<h2 id="5-tactical-design-patterns">5. Tactical Design Patterns<a class="headerlink" href="#5-tactical-design-patterns" title="Permanent link">&para;</a></h2>
<p>Tactical patterns focus on the internal structure of a bounded context. While strategic patterns address system organization and context boundaries, tactical patterns provide the vocabulary and techniques for expressing domain logic clearly and maintainably.</p>
<p><strong>Key Principle</strong>: The domain layer should be isolated from infrastructure and application concerns, containing pure business logic expressed in the Ubiquitous Language.</p>
<h3 id="51-overview-and-building-blocks">5.1 Overview and Building Blocks<a class="headerlink" href="#51-overview-and-building-blocks" title="Permanent link">&para;</a></h3>
<p><strong>Purpose of Tactical Patterns:</strong><br />
- Structure domain logic clearly and explicitly<br />
- Maintain business invariants consistently<br />
- Express domain concepts in code<br />
- Enable comprehensive testing<br />
- Facilitate evolutionary change</p>
<p><strong>The Tactical Pattern Catalog:</strong></p>
<ol>
<li><strong>Entity</strong>: Object with identity and continuous lifecycle</li>
<li><strong>Value Object</strong>: Immutable object defined by attributes</li>
<li><strong>Aggregate</strong>: Consistency boundary clustering related objects</li>
<li><strong>Aggregate Root</strong>: Entry point and guardian of aggregate</li>
<li><strong>Repository</strong>: Abstraction for aggregate persistence</li>
<li><strong>Domain Service</strong>: Stateless operations not belonging to entities</li>
<li><strong>Domain Event</strong>: Fact about something that happened</li>
<li><strong>Factory</strong>: Complex object creation logic</li>
</ol>
<p><strong>Pattern Relationships:</strong></p>
<div class="codehilite"><pre><span></span><code>BoundedContext (Root Object)
    ↓ contains
Aggregates (consistency boundaries)
    ↓ composed of
Aggregate Root (Entity - entry point)
    ├─ Other Entities (identity-based objects)
    └─ Value Objects (attribute-based objects)
        ↓ persisted/retrieved by
Repository (one per aggregate)
    ↓ publishes
Domain Events (facts about what happened)
</code></pre></div>

<p><strong>In the Schema:</strong></p>
<p>The tactical schema uses <strong>BoundedContext as the root object</strong>, eliminating the need for <code>bounded_context_ref</code> on child types. All tactical elements exist within a bounded context:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">bounded_context</span><span class="p">:</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_order_management</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Order</span><span class="nv"> </span><span class="s">Management&quot;</span>
<span class="w">  </span><span class="nt">domain_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dom_sales</span>

<span class="w">  </span><span class="nt">aggregates</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">entities</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">value_objects</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">repositories</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">domain_services</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">application_services</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">domain_events</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span>
</code></pre></div>

<p>With the tactical pattern catalog and relationships established, we now examine each pattern in detail, starting with Entities—objects defined by their unique identity and continuous lifecycle.</p>
<h3 id="52-entities">5.2 Entities<a class="headerlink" href="#52-entities" title="Permanent link">&para;</a></h3>
<p><strong>Definition</strong>: An <strong>Entity</strong> is an object defined by its identity rather than its attributes. It has a continuous lifecycle, and while its attributes may change, it remains the same entity throughout.</p>
<p><strong>Core Concept: Identity</strong></p>
<p>Identity is what makes an entity unique and distinguishes it from all others:</p>
<p><strong>What is Identity?</strong><br />
- A unique identifier that persists throughout the entity's lifecycle<br />
- Does not change even if all other attributes change<br />
- Used for equality comparison (not attribute values)<br />
- Immutable once assigned</p>
<p><strong>Identity Generation Strategies:</strong></p>
<ol>
<li><strong>User-Provided</strong>: Email address, username, SSN (when truly unique)</li>
<li><strong>Auto-Generated</strong>: UUID, GUID (preferred for most cases)</li>
<li><strong>Database Sequence</strong>: Auto-increment ID (coupling to infrastructure)</li>
<li><strong>Derived</strong>: Combination of attributes (composite key)</li>
<li><strong>External</strong>: Provided by external system</li>
</ol>
<p><strong>Best Practice</strong>: Use UUIDs or GUIDs for domain entity identity. They're globally unique, don't require database coordination, and work well in distributed systems.</p>
<p><strong>Example</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Customer</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">CustomerId</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w">  </span><span class="c1">// Immutable identity (Value Object wrapping UUID)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">PersonName</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w">      </span><span class="c1">// Mutable attribute</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Email</span><span class="w"> </span><span class="n">email</span><span class="p">;</span><span class="w">          </span><span class="c1">// Mutable attribute</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Address</span><span class="w"> </span><span class="n">shippingAddress</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">CustomerStatus</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Constructor enforces identity immutability</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Customer</span><span class="p">(</span><span class="n">CustomerId</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">PersonName</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">Email</span><span class="w"> </span><span class="n">email</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">requireNonNull</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Customer ID required&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">requireNonNull</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name required&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">requireNonNull</span><span class="p">(</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Email required&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CustomerStatus</span><span class="p">.</span><span class="na">ACTIVE</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Identity-based equality</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">equals</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">o</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">o</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">o</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">Customer</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">        </span><span class="n">Customer</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Customer</span><span class="p">)</span><span class="w"> </span><span class="n">o</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">id</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="na">id</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">hashCode</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">id</span><span class="p">.</span><span class="na">hashCode</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Entity Lifecycle</strong></p>
<p><strong>Creation:</strong><br />
- Entity comes into existence<br />
- Identity assigned (must be unique)<br />
- Initial state established<br />
- Invariants must be satisfied from the start</p>
<p><strong>Modification:</strong><br />
- Attributes change over time<br />
- Identity remains constant<br />
- Invariants maintained at all times<br />
- Changes may trigger Domain Events</p>
<p><strong>Deletion/Archival:</strong><br />
- Entity no longer active in the system<br />
- Often soft-deleted (marked inactive) rather than hard-deleted<br />
- Identity preserved for historical reference and audit trails</p>
<p><strong>Design Guidelines for Entities</strong></p>
<p><strong>1. Model Identity Explicitly</strong></p>
<p>Use a Value Object to represent identity (not primitive strings):</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ✓ Good: Type-safe identity</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Order</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">OrderId</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w">  </span><span class="c1">// Value Object</span>
<span class="p">}</span>

<span class="c1">// ❌ Bad: Primitive obsession</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Order</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w">  </span><span class="c1">// Just a string</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>2. Enforce Invariants Through Methods</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Order</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OrderStatus</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderLine</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lines</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Business method enforcing invariants</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">submit</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lines</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">EmptyOrderException</span><span class="p">(</span><span class="s">&quot;Cannot submit order without items&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">DRAFT</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderNotModifiableException</span><span class="p">(</span><span class="s">&quot;Can only submit draft orders&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">SUBMITTED</span><span class="p">;</span>
<span class="w">        </span><span class="n">DomainEvents</span><span class="p">.</span><span class="na">raise</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">OrderSubmitted</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ❌ Bad: Public setter breaks encapsulation</span>
<span class="w">    </span><span class="c1">// public void setStatus(OrderStatus status) { ... }</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>3. Use Value Objects for Attributes</strong></p>
<p>Prefer value objects over primitives to make domain concepts explicit:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ✓ Good: Value objects make concepts explicit</span>
<span class="kd">private</span><span class="w"> </span><span class="n">Email</span><span class="w"> </span><span class="n">email</span><span class="p">;</span>
<span class="kd">private</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="n">totalAmount</span><span class="p">;</span>
<span class="kd">private</span><span class="w"> </span><span class="n">Address</span><span class="w"> </span><span class="n">shippingAddress</span><span class="p">;</span>

<span class="c1">// ❌ Bad: Primitives hide domain meaning</span>
<span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">email</span><span class="p">;</span>
<span class="kd">private</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span>
<span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">currency</span><span class="p">;</span>
</code></pre></div>

<p><strong>4. Intention-Revealing Method Names</strong></p>
<p>Use names from ubiquitous language:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ✓ Good: Reveals business intent</span>
<span class="n">customer</span><span class="p">.</span><span class="na">suspend</span><span class="p">();</span>
<span class="n">order</span><span class="p">.</span><span class="na">cancel</span><span class="p">();</span>
<span class="n">product</span><span class="p">.</span><span class="na">discontinue</span><span class="p">();</span>

<span class="c1">// ❌ Bad: Generic technical names</span>
<span class="n">customer</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">Status</span><span class="p">.</span><span class="na">SUSPENDED</span><span class="p">);</span>
<span class="n">order</span><span class="p">.</span><span class="na">update</span><span class="p">(</span><span class="n">Map</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cancelled&quot;</span><span class="p">));</span>
</code></pre></div>

<p><strong>Entity vs Value Object Decision</strong></p>
<p><strong>Choose Entity when:</strong><br />
- ✓ Object must be tracked over time<br />
- ✓ Object has a unique identity<br />
- ✓ Object's history matters (audit trail, lifecycle events)<br />
- ✓ Two objects with identical attributes are still different<br />
- ✓ Object participates in relationships with other entities</p>
<p><strong>Choose Value Object when:</strong><br />
- ✓ Only the attributes matter (not which specific instance)<br />
- ✓ Two objects with same attributes are interchangeable<br />
- ✓ Immutability is natural for the concept<br />
- ✓ No lifecycle to track<br />
- ✓ Represents a measurement, quantity, or description</p>
<p><strong>Example</strong>: Two customers with the same name are different people (Entity). Two addresses with the same values are the same address (Value Object).</p>
<h3 id="53-value-objects">5.3 Value Objects<a class="headerlink" href="#53-value-objects" title="Permanent link">&para;</a></h3>
<p><strong>Definition</strong>: A <strong>Value Object</strong> is an immutable object defined entirely by its attributes. Two value objects with the same attribute values are considered equal and completely interchangeable.</p>
<p><strong>Core Characteristics</strong></p>
<p><strong>1. Immutability</strong></p>
<p>Value objects cannot change after creation:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Money</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Currency</span><span class="w"> </span><span class="n">currency</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Money</span><span class="p">(</span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="n">Currency</span><span class="w"> </span><span class="n">currency</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Validation in constructor</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">requireNonNull</span><span class="p">(</span><span class="n">amount</span><span class="p">);</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">currency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">requireNonNull</span><span class="p">(</span><span class="n">currency</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// No setters!</span>

<span class="w">    </span><span class="c1">// Operations return NEW instances</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">Money</span><span class="w"> </span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">validateSameCurrency</span><span class="p">(</span><span class="n">other</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Money</span><span class="p">(</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">amount</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="na">amount</span><span class="p">),</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">currency</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>2. Attribute-Based Equality</strong></p>
<p>Equals and hashCode based on attribute values:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Override</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">equals</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">o</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">o</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">o</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">Money</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="n">Money</span><span class="w"> </span><span class="n">money</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Money</span><span class="p">)</span><span class="w"> </span><span class="n">o</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">amount</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">money</span><span class="p">.</span><span class="na">amount</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">           </span><span class="n">currency</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">money</span><span class="p">.</span><span class="na">currency</span><span class="p">);</span>
<span class="p">}</span>

<span class="nd">@Override</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">hashCode</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Objects</span><span class="p">.</span><span class="na">hash</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="n">currency</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>3. Self-Validation</strong></p>
<p>Constructor validates all invariants—invalid state cannot exist:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Email</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Email</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="na">isBlank</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;Email cannot be blank&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">value</span><span class="p">.</span><span class="na">matches</span><span class="p">(</span><span class="s">&quot;^[A-Za-z0-9+_.-]+@(.+)$&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">InvalidEmailException</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="na">toLowerCase</span><span class="p">().</span><span class="na">trim</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>4. Side-Effect-Free Behavior</strong></p>
<p>Methods don't modify state, they return new instances:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DateRange</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">start</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">end</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Returns boolean, doesn&#39;t modify state</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">contains</span><span class="p">(</span><span class="n">LocalDate</span><span class="w"> </span><span class="n">date</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">!</span><span class="n">date</span><span class="p">.</span><span class="na">isBefore</span><span class="p">(</span><span class="n">start</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">date</span><span class="p">.</span><span class="na">isAfter</span><span class="p">(</span><span class="n">end</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Returns NEW DateRange, doesn&#39;t modify this one</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">DateRange</span><span class="w"> </span><span class="nf">extendBy</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">days</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DateRange</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">start</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">end</span><span class="p">.</span><span class="na">plusDays</span><span class="p">(</span><span class="n">days</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Immutability Enforcement in the Schema</strong></p>
<p>Value Objects must be immutable:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">ValueObject</span><span class="p">:</span>
<span class="w">  </span><span class="nt">properties</span><span class="p">:</span>
<span class="w">    </span><span class="nt">immutability</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">boolean</span>
<span class="w">      </span><span class="nt">const</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># MUST be true (required)</span>
</code></pre></div>

<p>Similarly for Domain Events (which are conceptually value objects representing facts):</p>
<div class="codehilite"><pre><span></span><code><span class="nt">DomainEvent</span><span class="p">:</span>
<span class="w">  </span><span class="nt">properties</span><span class="p">:</span>
<span class="w">    </span><span class="nt">immutable</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">boolean</span>
<span class="w">      </span><span class="nt">const</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>

<p>This schema-level enforcement prevents accidentally creating mutable value objects.</p>
<p><strong>When to Use Value Objects</strong></p>
<p>Value Objects are appropriate for:</p>
<p>✓ <strong>Measurements</strong>: Money, Weight, Temperature, Distance<br />
✓ <strong>Quantities</strong>: Quantity with unit, Percentage, Ratio<br />
✓ <strong>Ranges</strong>: DateRange, AgeRange, PriceRange<br />
✓ <strong>Descriptive Aspects</strong>: PersonName, Address, Email, PhoneNumber<br />
✓ <strong>Complex Calculations</strong>: Interest Rate, Exchange Rate<br />
✓ <strong>Specifications</strong>: ProductSpecification, SearchCriteria<br />
✓ <strong>Domain Primitives</strong>: Wrapping primitives with domain meaning</p>
<p><strong>Benefits of Value Objects:</strong><br />
- Make domain concepts explicit in code<br />
- Encapsulate validation logic<br />
- Provide type safety<br />
- Enable reusability across aggregates<br />
- Simplify testing (pure functions)<br />
- Thread-safe by nature (immutable)</p>
<p><strong>Common Value Object Patterns</strong></p>
<p><strong>Money (Amount + Currency):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Money</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Currency</span><span class="w"> </span><span class="n">currency</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">Money</span><span class="w"> </span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">currency</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="na">currency</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CurrencyMismatchException</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="na">amount</span><span class="p">),</span><span class="w"> </span><span class="n">currency</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="nf">multiply</span><span class="p">(</span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">factor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="p">.</span><span class="na">multiply</span><span class="p">(</span><span class="n">factor</span><span class="p">),</span><span class="w"> </span><span class="n">currency</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isGreaterThan</span><span class="p">(</span><span class="n">Money</span><span class="w"> </span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">validateSameCurrency</span><span class="p">(</span><span class="n">other</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">amount</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="na">amount</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Address (Structured Location):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Address</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">street</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">city</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">postalCode</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Country</span><span class="w"> </span><span class="n">country</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Constructor validates all fields</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Address</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">street</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">postalCode</span><span class="p">,</span><span class="w"> </span><span class="n">Country</span><span class="w"> </span><span class="n">country</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">street</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">requireNonBlank</span><span class="p">(</span><span class="n">street</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Street&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">requireNonBlank</span><span class="p">(</span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;City&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">postalCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">requireValidPostalCode</span><span class="p">(</span><span class="n">postalCode</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="p">);</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">requireNonNull</span><span class="p">(</span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Country&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Convenience method for partial updates</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Address</span><span class="w"> </span><span class="nf">withStreet</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">newStreet</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Address</span><span class="p">(</span><span class="n">newStreet</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">city</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">postalCode</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">country</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>PersonName (Structured Name):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PersonName</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">firstName</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">lastName</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">middleName</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">fullName</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">middleName</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span>
<span class="w">            </span><span class="o">?</span><span class="w"> </span><span class="n">firstName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">middleName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lastName</span>
<span class="w">            </span><span class="p">:</span><span class="w"> </span><span class="n">firstName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lastName</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">formalName</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">lastName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;, &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">firstName</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Replaceability</strong></p>
<p>Since value objects are immutable, to "change" them you replace the entire instance:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Customer</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// Entity</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Email</span><span class="w"> </span><span class="n">email</span><span class="p">;</span><span class="w">  </span><span class="c1">// Value Object</span>

<span class="w">    </span><span class="c1">// To change email, replace the entire Value Object</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">changeEmail</span><span class="p">(</span><span class="n">Email</span><span class="w"> </span><span class="n">newEmail</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">email</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">newEmail</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span><span class="w">  </span><span class="c1">// No change needed</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newEmail</span><span class="p">;</span><span class="w">  </span><span class="c1">// Complete replacement</span>
<span class="w">        </span><span class="n">DomainEvents</span><span class="p">.</span><span class="na">raise</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">CustomerEmailChanged</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="p">,</span><span class="w"> </span><span class="n">newEmail</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Common Mistakes</strong></p>
<ol>
<li><strong>Mutable Value Objects</strong>: Adding setters or allowing state modification</li>
<li><strong>Reference Equality</strong>: Using <code>==</code> instead of <code>.equals()</code></li>
<li><strong>Missing Validation</strong>: Not validating invariants in constructor</li>
<li><strong>Primitive Obsession</strong>: Not creating value objects for domain concepts</li>
<li><strong>Too Large</strong>: Creating value objects that are really entities in disguise</li>
</ol>
<h3 id="54-aggregates">5.4 Aggregates<a class="headerlink" href="#54-aggregates" title="Permanent link">&para;</a></h3>
<p><strong>Definition</strong>: An <strong>Aggregate</strong> is a cluster of associated entities and value objects treated as a single unit for data changes. It has a root entity (the Aggregate Root) and a boundary defining what's inside.</p>
<p><strong>Purpose: Consistency Boundary</strong></p>
<p>Aggregates solve the fundamental challenge: <strong>How do we maintain business invariants in a complex domain model?</strong></p>
<p><strong>Key Insights:</strong><br />
- Aggregates define <strong>transactional boundaries</strong>—all changes within an aggregate happen in a single transaction<br />
- Aggregates ensure <strong>business invariants</strong>—rules that must always be true<br />
- Aggregates are the <strong>atomic unit of persistence</strong>—you save/load entire aggregates, not individual entities</p>
<h4 id="vaughn-vernons-aggregate-design-rules">Vaughn Vernon's Aggregate Design Rules<a class="headerlink" href="#vaughn-vernons-aggregate-design-rules" title="Permanent link">&para;</a></h4>
<h5 id="rule-1-protect-true-invariants-in-consistency-boundaries">Rule 1: Protect True Invariants in Consistency Boundaries<a class="headerlink" href="#rule-1-protect-true-invariants-in-consistency-boundaries" title="Permanent link">&para;</a></h5>
<p><strong>True Invariants</strong> are business rules that must be consistent at all times:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Order</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// Aggregate Root</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OrderId</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderLine</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lines</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="n">total</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// TRUE INVARIANT: Total must equal sum of line items</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addLine</span><span class="p">(</span><span class="n">Product</span><span class="w"> </span><span class="n">product</span><span class="p">,</span><span class="w"> </span><span class="n">Quantity</span><span class="w"> </span><span class="n">qty</span><span class="p">,</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="n">price</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">OrderLine</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderLine</span><span class="p">(</span><span class="n">product</span><span class="p">,</span><span class="w"> </span><span class="n">qty</span><span class="p">,</span><span class="w"> </span><span class="n">price</span><span class="p">);</span>
<span class="w">        </span><span class="n">lines</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
<span class="w">        </span><span class="n">recalculateTotal</span><span class="p">();</span><span class="w">  </span><span class="c1">// Maintain invariant immediately</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">recalculateTotal</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lines</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">OrderLine</span><span class="p">::</span><span class="n">subtotal</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">reduce</span><span class="p">(</span><span class="n">Money</span><span class="p">.</span><span class="na">ZERO</span><span class="p">,</span><span class="w"> </span><span class="n">Money</span><span class="p">::</span><span class="n">add</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Invariant is ALWAYS true - cannot violate</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Eventual Consistency</strong> is acceptable for invariants that span aggregates:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Customer&#39;s lifetime value across ALL orders</span>
<span class="c1">// This is EVENTUALLY consistent, not immediately</span>
<span class="c1">// Each Order aggregate maintains its own consistency</span>
<span class="c1">// Customer aggregate&#39;s totalSpent updated asynchronously</span>
</code></pre></div>

<h5 id="rule-2-design-small-aggregates">Rule 2: Design Small Aggregates<a class="headerlink" href="#rule-2-design-small-aggregates" title="Permanent link">&para;</a></h5>
<p><strong>Prefer small aggregates</strong> with only the entities and value objects needed to enforce invariants.</p>
<p><strong>Why?</strong><br />
- Smaller transaction scope (less locking)<br />
- Better performance (less to load/save)<br />
- Reduced merge conflicts<br />
- Clearer responsibility</p>
<p><strong>Example</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># ✓ Good: Small, focused aggregate</span>
<span class="nt">aggregates</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agg_order</span>
<span class="w">    </span><span class="nt">root_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ent_order</span>
<span class="w">    </span><span class="nt">entities</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ent_order</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">ent_order_line</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># Small cluster</span>
<span class="w">    </span><span class="nt">invariants</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;Order</span><span class="nv"> </span><span class="s">total</span><span class="nv"> </span><span class="s">equals</span><span class="nv"> </span><span class="s">sum</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">line</span><span class="nv"> </span><span class="s">items&quot;</span>

<span class="c1"># ❌ Bad: Large aggregate spanning too much</span>
<span class="nt">aggregates</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agg_customer</span>
<span class="w">    </span><span class="nt">entities</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ent_customer</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ent_order</span><span class="w">  </span><span class="c1"># Shouldn&#39;t be inside customer aggregate</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ent_order_line</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ent_shipment</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ent_payment</span>
<span class="w">    </span><span class="c1"># Too large! Customer and Order should be separate aggregates</span>
</code></pre></div>

<h5 id="rule-3-reference-other-aggregates-by-identity-only">Rule 3: Reference Other Aggregates by Identity Only<a class="headerlink" href="#rule-3-reference-other-aggregates-by-identity-only" title="Permanent link">&para;</a></h5>
<p>Aggregates should reference each other by ID, not hold direct object references:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ✓ Good: Reference by ID</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Order</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// Aggregate Root</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OrderId</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">CustomerId</span><span class="w"> </span><span class="n">customerId</span><span class="p">;</span><span class="w">  </span><span class="c1">// ID reference to Customer aggregate</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderLine</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lines</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ❌ Bad: Direct object reference</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Order</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OrderId</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Customer</span><span class="w"> </span><span class="n">customer</span><span class="p">;</span><span class="w">  </span><span class="c1">// Direct reference crosses aggregate boundary!</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Why?</strong><br />
- Clear aggregate boundaries<br />
- Prevents accidentally modifying other aggregates<br />
- Enables lazy loading<br />
- Supports eventual consistency between aggregates</p>
<p><strong>To access related aggregate:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Load related aggregate through repository</span>
<span class="n">Customer</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">customerRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">order</span><span class="p">.</span><span class="na">getCustomerId</span><span class="p">());</span>
</code></pre></div>

<h5 id="rule-4-update-other-aggregates-via-domain-events">Rule 4: Update Other Aggregates via Domain Events<a class="headerlink" href="#rule-4-update-other-aggregates-via-domain-events" title="Permanent link">&para;</a></h5>
<p>Use domain events (eventual consistency) rather than trying to update multiple aggregates in one transaction:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Order</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">submit</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lines</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">EmptyOrderException</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">SUBMITTED</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// Publish event - other aggregates react asynchronously</span>
<span class="w">        </span><span class="n">DomainEvents</span><span class="p">.</span><span class="na">raise</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">OrderSubmitted</span><span class="p">(</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="p">,</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">customerId</span><span class="p">,</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">total</span>
<span class="w">        </span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Event handler updates Customer aggregate separately</span>
<span class="nd">@EventHandler</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onOrderSubmitted</span><span class="p">(</span><span class="n">OrderSubmitted</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Customer</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">customerRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">customerId</span><span class="p">());</span>
<span class="w">    </span><span class="n">customer</span><span class="p">.</span><span class="na">recordOrderPlaced</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">total</span><span class="p">());</span>
<span class="w">    </span><span class="n">customerRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">customer</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="aggregate-root">Aggregate Root<a class="headerlink" href="#aggregate-root" title="Permanent link">&para;</a></h4>
<p>The <strong>Aggregate Root</strong> is the only entity within the aggregate that external objects may hold references to.</p>
<p><strong>Responsibilities:</strong><br />
- Entry point for all operations on the aggregate<br />
- Enforces all invariants within the aggregate<br />
- Coordinates changes to internal entities<br />
- Publishes Domain Events<br />
- Controls access to internals</p>
<p><strong>Example</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Order</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// Aggregate Root</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OrderId</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderLine</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lines</span><span class="p">;</span><span class="w">  </span><span class="c1">// Internal entities</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="n">total</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// ONLY way to add lines is through root</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addLine</span><span class="p">(</span><span class="n">ProductId</span><span class="w"> </span><span class="n">productId</span><span class="p">,</span><span class="w"> </span><span class="n">Quantity</span><span class="w"> </span><span class="n">qty</span><span class="p">,</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="n">price</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Root enforces invariants</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">DRAFT</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderNotModifiableException</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Root coordinates internal changes</span>
<span class="w">        </span><span class="n">OrderLine</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderLine</span><span class="p">(</span><span class="n">productId</span><span class="p">,</span><span class="w"> </span><span class="n">qty</span><span class="p">,</span><span class="w"> </span><span class="n">price</span><span class="p">);</span>
<span class="w">        </span><span class="n">lines</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
<span class="w">        </span><span class="n">recalculateTotal</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// Root publishes events</span>
<span class="w">        </span><span class="n">DomainEvents</span><span class="p">.</span><span class="na">raise</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">OrderLineAdded</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="p">,</span><span class="w"> </span><span class="n">line</span><span class="p">.</span><span class="na">id</span><span class="p">()));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Internal entities NOT accessible directly</span>
<span class="w">    </span><span class="c1">// ❌ public List&lt;OrderLine&gt; getLines() - violates encapsulation</span>

<span class="w">    </span><span class="c1">// ✓ Expose safe, read-only view</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">lineCount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">lines</span><span class="p">.</span><span class="na">size</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="one-aggregate-per-transaction">One Aggregate Per Transaction<a class="headerlink" href="#one-aggregate-per-transaction" title="Permanent link">&para;</a></h4>
<p><strong>Critical Rule</strong>: Modify only ONE aggregate per transaction.</p>
<p>This is captured in the <code>TransactionBoundary</code> pattern:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">TransactionBoundary</span><span class="p">:</span>
<span class="w">  </span><span class="nt">properties</span><span class="p">:</span>
<span class="w">    </span><span class="nt">modifies_aggregates</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">array</span>
<span class="w">      </span><span class="nt">items</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> $ref</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;#/$defs/AggId&quot;</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">      </span><span class="nt">maxItems</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w">  </span><span class="c1"># Enforces one-aggregate-per-transaction rule</span>
</code></pre></div>

<p><strong>Why?</strong><br />
- Prevents distributed transaction complexity<br />
- Ensures clear consistency boundaries<br />
- Enables horizontal scaling<br />
- Simplifies error handling</p>
<p><strong>If you need to modify multiple aggregates:</strong></p>
<p>Use domain events and eventual consistency:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ✓ Good: One aggregate per transaction</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">submitOrder</span><span class="p">(</span><span class="n">OrderId</span><span class="w"> </span><span class="n">orderId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">orderId</span><span class="p">);</span>
<span class="w">    </span><span class="n">order</span><span class="p">.</span><span class="na">submit</span><span class="p">();</span><span class="w">  </span><span class="c1">// Modifies ONLY Order aggregate</span>
<span class="w">    </span><span class="n">orderRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">order</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Event published: OrderSubmitted</span>
<span class="p">}</span>

<span class="c1">// Event handler runs in SEPARATE transaction</span>
<span class="nd">@EventHandler</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onOrderSubmitted</span><span class="p">(</span><span class="n">OrderSubmitted</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Inventory</span><span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inventoryRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">productId</span><span class="p">());</span>
<span class="w">    </span><span class="n">inventory</span><span class="p">.</span><span class="na">reserve</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">quantity</span><span class="p">());</span><span class="w">  </span><span class="c1">// Modifies ONLY Inventory aggregate</span>
<span class="w">    </span><span class="n">inventoryRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">inventory</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="identifying-aggregates">Identifying Aggregates<a class="headerlink" href="#identifying-aggregates" title="Permanent link">&para;</a></h4>
<p>From domain stories, look for:</p>
<ol>
<li>
<p><strong>Work objects that always change together</strong> → Likely one aggregate<br />
   - Order and OrderLine always change together → Order aggregate<br />
   - ShoppingCart and CartItem always change together → ShoppingCart aggregate</p>
</li>
<li>
<p><strong>Entry points in stories</strong> → Likely aggregate roots<br />
   - "Customer submits Order" → Order is aggregate root<br />
   - "System creates Shipment" → Shipment is aggregate root</p>
</li>
<li>
<p><strong>Transactional boundaries in business rules</strong><br />
   - "When Order is submitted, total must equal line items" → Order aggregate<br />
   - "Inventory reservation is atomic" → Inventory aggregate</p>
</li>
</ol>
<h4 id="aggregate-examples">Aggregate Examples<a class="headerlink" href="#aggregate-examples" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Order Aggregate</span>
<span class="nt">aggregates</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agg_order</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Order</span>
<span class="w">    </span><span class="nt">root_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ent_order</span>
<span class="w">    </span><span class="nt">entities</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ent_order</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">ent_order_line</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">value_objects</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">vo_money</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">vo_address</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">vo_order_status</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">invariants</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;Order</span><span class="nv"> </span><span class="s">total</span><span class="nv"> </span><span class="s">must</span><span class="nv"> </span><span class="s">equal</span><span class="nv"> </span><span class="s">sum</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">all</span><span class="nv"> </span><span class="s">line</span><span class="nv"> </span><span class="s">items&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;Order</span><span class="nv"> </span><span class="s">must</span><span class="nv"> </span><span class="s">have</span><span class="nv"> </span><span class="s">at</span><span class="nv"> </span><span class="s">least</span><span class="nv"> </span><span class="s">one</span><span class="nv"> </span><span class="s">line</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">when</span><span class="nv"> </span><span class="s">submitted&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;Order</span><span class="nv"> </span><span class="s">cannot</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">modified</span><span class="nv"> </span><span class="s">after</span><span class="nv"> </span><span class="s">submission&quot;</span>
<span class="w">    </span><span class="nt">domain_events</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">evt_order_submitted</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">evt_order_cancelled</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">evt_order_line_added</span>

<span class="c1"># Inventory Aggregate</span>
<span class="nt">aggregates</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agg_inventory</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Inventory</span>
<span class="w">    </span><span class="nt">root_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ent_inventory_item</span>
<span class="w">    </span><span class="nt">entities</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ent_inventory_item</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">value_objects</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">vo_quantity</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">vo_warehouse_location</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">invariants</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;Quantity</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">hand</span><span class="nv"> </span><span class="s">cannot</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">negative&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;Reserved</span><span class="nv"> </span><span class="s">quantity</span><span class="nv"> </span><span class="s">cannot</span><span class="nv"> </span><span class="s">exceed</span><span class="nv"> </span><span class="s">quantity</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">hand&quot;</span>
<span class="w">    </span><span class="nt">domain_events</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">evt_inventory_reserved</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">evt_inventory_restocked</span>
</code></pre></div>

<h3 id="55-repositories">5.5 Repositories<a class="headerlink" href="#55-repositories" title="Permanent link">&para;</a></h3>
<p><strong>Definition</strong>: A <strong>Repository</strong> is an abstraction that provides the illusion of an in-memory collection of aggregates, hiding all persistence details.</p>
<p><strong>Purpose</strong></p>
<p>Repositories serve as the boundary between the domain model and data persistence:</p>
<p><strong>Key Responsibilities:</strong><br />
- Load aggregates by identity<br />
- Save aggregates (create or update)<br />
- Query for aggregates matching criteria<br />
- Hide all database/ORM details from domain layer</p>
<p><strong>One Repository Per Aggregate</strong></p>
<p>Critical rule: Create one repository for each aggregate (not for every entity):</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ✓ Good: One repository per aggregate root</span>
<span class="n">OrderRepository</span><span class="w">  </span><span class="c1">// For Order aggregate</span>
<span class="n">CustomerRepository</span><span class="w">  </span><span class="c1">// For Customer aggregate</span>
<span class="n">InventoryRepository</span><span class="w">  </span><span class="c1">// For Inventory aggregate</span>

<span class="c1">// ❌ Bad: Repositories for internal entities</span>
<span class="n">OrderLineRepository</span><span class="w">  </span><span class="c1">// No! OrderLine is internal to Order aggregate</span>
</code></pre></div>

<p><strong>Repository Interface Pattern</strong></p>
<p>Define repository as interface in domain layer, implement in infrastructure:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Domain layer - interface</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">OrderRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">OrderId</span><span class="w"> </span><span class="nf">nextId</span><span class="p">();</span>
<span class="w">    </span><span class="n">Order</span><span class="w"> </span><span class="nf">findById</span><span class="p">(</span><span class="n">OrderId</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByCustomer</span><span class="p">(</span><span class="n">CustomerId</span><span class="w"> </span><span class="n">customerId</span><span class="p">);</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="p">);</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">remove</span><span class="p">(</span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Infrastructure layer - implementation</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JpaOrderRepository</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">OrderRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@PersistenceContext</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">EntityManager</span><span class="w"> </span><span class="n">entityManager</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="nf">findById</span><span class="p">(</span><span class="n">OrderId</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// JPA/Hibernate details hidden from domain</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">entityManager</span><span class="p">.</span><span class="na">find</span><span class="p">(</span><span class="n">OrderEntity</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">.</span><span class="na">value</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">toDomainModel</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Persistence details encapsulated</span>
<span class="w">        </span><span class="n">OrderEntity</span><span class="w"> </span><span class="n">entity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OrderEntity</span><span class="p">.</span><span class="na">fromDomain</span><span class="p">(</span><span class="n">order</span><span class="p">);</span>
<span class="w">        </span><span class="n">entityManager</span><span class="p">.</span><span class="na">merge</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Repository Methods</strong></p>
<p><strong>Standard Methods:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">Repository</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">ID</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Generate next identity</span>
<span class="w">    </span><span class="n">ID</span><span class="w"> </span><span class="nf">nextId</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Retrieve by identity</span>
<span class="w">    </span><span class="n">T</span><span class="w"> </span><span class="nf">findById</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
<span class="w">    </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByIdOptional</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Save (create or update)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">aggregate</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Remove</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">remove</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">aggregate</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Query Methods:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">OrderRepository</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Repository</span><span class="o">&lt;</span><span class="n">Order</span><span class="p">,</span><span class="w"> </span><span class="n">OrderId</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Find by specific criteria</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByCustomer</span><span class="p">(</span><span class="n">CustomerId</span><span class="w"> </span><span class="n">customerId</span><span class="p">);</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByStatus</span><span class="p">(</span><span class="n">OrderStatus</span><span class="w"> </span><span class="n">status</span><span class="p">);</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findSubmittedBetween</span><span class="p">(</span><span class="n">LocalDate</span><span class="w"> </span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">end</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Count</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="nf">countByCustomer</span><span class="p">(</span><span class="n">CustomerId</span><span class="w"> </span><span class="n">customerId</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Existence check</span>
<span class="w">    </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">existsById</span><span class="p">(</span><span class="n">OrderId</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Best Practices:</strong></p>
<ol>
<li><strong>Return aggregates, not DTOs</strong>: Repository returns full domain objects</li>
<li><strong>Avoid lazy loading across aggregates</strong>: Load complete aggregate or use references</li>
<li><strong>Use specifications for complex queries</strong>: Encapsulate query logic</li>
<li><strong>Consider read models for queries</strong>: CQRS pattern for complex reads</li>
</ol>
<p><strong>In the Schema:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">repositories</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">repo_order</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;OrderRepository&quot;</span>
<span class="w">    </span><span class="nt">aggregate_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agg_order</span>
<span class="w">    </span><span class="nt">operations</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;findById&quot;</span>
<span class="w">        </span><span class="nt">parameters</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;id&quot;</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ref&quot;</span>
<span class="w">            </span><span class="nt">ref_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ent_order&quot;</span>
<span class="w">        </span><span class="nt">return_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ref&quot;</span>
<span class="w">        </span><span class="nt">return_ref_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;agg_order&quot;</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;save&quot;</span>
<span class="w">        </span><span class="nt">parameters</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;order&quot;</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ref&quot;</span>
<span class="w">            </span><span class="nt">ref_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;agg_order&quot;</span>
<span class="w">        </span><span class="nt">return_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;void&quot;</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;findByCustomer&quot;</span>
<span class="w">        </span><span class="nt">parameters</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;customerId&quot;</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;uuid&quot;</span>
<span class="w">        </span><span class="nt">return_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;list&quot;</span>
</code></pre></div>

<h3 id="56-domain-services">5.6 Domain Services<a class="headerlink" href="#56-domain-services" title="Permanent link">&para;</a></h3>
<p><strong>Definition</strong>: A <strong>Domain Service</strong> is a stateless operation that doesn't naturally belong to an entity or value object but is part of the domain.</p>
<p><strong>When to Use Domain Services</strong></p>
<p>Use a domain service when:<br />
- ✓ Operation involves multiple aggregates<br />
- ✓ Operation doesn't naturally belong to any one entity<br />
- ✓ Operation is a significant domain concept (in ubiquitous language)<br />
- ✓ Operation would make an entity or value object awkward</p>
<p><strong>Examples of Domain Services:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Pricing calculation involving multiple factors</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">PricingService</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Money</span><span class="w"> </span><span class="nf">calculatePrice</span><span class="p">(</span><span class="n">Product</span><span class="w"> </span><span class="n">product</span><span class="p">,</span><span class="w"> </span><span class="n">Customer</span><span class="w"> </span><span class="n">customer</span><span class="p">,</span><span class="w"> </span><span class="n">Quantity</span><span class="w"> </span><span class="n">quantity</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Transfer between accounts (involves two aggregates)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">FundsTransferService</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">transfer</span><span class="p">(</span><span class="n">AccountId</span><span class="w"> </span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="n">AccountId</span><span class="w"> </span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="n">amount</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Availability check across inventory locations</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">AvailabilityService</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isAvailable</span><span class="p">(</span><span class="n">ProductId</span><span class="w"> </span><span class="n">productId</span><span class="p">,</span><span class="w"> </span><span class="n">Quantity</span><span class="w"> </span><span class="n">requested</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Domain Service vs Application Service</strong></p>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Domain Service</th>
<th>Application Service</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Layer</strong></td>
<td>Domain layer</td>
<td>Application layer</td>
</tr>
<tr>
<td><strong>Concerns</strong></td>
<td>Pure business logic</td>
<td>Use case orchestration</td>
</tr>
<tr>
<td><strong>Dependencies</strong></td>
<td>Other domain objects</td>
<td>Domain services, repositories, infrastructure</td>
</tr>
<tr>
<td><strong>State</strong></td>
<td>Stateless</td>
<td>Stateless</td>
</tr>
<tr>
<td><strong>Transactions</strong></td>
<td>No transaction mgmt</td>
<td>Manages transactions</td>
</tr>
<tr>
<td><strong>Example</strong></td>
<td><code>PricingService.calculatePrice()</code></td>
<td><code>OrderService.submitOrder()</code></td>
</tr>
</tbody>
</table>
<p><strong>Implementation:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Domain Service - pure business logic</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PricingService</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="nf">calculatePrice</span><span class="p">(</span>
<span class="w">        </span><span class="n">Product</span><span class="w"> </span><span class="n">product</span><span class="p">,</span>
<span class="w">        </span><span class="n">Customer</span><span class="w"> </span><span class="n">customer</span><span class="p">,</span>
<span class="w">        </span><span class="n">Quantity</span><span class="w"> </span><span class="n">quantity</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Money</span><span class="w"> </span><span class="n">basePrice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">product</span><span class="p">.</span><span class="na">price</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// Volume discount</span>
<span class="w">        </span><span class="n">Money</span><span class="w"> </span><span class="n">volumeDiscounted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">applyVolumeDiscount</span><span class="p">(</span><span class="n">basePrice</span><span class="p">,</span><span class="w"> </span><span class="n">quantity</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Customer tier discount</span>
<span class="w">        </span><span class="n">Money</span><span class="w"> </span><span class="n">customerDiscounted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">applyCustomerDiscount</span><span class="p">(</span>
<span class="w">            </span><span class="n">volumeDiscounted</span><span class="p">,</span>
<span class="w">            </span><span class="n">customer</span><span class="p">.</span><span class="na">tier</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">customerDiscounted</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="nf">applyVolumeDiscount</span><span class="p">(</span><span class="n">Money</span><span class="w"> </span><span class="n">price</span><span class="p">,</span><span class="w"> </span><span class="n">Quantity</span><span class="w"> </span><span class="n">qty</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">qty</span><span class="p">.</span><span class="na">isGreaterThan</span><span class="p">(</span><span class="n">Quantity</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">100</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">price</span><span class="p">.</span><span class="na">multiply</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;0.9&quot;</span><span class="p">));</span><span class="w">  </span><span class="c1">// 10% off</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">price</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>In the Schema:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">domain_services</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc_dom_pricing</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;PricingService&quot;</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Calculates</span><span class="nv"> </span><span class="s">product</span><span class="nv"> </span><span class="s">pricing</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">discounts&quot;</span>
<span class="w">    </span><span class="nt">stateless</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">operations</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;calculatePrice&quot;</span>
<span class="w">        </span><span class="nt">parameters</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;product&quot;</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ref&quot;</span>
<span class="w">            </span><span class="nt">ref_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ent_product&quot;</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;customer&quot;</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ref&quot;</span>
<span class="w">            </span><span class="nt">ref_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ent_customer&quot;</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;quantity&quot;</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ref&quot;</span>
<span class="w">            </span><span class="nt">ref_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;vo_quantity&quot;</span>
<span class="w">        </span><span class="nt">return_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ref&quot;</span>
<span class="w">        </span><span class="nt">return_ref_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;vo_money&quot;</span>
</code></pre></div>

<h3 id="57-domain-events">5.7 Domain Events<a class="headerlink" href="#57-domain-events" title="Permanent link">&para;</a></h3>
<p><strong>Definition</strong>: A <strong>Domain Event</strong> is a record of something significant that happened in the domain. It represents a fact—something that occurred in the past.</p>
<p><strong>Characteristics:</strong></p>
<ol>
<li>
<p><strong>Past Tense</strong>: Event names describe what happened<br />
   - <code>OrderSubmitted</code> (not <code>SubmitOrder</code>)<br />
   - <code>PaymentAuthorized</code> (not <code>AuthorizePayment</code>)<br />
   - <code>InventoryRestocked</code> (not <code>RestockInventory</code>)</p>
</li>
<li>
<p><strong>Immutable</strong>: Events are historical facts that cannot change<br />
   - Design requires: <code>immutable: const: true</code></p>
</li>
<li>
<p><strong>Include Relevant Data</strong>: Carry information about what happened<br />
   - Who, what, when, and relevant context</p>
</li>
</ol>
<p><strong>Purpose of Domain Events:</strong></p>
<ol>
<li><strong>Decouple aggregates</strong>: Aggregates communicate via events rather than direct calls</li>
<li><strong>Audit trail</strong>: Events provide complete history of what happened</li>
<li><strong>Eventual consistency</strong>: Enable updates across aggregate boundaries</li>
<li><strong>Integration</strong>: External systems subscribe to events</li>
<li><strong>Event sourcing</strong>: Events can be the source of truth</li>
</ol>
<p><strong>Publishing Events from Aggregates:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Order</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OrderId</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OrderStatus</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">DomainEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">uncommittedEvents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">submit</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Validate invariants</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lines</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">EmptyOrderException</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Change state</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">SUBMITTED</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">submittedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// Record event</span>
<span class="w">        </span><span class="n">addEvent</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">OrderSubmitted</span><span class="p">(</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="p">,</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">customerId</span><span class="p">,</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">total</span><span class="p">,</span>
<span class="w">            </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">        </span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addEvent</span><span class="p">(</span><span class="n">DomainEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">uncommittedEvents</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">DomainEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getUncommittedEvents</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Collections</span><span class="p">.</span><span class="na">unmodifiableList</span><span class="p">(</span><span class="n">uncommittedEvents</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">clearEvents</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">uncommittedEvents</span><span class="p">.</span><span class="na">clear</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Event Structure:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderSubmitted</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">DomainEvent</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">OrderId</span><span class="w"> </span><span class="n">orderId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">CustomerId</span><span class="w"> </span><span class="n">customerId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="n">totalAmount</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">occurredAt</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">OrderSubmitted</span><span class="p">(</span><span class="n">OrderId</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span><span class="w"> </span><span class="n">CustomerId</span><span class="w"> </span><span class="n">customerId</span><span class="p">,</span>
<span class="w">                          </span><span class="n">Money</span><span class="w"> </span><span class="n">totalAmount</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">occurredAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">orderId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">requireNonNull</span><span class="p">(</span><span class="n">orderId</span><span class="p">);</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">customerId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">requireNonNull</span><span class="p">(</span><span class="n">customerId</span><span class="p">);</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">totalAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">requireNonNull</span><span class="p">(</span><span class="n">totalAmount</span><span class="p">);</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">occurredAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">requireNonNull</span><span class="p">(</span><span class="n">occurredAt</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Getters only - immutable</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">OrderId</span><span class="w"> </span><span class="nf">orderId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">orderId</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CustomerId</span><span class="w"> </span><span class="nf">customerId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">customerId</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="nf">totalAmount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">totalAmount</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="nf">occurredAt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">occurredAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>In the Schema:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">domain_events</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">evt_order_submitted</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;OrderSubmitted&quot;</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Raised</span><span class="nv"> </span><span class="s">when</span><span class="nv"> </span><span class="s">customer</span><span class="nv"> </span><span class="s">submits</span><span class="nv"> </span><span class="s">an</span><span class="nv"> </span><span class="s">order&quot;</span>
<span class="w">    </span><span class="nt">aggregate_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agg_order</span>
<span class="w">    </span><span class="nt">immutable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># Enforced by schema</span>
<span class="w">    </span><span class="nt">data_attributes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;order_id&quot;</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;uuid&quot;</span>
<span class="w">        </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;customer_id&quot;</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;uuid&quot;</span>
<span class="w">        </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;total_amount&quot;</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;money&quot;</span>
<span class="w">        </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;occurred_at&quot;</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;datetime&quot;</span>
<span class="w">        </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">triggered_by</span><span class="p">:</span>
<span class="w">      </span><span class="nt">command_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cmd_submit_order&quot;</span>
</code></pre></div>

<p><strong>Event Handlers:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderEventHandlers</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">InventoryService</span><span class="w"> </span><span class="n">inventoryService</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">CustomerRepository</span><span class="w"> </span><span class="n">customerRepository</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onOrderSubmitted</span><span class="p">(</span><span class="n">OrderSubmitted</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Reserve inventory (separate transaction, separate aggregate)</span>
<span class="w">        </span><span class="n">inventoryService</span><span class="p">.</span><span class="na">reserve</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">orderId</span><span class="p">(),</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">items</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateCustomerStatistics</span><span class="p">(</span><span class="n">OrderSubmitted</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Update customer aggregate (separate transaction)</span>
<span class="w">        </span><span class="n">Customer</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">customerRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">customerId</span><span class="p">());</span>
<span class="w">        </span><span class="n">customer</span><span class="p">.</span><span class="na">recordOrderPlaced</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">totalAmount</span><span class="p">());</span>
<span class="w">        </span><span class="n">customerRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">customer</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="58-id-types-and-conventions">5.8 ID Types and Conventions<a class="headerlink" href="#58-id-types-and-conventions" title="Permanent link">&para;</a></h3>
<p>The schemas define explicit ID type patterns for all tactical elements:</p>
<p><strong>ID Prefixes:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Prefix</th>
<th>Pattern</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>Bounded Context</td>
<td><code>bc_</code></td>
<td><code>^bc_[a-z0-9_]+$</code></td>
<td><code>bc_order_management</code></td>
</tr>
<tr>
<td>Aggregate</td>
<td><code>agg_</code></td>
<td><code>^agg_[a-z0-9_]+$</code></td>
<td><code>agg_order</code></td>
</tr>
<tr>
<td>Entity</td>
<td><code>ent_</code></td>
<td><code>^ent_[a-z0-9_]+$</code></td>
<td><code>ent_customer</code></td>
</tr>
<tr>
<td>Value Object</td>
<td><code>vo_</code></td>
<td><code>^vo_[a-z0-9_]+$</code></td>
<td><code>vo_money</code></td>
</tr>
<tr>
<td>Repository</td>
<td><code>repo_</code></td>
<td><code>^repo_[a-z0-9_]+$</code></td>
<td><code>repo_order</code></td>
</tr>
<tr>
<td>Domain Service</td>
<td><code>svc_dom_</code></td>
<td><code>^svc_dom_[a-z0-9_]+$</code></td>
<td><code>svc_dom_pricing</code></td>
</tr>
<tr>
<td>Application Service</td>
<td><code>svc_app_</code></td>
<td><code>^svc_app_[a-z0-9_]+$</code></td>
<td><code>svc_app_order_mgmt</code></td>
</tr>
<tr>
<td>Command</td>
<td><code>cmd_</code></td>
<td><code>^cmd_[a-z0-9_]+$</code></td>
<td><code>cmd_submit_order</code></td>
</tr>
<tr>
<td>Query</td>
<td><code>qry_</code></td>
<td><code>^qry_[a-z0-9_]+$</code></td>
<td><code>qry_get_order</code></td>
</tr>
<tr>
<td>Domain Event</td>
<td><code>evt_</code></td>
<td><code>^evt_[a-z0-9_]+$</code></td>
<td><code>evt_order_submitted</code></td>
</tr>
</tbody>
</table>
<p><strong>Benefits:</strong><br />
- Clear identification of element types<br />
- Enable tooling and code generation<br />
- Consistent naming across schemas<br />
- LLM-friendly patterns</p>
<hr />
<h2 id="6-application-layer">6. Application Layer<a class="headerlink" href="#6-application-layer" title="Permanent link">&para;</a></h2>
<h3 id="61-overview">6.1 Overview<a class="headerlink" href="#61-overview" title="Permanent link">&para;</a></h3>
<p>The <strong>Application Layer</strong> is a critical architectural layer in Domain-Driven Design that sits between the User Interface and the Domain Layer. Its primary responsibility is to orchestrate use case execution without containing business logic.</p>
<p><strong>Eric Evans' Definition:</strong></p>
<blockquote>
<p>"The application layer is responsible for driving the workflow of the application, coordinating the domain objects to perform the actual work."</p>
</blockquote>
<p><strong>Martin Fowler's Service Layer Definition:</strong></p>
<blockquote>
<p>"Defines an application's boundary with a layer of services that establishes a set of available operations and coordinates the application's response in each operation."</p>
</blockquote>
<p><strong>Key Characteristics:</strong></p>
<table>
<thead>
<tr>
<th>Characteristic</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Stateless</strong></td>
<td>Holds no domain state between operations</td>
</tr>
<tr>
<td><strong>Thin</strong></td>
<td>Contains no business logic, only orchestration</td>
</tr>
<tr>
<td><strong>Coordinates</strong></td>
<td>Orchestrates domain objects and domain services</td>
</tr>
<tr>
<td><strong>Transaction Boundary</strong></td>
<td>Manages database transactions</td>
</tr>
<tr>
<td><strong>Use Case Focused</strong></td>
<td>One operation per use case</td>
</tr>
<tr>
<td><strong>External Interface</strong></td>
<td>API exposed to external clients (UI, BFF, API)</td>
</tr>
</tbody>
</table>
<p><strong>Alternative Names:</strong><br />
- <strong>Application Layer</strong> (Eric Evans, <em>DDD Blue Book</em>)<br />
- <strong>Service Layer</strong> (Martin Fowler, <em>PoEAA</em>)<br />
- <strong>Use Case Layer</strong> (Clean Architecture)<br />
- <strong>Command/Query Handlers</strong> (CQRS architecture)</p>
<p><strong>Core Principle</strong>: Application Services contain <strong>NO business logic</strong>—only orchestration logic. Business logic belongs exclusively in the Domain Layer.</p>
<p>Having established the Application Layer's purpose as a stateless orchestrator, let's examine its precise position in the four-layer architecture and how it coordinates between the UI and Domain layers.</p>
<h3 id="62-application-layer-position">6.2 Application Layer Position<a class="headerlink" href="#62-application-layer-position" title="Permanent link">&para;</a></h3>
<h4 id="four-layer-architecture">Four-Layer Architecture<a class="headerlink" href="#four-layer-architecture" title="Permanent link">&para;</a></h4>
<p>Eric Evans defines a four-layer architecture with the Application Layer positioned between UI and Domain:</p>
<div class="codehilite"><pre><span></span><code>┌─────────────────────────────────────────────────┐
│   USER INTERFACE LAYER                          │
│   (Presentation, UI Controls, REST APIs, BFFs)  │
├─────────────────────────────────────────────────┤
│   APPLICATION LAYER ← THIS LAYER                │
│   (Application Services, Use Case Orchestration)│
├─────────────────────────────────────────────────┤
│   DOMAIN LAYER                                  │
│   (Entities, Value Objects, Aggregates,         │
│    Domain Services, Repositories)               │
├─────────────────────────────────────────────────┤
│   INFRASTRUCTURE LAYER                          │
│   (Persistence, External Services, Messaging)   │
└─────────────────────────────────────────────────┘
</code></pre></div>

<h4 id="dependency-direction">Dependency Direction<a class="headerlink" href="#dependency-direction" title="Permanent link">&para;</a></h4>
<p>Dependencies flow in <strong>one direction</strong>:</p>
<div class="codehilite"><pre><span></span><code>UI Layer → Application Layer → Domain Layer
</code></pre></div>

<ul>
<li>User Interface depends on Application Layer</li>
<li>Application Layer depends on Domain Layer</li>
<li>Domain Layer is independent (core of the system)</li>
<li>Infrastructure implements interfaces defined in Domain/Application layers</li>
</ul>
<p><strong>Dependency Inversion Principle:</strong></p>
<p>The Application Layer defines repository interfaces, and the Infrastructure Layer provides implementations:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Application Layer: Defines interface</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">UserRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">);</span>
<span class="w">    </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findById</span><span class="p">(</span><span class="n">UserId</span><span class="w"> </span><span class="n">userId</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Infrastructure Layer: Implements interface</span>
<span class="nd">@Repository</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JpaUserRepository</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">UserRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// JPA implementation</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="application-layer-responsibilities">Application Layer Responsibilities<a class="headerlink" href="#application-layer-responsibilities" title="Permanent link">&para;</a></h4>
<p><strong>What the Application Layer DOES:</strong><br />
- Defines jobs the software is supposed to do<br />
- Directs domain objects to work out problems<br />
- Coordinates domain layer objects to perform actual work<br />
- Manages transaction boundaries<br />
- Publishes domain events<br />
- Performs security and authorization checks<br />
- Validates input format and required fields<br />
- Orchestrates multi-step workflows<br />
- Converts domain objects to DTOs for return</p>
<p><strong>What the Application Layer DOES NOT DO:</strong><br />
- Contain business logic (belongs in Domain Layer)<br />
- Make business decisions (delegates to domain)<br />
- Directly access infrastructure (uses interfaces)<br />
- Maintain state between operations<br />
- Implement domain rules (delegates to aggregates)</p>
<h3 id="63-application-service-pattern">6.3 Application Service Pattern<a class="headerlink" href="#63-application-service-pattern" title="Permanent link">&para;</a></h3>
<h4 id="what-is-an-application-service">What is an Application Service?<a class="headerlink" href="#what-is-an-application-service" title="Permanent link">&para;</a></h4>
<p>An <strong>Application Service</strong> is a stateless object that orchestrates use case execution by:</p>
<ol>
<li>Fetching domain objects from repositories</li>
<li>Executing domain operations on aggregates</li>
<li>Persisting changes back to repositories</li>
<li>Managing transaction boundaries</li>
<li>Publishing domain events to external systems</li>
</ol>
<p><strong>Vaughn Vernon's Guidance:</strong></p>
<blockquote>
<p>"Application Services are the direct clients of the domain model and remain lightweight, coordinating operations performed against domain objects. Application Services should be kept thin, using them only to coordinate tasks on the model."</p>
</blockquote>
<h4 id="application-service-vs-domain-service">Application Service vs Domain Service<a class="headerlink" href="#application-service-vs-domain-service" title="Permanent link">&para;</a></h4>
<p>This distinction is critical in DDD and frequently misunderstood:</p>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Application Service</th>
<th>Domain Service</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Business Logic</strong></td>
<td>None</td>
<td>Contains domain logic</td>
</tr>
<tr>
<td><strong>Transaction Management</strong></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><strong>Repository Access</strong></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><strong>External Dependencies</strong></td>
<td>Yes (repos, infrastructure)</td>
<td>No</td>
</tr>
<tr>
<td><strong>Parameters/Return Types</strong></td>
<td>DTOs, primitives</td>
<td>Domain objects</td>
</tr>
<tr>
<td><strong>Called By</strong></td>
<td>UI, API controllers, BFFs</td>
<td>Application services, other domain services</td>
</tr>
<tr>
<td><strong>Validation</strong></td>
<td>Input format validation</td>
<td>Business rule validation</td>
</tr>
<tr>
<td><strong>Ubiquitous Language</strong></td>
<td>Use case names</td>
<td>Domain concept names</td>
</tr>
<tr>
<td><strong>Example</strong></td>
<td><code>UserApplicationService.createUser()</code></td>
<td><code>UserAuthenticationService.authenticate()</code></td>
</tr>
</tbody>
</table>
<h4 id="application-service-structure-knight-pattern">Application Service Structure (Knight Pattern)<a class="headerlink" href="#application-service-structure-knight-pattern" title="Permanent link">&para;</a></h4>
<p>The Knight codebase demonstrates an elegant pattern using nested command records:</p>
<p><strong>Commands Interface:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">UserCommands</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">UserId</span><span class="w"> </span><span class="nf">createUser</span><span class="p">(</span><span class="n">CreateUserCmd</span><span class="w"> </span><span class="n">cmd</span><span class="p">);</span>

<span class="w">    </span><span class="kd">record</span> <span class="nc">CreateUserCmd</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">email</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">userType</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">identityProvider</span><span class="p">,</span>
<span class="w">        </span><span class="n">ClientId</span><span class="w"> </span><span class="n">clientId</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">activateUser</span><span class="p">(</span><span class="n">ActivateUserCmd</span><span class="w"> </span><span class="n">cmd</span><span class="p">);</span>

<span class="w">    </span><span class="kd">record</span> <span class="nc">ActivateUserCmd</span><span class="p">(</span><span class="n">UserId</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">deactivateUser</span><span class="p">(</span><span class="n">DeactivateUserCmd</span><span class="w"> </span><span class="n">cmd</span><span class="p">);</span>

<span class="w">    </span><span class="kd">record</span> <span class="nc">DeactivateUserCmd</span><span class="p">(</span><span class="n">UserId</span><span class="w"> </span><span class="n">userId</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">reason</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Queries Interface:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">UserQueries</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">record</span> <span class="nc">UserSummary</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">userId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">email</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">userType</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">identityProvider</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="w">    </span><span class="n">UserSummary</span><span class="w"> </span><span class="nf">getUserSummary</span><span class="p">(</span><span class="n">UserId</span><span class="w"> </span><span class="n">userId</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Application Service Implementation:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Singleton</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">UserApplicationService</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">UserCommands</span><span class="p">,</span><span class="w"> </span><span class="n">UserQueries</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">UserRepository</span><span class="w"> </span><span class="n">repository</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ApplicationEventPublisher</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">eventPublisher</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">UserId</span><span class="w"> </span><span class="nf">createUser</span><span class="p">(</span><span class="n">CreateUserCmd</span><span class="w"> </span><span class="n">cmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 1. Generate domain ID</span>
<span class="w">        </span><span class="n">UserId</span><span class="w"> </span><span class="n">userId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// 2. Parse enums (input validation)</span>
<span class="w">        </span><span class="n">User</span><span class="p">.</span><span class="na">UserType</span><span class="w"> </span><span class="n">userType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">User</span><span class="p">.</span><span class="na">UserType</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">userType</span><span class="p">());</span>
<span class="w">        </span><span class="n">User</span><span class="p">.</span><span class="na">IdentityProvider</span><span class="w"> </span><span class="n">identityProvider</span><span class="w"> </span><span class="o">=</span>
<span class="w">            </span><span class="n">User</span><span class="p">.</span><span class="na">IdentityProvider</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">identityProvider</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// 3. Create aggregate (business logic in aggregate)</span>
<span class="w">        </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">User</span><span class="p">.</span><span class="na">create</span><span class="p">(</span>
<span class="w">            </span><span class="n">userId</span><span class="p">,</span>
<span class="w">            </span><span class="n">cmd</span><span class="p">.</span><span class="na">email</span><span class="p">(),</span>
<span class="w">            </span><span class="n">userType</span><span class="p">,</span>
<span class="w">            </span><span class="n">identityProvider</span><span class="p">,</span>
<span class="w">            </span><span class="n">cmd</span><span class="p">.</span><span class="na">clientId</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 4. Save aggregate</span>
<span class="w">        </span><span class="n">repository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 5. Publish event (after persistence)</span>
<span class="w">        </span><span class="n">eventPublisher</span><span class="p">.</span><span class="na">publishEvent</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">UserCreated</span><span class="p">(</span>
<span class="w">            </span><span class="n">userId</span><span class="p">.</span><span class="na">id</span><span class="p">(),</span>
<span class="w">            </span><span class="n">cmd</span><span class="p">.</span><span class="na">email</span><span class="p">(),</span>
<span class="w">            </span><span class="n">cmd</span><span class="p">.</span><span class="na">userType</span><span class="p">(),</span>
<span class="w">            </span><span class="n">cmd</span><span class="p">.</span><span class="na">identityProvider</span><span class="p">(),</span>
<span class="w">            </span><span class="n">Instant</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">        </span><span class="p">));</span>

<span class="w">        </span><span class="c1">// 6. Return domain ID</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">userId</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">activateUser</span><span class="p">(</span><span class="n">ActivateUserCmd</span><span class="w"> </span><span class="n">cmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 1. Load aggregate</span>
<span class="w">        </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">repository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">userId</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">orElseThrow</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span>
<span class="w">                </span><span class="s">&quot;User not found: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">cmd</span><span class="p">.</span><span class="na">userId</span><span class="p">().</span><span class="na">id</span><span class="p">()));</span>

<span class="w">        </span><span class="c1">// 2. Execute domain operation</span>
<span class="w">        </span><span class="n">user</span><span class="p">.</span><span class="na">activate</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// 3. Save aggregate</span>
<span class="w">        </span><span class="n">repository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 4. Publish event</span>
<span class="w">        </span><span class="n">eventPublisher</span><span class="p">.</span><span class="na">publishEvent</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">UserActivated</span><span class="p">(</span>
<span class="w">            </span><span class="n">user</span><span class="p">.</span><span class="na">getUserId</span><span class="p">().</span><span class="na">id</span><span class="p">(),</span>
<span class="w">            </span><span class="n">Instant</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">        </span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">UserSummary</span><span class="w"> </span><span class="nf">getUserSummary</span><span class="p">(</span><span class="n">UserId</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 1. Load aggregate</span>
<span class="w">        </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">repository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">userId</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">orElseThrow</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span>
<span class="w">                </span><span class="s">&quot;User not found: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">userId</span><span class="p">.</span><span class="na">id</span><span class="p">()));</span>

<span class="w">        </span><span class="c1">// 2. Map domain aggregate to DTO</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UserSummary</span><span class="p">(</span>
<span class="w">            </span><span class="n">user</span><span class="p">.</span><span class="na">getUserId</span><span class="p">().</span><span class="na">id</span><span class="p">(),</span>
<span class="w">            </span><span class="n">user</span><span class="p">.</span><span class="na">getEmail</span><span class="p">(),</span>
<span class="w">            </span><span class="n">user</span><span class="p">.</span><span class="na">getStatus</span><span class="p">().</span><span class="na">name</span><span class="p">(),</span>
<span class="w">            </span><span class="n">user</span><span class="p">.</span><span class="na">getUserType</span><span class="p">().</span><span class="na">name</span><span class="p">(),</span>
<span class="w">            </span><span class="n">user</span><span class="p">.</span><span class="na">getIdentityProvider</span><span class="p">().</span><span class="na">name</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Key Benefits:</strong><br />
- Immutable command objects (records are final)<br />
- Type-safe parameters<br />
- Clear intent (one command per operation)<br />
- Minimal boilerplate<br />
- Grouped by aggregate root</p>
<h4 id="coordination-vs-business-logic">Coordination vs Business Logic<a class="headerlink" href="#coordination-vs-business-logic" title="Permanent link">&para;</a></h4>
<p>This distinction is the most critical aspect of Application Services and the most commonly violated principle.</p>
<p><strong>Comparison Table:</strong></p>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Coordination Logic (Application)</th>
<th>Business Logic (Domain)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Responsibility</strong></td>
<td>Load, save, orchestrate</td>
<td>Calculate, validate, enforce rules</td>
</tr>
<tr>
<td><strong>Location</strong></td>
<td>Application Service</td>
<td>Aggregate, Domain Service</td>
</tr>
<tr>
<td><strong>Examples</strong></td>
<td>Fetch from repo, publish events</td>
<td>Pricing, invariants, state transitions</td>
</tr>
<tr>
<td><strong>Dependencies</strong></td>
<td>Repositories, infrastructure</td>
<td>Pure domain objects</td>
</tr>
</tbody>
</table>
<p><strong>Example of Proper Coordination:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Transactional</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">activateCustomer</span><span class="p">(</span><span class="n">ActivateCustomerCmd</span><span class="w"> </span><span class="n">cmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 1. Authorization, 2. Load aggregate</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">authService</span><span class="p">.</span><span class="na">hasPermission</span><span class="p">(</span><span class="n">currentUser</span><span class="p">,</span><span class="w"> </span><span class="n">Permission</span><span class="p">.</span><span class="na">ACTIVATE_CUSTOMER</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UnauthorizedException</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">Customer</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">customerRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">customerId</span><span class="p">())</span>
<span class="w">        </span><span class="p">.</span><span class="na">orElseThrow</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CustomerNotFoundException</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">customerId</span><span class="p">()));</span>

<span class="w">    </span><span class="c1">// 3. Invoke domain operation (business logic in domain)</span>
<span class="w">    </span><span class="n">customer</span><span class="p">.</span><span class="na">activate</span><span class="p">();</span><span class="w">  </span><span class="c1">// &lt;-- Business logic is HERE</span>

<span class="w">    </span><span class="c1">// 4. Persist, 5. Publish event</span>
<span class="w">    </span><span class="n">customerRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">customer</span><span class="p">);</span>
<span class="w">    </span><span class="n">eventPublisher</span><span class="p">.</span><span class="na">publish</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">CustomerActivated</span><span class="p">(</span><span class="n">customer</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span><span class="w"> </span><span class="n">Instant</span><span class="p">.</span><span class="na">now</span><span class="p">()));</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Anti-Pattern: Business Logic in Application Service</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Transactional</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">placeOrder</span><span class="p">(</span><span class="n">PlaceOrderCmd</span><span class="w"> </span><span class="n">cmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">orderId</span><span class="p">());</span>

<span class="w">    </span><span class="c1">// WRONG: Calculations in application service</span>
<span class="w">    </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">OrderItem</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">cmd</span><span class="p">.</span><span class="na">items</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ... discount logic</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">order</span><span class="p">.</span><span class="na">setTotal</span><span class="p">(</span><span class="n">total</span><span class="p">);</span><span class="w">  </span><span class="c1">// Anemic domain model</span>
<span class="w">    </span><span class="n">orderRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">order</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Correct Pattern: Business Logic in Domain</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Application Service (thin coordination)</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">placeOrder</span><span class="p">(</span><span class="n">PlaceOrderCmd</span><span class="w"> </span><span class="n">cmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">orderId</span><span class="p">());</span>
<span class="w">    </span><span class="n">order</span><span class="p">.</span><span class="na">addItems</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">items</span><span class="p">());</span><span class="w">  </span><span class="c1">// Business logic encapsulated</span>
<span class="w">    </span><span class="n">orderRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">order</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Domain Aggregate (rich with business logic)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Order</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addItems</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">items</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">items</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">validateItem</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
<span class="w">            </span><span class="n">applyPricingRules</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
<span class="w">            </span><span class="c1">// ... other business logic</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">totalAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calculateTotal</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="granularity-and-operations">Granularity and Operations<a class="headerlink" href="#granularity-and-operations" title="Permanent link">&para;</a></h4>
<p><strong>Principle:</strong> One application service method = One use case</p>
<p><strong>Good Examples (Fine-Grained, Use Case Aligned):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">UserCommands</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UserId</span><span class="w"> </span><span class="nf">createUser</span><span class="p">(</span><span class="n">CreateUserCmd</span><span class="w"> </span><span class="n">cmd</span><span class="p">);</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">activateUser</span><span class="p">(</span><span class="n">ActivateUserCmd</span><span class="w"> </span><span class="n">cmd</span><span class="p">);</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">deactivateUser</span><span class="p">(</span><span class="n">DeactivateUserCmd</span><span class="w"> </span><span class="n">cmd</span><span class="p">);</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">lockUser</span><span class="p">(</span><span class="n">LockUserCmd</span><span class="w"> </span><span class="n">cmd</span><span class="p">);</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">unlockUser</span><span class="p">(</span><span class="n">UnlockUserCmd</span><span class="w"> </span><span class="n">cmd</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Bad Example (Too Generic):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Anti-pattern: Generic method handling multiple use cases</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">manageUser</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">action</span><span class="p">,</span><span class="w"> </span><span class="n">UserData</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Violates single responsibility principle</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="validation-in-application-services">Validation in Application Services<a class="headerlink" href="#validation-in-application-services" title="Permanent link">&para;</a></h4>
<p><strong>Two-Level Validation Strategy:</strong></p>
<p><strong>Level 1: Application Service - Input Validation</strong><br />
- Format validation (email format, date format)<br />
- Required field validation<br />
- Data type validation<br />
- Lookup validation (checking reference data exists)<br />
- <strong>Action:</strong> Throws exceptions if validation fails<br />
- <strong>Tool:</strong> JSR-303, custom validators</p>
<p><strong>Level 2: Domain Level - Business Rule Validation</strong><br />
- Business invariant enforcement<br />
- Complex domain rules<br />
- Cross-entity validation<br />
- <strong>Action:</strong> Domain returns result indicating success/failure with reasons<br />
- <strong>Location:</strong> Domain aggregates and domain services</p>
<p><strong>Example Flow:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Transactional</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">placeOrder</span><span class="p">(</span><span class="n">PlaceOrderCmd</span><span class="w"> </span><span class="n">cmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 1. Application-level input validation</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">items</span><span class="p">().</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ValidationException</span><span class="p">(</span><span class="s">&quot;Order must have at least one item&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 2. Load aggregate</span>
<span class="w">    </span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Order</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">orderId</span><span class="p">(),</span><span class="w"> </span><span class="n">cmd</span><span class="p">.</span><span class="na">customerId</span><span class="p">());</span>

<span class="w">    </span><span class="c1">// 3. Invoke domain operation (domain validates business rules)</span>
<span class="w">    </span><span class="n">Result</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">addItems</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">items</span><span class="p">());</span>

<span class="w">    </span><span class="c1">// 4. Check business rule validation result</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">result</span><span class="p">.</span><span class="na">isSuccess</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessRuleViolationException</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">getErrors</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 5. Persist and commit</span>
<span class="w">    </span><span class="n">repository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">order</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="64-commandquery-separation-cqrs">6.4 Command/Query Separation (CQRS)<a class="headerlink" href="#64-commandquery-separation-cqrs" title="Permanent link">&para;</a></h3>
<h4 id="pattern-definition">Pattern Definition<a class="headerlink" href="#pattern-definition" title="Permanent link">&para;</a></h4>
<p><strong>CQRS</strong> (Command Query Responsibility Segregation) extends the Command-Query Separation (CQS) principle from the method level to the architectural level.</p>
<p><strong>Martin Fowler's Definition:</strong></p>
<blockquote>
<p>"Use a different model to update information than the model you use to read information."</p>
</blockquote>
<p><strong>Key Distinction:</strong><br />
- <strong>CQS (Bertrand Meyer):</strong> Methods are either commands (change state) or queries (return data), but not both<br />
- <strong>CQRS (Greg Young):</strong> Separate <strong>object models</strong> for commands and queries</p>
<h4 id="commands-vs-queries">Commands vs Queries<a class="headerlink" href="#commands-vs-queries" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Commands</th>
<th>Queries</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Purpose</strong></td>
<td>Change state</td>
<td>Retrieve data</td>
</tr>
<tr>
<td><strong>Side Effects</strong></td>
<td>Yes - modifies data</td>
<td>No - read-only</td>
</tr>
<tr>
<td><strong>Return Value</strong></td>
<td>void / result status / ID</td>
<td>Business data (DTO)</td>
</tr>
<tr>
<td><strong>Naming</strong></td>
<td>Imperative verbs (PlaceOrder, CancelOrder)</td>
<td>Query verbs (GetOrder, ListOrders)</td>
</tr>
<tr>
<td><strong>Validation</strong></td>
<td>Business rules enforced</td>
<td>Input parameter validation only</td>
</tr>
<tr>
<td><strong>Model Used</strong></td>
<td>Write model (domain model)</td>
<td>Read model (query model)</td>
</tr>
<tr>
<td><strong>Optimization</strong></td>
<td>Consistency, integrity</td>
<td>Performance, denormalization</td>
</tr>
<tr>
<td><strong>Database</strong></td>
<td>Write database</td>
<td>Read database (potentially separate)</td>
</tr>
<tr>
<td><strong>Example</strong></td>
<td><code>PlaceOrder</code>, <code>CancelOrder</code></td>
<td><code>GetOrderDetails</code>, <code>ListOrders</code></td>
</tr>
</tbody>
</table>
<h4 id="when-to-use-cqrs-vs-simple-crud">When to Use CQRS vs Simple CRUD<a class="headerlink" href="#when-to-use-cqrs-vs-simple-crud" title="Permanent link">&para;</a></h4>
<p><strong>Use CQRS When:</strong></p>
<ol>
<li><strong>Complex Domains</strong> - Significant differences between read and write operations</li>
<li><strong>Performance Requirements</strong> - High read-to-write ratio (&gt; 10:1), need independent scaling</li>
<li><strong>Collaborative Domains</strong> - Multiple users operating on same data</li>
<li><strong>Event-Driven Architecture</strong> - Already using Event Sourcing</li>
<li><strong>Specific Bounded Contexts</strong> - Apply to portions of system, not entire system</li>
</ol>
<p><strong>Do NOT Use CQRS When:</strong></p>
<ol>
<li><strong>Simple CRUD Applications</strong> - Straightforward create/read/update/delete operations</li>
<li><strong>Low Complexity Domains</strong> - No significant difference between read and write needs</li>
<li><strong>Small Systems</strong> - Complexity overhead not justified</li>
<li><strong>Starting New Projects</strong> - Begin simpler, add CQRS later if needed</li>
</ol>
<p><strong>Martin Fowler's Caution:</strong></p>
<blockquote>
<p>"You should be very cautious about using CQRS. Many information systems fit well with the notion of an information base that is updated in the same way that it's read, adding CQRS to such a system can add significant complexity."</p>
</blockquote>
<h4 id="command-side-write-model">Command Side (Write Model)<a class="headerlink" href="#command-side-write-model" title="Permanent link">&para;</a></h4>
<p>The command side uses the domain model with its rich business logic, aggregates, and invariants.</p>
<p><strong>Command Processing Flow:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">1. Client submits Command (e.g., PlaceOrderCmd)</span>
<span class="l l-Scalar l-Scalar-Plain">2. Command Handler (Application Service) receives command</span>
<span class="l l-Scalar l-Scalar-Plain">3. Validate input format and required fields</span>
<span class="l l-Scalar l-Scalar-Plain">4. Load Aggregate from Repository</span>
<span class="l l-Scalar l-Scalar-Plain">5. Execute domain operation on Aggregate</span>
<span class="l l-Scalar l-Scalar-Plain">6. Aggregate validates business rules and invariants</span>
<span class="l l-Scalar l-Scalar-Plain">7. Persist Aggregate to Write Database</span>
<span class="l l-Scalar l-Scalar-Plain">8. Collect Domain Events from Aggregate</span>
<span class="l l-Scalar l-Scalar-Plain">9. Publish Domain Events</span>
<span class="l l-Scalar l-Scalar-Plain">10. Return result (void, ID, or acknowledgment)</span>
</code></pre></div>

<p><strong>Schema Support:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">command_interfaces</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmd_order_commands</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OrderCommands</span>
<span class="w">    </span><span class="nt">aggregate_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agg_order</span>
<span class="w">    </span><span class="nt">command_records</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">record_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PlaceOrderCmd</span>
<span class="w">        </span><span class="nt">intent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">placeOrder</span>
<span class="w">        </span><span class="nt">parameters</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customerId</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CustomerId</span>
<span class="w">            </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">items</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">List&lt;OrderItem&gt;</span>
<span class="w">            </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">returns</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">domain_id</span>
<span class="w">        </span><span class="nt">return_type_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vo_order_id</span>
<span class="w">        </span><span class="nt">modifies_aggregate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agg_order</span>
<span class="w">        </span><span class="nt">publishes_events</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">evt_order_placed</span>
</code></pre></div>

<h4 id="query-side-read-model">Query Side (Read Model)<a class="headerlink" href="#query-side-read-model" title="Permanent link">&para;</a></h4>
<p>The query side bypasses the domain model and reads directly from optimized read models.</p>
<p><strong>Query Processing Flow:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">1. Client submits Query (e.g., GetOrderSummary)</span>
<span class="l l-Scalar l-Scalar-Plain">2. Query Handler (Application Service) receives query</span>
<span class="l l-Scalar l-Scalar-Plain">3. Validate query parameters</span>
<span class="l l-Scalar l-Scalar-Plain">4. Query Read Model directly (bypass domain model)</span>
<span class="l l-Scalar l-Scalar-Plain">5. Transform data to DTO</span>
<span class="l l-Scalar l-Scalar-Plain">6. Return DTO to client</span>
</code></pre></div>

<p><strong>Schema Support:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">query_interfaces</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qry_order_queries</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OrderQueries</span>
<span class="w">    </span><span class="nt">aggregate_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agg_order</span>
<span class="w">    </span><span class="nt">query_methods</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">method_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">getOrderSummary</span>
<span class="w">        </span><span class="nt">parameters</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">orderId</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OrderId</span>
<span class="w">            </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">result_record_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OrderSummary</span>
<span class="w">        </span><span class="nt">result_structure</span><span class="p">:</span>
<span class="w">          </span><span class="nt">fields</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">orderId</span>
<span class="w">              </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">String</span>
<span class="w">              </span><span class="nt">serialization</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;OrderId.value()&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">status</span>
<span class="w">              </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">String</span>
<span class="w">              </span><span class="nt">serialization</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;status.name()&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">totalAmount</span>
<span class="w">              </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BigDecimal</span>
<span class="w">        </span><span class="nt">bypasses_domain_model</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">optimizations</span><span class="p">:</span>
<span class="w">          </span><span class="nt">denormalized</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">          </span><span class="nt">cached</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">          </span><span class="nt">indexed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>

<h4 id="cqrs-lite-same-database">CQRS-Lite (Same Database)<a class="headerlink" href="#cqrs-lite-same-database" title="Permanent link">&para;</a></h4>
<p>For many systems, you can gain benefits of CQRS without the complexity of separate databases:</p>
<p><strong>Approach:</strong><br />
- Separate command and query handlers<br />
- Same database for both<br />
- Different tables optimized for reads vs. writes<br />
- Update read tables in same transaction as write</p>
<p><strong>Benefits:</strong><br />
- Maintains immediate consistency<br />
- Simpler infrastructure<br />
- Clear separation of concerns<br />
- Independent handler optimization</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Write to domain tables</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span><span class="w"> </span><span class="n">OrderId</span><span class="w"> </span><span class="nf">placeOrder</span><span class="p">(</span><span class="n">PlaceOrderCmd</span><span class="w"> </span><span class="n">cmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Write to normalized domain tables</span>
<span class="w">    </span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Order</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">orderId</span><span class="p">(),</span><span class="w"> </span><span class="n">cmd</span><span class="p">.</span><span class="na">customerId</span><span class="p">());</span>
<span class="w">    </span><span class="n">order</span><span class="p">.</span><span class="na">addItems</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">items</span><span class="p">());</span>
<span class="w">    </span><span class="n">orderRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">order</span><span class="p">);</span><span class="w">  </span><span class="c1">// Writes to order, order_items tables</span>

<span class="w">    </span><span class="c1">// Update denormalized read table in same transaction</span>
<span class="w">    </span><span class="n">OrderSummary</span><span class="w"> </span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buildSummary</span><span class="p">(</span><span class="n">order</span><span class="p">);</span>
<span class="w">    </span><span class="n">readRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">summary</span><span class="p">);</span><span class="w">  </span><span class="c1">// Writes to order_summary table</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">getId</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// Read from denormalized read table</span>
<span class="kd">public</span><span class="w"> </span><span class="n">OrderSummary</span><span class="w"> </span><span class="nf">getOrderSummary</span><span class="p">(</span><span class="n">OrderId</span><span class="w"> </span><span class="n">orderId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Query optimized read table directly</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">readRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">orderId</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="eventual-consistency-in-cqrs">Eventual Consistency in CQRS<a class="headerlink" href="#eventual-consistency-in-cqrs" title="Permanent link">&para;</a></h4>
<p>When using CQRS with separate databases or tables, the read model becomes eventually consistent with the write model.</p>
<p><strong>Implications:</strong><br />
- Users may see stale data briefly after a command<br />
- UI must handle scenarios where data hasn't updated yet<br />
- Business processes must account for synchronization delays<br />
- Error handling for sync failures is required</p>
<p><strong>Mitigation Strategies:</strong></p>
<p><strong>1. Optimistic UI Updates:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Client-side: Optimistically update UI immediately</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">placeOrder</span><span class="p">(</span><span class="nx">orderData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Update UI immediately (optimistic)</span>
<span class="w">    </span><span class="nx">displayOrderConfirmation</span><span class="p">(</span><span class="nx">orderData</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Submit command</span>
<span class="w">    </span><span class="nx">api</span><span class="p">.</span><span class="nx">placeOrder</span><span class="p">(</span><span class="nx">orderData</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Command succeeded</span>
<span class="w">            </span><span class="nx">updateWithServerData</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">        </span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Command failed - revert UI</span>
<span class="w">            </span><span class="nx">revertOptimisticUpdate</span><span class="p">();</span>
<span class="w">            </span><span class="nx">displayError</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>2. Command Result with Projection:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Return projection immediately with command result</span>
<span class="kd">public</span><span class="w"> </span><span class="n">OrderPlacedResult</span><span class="w"> </span><span class="nf">placeOrder</span><span class="p">(</span><span class="n">PlaceOrderCmd</span><span class="w"> </span><span class="n">cmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Execute command on write model</span>
<span class="w">    </span><span class="n">OrderId</span><span class="w"> </span><span class="n">orderId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">commandHandler</span><span class="p">.</span><span class="na">handle</span><span class="p">(</span><span class="n">cmd</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Immediately build projection from write model</span>
<span class="w">    </span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">orderId</span><span class="p">);</span>
<span class="w">    </span><span class="n">OrderSummary</span><span class="w"> </span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OrderSummaryMapper</span><span class="p">.</span><span class="na">toDTO</span><span class="p">(</span><span class="n">order</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderPlacedResult</span><span class="p">(</span><span class="n">orderId</span><span class="p">,</span><span class="w"> </span><span class="n">summary</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="65-transaction-boundaries">6.5 Transaction Boundaries<a class="headerlink" href="#65-transaction-boundaries" title="Permanent link">&para;</a></h3>
<h4 id="fundamental-rule-one-aggregate-per-transaction">Fundamental Rule: One Aggregate Per Transaction<a class="headerlink" href="#fundamental-rule-one-aggregate-per-transaction" title="Permanent link">&para;</a></h4>
<p><strong>Vaughn Vernon's Rule:</strong></p>
<blockquote>
<p>"Modify only ONE aggregate instance per transaction"</p>
</blockquote>
<p>This rule is the most important transaction management principle in DDD and is required by the tactical pattern:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">TransactionBoundary</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">object</span>
<span class="w">  </span><span class="nt">properties</span><span class="p">:</span>
<span class="w">    </span><span class="nt">modifies_aggregates</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">array</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Aggregates</span><span class="nv"> </span><span class="s">modified</span><span class="nv"> </span><span class="s">by</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">operation</span><span class="nv"> </span><span class="s">(should</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">0-1</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">commands)&quot;</span>
<span class="w">      </span><span class="nt">items</span><span class="p">:</span>
<span class="w">        </span><span class="nt">$ref</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;#/$defs/AggId&quot;</span>
<span class="w">      </span><span class="nt">maxItems</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w">  </span><span class="c1"># Design enforces the rule</span>
</code></pre></div>

<p><strong>Validation Rule:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">validation_rules</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">rule</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;one_aggregate_per_transaction&quot;</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Command</span><span class="nv"> </span><span class="s">must</span><span class="nv"> </span><span class="s">modify</span><span class="nv"> </span><span class="s">at</span><span class="nv"> </span><span class="s">most</span><span class="nv"> </span><span class="s">one</span><span class="nv"> </span><span class="s">aggregate</span><span class="nv"> </span><span class="s">per</span><span class="nv"> </span><span class="s">transaction</span><span class="nv"> </span><span class="s">(Vaughn</span><span class="nv"> </span><span class="s">Vernon</span><span class="nv"> </span><span class="s">rule)&quot;</span>
<span class="w">    </span><span class="nt">validation</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;For</span><span class="nv"> </span><span class="s">each</span><span class="nv"> </span><span class="s">operation</span><span class="nv"> </span><span class="s">where</span><span class="nv"> </span><span class="s">type=&#39;command&#39;,</span>
<span class="w">                 </span><span class="s">transaction_boundary.modifies_aggregates</span><span class="nv"> </span><span class="s">must</span><span class="nv"> </span><span class="s">have</span><span class="nv"> </span><span class="s">maxItems:</span><span class="nv"> </span><span class="s">1&quot;</span>
</code></pre></div>

<h4 id="why-one-aggregate-per-transaction">Why One Aggregate Per Transaction?<a class="headerlink" href="#why-one-aggregate-per-transaction" title="Permanent link">&para;</a></h4>
<p><strong>Reason 1: Aggregate = Consistency Boundary</strong></p>
<p>Aggregates define consistency boundaries. A transaction ensures all invariants within an aggregate are maintained:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Order</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">items</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="n">totalAmount</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Invariant: total must equal sum of items</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addItem</span><span class="p">(</span><span class="n">OrderItem</span><span class="w"> </span><span class="n">item</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">items</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
<span class="w">        </span><span class="n">totalAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calculateTotal</span><span class="p">();</span><span class="w">  </span><span class="c1">// Invariant maintained</span>

<span class="w">        </span><span class="c1">// Transaction ensures both are saved atomically</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>If transactions could span multiple aggregates, you'd create distributed transactions across consistency boundaries—defeating the purpose of aggregates.</p>
<p><strong>Reason 2: Scalability</strong></p>
<p>Single-aggregate transactions:<br />
- Can be executed independently<br />
- Allow horizontal scaling<br />
- Avoid distributed transaction coordination<br />
- Enable partitioning by aggregate ID</p>
<p><strong>Reason 3: Avoid Deadlocks</strong></p>
<p>Multi-aggregate transactions increase deadlock risk:<br />
- Transaction A locks Order, then Inventory<br />
- Transaction B locks Inventory, then Order<br />
- Deadlock!</p>
<p>Single-aggregate transactions eliminate this risk.</p>
<p><strong>Reason 4: Clearer Design</strong></p>
<p>The one-aggregate rule forces you to think carefully about aggregate boundaries:<br />
- Are these truly separate aggregates?<br />
- Should they be unified?<br />
- Can they coordinate via eventual consistency?</p>
<h4 id="single-transaction-per-use-case">Single Transaction Per Use Case<a class="headerlink" href="#single-transaction-per-use-case" title="Permanent link">&para;</a></h4>
<p>Each application service method defines one transaction boundary:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Transactional</span><span class="w">  </span><span class="c1">// Transaction starts here</span>
<span class="kd">public</span><span class="w"> </span><span class="n">OrderId</span><span class="w"> </span><span class="nf">placeOrder</span><span class="p">(</span><span class="n">PlaceOrderCmd</span><span class="w"> </span><span class="n">cmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// All operations in this method execute in one transaction</span>

<span class="w">    </span><span class="c1">// 1. Load aggregate</span>
<span class="w">    </span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Order</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">orderId</span><span class="p">(),</span><span class="w"> </span><span class="n">cmd</span><span class="p">.</span><span class="na">customerId</span><span class="p">());</span>

<span class="w">    </span><span class="c1">// 2. Execute domain operations</span>
<span class="w">    </span><span class="n">order</span><span class="p">.</span><span class="na">addItems</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">items</span><span class="p">());</span>
<span class="w">    </span><span class="n">order</span><span class="p">.</span><span class="na">setShippingAddress</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">shippingAddress</span><span class="p">());</span>

<span class="w">    </span><span class="c1">// 3. Persist</span>
<span class="w">    </span><span class="n">orderRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">order</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 4. Collect events</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">DomainEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">events</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">getDomainEvents</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Transaction commits here</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">getId</span><span class="p">();</span>
<span class="p">}</span><span class="w">  </span><span class="c1">// COMMIT</span>

<span class="c1">// After commit, publish events</span>
</code></pre></div>

<p><strong>Key Points:</strong><br />
- Transaction demarcation at application service boundary<br />
- Domain layer is unaware of transactions<br />
- Commit happens when method returns successfully<br />
- Rollback happens on exception</p>
<h4 id="consistency-types-transactional-vs-eventual">Consistency Types: Transactional vs Eventual<a class="headerlink" href="#consistency-types-transactional-vs-eventual" title="Permanent link">&para;</a></h4>
<p>DDD distinguishes two consistency types:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">consistency_type</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">  </span><span class="nt">enum</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">transactional</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">eventual</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Immediate</span><span class="nv"> </span><span class="s">(transactional)</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">deferred</span><span class="nv"> </span><span class="s">(eventual)</span><span class="nv"> </span><span class="s">consistency&quot;</span>
</code></pre></div>

<p><strong>Transactional Consistency (Immediate)</strong></p>
<p>Used within a single aggregate:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Transactional</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">placeOrder</span><span class="p">(</span><span class="n">PlaceOrderCmd</span><span class="w"> </span><span class="n">cmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Single aggregate, single transaction</span>
<span class="w">    </span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Order</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">orderId</span><span class="p">(),</span><span class="w"> </span><span class="n">cmd</span><span class="p">.</span><span class="na">customerId</span><span class="p">());</span>
<span class="w">    </span><span class="n">order</span><span class="p">.</span><span class="na">addItems</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">items</span><span class="p">());</span><span class="w">      </span><span class="c1">// Invariants enforced immediately</span>
<span class="w">    </span><span class="n">order</span><span class="p">.</span><span class="na">calculateTotal</span><span class="p">();</span><span class="w">            </span><span class="c1">// Consistency immediate</span>

<span class="w">    </span><span class="n">orderRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">order</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// All changes committed atomically</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Characteristics:</strong><br />
- ACID guarantees<br />
- Immediate consistency<br />
- Within aggregate boundary<br />
- Rollback on failure</p>
<p><strong>Eventual Consistency (Deferred)</strong></p>
<p>Used between aggregates:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Transaction 1: Place order</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span><span class="w"> </span><span class="n">OrderId</span><span class="w"> </span><span class="nf">placeOrder</span><span class="p">(</span><span class="n">PlaceOrderCmd</span><span class="w"> </span><span class="n">cmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Order</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">orderId</span><span class="p">(),</span><span class="w"> </span><span class="n">cmd</span><span class="p">.</span><span class="na">customerId</span><span class="p">());</span>
<span class="w">    </span><span class="n">order</span><span class="p">.</span><span class="na">addItems</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">items</span><span class="p">());</span>
<span class="w">    </span><span class="n">orderRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">order</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Publish event for other aggregates</span>
<span class="w">    </span><span class="n">eventPublisher</span><span class="p">.</span><span class="na">publish</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">OrderPlaced</span><span class="p">(</span><span class="n">order</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">getItems</span><span class="p">()));</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">getId</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// Transaction 2: Reserve inventory (separate transaction)</span>
<span class="nd">@EventListener</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">OrderPlaced</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Inventory</span><span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inventoryRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getWarehouseId</span><span class="p">());</span>
<span class="w">    </span><span class="n">inventory</span><span class="p">.</span><span class="na">reserveItems</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getItems</span><span class="p">());</span>
<span class="w">    </span><span class="n">inventoryRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">inventory</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Characteristics:</strong><br />
- No distributed transaction<br />
- Temporary inconsistency acceptable<br />
- Asynchronous coordination<br />
- Each aggregate in its own transaction</p>
<h4 id="when-to-use-eventual-consistency">When to Use Eventual Consistency<a class="headerlink" href="#when-to-use-eventual-consistency" title="Permanent link">&para;</a></h4>
<p>Ask these questions to determine if eventual consistency is acceptable:</p>
<p><strong>Question 1: Is it the user's job to make data consistent?</strong><br />
- YES → Use transactional consistency<br />
- NO → Use eventual consistency</p>
<p>Example:<br />
- Placing an order: User's job (transactional)<br />
- Updating inventory: System's job (eventual)</p>
<p><strong>Question 2: Must the invariant be enforced immediately?</strong><br />
- YES → Transactional (true invariant)<br />
- NO → Eventual</p>
<p>Example:<br />
- Order total = sum of items: True invariant (transactional)<br />
- Inventory count reflects all orders: Not a true invariant (eventual)</p>
<p><strong>Question 3: Can the business tolerate a delay?</strong><br />
- YES → Eventual consistency acceptable<br />
- NO → Consider if you've designed the right boundaries</p>
<p>Example:<br />
- Welcome email: Delay acceptable (eventual)<br />
- Password reset token: Delay problematic (transactional)</p>
<h4 id="sagas-for-complex-workflows">Sagas for Complex Workflows<a class="headerlink" href="#sagas-for-complex-workflows" title="Permanent link">&para;</a></h4>
<p>For long-running processes spanning multiple aggregates, use the <strong>Saga Pattern</strong>:</p>
<div class="codehilite"><pre><span></span><code>OrderSaga coordinating Order, Inventory, Payment, Shipping

Step 1: Create Order
  BEGIN TRANSACTION
    order = Order.create()
    orderRepository.save(order)
  COMMIT
  PUBLISH OrderCreated

Step 2: Reserve Inventory (event handler)
  ON EVENT OrderCreated
    BEGIN TRANSACTION
      inventory.reserve(items)
      inventoryRepository.save(inventory)
    COMMIT
    PUBLISH InventoryReserved

Step 3: Process Payment (event handler)
  ON EVENT InventoryReserved
    BEGIN TRANSACTION
      payment.process(amount)
      paymentRepository.save(payment)
    COMMIT
    PUBLISH PaymentProcessed (or PaymentFailed)

Step 4: Complete Order (event handler)
  ON EVENT PaymentProcessed
    BEGIN TRANSACTION
      order.complete()
      orderRepository.save(order)
    COMMIT
    PUBLISH OrderCompleted

// Compensation on failure
  ON EVENT PaymentFailed
    BEGIN TRANSACTION
      inventory.release(items)
      inventoryRepository.save(inventory)
    COMMIT
    BEGIN TRANSACTION
      order.cancel()
      orderRepository.save(order)
    COMMIT
</code></pre></div>

<h3 id="66-application-service-orchestration">6.6 Application Service Orchestration<a class="headerlink" href="#66-application-service-orchestration" title="Permanent link">&para;</a></h3>
<h4 id="applicationserviceoperation-structure">ApplicationServiceOperation Structure<a class="headerlink" href="#applicationserviceoperation-structure" title="Permanent link">&para;</a></h4>
<p>The tactical schema defines a structured workflow for application service operations:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">ApplicationServiceOperation</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">object</span>
<span class="w">  </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">name</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">type</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">properties</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">      </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;^[a-z][a-zA-Z]+$&quot;</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Operation</span><span class="nv"> </span><span class="s">method</span><span class="nv"> </span><span class="s">name</span><span class="nv"> </span><span class="s">(e.g.,</span><span class="nv"> </span><span class="s">createUser,</span><span class="nv"> </span><span class="s">placeOrder)&quot;</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">      </span><span class="nt">enum</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">command</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">query</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Whether</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">operation</span><span class="nv"> </span><span class="s">modifies</span><span class="nv"> </span><span class="s">state</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">retrieves</span><span class="nv"> </span><span class="s">data&quot;</span>
<span class="w">    </span><span class="nt">transaction_boundary</span><span class="p">:</span>
<span class="w">      </span><span class="nt">$ref</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;#/$defs/TransactionBoundary&quot;</span>
<span class="w">    </span><span class="nt">workflow</span><span class="p">:</span>
<span class="w">      </span><span class="nt">$ref</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;#/$defs/Workflow&quot;</span>
</code></pre></div>

<h4 id="workflow-structure">Workflow Structure<a class="headerlink" href="#workflow-structure" title="Permanent link">&para;</a></h4>
<p>The <code>Workflow</code> type defines orchestration steps:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">Workflow</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">object</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Orchestration</span><span class="nv"> </span><span class="s">workflow</span><span class="nv"> </span><span class="s">steps&quot;</span>
<span class="w">  </span><span class="nt">properties</span><span class="p">:</span>
<span class="w">    </span><span class="nt">validates_input</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">boolean</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Performs</span><span class="nv"> </span><span class="s">input/format</span><span class="nv"> </span><span class="s">validation&quot;</span>
<span class="w">      </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">loads_aggregates</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">array</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Aggregates</span><span class="nv"> </span><span class="s">loaded</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">repositories&quot;</span>
<span class="w">      </span><span class="nt">items</span><span class="p">:</span>
<span class="w">        </span><span class="nt">$ref</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;#/$defs/AggId&quot;</span>
<span class="w">    </span><span class="nt">invokes_domain_operations</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">array</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Domain</span><span class="nv"> </span><span class="s">operations</span><span class="nv"> </span><span class="s">invoked</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">aggregates&quot;</span>
<span class="w">      </span><span class="nt">items</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">    </span><span class="nt">invokes_domain_services</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">array</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Domain</span><span class="nv"> </span><span class="s">services</span><span class="nv"> </span><span class="s">invoked&quot;</span>
<span class="w">      </span><span class="nt">items</span><span class="p">:</span>
<span class="w">        </span><span class="nt">$ref</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;#/$defs/SvcDomId&quot;</span>
<span class="w">    </span><span class="nt">persists_aggregates</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">boolean</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Saves</span><span class="nv"> </span><span class="s">aggregates</span><span class="nv"> </span><span class="s">back</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">repository&quot;</span>
<span class="w">      </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">publishes_events</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">array</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Domain</span><span class="nv"> </span><span class="s">events</span><span class="nv"> </span><span class="s">published</span><span class="nv"> </span><span class="s">after</span><span class="nv"> </span><span class="s">successful</span><span class="nv"> </span><span class="s">execution&quot;</span>
<span class="w">      </span><span class="nt">items</span><span class="p">:</span>
<span class="w">        </span><span class="nt">$ref</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;#/$defs/EvtId&quot;</span>
<span class="w">    </span><span class="nt">returns_dto</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;DTO</span><span class="nv"> </span><span class="s">returned</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">queries&quot;</span>
</code></pre></div>

<h4 id="complete-workflow-example">Complete Workflow Example<a class="headerlink" href="#complete-workflow-example" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="nd">@Transactional</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">deactivateUser</span><span class="p">(</span><span class="n">DeactivateUserCmd</span><span class="w"> </span><span class="n">cmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Step 1: Validate input</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">userId</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ValidationException</span><span class="p">(</span><span class="s">&quot;User ID is required&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">StringUtils</span><span class="p">.</span><span class="na">isBlank</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">reason</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ValidationException</span><span class="p">(</span><span class="s">&quot;Deactivation reason is required&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Step 2: Load aggregate</span>
<span class="w">    </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">userId</span><span class="p">())</span>
<span class="w">        </span><span class="p">.</span><span class="na">orElseThrow</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UserNotFoundException</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">userId</span><span class="p">()));</span>

<span class="w">    </span><span class="c1">// Step 3: Invoke domain service (if needed)</span>
<span class="w">    </span><span class="c1">// In this case, no domain service needed</span>

<span class="w">    </span><span class="c1">// Step 4: Invoke domain operation</span>
<span class="w">    </span><span class="n">user</span><span class="p">.</span><span class="na">deactivate</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">reason</span><span class="p">());</span>

<span class="w">    </span><span class="c1">// Step 5: Persist aggregate</span>
<span class="w">    </span><span class="n">userRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Step 6: Publish events</span>
<span class="w">    </span><span class="n">eventPublisher</span><span class="p">.</span><span class="na">publishEvent</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">UserDeactivated</span><span class="p">(</span>
<span class="w">        </span><span class="n">user</span><span class="p">.</span><span class="na">getUserId</span><span class="p">().</span><span class="na">value</span><span class="p">(),</span>
<span class="w">        </span><span class="n">cmd</span><span class="p">.</span><span class="na">reason</span><span class="p">(),</span>
<span class="w">        </span><span class="n">Instant</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">    </span><span class="p">));</span>

<span class="w">    </span><span class="c1">// Step 7: Return (void for state transitions)</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="domain-event-publishing-patterns">Domain Event Publishing Patterns<a class="headerlink" href="#domain-event-publishing-patterns" title="Permanent link">&para;</a></h4>
<p>Application Services are responsible for publishing domain events after successful transactions.</p>
<p><strong>Pattern 1: Collect and Publish After Commit</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Transactional</span>
<span class="kd">public</span><span class="w"> </span><span class="n">OrderId</span><span class="w"> </span><span class="nf">placeOrder</span><span class="p">(</span><span class="n">PlaceOrderCmd</span><span class="w"> </span><span class="n">cmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Order</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">orderId</span><span class="p">(),</span><span class="w"> </span><span class="n">cmd</span><span class="p">.</span><span class="na">customerId</span><span class="p">());</span>
<span class="w">    </span><span class="n">order</span><span class="p">.</span><span class="na">addItems</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">items</span><span class="p">());</span>

<span class="w">    </span><span class="n">orderRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">order</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Collect events from aggregate</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">DomainEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">events</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">getDomainEvents</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Register for publishing after commit</span>
<span class="w">    </span><span class="n">TransactionSynchronizationManager</span><span class="p">.</span><span class="na">registerSynchronization</span><span class="p">(</span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">AfterCommitPublisher</span><span class="p">(</span><span class="n">events</span><span class="p">,</span><span class="w"> </span><span class="n">eventPublisher</span><span class="p">)</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">getId</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">AfterCommitPublisher</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">TransactionSynchronizationAdapter</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">afterCommit</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">events</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">publisher</span><span class="p">::</span><span class="n">publish</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Pattern 2: Outbox Pattern for Reliability</strong></p>
<p>For guaranteed event delivery:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Transactional</span>
<span class="kd">public</span><span class="w"> </span><span class="n">OrderId</span><span class="w"> </span><span class="nf">placeOrder</span><span class="p">(</span><span class="n">PlaceOrderCmd</span><span class="w"> </span><span class="n">cmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 1. Execute domain operation</span>
<span class="w">    </span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Order</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">orderId</span><span class="p">(),</span><span class="w"> </span><span class="n">cmd</span><span class="p">.</span><span class="na">customerId</span><span class="p">());</span>
<span class="w">    </span><span class="n">order</span><span class="p">.</span><span class="na">addItems</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">items</span><span class="p">());</span>
<span class="w">    </span><span class="n">orderRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">order</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 2. Write events to outbox table in same transaction</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">DomainEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">events</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">getDomainEvents</span><span class="p">();</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">DomainEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">events</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">OutboxMessage</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OutboxMessage</span><span class="p">(</span>
<span class="w">            </span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">(),</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">getName</span><span class="p">(),</span>
<span class="w">            </span><span class="n">objectMapper</span><span class="p">.</span><span class="na">writeValueAsString</span><span class="p">(</span><span class="n">event</span><span class="p">),</span>
<span class="w">            </span><span class="n">Instant</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">        </span><span class="n">outboxRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">getId</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// Separate background process publishes from outbox</span>
<span class="nd">@Scheduled</span><span class="p">(</span><span class="n">fixedDelay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">publishOutboxMessages</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">OutboxMessage</span><span class="o">&gt;</span><span class="w"> </span><span class="n">pending</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">outboxRepository</span><span class="p">.</span><span class="na">findUnpublished</span><span class="p">();</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">OutboxMessage</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">pending</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">DomainEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">deserializeEvent</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
<span class="w">            </span><span class="n">eventPublisher</span><span class="p">.</span><span class="na">publish</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>

<span class="w">            </span><span class="n">message</span><span class="p">.</span><span class="na">markPublished</span><span class="p">();</span>
<span class="w">            </span><span class="n">outboxRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Retry later</span>
<span class="w">            </span><span class="n">message</span><span class="p">.</span><span class="na">incrementRetryCount</span><span class="p">();</span>
<span class="w">            </span><span class="n">outboxRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="67-read-models-and-dtos">6.7 Read Models and DTOs<a class="headerlink" href="#67-read-models-and-dtos" title="Permanent link">&para;</a></h3>
<h4 id="read-model-purpose">Read Model Purpose<a class="headerlink" href="#read-model-purpose" title="Permanent link">&para;</a></h4>
<p>Read Models serve a fundamentally different purpose than write models. While write models enforce business rules and maintain transactional consistency, read models optimize for query performance and user experience.</p>
<p><strong>Key Motivations:</strong></p>
<ol>
<li><strong>Query Performance</strong>: Denormalized data eliminates expensive joins</li>
<li><strong>View-Specific Optimization</strong>: Each view gets its own optimized projection</li>
<li><strong>Scalability</strong>: Read databases can be replicated and scaled independently</li>
<li><strong>Simplicity</strong>: No business logic in queries—just data retrieval</li>
</ol>
<h4 id="denormalization-strategies">Denormalization Strategies<a class="headerlink" href="#denormalization-strategies" title="Permanent link">&para;</a></h4>
<p><strong>Normalized Write Model:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">-- Separate tables (normalized)</span>
<span class="n">orders</span><span class="p">:</span><span class="w"> </span><span class="n">order_id</span><span class="p">,</span><span class="w"> </span><span class="n">customer_id</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="n">created_at</span>
<span class="n">customers</span><span class="p">:</span><span class="w"> </span><span class="n">customer_id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">email</span>
<span class="n">order_items</span><span class="p">:</span><span class="w"> </span><span class="n">item_id</span><span class="p">,</span><span class="w"> </span><span class="n">order_id</span><span class="p">,</span><span class="w"> </span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span><span class="w"> </span><span class="n">price</span>
<span class="n">products</span><span class="p">:</span><span class="w"> </span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">description</span>
</code></pre></div>

<p><strong>Denormalized Read Model:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">-- Single denormalized table</span>
<span class="n">order_summary</span><span class="p">:</span>
<span class="w">  </span><span class="n">order_id</span><span class="p">,</span>
<span class="w">  </span><span class="n">customer_id</span><span class="p">,</span>
<span class="w">  </span><span class="n">customer_name</span><span class="p">,</span><span class="w">        </span><span class="c1">-- Denormalized from customers</span>
<span class="w">  </span><span class="n">customer_email</span><span class="p">,</span><span class="w">       </span><span class="c1">-- Denormalized from customers</span>
<span class="w">  </span><span class="n">status</span><span class="p">,</span>
<span class="w">  </span><span class="n">item_count</span><span class="p">,</span><span class="w">           </span><span class="c1">-- Pre-calculated</span>
<span class="w">  </span><span class="n">total_amount</span><span class="p">,</span><span class="w">         </span><span class="c1">-- Pre-calculated</span>
<span class="w">  </span><span class="n">created_at</span><span class="p">,</span>
<span class="w">  </span><span class="n">shipping_address</span><span class="w">      </span><span class="c1">-- Flattened JSON</span>
</code></pre></div>

<h4 id="read-model-update-via-projections">Read Model Update via Projections<a class="headerlink" href="#read-model-update-via-projections" title="Permanent link">&para;</a></h4>
<p>Read models are kept synchronized with write models through event-driven projections:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderProjections</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">OrderSummaryRepository</span><span class="w"> </span><span class="n">readRepository</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@EventListener</span>
<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">OrderPlaced</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Create new read model entry</span>
<span class="w">        </span><span class="n">OrderSummaryEntity</span><span class="w"> </span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderSummaryEntity</span><span class="p">();</span>
<span class="w">        </span><span class="n">summary</span><span class="p">.</span><span class="na">setOrderId</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getOrderId</span><span class="p">().</span><span class="na">value</span><span class="p">());</span>
<span class="w">        </span><span class="n">summary</span><span class="p">.</span><span class="na">setCustomerId</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getCustomerId</span><span class="p">().</span><span class="na">value</span><span class="p">());</span>
<span class="w">        </span><span class="n">summary</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="s">&quot;PLACED&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">summary</span><span class="p">.</span><span class="na">setItemCount</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getItems</span><span class="p">().</span><span class="na">size</span><span class="p">());</span>
<span class="w">        </span><span class="n">summary</span><span class="p">.</span><span class="na">setTotalAmount</span><span class="p">(</span><span class="n">calculateTotal</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getItems</span><span class="p">()));</span>
<span class="w">        </span><span class="n">summary</span><span class="p">.</span><span class="na">setCreatedAt</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getTimestamp</span><span class="p">());</span>

<span class="w">        </span><span class="n">readRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">summary</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventListener</span>
<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">OrderShipped</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Update existing read model entry</span>
<span class="w">        </span><span class="n">OrderSummaryEntity</span><span class="w"> </span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">readRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getOrderId</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">orElseThrow</span><span class="p">();</span>

<span class="w">        </span><span class="n">summary</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="s">&quot;SHIPPED&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">summary</span><span class="p">.</span><span class="na">setShippedAt</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getTimestamp</span><span class="p">());</span>

<span class="w">        </span><span class="n">readRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">summary</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="dtos-vs-domain-objects">DTOs vs Domain Objects<a class="headerlink" href="#dtos-vs-domain-objects" title="Permanent link">&para;</a></h4>
<p><strong>Domain Objects:</strong><br />
- Belong to domain layer<br />
- Rich with behavior and business logic<br />
- Encapsulate state and invariants<br />
- May contain references to other domain objects<br />
- Optimized for business operations</p>
<p><strong>DTOs:</strong><br />
- Belong to application/API layer<br />
- Pure data containers with no behavior<br />
- Simple, serializable structures<br />
- Optimized for data transfer<br />
- Often flat and denormalized</p>
<p><strong>Martin Fowler's Definition:</strong></p>
<blockquote>
<p>"DTO is an object that carries data between processes. The difference between data transfer objects and business objects or data access objects is that a DTO does not have any behavior except for storage and retrieval of its own data."</p>
</blockquote>
<h4 id="flat-dto-pattern-knight">Flat DTO Pattern (Knight)<a class="headerlink" href="#flat-dto-pattern-knight" title="Permanent link">&para;</a></h4>
<p>The Knight codebase demonstrates a flat DTO pattern that avoids nested objects:</p>
<p><strong>Design Constraints:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">query_interfaces</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qry_user_queries</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UserQueries</span>
<span class="w">    </span><span class="nt">result_characteristics</span><span class="p">:</span>
<span class="w">      </span><span class="nt">flat_structure</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">      </span><span class="c1"># Enforces flat structure</span>
<span class="w">      </span><span class="nt">string_serialization</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># Complex types as strings</span>
</code></pre></div>

<p><strong>Why Flat Structure?</strong></p>
<p><strong>Benefits:</strong><br />
1. <strong>Simpler Serialization</strong>: No complex object graphs<br />
2. <strong>Better Caching</strong>: Easier to cache flat structures<br />
3. <strong>Client-Friendly</strong>: Easier for clients to consume<br />
4. <strong>Version Resilience</strong>: Flatter structures evolve more easily<br />
5. <strong>Performance</strong>: Less serialization overhead</p>
<p><strong>Anti-Pattern: Nested DTOs:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// AVOID: Nested structure</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderDTO</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">CustomerDTO</span><span class="w"> </span><span class="n">customer</span><span class="p">;</span><span class="w">  </span><span class="c1">// Nested object</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItemDTO</span><span class="o">&gt;</span><span class="w"> </span><span class="n">items</span><span class="p">;</span><span class="w">  </span><span class="c1">// Nested collection</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">AddressDTO</span><span class="w"> </span><span class="n">shippingAddress</span><span class="p">;</span><span class="w">  </span><span class="c1">// Nested object</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Recommended: Flat Structure:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// BETTER: Flat structure</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">OrderSummary</span><span class="p">(</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">customerId</span><span class="p">,</span><span class="w">      </span><span class="c1">// ID only, not nested object</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">customerName</span><span class="p">,</span><span class="w">    </span><span class="c1">// Denormalized</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">customerEmail</span><span class="p">,</span><span class="w">   </span><span class="c1">// Denormalized</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="p">,</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">itemCount</span><span class="p">,</span><span class="w">          </span><span class="c1">// Count, not collection</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">totalAmount</span><span class="p">,</span><span class="w">     </span><span class="c1">// Pre-formatted string</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">shippingStreet</span><span class="p">,</span><span class="w">  </span><span class="c1">// Flattened address</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">shippingCity</span><span class="p">,</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">shippingState</span>
<span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div>

<h4 id="string-serialization-for-complex-types">String Serialization for Complex Types<a class="headerlink" href="#string-serialization-for-complex-types" title="Permanent link">&para;</a></h4>
<p>The Knight pattern serializes complex types (IDs, enums, dates) to strings in DTOs:</p>
<p><strong>Pattern 1: Domain IDs to Strings:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Domain: UserId value object</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">UserId</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">UserId</span><span class="w"> </span><span class="nf">of</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UserId</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// DTO: Serialized to String</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">UserSummary</span><span class="p">(</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">userId</span><span class="w">  </span><span class="c1">// Not UserId, just String</span>
<span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="c1">// Mapping</span>
<span class="n">UserSummary</span><span class="w"> </span><span class="nf">toDTO</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UserSummary</span><span class="p">(</span>
<span class="w">        </span><span class="n">user</span><span class="p">.</span><span class="na">getUserId</span><span class="p">().</span><span class="na">id</span><span class="p">()</span><span class="w">  </span><span class="c1">// Extract string from value object</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Pattern 2: Enums to Strings:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Domain: Status enum</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">enum</span><span class="w"> </span><span class="n">UserStatus</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">PENDING</span><span class="p">,</span><span class="w"> </span><span class="n">ACTIVE</span><span class="p">,</span><span class="w"> </span><span class="n">LOCKED</span><span class="p">,</span><span class="w"> </span><span class="n">DEACTIVATED</span>
<span class="p">}</span>

<span class="c1">// DTO: Serialized to String</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">UserSummary</span><span class="p">(</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="w">  </span><span class="c1">// Not UserStatus enum</span>
<span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="c1">// Mapping</span>
<span class="n">UserSummary</span><span class="w"> </span><span class="nf">toDTO</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UserSummary</span><span class="p">(</span>
<span class="w">        </span><span class="n">user</span><span class="p">.</span><span class="na">getStatus</span><span class="p">().</span><span class="na">name</span><span class="p">()</span><span class="w">  </span><span class="c1">// Enum to string</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Pattern 3: Dates/Times to ISO-8601 Strings:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Domain: Instant</span>
<span class="kd">private</span><span class="w"> </span><span class="n">Instant</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span>

<span class="c1">// DTO: String in ISO-8601 format</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">UserSummary</span><span class="p">(</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">createdAt</span><span class="w">  </span><span class="c1">// &quot;2025-10-24T10:30:00Z&quot;</span>
<span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="c1">// Mapping</span>
<span class="n">UserSummary</span><span class="w"> </span><span class="nf">toDTO</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UserSummary</span><span class="p">(</span>
<span class="w">        </span><span class="n">user</span><span class="p">.</span><span class="na">getCreatedAt</span><span class="p">().</span><span class="na">toString</span><span class="p">()</span><span class="w">  </span><span class="c1">// ISO-8601 string</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="bypasses-domain-model-flag">Bypasses Domain Model Flag<a class="headerlink" href="#bypasses-domain-model-flag" title="Permanent link">&para;</a></h4>
<p>Queries can include a <code>bypasses_domain_model</code> flag to indicate whether they go through the domain layer or directly to the read database:</p>
<p><strong>Bypass (bypasses_domain_model: true):</strong><br />
- Read model is denormalized and optimized<br />
- No business logic needed<br />
- High-volume queries<br />
- Performance is critical</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="n">OrderSummary</span><span class="w"> </span><span class="nf">getOrderSummary</span><span class="p">(</span><span class="n">OrderId</span><span class="w"> </span><span class="n">orderId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Bypass domain model - query read database directly</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">readRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">orderId</span><span class="p">.</span><span class="na">value</span><span class="p">())</span>
<span class="w">        </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="k">this</span><span class="p">::</span><span class="n">toDTO</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">orElseThrow</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderNotFoundException</span><span class="p">(</span><span class="n">orderId</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Use Domain Model (bypasses_domain_model: false):</strong><br />
- Need domain logic for permissions<br />
- Business rules affect what data is shown<br />
- Computed values require domain methods</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="n">OrderDetails</span><span class="w"> </span><span class="nf">getOrderDetails</span><span class="p">(</span><span class="n">OrderId</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span><span class="w"> </span><span class="n">UserId</span><span class="w"> </span><span class="n">requestingUser</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Load from domain model</span>
<span class="w">    </span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">orderId</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">orElseThrow</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderNotFoundException</span><span class="p">(</span><span class="n">orderId</span><span class="p">));</span>

<span class="w">    </span><span class="c1">// Apply business logic</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">order</span><span class="p">.</span><span class="na">canBeViewedBy</span><span class="p">(</span><span class="n">requestingUser</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UnauthorizedException</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Return with domain-calculated values</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">OrderDetails</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">order</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="68-best-practices-and-anti-patterns">6.8 Best Practices and Anti-Patterns<a class="headerlink" href="#68-best-practices-and-anti-patterns" title="Permanent link">&para;</a></h3>
<h4 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">&para;</a></h4>
<p><strong>1. Keep Application Services Thin</strong><br />
- No business logic<br />
- Only orchestration and coordination<br />
- Delegate to domain for business rules</p>
<p><strong>2. One Method Per Use Case</strong><br />
- Each method represents one business operation<br />
- Clear, descriptive names (createUser, placeOrder, approveInvoice)<br />
- Avoid generic methods handling multiple use cases</p>
<p><strong>3. Stateless Always</strong><br />
- Application services must not maintain state between calls<br />
- All needed data passed via method parameters<br />
- Use dependency injection for infrastructure dependencies</p>
<p><strong>4. Transaction Boundary = Method Boundary</strong><br />
- Each method defines one transaction<br />
- @Transactional annotation on command methods<br />
- No transactions for query methods</p>
<p><strong>5. ID Generation</strong><br />
- Generate domain IDs in application service (not database)<br />
- Use UUID or domain-specific ID generation strategy<br />
- Return domain IDs for creation operations</p>
<p><strong>6. Immutable Commands</strong><br />
- Use record types or final fields<br />
- Commands represent intent, should not be modified</p>
<p><strong>7. Return DTOs, Not Aggregates</strong><br />
- Serialize complex types to strings<br />
- Use flat structure (no nested objects)<br />
- Return aggregate counts, not full collections</p>
<p><strong>8. Two-Level Validation</strong><br />
- <strong>Application Layer:</strong> Input format, required fields, data types<br />
- <strong>Domain Layer:</strong> Business rules, invariants, complex validations</p>
<h4 id="anti-patterns-to-avoid">Anti-Patterns to Avoid<a class="headerlink" href="#anti-patterns-to-avoid" title="Permanent link">&para;</a></h4>
<p><strong>Anti-Pattern 1: Business Logic in Application Service</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Bad: Anti-Pattern</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">placeOrder</span><span class="p">(</span><span class="n">PlaceOrderCmd</span><span class="w"> </span><span class="n">cmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Order</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">orderId</span><span class="p">());</span>

<span class="w">    </span><span class="c1">// WRONG: Business logic in application service</span>
<span class="w">    </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">OrderItem</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">cmd</span><span class="p">.</span><span class="na">items</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">lineTotal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="na">quantity</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">multiply</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="na">unitPrice</span><span class="p">());</span>
<span class="w">        </span><span class="n">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">total</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">lineTotal</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">order</span><span class="p">.</span><span class="na">setTotal</span><span class="p">(</span><span class="n">total</span><span class="p">);</span>

<span class="w">    </span><span class="n">repository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">order</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Good: Correct Pattern</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">placeOrder</span><span class="p">(</span><span class="n">PlaceOrderCmd</span><span class="w"> </span><span class="n">cmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Order</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">orderId</span><span class="p">());</span>

<span class="w">    </span><span class="c1">// Business logic delegated to aggregate</span>
<span class="w">    </span><span class="n">order</span><span class="p">.</span><span class="na">addItems</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">items</span><span class="p">());</span>

<span class="w">    </span><span class="n">repository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">order</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Anti-Pattern 2: Modifying Multiple Aggregates in One Transaction</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Bad: Anti-Pattern</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">processOrder</span><span class="p">(</span><span class="n">ProcessOrderCmd</span><span class="w"> </span><span class="n">cmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// WRONG: Modifying multiple aggregates in one transaction</span>
<span class="w">    </span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">orderId</span><span class="p">());</span>
<span class="w">    </span><span class="n">order</span><span class="p">.</span><span class="na">confirm</span><span class="p">();</span>
<span class="w">    </span><span class="n">orderRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">order</span><span class="p">);</span>

<span class="w">    </span><span class="n">Inventory</span><span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inventoryRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">warehouseId</span><span class="p">());</span>
<span class="w">    </span><span class="n">inventory</span><span class="p">.</span><span class="na">reserve</span><span class="p">(</span><span class="n">order</span><span class="p">.</span><span class="na">getItems</span><span class="p">());</span>
<span class="w">    </span><span class="n">inventoryRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">inventory</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Good: Correct Pattern</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">confirmOrder</span><span class="p">(</span><span class="n">ConfirmOrderCmd</span><span class="w"> </span><span class="n">cmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">orderId</span><span class="p">());</span>
<span class="w">    </span><span class="n">order</span><span class="p">.</span><span class="na">confirm</span><span class="p">();</span>
<span class="w">    </span><span class="n">orderRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">order</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Publish event for eventual consistency</span>
<span class="w">    </span><span class="n">eventPublisher</span><span class="p">.</span><span class="na">publishEvent</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">OrderConfirmed</span><span class="p">(</span><span class="n">order</span><span class="p">.</span><span class="na">getId</span><span class="p">()));</span>
<span class="p">}</span>

<span class="c1">// Separate event handler</span>
<span class="nd">@EventListener</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onOrderConfirmed</span><span class="p">(</span><span class="n">OrderConfirmed</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Inventory</span><span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inventoryRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">warehouseId</span><span class="p">());</span>
<span class="w">    </span><span class="n">inventory</span><span class="p">.</span><span class="na">reserve</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">items</span><span class="p">());</span>
<span class="w">    </span><span class="n">inventoryRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">inventory</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Anti-Pattern 3: Generic Application Service Methods</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Bad: Anti-Pattern</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateUser</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">action</span><span class="p">,</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">action</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;activate&quot;</span><span class="p">:</span><span class="w"> </span><span class="c1">// ...</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;deactivate&quot;</span><span class="p">:</span><span class="w"> </span><span class="c1">// ...</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;lock&quot;</span><span class="p">:</span><span class="w"> </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Good: Correct Pattern</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">activateUser</span><span class="p">(</span><span class="n">ActivateUserCmd</span><span class="w"> </span><span class="n">cmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">deactivateUser</span><span class="p">(</span><span class="n">DeactivateUserCmd</span><span class="w"> </span><span class="n">cmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">lockUser</span><span class="p">(</span><span class="n">LockUserCmd</span><span class="w"> </span><span class="n">cmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>

<p><strong>Anti-Pattern 4: Anemic Domain Model</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Bad: Anti-Pattern: Anemic aggregate</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Order</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OrderId</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">total</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setTotal</span><span class="p">(</span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">total</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">total</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="nf">getTotal</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">total</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Good: Correct Pattern: Rich domain model</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Order</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">OrderId</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">total</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">items</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Business logic in aggregate</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addItems</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">items</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">items</span><span class="p">.</span><span class="na">addAll</span><span class="p">(</span><span class="n">items</span><span class="p">);</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calculateTotal</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="nf">calculateTotal</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">items</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="na">quantity</span><span class="p">().</span><span class="na">multiply</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="na">unitPrice</span><span class="p">()))</span>
<span class="w">            </span><span class="p">.</span><span class="na">reduce</span><span class="p">(</span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">::</span><span class="n">add</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="7-backend-for-frontend-bff-pattern">7. Backend-for-Frontend (BFF) Pattern<a class="headerlink" href="#7-backend-for-frontend-bff-pattern" title="Permanent link">&para;</a></h2>
<h3 id="71-overview">7.1 Overview<a class="headerlink" href="#71-overview" title="Permanent link">&para;</a></h3>
<h4 id="pattern-definition_1">Pattern Definition<a class="headerlink" href="#pattern-definition_1" title="Permanent link">&para;</a></h4>
<p><strong>Phil Calçado's Definition:</strong></p>
<blockquote>
<p>"A server-side component tightly coupled to a specific user interface, providing one BFF per user interface type (web, mobile, tablet, etc.)."</p>
</blockquote>
<p>The <strong>Backend for Frontend (BFF)</strong> pattern is an architectural pattern where you create separate backend services for different frontend experiences. Each BFF is optimized for a specific client type and owned by the team building that frontend.</p>
<h4 id="origin-and-history">Origin and History<a class="headerlink" href="#origin-and-history" title="Permanent link">&para;</a></h4>
<p>First introduced by <strong>Phil Calçado</strong> and colleagues at <strong>SoundCloud</strong> in 2011, formally documented in "The Back-end for Front-end Pattern (BFF)" (September 18, 2015). The pattern emerged from SoundCloud's transition from a monolithic Rails application to microservices architecture.</p>
<p><strong>Problem at SoundCloud:</strong><br />
- Multiple diverse client types (web, mobile apps, partner integrations)<br />
- Generic API Gateway becoming bloated with client-specific logic<br />
- Frontend teams blocked on centralized API team for changes<br />
- "One-size-fits-all" API didn't optimize for any specific client</p>
<p><strong>Solution:</strong><br />
- Create separate BFF for each client type<br />
- Frontend teams own their BFF<br />
- Each BFF calls microservices directly<br />
- Eliminates dependency on centralized API team</p>
<h4 id="core-principle-one-experience-one-bff">Core Principle: "One Experience, One BFF"<a class="headerlink" href="#core-principle-one-experience-one-bff" title="Permanent link">&para;</a></h4>
<p>The fundamental principle of the BFF pattern:</p>
<p><strong>Scope by Client:</strong><br />
- One BFF serves <strong>ONE</strong> user interface type (web, iOS, Android, partner API)<br />
- Each BFF is tailored exclusively for that client's needs<br />
- BFFs do not share client-specific logic</p>
<p><strong>Scope by Data:</strong><br />
- One BFF aggregates data from <strong>MULTIPLE</strong> bounded contexts/microservices<br />
- BFF scope is defined by <strong>CLIENT TYPE</strong>, not by bounded contexts<br />
- A single BFF endpoint may combine data from 5-10 downstream services</p>
<p><strong>Key Distinction:</strong></p>
<div class="codehilite"><pre><span></span><code>❌ WRONG: One BFF per bounded context
✓ CORRECT: One BFF per client type
</code></pre></div>

<h4 id="bff-in-the-schema">BFF in the Schema<a class="headerlink" href="#bff-in-the-schema" title="Permanent link">&para;</a></h4>
<p>The strategic schema provides comprehensive BFF modeling:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">BFFScope</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">object</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">BFF serves exactly ONE client type (web, mobile, etc.) and aggregates</span>
<span class="w">    </span><span class="no">data from MULTIPLE bounded contexts. BFF is owned by the frontend team.</span>
<span class="w">    </span><span class="no">Key principle: &quot;One experience, one BFF&quot; - scope is defined by CLIENT TYPE.</span>
<span class="w">  </span><span class="nt">required</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">id</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">name</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">client_type</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">serves_interface</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aggregates_from_contexts</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">owned_by_team</span>
<span class="w">  </span><span class="nt">properties</span><span class="p">:</span>
<span class="w">    </span><span class="nt">client_type</span><span class="p">:</span>
<span class="w">      </span><span class="nt">enum</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">web</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">mobile_ios</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">mobile_android</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">desktop</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">partner_api</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">iot</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">tablet</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">aggregates_from_contexts</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">array</span>
<span class="w">      </span><span class="nt">items</span><span class="p">:</span>
<span class="w">        </span><span class="nt">$ref</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;#/$defs/BcId&quot;</span>
<span class="w">      </span><span class="nt">minItems</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">responsibilities</span><span class="p">:</span>
<span class="w">      </span><span class="nt">properties</span><span class="p">:</span>
<span class="w">        </span><span class="nt">data_aggregation</span><span class="p">:</span>
<span class="w">          </span><span class="nt">const</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># BFF MUST aggregate data</span>
<span class="w">        </span><span class="nt">business_logic</span><span class="p">:</span>
<span class="w">          </span><span class="nt">const</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># BFF must NOT contain business logic</span>
</code></pre></div>

<p>With the BFF pattern's origin and core principle established, we now examine the most critical design constraint: how BFF scope is defined by client type (not bounded context) and why this distinction matters.</p>
<h3 id="72-bff-scope-one-experience-one-bff">7.2 BFF Scope: One Experience, One BFF<a class="headerlink" href="#72-bff-scope-one-experience-one-bff" title="Permanent link">&para;</a></h3>
<h4 id="single-ui-focus">Single UI Focus<a class="headerlink" href="#single-ui-focus" title="Permanent link">&para;</a></h4>
<p><strong>Principle:</strong> Each BFF serves exactly <strong>one type of user interface</strong></p>
<p><strong>Examples:</strong></p>
<table>
<thead>
<tr>
<th>BFF ID</th>
<th>Name</th>
<th>Client Type</th>
<th>Serves</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bff_web</code></td>
<td>WebBFF</td>
<td><code>web</code></td>
<td>Web applications</td>
</tr>
<tr>
<td><code>bff_ios</code></td>
<td>iOSBFF</td>
<td><code>mobile_ios</code></td>
<td>iOS mobile apps</td>
</tr>
<tr>
<td><code>bff_android</code></td>
<td>AndroidBFF</td>
<td><code>mobile_android</code></td>
<td>Android mobile apps</td>
</tr>
<tr>
<td><code>bff_partner_api</code></td>
<td>PartnerAPIBFF</td>
<td><code>partner_api</code></td>
<td>Third-party integrations</td>
</tr>
<tr>
<td><code>bff_desktop</code></td>
<td>DesktopBFF</td>
<td><code>desktop</code></td>
<td>Desktop applications</td>
</tr>
<tr>
<td><code>bff_iot</code></td>
<td>IoTBFF</td>
<td><code>iot</code></td>
<td>IoT devices</td>
</tr>
</tbody>
</table>
<p><strong>Why One BFF Per Client:</strong></p>
<ol>
<li>
<p><strong>Different Data Needs</strong><br />
   - Mobile needs minimal data due to bandwidth constraints<br />
   - Web can handle rich, nested structures<br />
   - IoT requires highly compressed payloads<br />
   - Partner API needs comprehensive, stable contracts</p>
</li>
<li>
<p><strong>Different Authentication Mechanisms</strong><br />
   - Web: Session-based or JWT tokens<br />
   - Mobile: OAuth with refresh tokens<br />
   - Partner API: API keys or mutual TLS<br />
   - IoT: Device certificates</p>
</li>
<li>
<p><strong>Different Performance Requirements</strong><br />
   - Mobile: Minimize latency, optimize for battery<br />
   - Web: Rich interactions, real-time updates<br />
   - Partner API: Batch operations, webhook support</p>
</li>
<li>
<p><strong>Different Team Ownership</strong><br />
   - Web team owns WebBFF<br />
   - iOS team owns iOSBFF<br />
   - Android team owns AndroidBFF<br />
   - Each team can iterate independently</p>
</li>
<li>
<p><strong>Independent Evolution</strong><br />
   - Each BFF can evolve at its own pace<br />
   - Breaking changes in one BFF don't affect others<br />
   - Deploy independently</p>
</li>
</ol>
<h4 id="multiple-bounded-context-aggregation">Multiple Bounded Context Aggregation<a class="headerlink" href="#multiple-bounded-context-aggregation" title="Permanent link">&para;</a></h4>
<p><strong>Critical Distinction:</strong> BFF scope is defined by the CLIENT TYPE, not by bounded contexts.</p>
<p>A single BFF typically <strong>aggregates data from multiple bounded contexts/microservices</strong>.</p>
<p><strong>Example Architecture:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">┌─────────────────────────────────────────┐</span>
<span class="l l-Scalar l-Scalar-Plain">│         Web Client                      │</span>
<span class="l l-Scalar l-Scalar-Plain">└───────────────┬─────────────────────────┘</span>
<span class="w">                </span><span class="l l-Scalar l-Scalar-Plain">│</span>
<span class="l l-Scalar l-Scalar-Plain">┌───────────────▼─────────────────────────┐</span>
<span class="l l-Scalar l-Scalar-Plain">│         WebBFF (bff_web)                │</span>
<span class="l l-Scalar l-Scalar-Plain">│  &quot;User Dashboard&quot; endpoint              │</span>
<span class="l l-Scalar l-Scalar-Plain">└───┬────────┬────────┬────────┬──────────┘</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">│        │        │        │</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">▼        ▼        ▼        ▼</span>
<span class="l l-Scalar l-Scalar-Plain">┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐</span>
<span class="l l-Scalar l-Scalar-Plain">│  User  │ │ Order  │ │Payment │ │ Notify │</span>
<span class="l l-Scalar l-Scalar-Plain">│Context │ │Context │ │Context │ │Context │</span>
<span class="l l-Scalar l-Scalar-Plain">└────────┘ └────────┘ └────────┘ └────────┘</span>
</code></pre></div>

<p><strong>Schema Definition:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">bff_scopes</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bff_web</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WebBFF</span>
<span class="w">    </span><span class="nt">client_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<span class="w">    </span><span class="nt">serves_interface</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Web</span><span class="nv"> </span><span class="s">application</span><span class="nv"> </span><span class="s">user</span><span class="nv"> </span><span class="s">dashboard</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">management&quot;</span>
<span class="w">    </span><span class="nt">aggregates_from_contexts</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_user_management</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_order_management</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_payment_processing</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_notification_service</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_analytics</span>
<span class="w">    </span><span class="nt">owned_by_team</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Web</span><span class="nv"> </span><span class="s">Frontend</span><span class="nv"> </span><span class="s">Team&quot;</span>
<span class="w">    </span><span class="nt">team_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
</code></pre></div>

<p><strong>Single BFF Endpoint:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="err">GET /api/web/user-dashboard/123</span>
</code></pre></div>

<p><strong>Aggregates data from 5 bounded contexts into unified response:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;user&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user_123&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;John Doe&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;john@example.com&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ACTIVE&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;recentOrders&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;orderId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;order_456&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;shipped&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$125.00&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;date&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-10-20&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;paymentMethods&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;credit_card&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;last4&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1234&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;brand&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Visa&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;unreadNotifications&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;usageStats&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;loginCount&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;lastLogin&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-10-23T15:30:00Z&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Without BFF:</strong></p>
<p>The client would need to make <strong>5 separate API calls</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="err">GET /api/users/123</span>
<span class="err">GET /api/users/123/orders</span>
<span class="err">GET /api/users/123/payment-methods</span>
<span class="err">GET /api/notifications?userId=123</span>
<span class="err">GET /api/analytics/users/123</span>
</code></pre></div>

<p><strong>With BFF:</strong></p>
<p><strong>One</strong> aggregated call returns everything the dashboard needs.</p>
<h4 id="core-responsibilities">Core Responsibilities<a class="headerlink" href="#core-responsibilities" title="Permanent link">&para;</a></h4>
<p><strong>What BFFs SHOULD Do:</strong></p>
<p><strong>1. Data Aggregation</strong> (Schema: <code>data_aggregation: true</code>)</p>
<p>Consolidate multiple downstream service calls into single endpoints:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Get</span><span class="p">(</span><span class="s">&quot;/dashboard/{userId}&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">DashboardDTO</span><span class="w"> </span><span class="nf">getDashboard</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UserId</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Aggregate from multiple contexts</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userQueries</span><span class="p">.</span><span class="na">getUserSummary</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderQueries</span><span class="p">.</span><span class="na">getRecentOrders</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">payments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paymentQueries</span><span class="p">.</span><span class="na">getPaymentMethods</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">notifCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">notificationQueries</span><span class="p">.</span><span class="na">getUnreadCount</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analyticsQueries</span><span class="p">.</span><span class="na">getUserStats</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Combine into client-specific DTO</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DashboardDTO</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">orders</span><span class="p">,</span><span class="w"> </span><span class="n">payments</span><span class="p">,</span><span class="w"> </span><span class="n">notifCount</span><span class="p">,</span><span class="w"> </span><span class="n">stats</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>2. Client-Specific Customization</strong></p>
<p>Different DTOs for different clients:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// WebBFF: Rich, comprehensive data</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">WebDashboardDTO</span><span class="p">(</span>
<span class="w">    </span><span class="n">UserProfile</span><span class="w"> </span><span class="n">user</span><span class="p">,</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderSummary</span><span class="o">&gt;</span><span class="w"> </span><span class="n">recentOrders</span><span class="p">,</span><span class="w">      </span><span class="c1">// Full list</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">PaymentMethod</span><span class="o">&gt;</span><span class="w"> </span><span class="n">paymentMethods</span><span class="p">,</span><span class="w">   </span><span class="c1">// All fields</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">unreadNotifications</span><span class="p">,</span>
<span class="w">    </span><span class="n">UsageStatistics</span><span class="w"> </span><span class="n">stats</span><span class="w">                 </span><span class="c1">// Detailed stats</span>
<span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="c1">// MobileBFF: Minimal, bandwidth-optimized</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">MobileDashboardDTO</span><span class="p">(</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">userId</span><span class="p">,</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">userName</span><span class="p">,</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">orderCount</span><span class="p">,</span><span class="w">                       </span><span class="c1">// Count only, not full list</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">primaryPaymentLast4</span><span class="p">,</span><span class="w">           </span><span class="c1">// One payment method</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">unreadNotifications</span><span class="w">               </span><span class="c1">// No detailed stats</span>
<span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div>

<p><strong>3. Presentation Logic</strong> (Schema: <code>presentation_logic: true</code>)</p>
<p>Client-specific logic not shared across client types:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Mobile-specific: Optimize for bandwidth</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">orders</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">orders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orders</span><span class="p">.</span><span class="na">subList</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span><span class="w">  </span><span class="c1">// Limit to 5 for mobile</span>
<span class="p">}</span>

<span class="c1">// Web-specific: Include pagination metadata</span>
<span class="n">response</span><span class="p">.</span><span class="na">addMetadata</span><span class="p">(</span><span class="s">&quot;totalPages&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">totalOrders</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">pageSize</span><span class="p">);</span>
</code></pre></div>

<p><strong>4. Format Translation</strong> (Schema: <code>format_translation: true</code>)</p>
<p>Transform domain models into client-friendly formats:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Domain: Money value object</span>
<span class="n">Money</span><span class="w"> </span><span class="n">totalAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">getTotalAmount</span><span class="p">();</span>

<span class="c1">// BFF: Format for client</span>
<span class="n">String</span><span class="w"> </span><span class="n">formattedTotal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;$%.2f&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">totalAmount</span><span class="p">.</span><span class="na">getAmount</span><span class="p">());</span>
</code></pre></div>

<p><strong>5. Error Handling</strong></p>
<p>Handle partial failures gracefully:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Get</span><span class="p">(</span><span class="s">&quot;/dashboard/{userId}&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">DashboardDTO</span><span class="w"> </span><span class="nf">getDashboard</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UserId</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span>

<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userQueries</span><span class="p">.</span><span class="na">getUserSummary</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Graceful degradation</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderSummary</span><span class="o">&gt;</span><span class="w"> </span><span class="n">orders</span><span class="p">;</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">orders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderQueries</span><span class="p">.</span><span class="na">getRecentOrders</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ServiceUnavailableException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">orders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Collections</span><span class="p">.</span><span class="na">emptyList</span><span class="p">();</span><span class="w">  </span><span class="c1">// Degraded response</span>
<span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&quot;Order service unavailable&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">notificationCount</span><span class="p">;</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">notificationCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">notificationQueries</span><span class="p">.</span><span class="na">getUnreadCount</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ServiceUnavailableException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">notificationCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">  </span><span class="c1">// Degraded response</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DashboardDTO</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">orders</span><span class="p">,</span><span class="w"> </span><span class="n">notificationCount</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>What BFFs Should NOT Do:</strong></p>
<p>According to Phil Calçado and Sam Newman:</p>
<p><strong>Anti-Pattern Prevention:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">anti_patterns</span><span class="p">:</span>
<span class="w">  </span><span class="nt">shared_business_logic</span><span class="p">:</span>
<span class="w">    </span><span class="nt">const</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># Do NOT duplicate business logic</span>
<span class="w">  </span><span class="nt">generic_cross_cutting_concerns</span><span class="p">:</span>
<span class="w">    </span><span class="nt">const</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># Do NOT implement auth/logging</span>
<span class="w">  </span><span class="nt">direct_database_access</span><span class="p">:</span>
<span class="w">    </span><span class="nt">const</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># Do NOT access databases directly</span>
<span class="w">  </span><span class="nt">serving_multiple_client_types</span><span class="p">:</span>
<span class="w">    </span><span class="nt">const</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># Do NOT serve multiple clients</span>
</code></pre></div>

<p><strong>1. Generic Cross-Cutting Concerns</strong> → Use API Gateway upstream<br />
- Authentication (JWT validation, OAuth flows)<br />
- SSL termination<br />
- Rate limiting<br />
- Request logging<br />
- Response caching</p>
<p><strong>2. Shared Business Logic</strong> → Belongs in domain services<br />
- Do NOT duplicate business rules across BFFs<br />
- Delegate to application services for all business logic<br />
- BFF contains NO calculations, validations, or business decisions</p>
<p><strong>3. Data Persistence</strong> → Delegate to downstream services<br />
- BFF does NOT write to databases directly<br />
- BFF does NOT manage transactions<br />
- Always call application services/microservices</p>
<p><strong>4. Direct Database Access</strong> → Always call application services</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Bad: Anti-Pattern: Direct database access in BFF</span>
<span class="nd">@Get</span><span class="p">(</span><span class="s">&quot;/users/{userId}&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">UserDTO</span><span class="w"> </span><span class="nf">getUser</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// WRONG: Direct SQL query in BFF</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">sql</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;SELECT * FROM users WHERE id = ?&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">UserEntity</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jdbcTemplate</span><span class="p">.</span><span class="na">queryForObject</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span><span class="w"> </span><span class="p">...);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">toDTO</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Good: Correct: Delegate to application service</span>
<span class="nd">@Get</span><span class="p">(</span><span class="s">&quot;/users/{userId}&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">UserDTO</span><span class="w"> </span><span class="nf">getUser</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">userSummary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userQueries</span><span class="p">.</span><span class="na">getUserSummary</span><span class="p">(</span><span class="n">UserId</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">userId</span><span class="p">));</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">toDTO</span><span class="p">(</span><span class="n">userSummary</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="team-ownership-and-conways-law">Team Ownership and Conway's Law<a class="headerlink" href="#team-ownership-and-conways-law" title="Permanent link">&para;</a></h4>
<p><strong>Conway's Law:</strong></p>
<blockquote>
<p>"Organizations design systems that mirror their communication structure."</p>
</blockquote>
<p><strong>BFF Ownership Model:</strong></p>
<div class="codehilite"><pre><span></span><code>┌────────────────────┐     ┌────────────────────┐
│  Web Frontend Team │ owns│      WebBFF        │
│  (HTML/CSS/JS)     │────▶│    (bff_web)       │
└────────────────────┘     └────────────────────┘

┌────────────────────┐     ┌────────────────────┐
│   iOS Mobile Team  │ owns│      iOSBFF        │
│   (Swift/UIKit)    │────▶│    (bff_ios)       │
└────────────────────┘     └────────────────────┘

┌────────────────────┐     ┌────────────────────┐
│ Android Mobile Team│ owns│    AndroidBFF      │
│ (Kotlin/Compose)   │────▶│  (bff_android)     │
└────────────────────┘     └────────────────────┘
</code></pre></div>

<p><strong>Schema Definition:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">bff_scope</span><span class="p">:</span>
<span class="w">  </span><span class="nt">owned_by_team</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Web</span><span class="nv"> </span><span class="s">Frontend</span><span class="nv"> </span><span class="s">Team&quot;</span><span class="w">  </span><span class="c1"># Required field</span>
<span class="w">  </span><span class="nt">team_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span><span class="w">                 </span><span class="c1"># Must be frontend-oriented</span>
</code></pre></div>

<p><strong>Benefits of Frontend Team Ownership:</strong></p>
<ol>
<li><strong>Autonomy</strong>: Frontend teams retain control over their API needs</li>
<li><strong>Rapid Iteration</strong>: No dependency on centralized API teams</li>
<li><strong>Faster Time-to-Market</strong>: Changes deployed independently</li>
<li><strong>Clear Boundaries</strong>: Ownership is unambiguous</li>
<li><strong>Domain Knowledge</strong>: Frontend team understands client needs best</li>
</ol>
<p><strong>Phil Calçado's Quote:</strong></p>
<blockquote>
<p>"The simple act of limiting the number of consumers they support makes BFFs much easier to work with and change, and helps teams developing customer-facing applications retain more autonomy."</p>
</blockquote>
<h3 id="73-bff-vs-api-gateway">7.3 BFF vs API Gateway<a class="headerlink" href="#73-bff-vs-api-gateway" title="Permanent link">&para;</a></h3>
<h4 id="api-gateway-pattern">API Gateway Pattern<a class="headerlink" href="#api-gateway-pattern" title="Permanent link">&para;</a></h4>
<p><strong>What is an API Gateway?</strong><br />
- <strong>Single point of entry</strong> for all clients<br />
- Provides <strong>generic, cross-cutting concerns</strong><br />
- Infrastructure-level pattern</p>
<p><strong>API Gateway Responsibilities:</strong></p>
<table>
<thead>
<tr>
<th>Concern</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>SSL Termination</strong></td>
<td>Handles HTTPS encryption</td>
</tr>
<tr>
<td><strong>Authentication</strong></td>
<td>Validates JWT tokens, OAuth flows</td>
</tr>
<tr>
<td><strong>Rate Limiting</strong></td>
<td>Throttles requests per client</td>
</tr>
<tr>
<td><strong>Request Logging</strong></td>
<td>Centralized logging and monitoring</td>
</tr>
<tr>
<td><strong>Response Caching</strong></td>
<td>Cache frequently accessed data</td>
</tr>
<tr>
<td><strong>Protocol Translation</strong></td>
<td>HTTP → gRPC, REST → GraphQL</td>
</tr>
<tr>
<td><strong>Load Balancing</strong></td>
<td>Distributes traffic across instances</td>
</tr>
</tbody>
</table>
<p><strong>When to Use API Gateway:</strong><br />
- Single client type or very similar clients<br />
- Need centralized infrastructure management<br />
- Generic cross-cutting concerns only<br />
- Simple pass-through with common transformations</p>
<p><strong>Limitations:</strong><br />
- Becomes bloated when serving multiple diverse client types<br />
- Difficult to optimize for specific clients<br />
- Centralized team becomes bottleneck<br />
- "One size fits all" approach doesn't work well</p>
<h4 id="bff-pattern">BFF Pattern<a class="headerlink" href="#bff-pattern" title="Permanent link">&para;</a></h4>
<p><strong>What is a BFF?</strong><br />
- <strong>Multiple entry points</strong>, one per client type<br />
- Provides <strong>client-specific API tailoring</strong><br />
- Application-level pattern</p>
<p><strong>BFF Responsibilities:</strong></p>
<table>
<thead>
<tr>
<th>Concern</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Data Aggregation</strong></td>
<td>Combines data from multiple services</td>
</tr>
<tr>
<td><strong>View Model Composition</strong></td>
<td>Assembles client-specific responses</td>
</tr>
<tr>
<td><strong>Client-Specific Logic</strong></td>
<td>Implements presentation logic</td>
</tr>
<tr>
<td><strong>Format Transformation</strong></td>
<td>Converts domain models to client formats</td>
</tr>
<tr>
<td><strong>Client Optimization</strong></td>
<td>Tailored responses per client type</td>
</tr>
</tbody>
</table>
<p><strong>When to Use BFF:</strong><br />
- Multiple diverse client types (web, mobile, IoT, partners)<br />
- Different team ownership for each client<br />
- Varying authentication mechanisms<br />
- Client-specific business logic needed<br />
- Need to optimize independently per client<br />
- Conway's Law: Team structure mirrors architecture</p>
<h4 id="decision-matrix">Decision Matrix<a class="headerlink" href="#decision-matrix" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Factor</th>
<th>Use API Gateway</th>
<th>Use BFF</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Number of client types</strong></td>
<td>1-2 similar</td>
<td>3+ diverse</td>
</tr>
<tr>
<td><strong>Team structure</strong></td>
<td>Single centralized team</td>
<td>Multiple client teams</td>
</tr>
<tr>
<td><strong>Business logic variance</strong></td>
<td>Minimal</td>
<td>Significant per client</td>
</tr>
<tr>
<td><strong>Authentication</strong></td>
<td>Uniform mechanism</td>
<td>Client-specific mechanisms</td>
</tr>
<tr>
<td><strong>Future scalability</strong></td>
<td>Limited growth expected</td>
<td>Ecosystem of apps planned</td>
</tr>
<tr>
<td><strong>Organizational structure</strong></td>
<td>Centralized control</td>
<td>Decentralized (Conway's Law)</td>
</tr>
<tr>
<td><strong>Primary need</strong></td>
<td>Cross-cutting concerns</td>
<td>Client optimization</td>
</tr>
<tr>
<td><strong>Data aggregation</strong></td>
<td>Simple pass-through</td>
<td>Complex multi-service aggregation</td>
</tr>
<tr>
<td><strong>Response format</strong></td>
<td>Standardized</td>
<td>Client-specific</td>
</tr>
</tbody>
</table>
<h4 id="hybrid-approach-recommended">Hybrid Approach (Recommended)<a class="headerlink" href="#hybrid-approach-recommended" title="Permanent link">&para;</a></h4>
<p><strong>Best Practice:</strong> Use BOTH patterns together</p>
<p><strong>Architecture:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="w">                 </span><span class="l l-Scalar l-Scalar-Plain">Clients</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">┌─────────┬─────────┬─────────┐</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">▼         ▼         ▼         ▼</span>
<span class="l l-Scalar l-Scalar-Plain">┌───────────────────────────────────────────┐</span>
<span class="l l-Scalar l-Scalar-Plain">│          API Gateway                      │</span>
<span class="l l-Scalar l-Scalar-Plain">│  • SSL Termination                        │</span>
<span class="l l-Scalar l-Scalar-Plain">│  • Authentication (JWT validation)        │</span>
<span class="l l-Scalar l-Scalar-Plain">│  • Rate Limiting                          │</span>
<span class="l l-Scalar l-Scalar-Plain">│  • Request Logging                        │</span>
<span class="l l-Scalar l-Scalar-Plain">└────────┬──────────┬──────────┬───────────┘</span>
<span class="w">         </span><span class="l l-Scalar l-Scalar-Plain">│          │          │</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">┌────▼───┐ ┌───▼────┐ ┌──▼─────┐</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">│Web BFF │ │iOS BFF │ │Android │</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">│        │ │        │ │  BFF   │</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">└───┬────┘ └───┬────┘ └───┬────┘</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">│          │          │</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">└──────────┴──────────┘</span>
<span class="w">               </span><span class="l l-Scalar l-Scalar-Plain">│</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">┌──────┴─────┬─────────┐</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">▼            ▼         ▼</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">┌────────┐  ┌────────┐ ┌────────┐</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">│  User  │  │ Order  │ │Payment │</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">│Context │  │Context │ │Context │</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">└────────┘  └────────┘ └────────┘</span>
</code></pre></div>

<p><strong>Layering:</strong></p>
<ol>
<li>
<p><strong>API Gateway (upstream)</strong> → Infrastructure concerns<br />
   - Owned by platform/infrastructure team<br />
   - Handles authentication, SSL, rate limiting<br />
   - Generic, reusable functionality</p>
</li>
<li>
<p><strong>BFFs (downstream)</strong> → Client-specific orchestration<br />
   - Owned by frontend teams<br />
   - Data aggregation from multiple contexts<br />
   - Client-optimized responses</p>
</li>
<li>
<p><strong>Microservices/Bounded Contexts</strong> → Business logic<br />
   - Owned by domain teams<br />
   - Contains business rules and domain logic<br />
   - Stateless, scalable services</p>
</li>
</ol>
<p><strong>Schema Support:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">bff_scope</span><span class="p">:</span>
<span class="w">  </span><span class="nt">upstream_dependencies</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api_gateway</span><span class="w">       </span><span class="c1"># Optional API Gateway upstream</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">load_balancer</span>
<span class="w">  </span><span class="nt">calls</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">application_service</span><span class="w">     </span><span class="c1"># BFF calls these downstream</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bounded_context_api</span>
<span class="w">  </span><span class="nt">architecture_layer</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;integration&quot;</span><span class="w">  </span><span class="c1"># BFF is integration layer</span>
</code></pre></div>

<h4 id="key-distinctions">Key Distinctions<a class="headerlink" href="#key-distinctions" title="Permanent link">&para;</a></h4>
<p><strong>API Gateway:</strong><br />
- Infrastructure layer<br />
- Owned by platform/infrastructure team<br />
- Generic, reusable functionality<br />
- One gateway for all clients<br />
- Cross-cutting concerns only<br />
- Technical focus (security, routing)</p>
<p><strong>BFF:</strong><br />
- Integration/Application layer<br />
- Owned by frontend team<br />
- Client-specific functionality<br />
- One BFF per client type<br />
- Data aggregation and orchestration<br />
- Business focus (use cases, workflows)</p>
<p><strong>Analogy:</strong><br />
- <strong>API Gateway</strong> = Airport security checkpoint (everyone goes through)<br />
- <strong>BFF</strong> = Airline lounge (specific to your airline/ticket class)</p>
<h3 id="74-bff-interface-design">7.4 BFF Interface Design<a class="headerlink" href="#74-bff-interface-design" title="Permanent link">&para;</a></h3>
<h4 id="bffinterface-vs-bffscope">BFFInterface vs BFFScope<a class="headerlink" href="#bffinterface-vs-bffscope" title="Permanent link">&para;</a></h4>
<p>The BFF pattern distinguishes between:</p>
<p><strong>BFFScope:</strong><br />
- High-level definition of the BFF<br />
- Defines client type, team ownership, responsibilities<br />
- One per client type</p>
<p><strong>BFFInterface:</strong><br />
- Concrete implementation of the BFF for a specific bounded context<br />
- REST API endpoints, request/response DTOs<br />
- Multiple per BFFScope</p>
<p><strong>Relationship:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">BFFScope (bff_web)</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">├─ BFFInterface (bff_if_user_web)     → User management endpoints</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">├─ BFFInterface (bff_if_order_web)    → Order management endpoints</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">└─ BFFInterface (bff_if_payment_web)  → Payment endpoints</span>
</code></pre></div>

<p><strong>Schema Definition:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">bff_interfaces</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bff_if_user_web</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;User</span><span class="nv"> </span><span class="s">Management</span><span class="nv"> </span><span class="s">Web</span><span class="nv"> </span><span class="s">BFF</span><span class="nv"> </span><span class="s">Interface&quot;</span>
<span class="w">    </span><span class="nt">bff_scope_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bff_web</span><span class="w">                      </span><span class="c1"># Belongs to WebBFF</span>
<span class="w">    </span><span class="nt">primary_bounded_context_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_user_management</span>
<span class="w">    </span><span class="nt">additional_context_refs</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_notification_service</span><span class="w">                  </span><span class="c1"># Also calls notifications</span>
<span class="w">    </span><span class="nt">base_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/api/web/users&quot;</span>
<span class="w">    </span><span class="nt">endpoints</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/create&quot;</span>
<span class="w">        </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POST</span>
<span class="w">        </span><span class="nt">operation_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">command</span>
<span class="w">        </span><span class="nt">delegates_to_commands</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">cmd_create_user</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/{userId}&quot;</span>
<span class="w">        </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GET</span>
<span class="w">        </span><span class="nt">operation_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">query</span>
<span class="w">        </span><span class="nt">delegates_to_queries</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">qry_get_user_summary</span><span class="p p-Indicator">]</span>
</code></pre></div>

<h4 id="rest-resource-mapping">REST Resource Mapping<a class="headerlink" href="#rest-resource-mapping" title="Permanent link">&para;</a></h4>
<p><strong>Principle:</strong> BFF endpoints should align with <strong>client use cases</strong>, not just domain aggregates.</p>
<p><strong>Traditional Domain-Aligned API:</strong></p>
<div class="codehilite"><pre><span></span><code>GET /api/users/123
GET /api/users/123/orders
GET /api/users/123/payment-methods
GET /api/notifications?userId=123
</code></pre></div>

<p><strong>Client makes 4+ separate calls</strong></p>
<p><strong>BFF Client-Optimized API:</strong></p>
<div class="codehilite"><pre><span></span><code>GET /api/web/user-dashboard/123
</code></pre></div>

<p><strong>Single call returns aggregated response</strong></p>
<p><strong>Schema Definition:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">endpoints</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/user-dashboard/{userId}&quot;</span>
<span class="w">    </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GET</span>
<span class="w">    </span><span class="nt">operation_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">query</span>
<span class="w">    </span><span class="nt">aggregates_data_from</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_user_management</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_order_management</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_payment_processing</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_notification_service</span>
<span class="w">    </span><span class="nt">response_dto</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UserDashboardDTO</span>
<span class="w">      </span><span class="nt">fields</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">userId</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">recentOrders</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">array</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">paymentMethods</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">array</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unreadNotifications</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">integer</span>
</code></pre></div>

<h4 id="http-verb-to-commandquery-mapping">HTTP Verb to Command/Query Mapping<a class="headerlink" href="#http-verb-to-commandquery-mapping" title="Permanent link">&para;</a></h4>
<p><strong>CQRS Mapping in BFF:</strong></p>
<table>
<thead>
<tr>
<th>Operation Type</th>
<th>HTTP Method</th>
<th>BFF Endpoint</th>
<th>Delegates To</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Query (single)</strong></td>
<td>GET</td>
<td><code>/api/web/users/123</code></td>
<td>GetUserQuery</td>
</tr>
<tr>
<td><strong>Query (collection)</strong></td>
<td>GET</td>
<td><code>/api/web/users?status=active</code></td>
<td>ListUsersQuery</td>
</tr>
<tr>
<td><strong>Command (create)</strong></td>
<td>POST</td>
<td><code>/api/web/users</code></td>
<td>CreateUserCommand</td>
</tr>
<tr>
<td><strong>Command (action)</strong></td>
<td>POST</td>
<td><code>/api/web/users/123/activate</code></td>
<td>ActivateUserCommand</td>
</tr>
<tr>
<td><strong>Command (update)</strong></td>
<td>PUT/PATCH</td>
<td><code>/api/web/users/123</code></td>
<td>UpdateUserCommand</td>
</tr>
<tr>
<td><strong>Command (delete)</strong></td>
<td>DELETE</td>
<td><code>/api/web/users/123</code></td>
<td>DeleteUserCommand</td>
</tr>
</tbody>
</table>
<p><strong>Schema Support:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">endpoints</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/users/{userId}/activate&quot;</span>
<span class="w">    </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POST</span>
<span class="w">    </span><span class="nt">operation_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">command</span><span class="w">        </span><span class="c1"># Explicit command classification</span>
<span class="w">    </span><span class="nt">delegates_to_commands</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmd_activate_user</span>
</code></pre></div>

<p><strong>Knight Pattern (Command-Oriented):</strong></p>
<p>All commands use POST with action-based paths:</p>
<div class="codehilite"><pre><span></span><code>POST /commands/users/create
POST /commands/users/activate
POST /commands/users/deactivate
POST /commands/users/lock
</code></pre></div>

<p><strong>Benefits:</strong><br />
- Clear intent (not just CRUD)<br />
- Captures business operations<br />
- Aligns with domain ubiquitous language<br />
- Easier to extend with new operations</p>
<h4 id="value-object-conversion">Value Object Conversion<a class="headerlink" href="#value-object-conversion" title="Permanent link">&para;</a></h4>
<p><strong>BFF Responsibility:</strong> Convert between <strong>string URNs</strong> and <strong>value objects</strong></p>
<p><strong>Schema Support:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">value_object_conversion</span><span class="p">:</span>
<span class="w">  </span><span class="nt">from_string</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">value_object_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vo_user_id</span>
<span class="w">      </span><span class="nt">from_field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;userId&quot;</span>
<span class="w">      </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;UserId.of(string)&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">value_object_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vo_client_id</span>
<span class="w">      </span><span class="nt">from_field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;clientUrn&quot;</span>
<span class="w">      </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ClientId.of(urn)&quot;</span>
<span class="w">  </span><span class="nt">to_string</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">value_object_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vo_user_id</span>
<span class="w">      </span><span class="nt">to_field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;userId&quot;</span>
<span class="w">      </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;userId.id()&quot;</span>
</code></pre></div>

<p><strong>Implementation Pattern:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Controller</span><span class="p">(</span><span class="s">&quot;/api/web/users&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">UserBFFController</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Post</span><span class="p">(</span><span class="s">&quot;/create&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CreateUserResult</span><span class="w"> </span><span class="nf">createUser</span><span class="p">(</span><span class="nd">@Body</span><span class="w"> </span><span class="n">CreateUserRequest</span><span class="w"> </span><span class="n">req</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// String → Value Object (incoming)</span>
<span class="w">        </span><span class="n">ClientId</span><span class="w"> </span><span class="n">clientId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ClientId</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">clientUrn</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// Create command with value objects</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UserCommands</span><span class="p">.</span><span class="na">CreateUserCmd</span><span class="p">(</span>
<span class="w">            </span><span class="n">req</span><span class="p">.</span><span class="na">email</span><span class="p">(),</span>
<span class="w">            </span><span class="n">req</span><span class="p">.</span><span class="na">userType</span><span class="p">(),</span>
<span class="w">            </span><span class="n">clientId</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Delegate to application service</span>
<span class="w">        </span><span class="n">UserId</span><span class="w"> </span><span class="n">userId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userCommands</span><span class="p">.</span><span class="na">createUser</span><span class="p">(</span><span class="n">cmd</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Value Object → String (outgoing)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CreateUserResult</span><span class="p">(</span><span class="n">userId</span><span class="p">.</span><span class="na">id</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// BFF-specific DTOs (separate from API command records)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">CreateUserRequest</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">email</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">userType</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">clientUrn</span><span class="w">  </span><span class="c1">// String, not ClientId</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">CreateUserResult</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">userId</span><span class="w">  </span><span class="c1">// String, not UserId</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Why Separate DTOs:</strong></p>
<ol>
<li><strong>Different Serialization</strong>: BFF uses strings, API uses value objects</li>
<li><strong>Client-Specific Fields</strong>: BFF may add/remove fields per client</li>
<li><strong>Version Independence</strong>: BFF can evolve separately from API</li>
<li><strong>Clear Boundaries</strong>: BFF layer vs. API layer separation</li>
</ol>
<h3 id="75-data-aggregation-and-transformation">7.5 Data Aggregation and Transformation<a class="headerlink" href="#75-data-aggregation-and-transformation" title="Permanent link">&para;</a></h3>
<h4 id="data-aggregation-strategies">Data Aggregation Strategies<a class="headerlink" href="#data-aggregation-strategies" title="Permanent link">&para;</a></h4>
<p>BFFs support three aggregation strategies:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">DataAggregation</span><span class="p">:</span>
<span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enum</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">parallel</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">sequential</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">conditional</span><span class="p p-Indicator">]</span>
</code></pre></div>

<p><strong>1. Parallel Calls</strong> (when data is independent):</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Get</span><span class="p">(</span><span class="s">&quot;/dashboard/{userId}&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">DashboardDTO</span><span class="w"> </span><span class="nf">getDashboard</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UserId</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Execute calls in parallel</span>
<span class="w">    </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">UserSummary</span><span class="o">&gt;</span><span class="w"> </span><span class="n">userFuture</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">userQueries</span><span class="p">.</span><span class="na">getUserSummary</span><span class="p">(</span><span class="n">id</span><span class="p">));</span>
<span class="w">    </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderSummary</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">ordersFuture</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">orderQueries</span><span class="p">.</span><span class="na">getRecentOrders</span><span class="p">(</span><span class="n">id</span><span class="p">));</span>
<span class="w">    </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">notifFuture</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">notificationQueries</span><span class="p">.</span><span class="na">getUnreadCount</span><span class="p">(</span><span class="n">id</span><span class="p">));</span>

<span class="w">    </span><span class="c1">// Wait for all to complete</span>
<span class="w">    </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">allOf</span><span class="p">(</span><span class="n">userFuture</span><span class="p">,</span><span class="w"> </span><span class="n">ordersFuture</span><span class="p">,</span><span class="w"> </span><span class="n">notifFuture</span><span class="p">).</span><span class="na">join</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Aggregate results</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DashboardDTO</span><span class="p">(</span>
<span class="w">        </span><span class="n">userFuture</span><span class="p">.</span><span class="na">get</span><span class="p">(),</span>
<span class="w">        </span><span class="n">ordersFuture</span><span class="p">.</span><span class="na">get</span><span class="p">(),</span>
<span class="w">        </span><span class="n">notifFuture</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Schema:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">provides</span><span class="p">:</span>
<span class="w">  </span><span class="nt">data_aggregation</span><span class="p">:</span>
<span class="w">    </span><span class="nt">strategy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">parallel</span>
<span class="w">    </span><span class="nt">example</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;User</span><span class="nv"> </span><span class="s">dashboard</span><span class="nv"> </span><span class="s">aggregates</span><span class="nv"> </span><span class="s">user</span><span class="nv"> </span><span class="s">profile,</span><span class="nv"> </span><span class="s">orders,</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">notifications</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">parallel&quot;</span>
</code></pre></div>

<p><strong>2. Sequential Calls</strong> (when data depends on prior responses):</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Get</span><span class="p">(</span><span class="s">&quot;/order-details/{orderId}&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">OrderDetailsDTO</span><span class="w"> </span><span class="nf">getOrderDetails</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Step 1: Get order</span>
<span class="w">    </span><span class="n">OrderSummary</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderQueries</span><span class="p">.</span><span class="na">getOrder</span><span class="p">(</span><span class="n">OrderId</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">orderId</span><span class="p">));</span>

<span class="w">    </span><span class="c1">// Step 2: Get customer (depends on order)</span>
<span class="w">    </span><span class="n">CustomerSummary</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">customerQueries</span><span class="p">.</span><span class="na">getCustomer</span><span class="p">(</span><span class="n">order</span><span class="p">.</span><span class="na">customerId</span><span class="p">());</span>

<span class="w">    </span><span class="c1">// Step 3: Get shipping (depends on order)</span>
<span class="w">    </span><span class="n">ShippingInfo</span><span class="w"> </span><span class="n">shipping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shippingQueries</span><span class="p">.</span><span class="na">getShippingInfo</span><span class="p">(</span><span class="n">order</span><span class="p">.</span><span class="na">shippingId</span><span class="p">());</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderDetailsDTO</span><span class="p">(</span><span class="n">order</span><span class="p">,</span><span class="w"> </span><span class="n">customer</span><span class="p">,</span><span class="w"> </span><span class="n">shipping</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Schema:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">provides</span><span class="p">:</span>
<span class="w">  </span><span class="nt">data_aggregation</span><span class="p">:</span>
<span class="w">    </span><span class="nt">strategy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sequential</span>
<span class="w">    </span><span class="nt">example</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Order</span><span class="nv"> </span><span class="s">details</span><span class="nv"> </span><span class="s">fetches</span><span class="nv"> </span><span class="s">order,</span><span class="nv"> </span><span class="s">then</span><span class="nv"> </span><span class="s">customer,</span><span class="nv"> </span><span class="s">then</span><span class="nv"> </span><span class="s">shipping</span><span class="nv"> </span><span class="s">sequentially&quot;</span>
</code></pre></div>

<p><strong>3. Conditional Calls</strong> (based on business logic):</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Get</span><span class="p">(</span><span class="s">&quot;/user-profile/{userId}&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">UserProfileDTO</span><span class="w"> </span><span class="nf">getUserProfile</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UserId</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span>

<span class="w">    </span><span class="n">UserSummary</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userQueries</span><span class="p">.</span><span class="na">getUserSummary</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Conditional: Only fetch premium features for premium users</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">isPremium</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">PremiumFeatures</span><span class="w"> </span><span class="n">features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">premiumQueries</span><span class="p">.</span><span class="na">getFeatures</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PremiumUserProfileDTO</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">features</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StandardUserProfileDTO</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Schema:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">provides</span><span class="p">:</span>
<span class="w">  </span><span class="nt">data_aggregation</span><span class="p">:</span>
<span class="w">    </span><span class="nt">strategy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">conditional</span>
<span class="w">    </span><span class="nt">example</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Premium</span><span class="nv"> </span><span class="s">user</span><span class="nv"> </span><span class="s">profile</span><span class="nv"> </span><span class="s">conditionally</span><span class="nv"> </span><span class="s">fetches</span><span class="nv"> </span><span class="s">premium</span><span class="nv"> </span><span class="s">features&quot;</span>
</code></pre></div>

<h4 id="data-transformation-types">Data Transformation Types<a class="headerlink" href="#data-transformation-types" title="Permanent link">&para;</a></h4>
<p>BFFs support five transformation types:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">DataTransformation</span><span class="p">:</span>
<span class="w">  </span><span class="nt">transformation_type</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enum</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">format_conversion</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data_enrichment</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">field_mapping</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">filtering</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">denormalization</span>
</code></pre></div>

<p><strong>1. Format Conversion</strong></p>
<p>Convert domain types to client-friendly formats:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Domain: Money value object</span>
<span class="n">Money</span><span class="w"> </span><span class="n">totalAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">getTotalAmount</span><span class="p">();</span>

<span class="c1">// BFF Transformation: Format for client</span>
<span class="n">String</span><span class="w"> </span><span class="n">formattedTotal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;$%.2f&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">totalAmount</span><span class="p">.</span><span class="na">getAmount</span><span class="p">());</span>
</code></pre></div>

<p><strong>Schema:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">transformations</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">from_context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_order_management</span>
<span class="w">    </span><span class="nt">transformation_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">format_conversion</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Convert</span><span class="nv"> </span><span class="s">Money</span><span class="nv"> </span><span class="s">value</span><span class="nv"> </span><span class="s">object</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">formatted</span><span class="nv"> </span><span class="s">string&quot;</span>
</code></pre></div>

<p><strong>2. Data Enrichment</strong></p>
<p>Add computed or derived data:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Domain data</span>
<span class="n">OrderSummary</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderQueries</span><span class="p">.</span><span class="na">getOrder</span><span class="p">(</span><span class="n">orderId</span><span class="p">);</span>

<span class="c1">// BFF Enrichment: Add computed fields</span>
<span class="kt">boolean</span><span class="w"> </span><span class="n">isReturnable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">status</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;DELIVERED&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">                       </span><span class="n">order</span><span class="p">.</span><span class="na">deliveredAt</span><span class="p">().</span><span class="na">isAfter</span><span class="p">(</span><span class="n">Instant</span><span class="p">.</span><span class="na">now</span><span class="p">().</span><span class="na">minus</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="n">DAYS</span><span class="p">));</span>

<span class="n">String</span><span class="w"> </span><span class="n">estimatedDelivery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calculateEstimatedDelivery</span><span class="p">(</span><span class="n">order</span><span class="p">);</span>

<span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderDetailsDTO</span><span class="p">(</span>
<span class="w">    </span><span class="n">order</span><span class="p">.</span><span class="na">orderId</span><span class="p">(),</span>
<span class="w">    </span><span class="n">order</span><span class="p">.</span><span class="na">status</span><span class="p">(),</span>
<span class="w">    </span><span class="n">isReturnable</span><span class="p">,</span><span class="w">          </span><span class="c1">// Computed</span>
<span class="w">    </span><span class="n">estimatedDelivery</span><span class="w">      </span><span class="c1">// Computed</span>
<span class="p">);</span>
</code></pre></div>

<p><strong>3. Field Mapping</strong></p>
<p>Map domain field names to client-specific names:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Domain: camelCase</span>
<span class="n">UserSummary</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userQueries</span><span class="p">.</span><span class="na">getUserSummary</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span>

<span class="c1">// BFF: snake_case for mobile client</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Map</span><span class="p">.</span><span class="na">of</span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;user_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="na">userId</span><span class="p">(),</span><span class="w">          </span><span class="c1">// userId → user_id</span>
<span class="w">    </span><span class="s">&quot;email_address&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="na">email</span><span class="p">(),</span><span class="w">     </span><span class="c1">// email → email_address</span>
<span class="w">    </span><span class="s">&quot;account_status&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="na">status</span><span class="p">()</span><span class="w">    </span><span class="c1">// status → account_status</span>
<span class="p">);</span>
</code></pre></div>

<p><strong>4. Filtering</strong></p>
<p>Remove unnecessary data for client:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Domain: Full order with all items</span>
<span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">orderId</span><span class="p">);</span>

<span class="c1">// BFF Filtering: Mobile needs only summary</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItemSummary</span><span class="o">&gt;</span><span class="w"> </span><span class="n">filteredItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">getItems</span><span class="p">().</span><span class="na">stream</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderItemSummary</span><span class="p">(</span>
<span class="w">        </span><span class="n">item</span><span class="p">.</span><span class="na">productName</span><span class="p">(),</span><span class="w">  </span><span class="c1">// Keep</span>
<span class="w">        </span><span class="n">item</span><span class="p">.</span><span class="na">quantity</span><span class="p">()</span><span class="w">      </span><span class="c1">// Keep</span>
<span class="w">        </span><span class="c1">// Omit: sku, description, dimensions (not needed by mobile)</span>
<span class="w">    </span><span class="p">))</span>
<span class="w">    </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">toList</span><span class="p">());</span>
</code></pre></div>

<p><strong>5. Denormalization</strong></p>
<p>Flatten nested structures:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Domain: Nested structure</span>
<span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderQueries</span><span class="p">.</span><span class="na">getOrder</span><span class="p">(</span><span class="n">orderId</span><span class="p">);</span>
<span class="n">Customer</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">getCustomer</span><span class="p">();</span>
<span class="n">Address</span><span class="w"> </span><span class="n">shippingAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">getShippingAddress</span><span class="p">();</span>

<span class="c1">// BFF Denormalization: Flat structure</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">OrderSummaryDTO</span><span class="p">(</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">customerName</span><span class="p">,</span><span class="w">        </span><span class="c1">// Denormalized from customer</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">customerEmail</span><span class="p">,</span><span class="w">       </span><span class="c1">// Denormalized from customer</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">shippingStreet</span><span class="p">,</span><span class="w">      </span><span class="c1">// Denormalized from address</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">shippingCity</span><span class="p">,</span><span class="w">        </span><span class="c1">// Denormalized from address</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">shippingState</span><span class="w">        </span><span class="c1">// Denormalized from address</span>
<span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div>

<p><strong>Schema:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">provides</span><span class="p">:</span>
<span class="w">  </span><span class="nt">transformations</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">from_context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_order_management</span>
<span class="w">      </span><span class="nt">transformation_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">denormalization</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Flatten</span><span class="nv"> </span><span class="s">order,</span><span class="nv"> </span><span class="s">customer,</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">address</span><span class="nv"> </span><span class="s">into</span><span class="nv"> </span><span class="s">flat</span><span class="nv"> </span><span class="s">DTO&quot;</span>
</code></pre></div>

<h4 id="client-specific-optimizations">Client-Specific Optimizations<a class="headerlink" href="#client-specific-optimizations" title="Permanent link">&para;</a></h4>
<p><strong>Schema Support:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">provides</span><span class="p">:</span>
<span class="w">  </span><span class="nt">client_optimizations</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;Bandwidth</span><span class="nv"> </span><span class="s">optimization</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">mobile&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;Image</span><span class="nv"> </span><span class="s">size</span><span class="nv"> </span><span class="s">reduction</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">mobile</span><span class="nv"> </span><span class="s">networks&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;Pagination</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">large</span><span class="nv"> </span><span class="s">datasets&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;Field</span><span class="nv"> </span><span class="s">selection</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">minimal</span><span class="nv"> </span><span class="s">payloads&quot;</span>
</code></pre></div>

<p><strong>Mobile Optimization Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Mobile BFF: Minimize payload</span>
<span class="nd">@Get</span><span class="p">(</span><span class="s">&quot;/products&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">MobileProductDTO</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getProducts</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">productQueries</span><span class="p">.</span><span class="na">getAllProducts</span><span class="p">();</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">products</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MobileProductDTO</span><span class="p">(</span>
<span class="w">            </span><span class="n">p</span><span class="p">.</span><span class="na">id</span><span class="p">(),</span>
<span class="w">            </span><span class="n">p</span><span class="p">.</span><span class="na">name</span><span class="p">(),</span>
<span class="w">            </span><span class="n">p</span><span class="p">.</span><span class="na">price</span><span class="p">(),</span>
<span class="w">            </span><span class="n">p</span><span class="p">.</span><span class="na">thumbnailUrl</span><span class="p">()</span><span class="w">  </span><span class="c1">// Low-res thumbnail for mobile</span>
<span class="w">            </span><span class="c1">// Omit: full description, high-res images, reviews</span>
<span class="w">        </span><span class="p">))</span>
<span class="w">        </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">toList</span><span class="p">());</span>
<span class="p">}</span>

<span class="c1">// Web BFF: Full data</span>
<span class="nd">@Get</span><span class="p">(</span><span class="s">&quot;/products&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">WebProductDTO</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getProducts</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">productQueries</span><span class="p">.</span><span class="na">getAllProducts</span><span class="p">();</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">products</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WebProductDTO</span><span class="p">(</span>
<span class="w">            </span><span class="n">p</span><span class="p">.</span><span class="na">id</span><span class="p">(),</span>
<span class="w">            </span><span class="n">p</span><span class="p">.</span><span class="na">name</span><span class="p">(),</span>
<span class="w">            </span><span class="n">p</span><span class="p">.</span><span class="na">price</span><span class="p">(),</span>
<span class="w">            </span><span class="n">p</span><span class="p">.</span><span class="na">fullDescription</span><span class="p">(),</span><span class="w">    </span><span class="c1">// Full description</span>
<span class="w">            </span><span class="n">p</span><span class="p">.</span><span class="na">highResImages</span><span class="p">(),</span><span class="w">      </span><span class="c1">// High-res images</span>
<span class="w">            </span><span class="n">p</span><span class="p">.</span><span class="na">customerReviews</span><span class="p">()</span><span class="w">     </span><span class="c1">// Reviews</span>
<span class="w">        </span><span class="p">))</span>
<span class="w">        </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">toList</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="76-integration-with-application-services">7.6 Integration with Application Services<a class="headerlink" href="#76-integration-with-application-services" title="Permanent link">&para;</a></h3>
<h4 id="bff-delegates-to-application-services">BFF Delegates to Application Services<a class="headerlink" href="#bff-delegates-to-application-services" title="Permanent link">&para;</a></h4>
<p><strong>Architectural Flow:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">Client Request</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">↓</span>
<span class="l l-Scalar l-Scalar-Plain">BFF Controller (REST endpoint)</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">↓ converts DTO to Command</span>
<span class="l l-Scalar l-Scalar-Plain">Application Service (use case orchestration)</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">↓ delegates business logic</span>
<span class="l l-Scalar l-Scalar-Plain">Domain Aggregate (business rules)</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">↓ persisted via</span>
<span class="l l-Scalar l-Scalar-Plain">Repository</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">↓</span>
<span class="l l-Scalar l-Scalar-Plain">Database</span>
</code></pre></div>

<p><strong>Key Principle:</strong> BFF contains <strong>NO business logic</strong>, only:<br />
- Value object conversion<br />
- Request/response mapping<br />
- Error handling<br />
- Client-specific formatting</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Controller</span><span class="p">(</span><span class="s">&quot;/api/web/users&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">UserWebBFFController</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Inject</span>
<span class="w">    </span><span class="n">UserCommands</span><span class="w"> </span><span class="n">commands</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Inject</span>
<span class="w">    </span><span class="n">UserQueries</span><span class="w"> </span><span class="n">queries</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Post</span><span class="p">(</span><span class="s">&quot;/create&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CreateUserResult</span><span class="w"> </span><span class="nf">createUser</span><span class="p">(</span><span class="nd">@Body</span><span class="w"> </span><span class="n">CreateUserRequest</span><span class="w"> </span><span class="n">req</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 1. Convert URN string to value object (BFF responsibility)</span>
<span class="w">        </span><span class="n">ClientId</span><span class="w"> </span><span class="n">clientId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ClientId</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">clientUrn</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// 2. Create command with value objects</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UserCommands</span><span class="p">.</span><span class="na">CreateUserCmd</span><span class="p">(</span>
<span class="w">            </span><span class="n">req</span><span class="p">.</span><span class="na">email</span><span class="p">(),</span>
<span class="w">            </span><span class="n">req</span><span class="p">.</span><span class="na">userType</span><span class="p">(),</span>
<span class="w">            </span><span class="n">req</span><span class="p">.</span><span class="na">identityProvider</span><span class="p">(),</span>
<span class="w">            </span><span class="n">clientId</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 3. Delegate to application service (NO business logic in BFF)</span>
<span class="w">        </span><span class="n">UserId</span><span class="w"> </span><span class="n">userId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">commands</span><span class="p">.</span><span class="na">createUser</span><span class="p">(</span><span class="n">cmd</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 4. Convert domain ID to string for response (BFF responsibility)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CreateUserResult</span><span class="p">(</span><span class="n">userId</span><span class="p">.</span><span class="na">id</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Get</span><span class="p">(</span><span class="s">&quot;/{userId}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">UserProfileDTO</span><span class="w"> </span><span class="nf">getUserProfile</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 1. Convert string to value object</span>
<span class="w">        </span><span class="n">UserId</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 2. Delegate to query handler</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">userSummary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">queries</span><span class="p">.</span><span class="na">getUserSummary</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 3. Map to client-specific DTO</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UserProfileDTO</span><span class="p">(</span>
<span class="w">            </span><span class="n">userSummary</span><span class="p">.</span><span class="na">userId</span><span class="p">(),</span>
<span class="w">            </span><span class="n">userSummary</span><span class="p">.</span><span class="na">email</span><span class="p">(),</span>
<span class="w">            </span><span class="n">userSummary</span><span class="p">.</span><span class="na">status</span><span class="p">(),</span>
<span class="w">            </span><span class="n">userSummary</span><span class="p">.</span><span class="na">userType</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Design Constraints:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">bff_scope</span><span class="p">:</span>
<span class="w">  </span><span class="nt">responsibilities</span><span class="p">:</span>
<span class="w">    </span><span class="nt">business_logic</span><span class="p">:</span>
<span class="w">      </span><span class="nt">const</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># BFF must NOT contain business logic</span>
<span class="w">    </span><span class="nt">transaction_management</span><span class="p">:</span>
<span class="w">      </span><span class="nt">const</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># BFF does NOT manage transactions</span>
<span class="w">    </span><span class="nt">direct_persistence</span><span class="p">:</span>
<span class="w">      </span><span class="nt">const</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># BFF does NOT access databases directly</span>

<span class="w">  </span><span class="nt">calls</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">application_service</span><span class="w">      </span><span class="c1"># BFF calls application services</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bounded_context_api</span><span class="w">      </span><span class="c1"># Or bounded context APIs</span>
</code></pre></div>

<h4 id="no-business-logic-in-bff">No Business Logic in BFF<a class="headerlink" href="#no-business-logic-in-bff" title="Permanent link">&para;</a></h4>
<p><strong>❌ Anti-Pattern (Business Logic in BFF):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Post</span><span class="p">(</span><span class="s">&quot;/create-order&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">CreateOrderResult</span><span class="w"> </span><span class="nf">createOrder</span><span class="p">(</span><span class="nd">@Body</span><span class="w"> </span><span class="n">CreateOrderRequest</span><span class="w"> </span><span class="n">req</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// WRONG: Business logic in BFF</span>
<span class="w">    </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">OrderItem</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">req</span><span class="p">.</span><span class="na">items</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">total</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="na">price</span><span class="p">().</span><span class="na">multiply</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="na">quantity</span><span class="p">()));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// WRONG: Business rule validation in BFF</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">total</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;1000&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderTooLargeException</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// WRONG: Discount calculation in BFF</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">items</span><span class="p">().</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">total</span><span class="p">.</span><span class="na">multiply</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;0.9&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>✓ Correct Pattern (BFF Delegates):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Post</span><span class="p">(</span><span class="s">&quot;/create-order&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">CreateOrderResult</span><span class="w"> </span><span class="nf">createOrder</span><span class="p">(</span><span class="nd">@Body</span><span class="w"> </span><span class="n">CreateOrderRequest</span><span class="w"> </span><span class="n">req</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Convert DTO to Command (BFF responsibility)</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderCommands</span><span class="p">.</span><span class="na">PlaceOrderCmd</span><span class="p">(</span>
<span class="w">        </span><span class="n">CustomerId</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">customerId</span><span class="p">()),</span>
<span class="w">        </span><span class="n">req</span><span class="p">.</span><span class="na">items</span><span class="p">(),</span>
<span class="w">        </span><span class="n">req</span><span class="p">.</span><span class="na">shippingAddress</span><span class="p">()</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Delegate to application service (business logic there)</span>
<span class="w">    </span><span class="n">OrderId</span><span class="w"> </span><span class="n">orderId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderCommands</span><span class="p">.</span><span class="na">placeOrder</span><span class="p">(</span><span class="n">cmd</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Convert response (BFF responsibility)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CreateOrderResult</span><span class="p">(</span><span class="n">orderId</span><span class="p">.</span><span class="na">value</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="77-best-practices-and-anti-patterns">7.7 Best Practices and Anti-Patterns<a class="headerlink" href="#77-best-practices-and-anti-patterns" title="Permanent link">&para;</a></h3>
<h4 id="best-practices_1">Best Practices<a class="headerlink" href="#best-practices_1" title="Permanent link">&para;</a></h4>
<p><strong>1. One BFF Per Client Type</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># ✓ Correct</span>
<span class="nt">bff_scopes</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bff_web</span>
<span class="w">    </span><span class="nt">client_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bff_ios</span>
<span class="w">    </span><span class="nt">client_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mobile_ios</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bff_android</span>
<span class="w">    </span><span class="nt">client_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mobile_android</span>

<span class="c1"># ❌ Wrong: One BFF serving multiple clients</span>
<span class="nt">bff_scopes</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bff_mobile</span>
<span class="w">    </span><span class="nt">client_type</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">mobile_ios</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">mobile_android</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># WRONG</span>
</code></pre></div>

<p><strong>2. Owned by Frontend Team</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">bff_scope</span><span class="p">:</span>
<span class="w">  </span><span class="nt">owned_by_team</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Web</span><span class="nv"> </span><span class="s">Frontend</span><span class="nv"> </span><span class="s">Team&quot;</span><span class="w">  </span><span class="c1"># Frontend team owns BFF</span>
<span class="w">  </span><span class="nt">team_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span><span class="w">                 </span><span class="c1"># Must be frontend-oriented</span>
</code></pre></div>

<p><strong>3. Client-Optimized Responses</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Mobile: Minimal payload</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">MobileUserDTO</span><span class="p">(</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">userId</span><span class="p">,</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">email</span><span class="p">,</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">status</span>
<span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="c1">// Web: Rich data</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">WebUserDTO</span><span class="p">(</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">userId</span><span class="p">,</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">email</span><span class="p">,</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="p">,</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">fullAddress</span><span class="p">,</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderHistory</span><span class="o">&gt;</span><span class="w"> </span><span class="n">recentOrders</span><span class="p">,</span>
<span class="w">    </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">preferences</span>
<span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div>

<p><strong>4. Aggregate from Multiple Contexts</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Single endpoint aggregates from 4 contexts</span>
<span class="nd">@Get</span><span class="p">(</span><span class="s">&quot;/dashboard/{userId}&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">DashboardDTO</span><span class="w"> </span><span class="nf">getDashboard</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userService</span><span class="p">.</span><span class="na">getUser</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span><span class="w">           </span><span class="c1">// Context 1</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderService</span><span class="p">.</span><span class="na">getOrders</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span><span class="w">      </span><span class="c1">// Context 2</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">payments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paymentService</span><span class="p">.</span><span class="na">getPayments</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span><span class="w"> </span><span class="c1">// Context 3</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">notifs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">notificationService</span><span class="p">.</span><span class="na">getCount</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span><span class="w"> </span><span class="c1">// Context 4</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DashboardDTO</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">orders</span><span class="p">,</span><span class="w"> </span><span class="n">payments</span><span class="p">,</span><span class="w"> </span><span class="n">notifs</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>5. Graceful Degradation</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Handle partial failures</span>
<span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">orders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderService</span><span class="p">.</span><span class="na">getOrders</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span>
<span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ServiceUnavailableException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">orders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Collections</span><span class="p">.</span><span class="na">emptyList</span><span class="p">();</span><span class="w">  </span><span class="c1">// Degraded response</span>
<span class="w">    </span><span class="n">log</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&quot;Order service unavailable&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="anti-patterns-to-avoid_1">Anti-Patterns to Avoid<a class="headerlink" href="#anti-patterns-to-avoid_1" title="Permanent link">&para;</a></h4>
<p><strong>Anti-Pattern 1: Generic BFF (Serving Multiple Client Types)</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Bad: Anti-Pattern</span>
<span class="nd">@Get</span><span class="p">(</span><span class="s">&quot;/dashboard&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">DashboardDTO</span><span class="w"> </span><span class="nf">getDashboard</span><span class="p">(</span>
<span class="w">    </span><span class="nd">@QueryValue</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">userId</span><span class="p">,</span>
<span class="w">    </span><span class="nd">@QueryValue</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">clientType</span><span class="w">  </span><span class="c1">// WRONG: Client type parameter</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">clientType</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;mobile&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Mobile-specific logic</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">clientType</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;web&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Web-specific logic</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Good: Correct: Separate BFFs</span>
<span class="nd">@Controller</span><span class="p">(</span><span class="s">&quot;/api/web&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WebBFFController</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Get</span><span class="p">(</span><span class="s">&quot;/dashboard/{userId}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">WebDashboardDTO</span><span class="w"> </span><span class="nf">getDashboard</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Web-optimized response</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nd">@Controller</span><span class="p">(</span><span class="s">&quot;/api/mobile&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MobileBFFController</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Get</span><span class="p">(</span><span class="s">&quot;/dashboard/{userId}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">MobileDashboardDTO</span><span class="w"> </span><span class="nf">getDashboard</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Mobile-optimized response</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Anti-Pattern 2: BFF Calling BFF</strong></p>
<div class="codehilite"><pre><span></span><code>❌ WRONG:
Web BFF → Mobile BFF → Application Services

✓ CORRECT:
Web BFF → Application Services
Mobile BFF → Application Services
</code></pre></div>

<p>BFFs should <strong>never call each other</strong>. Each BFF calls application services directly.</p>
<p><strong>Anti-Pattern 3: Shared DTOs Across BFFs</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Bad: Anti-Pattern: Shared DTO used by multiple BFFs</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">SharedUserDTO</span><span class="p">(</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">userId</span><span class="p">,</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">email</span><span class="p">,</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="p">,</span>
<span class="w">    </span><span class="c1">// Too many fields for mobile</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">fullAddress</span><span class="p">,</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderHistory</span><span class="o">&gt;</span><span class="w"> </span><span class="n">orders</span><span class="p">,</span>
<span class="w">    </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">preferences</span>
<span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="c1">// Good: Correct: Client-specific DTOs</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">WebUserDTO</span><span class="p">(</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">userId</span><span class="p">,</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">email</span><span class="p">,</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="p">,</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">fullAddress</span><span class="p">,</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderHistory</span><span class="o">&gt;</span><span class="w"> </span><span class="n">orders</span><span class="p">,</span>
<span class="w">    </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">preferences</span>
<span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">MobileUserDTO</span><span class="p">(</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">userId</span><span class="p">,</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">email</span><span class="p">,</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">status</span>
<span class="w">    </span><span class="c1">// Minimal fields for mobile</span>
<span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div>

<hr />
<h2 id="part-iii-summary">Part III Summary<a class="headerlink" href="#part-iii-summary" title="Permanent link">&para;</a></h2>
<p>Part III covered <strong>Tactical Implementation</strong> across three major areas: domain modeling patterns, application layer orchestration, and client-specific optimization through BFFs.</p>
<p><strong>Section 5: Tactical Design Patterns</strong></p>
<p>The core building blocks for implementing rich domain models within bounded contexts:<br />
- <strong>Entities</strong>: Identity-based objects with lifecycle and behavior<br />
- <strong>Value Objects</strong>: Immutable, attribute-based objects enforcing domain concepts<br />
- <strong>Aggregates</strong>: Consistency boundaries protecting business invariants<br />
- <strong>Repositories</strong>: Persistence abstraction providing collection semantics (one per aggregate root)<br />
- <strong>Domain Services</strong>: Stateless operations spanning multiple aggregates<br />
- <strong>Domain Events</strong>: Immutable facts recording what happened in the domain</p>
<p><strong>Critical Rules</strong>: One aggregate per transaction, reference other aggregates by ID only, value objects must be immutable, repository per aggregate root (not per entity), and events enable eventual consistency across aggregates.</p>
<p><strong>Section 6: Application Layer</strong></p>
<p>How application services orchestrate use cases without containing business logic:<br />
- <strong>Application Services</strong>: Stateless orchestrators coordinating domain operations<br />
- <strong>CQRS Pattern</strong>: Separate models for commands (state changes) and queries (data retrieval)<br />
- <strong>Transaction Boundaries</strong>: One aggregate per transaction = one method per use case<br />
- <strong>Workflow Orchestration</strong>: Structured steps defining use case execution flow<br />
- <strong>Read Models</strong>: Denormalized views optimized for query performance<br />
- <strong>DTOs</strong>: Flat, string-serialized data transfer objects for external communication</p>
<p><strong>Critical Principles</strong>: Application layer contains NO business logic (only coordination), transaction boundary equals method boundary, commands modify exactly one aggregate while queries modify none, and eventual consistency between aggregates via domain events.</p>
<p><strong>Section 7: Backend-for-Frontend (BFF) Pattern</strong></p>
<p>How BFFs bridge domain models and client-specific needs:<br />
- <strong>"One Experience, One BFF"</strong>: One BFF per client type (web, mobile, partner), not per bounded context<br />
- <strong>Multi-Context Aggregation</strong>: BFFs aggregate data from multiple bounded contexts<br />
- <strong>Client-Specific Optimization</strong>: Each BFF tailored to its client's data needs and constraints<br />
- <strong>No Business Logic</strong>: BFF contains presentation logic only, delegates business operations to application services<br />
- <strong>Value Object Conversion</strong>: BFFs handle string serialization ↔ value object translation</p>
<p><strong>BFF vs API Gateway</strong>: API Gateway handles infrastructure concerns (auth, rate limiting, routing) at a single entry point, while BFFs handle client-specific aggregation and transformation at multiple entry points. Use both together—API Gateway upstream, BFFs downstream.</p>
<p><strong>Schema Integration Across Part III</strong>:<br />
- BoundedContext as root object containing all tactical patterns<br />
- Immutability enforcement (const: true) for value objects and events<br />
- TransactionBoundary with maxItems: 1 ensuring aggregate isolation<br />
- Comprehensive ID type patterns enabling tool generation<br />
- Explicit aggregate boundaries and dependencies<br />
- Application service operations typed as command or query<br />
- BFF scope and interface definitions with client type and team ownership<br />
- Data aggregation strategies and transformation patterns</p>
<p><strong>What's Next</strong>: Part IV examines how DDD integrates with Martin Fowler's Patterns of Enterprise Application Architecture (PoEAA), showing how Domain Model, Service Layer, Repository, Unit of Work, and other enterprise patterns complement DDD's tactical and strategic approaches.</p>
<hr />
<h1 id="part-iv-integration-patterns_1">Part IV: Integration &amp; Patterns<a class="headerlink" href="#part-iv-integration-patterns_1" title="Permanent link">&para;</a></h1>
<h2 id="8-integration-with-patterns-of-enterprise-application-architecture-poeaa">8. Integration with Patterns of Enterprise Application Architecture (PoEAA)<a class="headerlink" href="#8-integration-with-patterns-of-enterprise-application-architecture-poeaa" title="Permanent link">&para;</a></h2>
<h3 id="81-overview">8.1 Overview<a class="headerlink" href="#81-overview" title="Permanent link">&para;</a></h3>
<p>Martin Fowler's <strong>Patterns of Enterprise Application Architecture</strong> (PoEAA), published in 2002, provides a comprehensive catalog of architectural patterns for enterprise applications. While Domain-Driven Design focuses primarily on domain modeling and strategic design, PoEAA covers broader concerns including presentation, data access, and session state management.</p>
<p><strong>Key Insight:</strong> PoEAA and DDD are <strong>not competing approaches</strong>—they solve different problems and integrate naturally. PoEAA provides the architectural scaffolding; DDD provides the domain modeling guidance.</p>
<p><strong>Relationship:</strong><br />
- <strong>PoEAA</strong> introduces high-level architectural patterns<br />
- <strong>DDD</strong> elaborates how to implement domain logic within that architecture<br />
- Many patterns overlap or complement each other<br />
- Together they provide a complete architecture</p>
<p><strong>Integration Benefits:</strong><br />
1. PoEAA provides proven persistence patterns (Repository, Data Mapper)<br />
2. DDD refines domain modeling within PoEAA's Domain Model pattern<br />
3. PoEAA's Service Layer aligns with DDD's Application Service<br />
4. Both advocate for layered architecture with clear separation of concerns</p>
<h3 id="82-domain-logic-patterns">8.2 Domain Logic Patterns<a class="headerlink" href="#82-domain-logic-patterns" title="Permanent link">&para;</a></h3>
<h4 id="domain-model-poeaa-domain-layer-ddd">Domain Model (PoEAA) = Domain Layer (DDD)<a class="headerlink" href="#domain-model-poeaa-domain-layer-ddd" title="Permanent link">&para;</a></h4>
<p><strong>PoEAA Domain Model Definition:</strong></p>
<blockquote>
<p>"An object model of the domain that incorporates both behavior and data."</p>
</blockquote>
<p><strong>Characteristics:</strong><br />
- Rich objects with business logic<br />
- Complex business rules embedded in objects<br />
- Object-oriented approach to domain logic<br />
- Alternative to Transaction Script or Table Module</p>
<p><strong>DDD Domain Model:</strong><br />
- Elaborates <strong>how</strong> to implement the Domain Model pattern<br />
- Provides tactical patterns: Entity, Value Object, Aggregate<br />
- Adds strategic patterns: Bounded Context, Context Mapping<br />
- Emphasizes Ubiquitous Language</p>
<p><strong>Integration:</strong></p>
<p>PoEAA introduces the <strong>concept</strong> of a Domain Model; DDD provides the <strong>implementation details</strong>.</p>
<p><strong>Example Evolution:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// PoEAA Domain Model - general concept</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Product</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">price</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">inventoryCount</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">adjustPrice</span><span class="p">(</span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">newPrice</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Business logic in domain object (PoEAA principle)</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">price</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newPrice</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isAvailable</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">inventoryCount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// DDD elaborates with Entity, Value Object, refined design</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Product</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// Entity (identity-based)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ProductId</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w">  </span><span class="c1">// Value Object for identity</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="n">price</span><span class="p">;</span><span class="w">   </span><span class="c1">// Value Object (not BigDecimal)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Inventory</span><span class="w"> </span><span class="n">inventory</span><span class="p">;</span><span class="w">  </span><span class="c1">// Value Object (not int)</span>

<span class="w">    </span><span class="c1">// Business method - same PoEAA idea, more refined</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">adjustPrice</span><span class="p">(</span><span class="n">Money</span><span class="w"> </span><span class="n">newPrice</span><span class="p">,</span><span class="w"> </span><span class="n">PricingPolicy</span><span class="w"> </span><span class="n">policy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Validation (business rule)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">policy</span><span class="p">.</span><span class="na">allows</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">newPrice</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">InvalidPriceException</span><span class="p">(</span>
<span class="w">                </span><span class="s">&quot;Price &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">newPrice</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; violates pricing policy&quot;</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">Money</span><span class="w"> </span><span class="n">oldPrice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">price</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">price</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newPrice</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// Domain Event (DDD addition)</span>
<span class="w">        </span><span class="n">DomainEvents</span><span class="p">.</span><span class="na">raise</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ProductPriceChanged</span><span class="p">(</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="p">,</span>
<span class="w">            </span><span class="n">oldPrice</span><span class="p">,</span>
<span class="w">            </span><span class="n">newPrice</span><span class="p">,</span>
<span class="w">            </span><span class="n">Instant</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">        </span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isAvailable</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="na">hasStock</span><span class="p">();</span><span class="w">  </span><span class="c1">// Delegate to Value Object</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>PoEAA Contribution</strong>: Rich domain objects with behavior<br />
<strong>DDD Contribution</strong>: Entity vs. Value Object distinction, immutability, domain events</p>
<h4 id="service-layer-poeaa-application-service-ddd">Service Layer (PoEAA) = Application Service (DDD)<a class="headerlink" href="#service-layer-poeaa-application-service-ddd" title="Permanent link">&para;</a></h4>
<p><strong>PoEAA Service Layer Definition:</strong></p>
<blockquote>
<p>"Defines an application's boundary with a layer of services that establishes a set of available operations and coordinates the application's response in each operation."</p>
</blockquote>
<p><strong>Characteristics:</strong><br />
- Defines application boundary<br />
- Coordinates domain objects<br />
- Manages transactions<br />
- Orchestrates responses<br />
- Thin layer—no business logic</p>
<p><strong>DDD Application Service:</strong><br />
- Essentially the same pattern<br />
- Orchestrates use cases<br />
- Transaction management<br />
- Delegates to domain layer<br />
- No business logic (critical rule)</p>
<p><strong>Differences:</strong><br />
- DDD distinguishes Application Services from Domain Services<br />
- DDD emphasizes CQRS (commands vs. queries)<br />
- DDD adds event publication</p>
<p><strong>Example Comparison:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// PoEAA Service Layer</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderService</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OrderRepository</span><span class="w"> </span><span class="n">orderRepo</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">CustomerRepository</span><span class="w"> </span><span class="n">customerRepo</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">placeOrder</span><span class="p">(</span><span class="n">OrderRequest</span><span class="w"> </span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Orchestration</span>
<span class="w">        </span><span class="n">Customer</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">customerRepo</span><span class="p">.</span><span class="na">find</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">customerId</span><span class="p">);</span>
<span class="w">        </span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Order</span><span class="p">(</span><span class="n">customer</span><span class="p">);</span>
<span class="w">        </span><span class="n">order</span><span class="p">.</span><span class="na">addItems</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">items</span><span class="p">);</span>
<span class="w">        </span><span class="n">orderRepo</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">order</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// DDD Application Service - same pattern, refined</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PlaceOrderService</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OrderRepository</span><span class="w"> </span><span class="n">orderRepo</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">CustomerRepository</span><span class="w"> </span><span class="n">customerRepo</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">DomainEventPublisher</span><span class="w"> </span><span class="n">eventPublisher</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">OrderId</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="n">PlaceOrderCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 1. Load aggregates</span>
<span class="w">        </span><span class="n">Customer</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">customerRepo</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">customerId</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">orElseThrow</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CustomerNotFoundException</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// 2. Execute domain logic (in domain layer)</span>
<span class="w">        </span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">customer</span><span class="p">.</span><span class="na">createOrder</span><span class="p">();</span>
<span class="w">        </span><span class="n">order</span><span class="p">.</span><span class="na">addItems</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">items</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// 3. Persist</span>
<span class="w">        </span><span class="n">orderRepo</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">order</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 4. Publish events (DDD addition)</span>
<span class="w">        </span><span class="n">eventPublisher</span><span class="p">.</span><span class="na">publish</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">OrderPlaced</span><span class="p">(</span><span class="n">order</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span><span class="w"> </span><span class="n">customer</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span><span class="w"> </span><span class="n">Instant</span><span class="p">.</span><span class="na">now</span><span class="p">()));</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">getId</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Key Similarity</strong>: Both orchestrate domain objects without containing business logic<br />
<strong>DDD Refinement</strong>: Explicit command objects, event publication, clearer boundaries</p>
<h3 id="83-data-source-patterns">8.3 Data Source Patterns<a class="headerlink" href="#83-data-source-patterns" title="Permanent link">&para;</a></h3>
<h4 id="repository-poeaa-vs-repository-ddd">Repository (PoEAA) vs Repository (DDD)<a class="headerlink" href="#repository-poeaa-vs-repository-ddd" title="Permanent link">&para;</a></h4>
<p><strong>PoEAA Repository Definition:</strong></p>
<blockquote>
<p>"Mediates between the domain and data mapping layers using a collection-like interface for accessing domain objects."</p>
</blockquote>
<p><strong>Characteristics:</strong><br />
- Collection metaphor (<code>add()</code>, <code>remove()</code>, <code>find()</code>)<br />
- Encapsulates data access logic<br />
- Can use Specification pattern for queries<br />
- One repository per entity (or per type)</p>
<p><strong>DDD Repository:</strong><br />
- <strong>One repository per Aggregate Root</strong> (not per entity)<br />
- Loads and reconstitutes entire aggregate atomically<br />
- Collection metaphor (same as PoEAA)<br />
- Domain-oriented query methods</p>
<p><strong>Key Difference:</strong></p>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>PoEAA Repository</th>
<th>DDD Repository</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Scope</strong></td>
<td>Per entity or per type</td>
<td>Per Aggregate Root only</td>
</tr>
<tr>
<td><strong>Granularity</strong></td>
<td>Can be fine-grained</td>
<td>Coarse-grained (whole aggregate)</td>
</tr>
<tr>
<td><strong>Load Strategy</strong></td>
<td>May lazy-load relationships</td>
<td>Eager-loads entire aggregate</td>
</tr>
<tr>
<td><strong>Purpose</strong></td>
<td>Abstract data access</td>
<td>Aggregate lifecycle management</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Both use collection-like interface</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">OrderRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="p">);</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">remove</span><span class="p">(</span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="p">);</span>
<span class="w">    </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findById</span><span class="p">(</span><span class="n">OrderId</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByCustomer</span><span class="p">(</span><span class="n">CustomerId</span><span class="w"> </span><span class="n">customerId</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// DDD adds: One repo per aggregate root, not per entity</span>
<span class="c1">// Bad: Don&#39;t create: OrderLineRepository</span>
<span class="c1">// Good: OrderLine is part of Order aggregate</span>

<span class="c1">// PoEAA adds: Specification pattern for complex queries</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">OrderRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">find</span><span class="p">(</span><span class="n">Specification</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span><span class="w"> </span><span class="n">spec</span><span class="p">);</span><span class="w">  </span><span class="c1">// PoEAA pattern</span>
<span class="p">}</span>

<span class="c1">// Usage:</span>
<span class="n">Specification</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span><span class="w"> </span><span class="n">spec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RecentOrdersSpecification</span><span class="p">(</span><span class="n">customerId</span><span class="p">,</span><span class="w"> </span><span class="n">days</span><span class="p">(</span><span class="mi">30</span><span class="p">));</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span><span class="w"> </span><span class="n">recentOrders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderRepo</span><span class="p">.</span><span class="na">find</span><span class="p">(</span><span class="n">spec</span><span class="p">);</span>
</code></pre></div>

<h4 id="data-mapper-poeaa">Data Mapper (PoEAA)<a class="headerlink" href="#data-mapper-poeaa" title="Permanent link">&para;</a></h4>
<p><strong>PoEAA Data Mapper Definition:</strong></p>
<blockquote>
<p>"A layer of Mappers that moves data between objects and a database while keeping them independent of each other and the mapper itself."</p>
</blockquote>
<p><strong>Purpose:</strong><br />
- Keep domain objects independent of persistence<br />
- Handle translation between domain and database schemas<br />
- Isolate database details from domain</p>
<p><strong>DDD Integration:</strong><br />
Data Mapper is the <strong>implementation strategy</strong> for DDD Repositories.</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Data Mapper implementing DDD Repository</span>
<span class="nd">@Repository</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JpaOrderRepository</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">OrderRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@PersistenceContext</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">EntityManager</span><span class="w"> </span><span class="n">entityManager</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">OrderEntity</span><span class="w"> </span><span class="n">entity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">toEntity</span><span class="p">(</span><span class="n">order</span><span class="p">);</span><span class="w">  </span><span class="c1">// Data Mapper translation</span>
<span class="w">        </span><span class="n">entityManager</span><span class="p">.</span><span class="na">merge</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findById</span><span class="p">(</span><span class="n">OrderId</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">OrderEntity</span><span class="w"> </span><span class="n">entity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entityManager</span><span class="p">.</span><span class="na">find</span><span class="p">(</span>
<span class="w">            </span><span class="n">OrderEntity</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
<span class="w">            </span><span class="n">id</span><span class="p">.</span><span class="na">value</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">ofNullable</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="k">this</span><span class="p">::</span><span class="n">toDomain</span><span class="p">);</span><span class="w">  </span><span class="c1">// Data Mapper translation</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Data Mapper: Domain → Entity</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OrderEntity</span><span class="w"> </span><span class="nf">toEntity</span><span class="p">(</span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">OrderEntity</span><span class="w"> </span><span class="n">entity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderEntity</span><span class="p">();</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setId</span><span class="p">(</span><span class="n">order</span><span class="p">.</span><span class="na">getId</span><span class="p">().</span><span class="na">value</span><span class="p">());</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setCustomerId</span><span class="p">(</span><span class="n">order</span><span class="p">.</span><span class="na">getCustomerId</span><span class="p">().</span><span class="na">value</span><span class="p">());</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">order</span><span class="p">.</span><span class="na">getStatus</span><span class="p">().</span><span class="na">name</span><span class="p">());</span>
<span class="w">        </span><span class="c1">// ... map other attributes</span>

<span class="w">        </span><span class="c1">// Key: Aggregate children mapped recursively</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">OrderLine</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">getLines</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">OrderLineEntity</span><span class="w"> </span><span class="n">lineEntity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderLineEntity</span><span class="p">();</span>
<span class="w">            </span><span class="n">lineEntity</span><span class="p">.</span><span class="na">setProductId</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="na">getProductId</span><span class="p">().</span><span class="na">value</span><span class="p">());</span>
<span class="w">            </span><span class="n">lineEntity</span><span class="p">.</span><span class="na">setQuantity</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="na">getQuantity</span><span class="p">().</span><span class="na">amount</span><span class="p">());</span>
<span class="w">            </span><span class="n">lineEntity</span><span class="p">.</span><span class="na">setUnitPrice</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="na">getUnitPrice</span><span class="p">().</span><span class="na">getAmount</span><span class="p">());</span>
<span class="w">            </span><span class="n">entity</span><span class="p">.</span><span class="na">addLine</span><span class="p">(</span><span class="n">lineEntity</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">entity</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Data Mapper: Entity → Domain</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="nf">toDomain</span><span class="p">(</span><span class="n">OrderEntity</span><span class="w"> </span><span class="n">entity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Order</span><span class="p">(</span>
<span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">OrderId</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="na">getId</span><span class="p">()),</span>
<span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">CustomerId</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="na">getCustomerId</span><span class="p">())</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">        </span><span class="c1">// ... reconstruct other attributes</span>

<span class="w">        </span><span class="c1">// Key: Aggregate children mapped recursively</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">OrderLineEntity</span><span class="w"> </span><span class="n">lineEntity</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">entity</span><span class="p">.</span><span class="na">getLines</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">order</span><span class="p">.</span><span class="na">addLine</span><span class="p">(</span>
<span class="w">                </span><span class="k">new</span><span class="w"> </span><span class="n">ProductId</span><span class="p">(</span><span class="n">lineEntity</span><span class="p">.</span><span class="na">getProductId</span><span class="p">()),</span>
<span class="w">                </span><span class="n">Quantity</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">lineEntity</span><span class="p">.</span><span class="na">getQuantity</span><span class="p">()),</span>
<span class="w">                </span><span class="n">Money</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">lineEntity</span><span class="p">.</span><span class="na">getUnitPrice</span><span class="p">(),</span><span class="w"> </span><span class="n">Currency</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="na">getCurrency</span><span class="p">()))</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">order</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Pattern Summary:</strong> Data Mappers translate between domain aggregates (Order with OrderLines) and persistence entities, keeping the domain model pure and persistence-ignorant. The key insight is recursive mapping of aggregate children while maintaining aggregate boundaries.</p>
<p><strong>Benefits:</strong><br />
- Domain model remains pure (no JPA annotations)<br />
- Can use different persistence models<br />
- Easier to test domain logic<br />
- Clear separation of concerns</p>
<h4 id="unit-of-work-poeaa">Unit of Work (PoEAA)<a class="headerlink" href="#unit-of-work-poeaa" title="Permanent link">&para;</a></h4>
<p><strong>PoEAA Unit of Work Definition:</strong></p>
<blockquote>
<p>"Maintains a list of objects affected by a business transaction and coordinates the writing out of changes and the resolution of concurrency problems."</p>
</blockquote>
<p><strong>Purpose:</strong><br />
- Track changes during a transaction<br />
- Coordinate database writes<br />
- Optimize database access (batch updates)<br />
- Handle concurrency</p>
<p><strong>DDD Integration:</strong></p>
<p>Unit of Work is typically handled by:<br />
1. <strong>ORM Frameworks</strong> (JPA EntityManager, Hibernate Session)<br />
2. <strong>Application Service Transaction Boundaries</strong></p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Unit of Work implicit in JPA EntityManager</span>
<span class="nd">@Service</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TransferMoneyService</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@PersistenceContext</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">EntityManager</span><span class="w"> </span><span class="n">entityManager</span><span class="p">;</span><span class="w">  </span><span class="c1">// Unit of Work</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">AccountRepository</span><span class="w"> </span><span class="n">accountRepo</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="n">TransferMoneyCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// EntityManager tracks all loaded entities (Unit of Work)</span>
<span class="w">        </span><span class="n">Account</span><span class="w"> </span><span class="n">fromAccount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accountRepo</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">fromAccountId</span><span class="p">());</span>
<span class="w">        </span><span class="n">Account</span><span class="w"> </span><span class="n">toAccount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accountRepo</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">toAccountId</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// Domain logic</span>
<span class="w">        </span><span class="n">fromAccount</span><span class="p">.</span><span class="na">debit</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">amount</span><span class="p">());</span>
<span class="w">        </span><span class="n">toAccount</span><span class="p">.</span><span class="na">credit</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">amount</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// EntityManager automatically detects changes and persists</span>
<span class="w">        </span><span class="c1">// No explicit save() call needed</span>

<span class="w">        </span><span class="c1">// Transaction commits - Unit of Work flushes changes</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>PoEAA Contribution</strong>: Pattern for coordinating database writes<br />
<strong>DDD + ORM</strong>: Typically handled transparently by framework</p>
<h3 id="84-presentation-patterns">8.4 Presentation Patterns<a class="headerlink" href="#84-presentation-patterns" title="Permanent link">&para;</a></h3>
<h4 id="presentation-model-view-models">Presentation Model / View Models<a class="headerlink" href="#presentation-model-view-models" title="Permanent link">&para;</a></h4>
<p><strong>PoEAA Presentation Model Definition:</strong></p>
<blockquote>
<p>"Represent the state and behavior of the presentation independently of the GUI controls used in the interface."</p>
</blockquote>
<p><strong>Purpose:</strong><br />
- Separate presentation state from view<br />
- Make presentation logic testable<br />
- Support multiple views of same data</p>
<p><strong>DDD Integration:</strong></p>
<p>Presentation Models or <strong>View Models</strong> sit in the <strong>Presentation Layer</strong> and transform domain models for UI consumption.</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Domain Model (rich with behavior)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Order</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OrderId</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">CustomerId</span><span class="w"> </span><span class="n">customerId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OrderStatus</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderLine</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lines</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="n">totalAmount</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Domain methods</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addLine</span><span class="p">(</span><span class="n">ProductId</span><span class="w"> </span><span class="n">productId</span><span class="p">,</span><span class="w"> </span><span class="n">Quantity</span><span class="w"> </span><span class="n">qty</span><span class="p">,</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="n">unitPrice</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Business logic</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="nf">calculateTotal</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Business calculation</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// View Model for Order (Presentation Layer)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderViewModel</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// UI-friendly properties</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">customerId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">customerName</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">statusDisplay</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">formattedTotal</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderLineViewModel</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lines</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Factory method: Domain → View Model</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">OrderViewModel</span><span class="w"> </span><span class="nf">from</span><span class="p">(</span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="p">,</span><span class="w"> </span><span class="n">Customer</span><span class="w"> </span><span class="n">customer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">OrderViewModel</span><span class="w"> </span><span class="n">vm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderViewModel</span><span class="p">();</span>
<span class="w">        </span><span class="n">vm</span><span class="p">.</span><span class="na">orderId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">getId</span><span class="p">().</span><span class="na">value</span><span class="p">();</span>
<span class="w">        </span><span class="n">vm</span><span class="p">.</span><span class="na">customerName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">customer</span><span class="p">.</span><span class="na">getName</span><span class="p">().</span><span class="na">fullName</span><span class="p">();</span>
<span class="w">        </span><span class="n">vm</span><span class="p">.</span><span class="na">statusDisplay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">getStatus</span><span class="p">().</span><span class="na">displayName</span><span class="p">();</span><span class="w">  </span><span class="c1">// &quot;Pending&quot; not &quot;PENDING&quot;</span>
<span class="w">        </span><span class="n">vm</span><span class="p">.</span><span class="na">formattedTotal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">getTotalAmount</span><span class="p">().</span><span class="na">format</span><span class="p">(</span><span class="n">Locale</span><span class="p">.</span><span class="na">US</span><span class="p">);</span><span class="w">  </span><span class="c1">// &quot;$125.00&quot;</span>
<span class="w">        </span><span class="c1">// ... map other properties and nested line items</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">vm</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// UI-specific computed properties</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isEditable</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">PENDING</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">DRAFT</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Benefits:</strong><br />
- Domain model remains focused on business logic<br />
- View Model handles presentation concerns (formatting, localization)<br />
- Testable without UI framework<br />
- Supports multiple views (web, mobile, reports)</p>
<h4 id="mvc-integration">MVC Integration<a class="headerlink" href="#mvc-integration" title="Permanent link">&para;</a></h4>
<p><strong>PoEAA MVC:</strong><br />
- <strong>Model</strong>: Holds data and logic<br />
- <strong>View</strong>: Displays model<br />
- <strong>Controller</strong>: Handles input, updates model</p>
<p><strong>DDD Integration:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Controller</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderController</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">PlaceOrderService</span><span class="w"> </span><span class="n">placeOrderService</span><span class="p">;</span><span class="w">  </span><span class="c1">// Application Service</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OrderRepository</span><span class="w"> </span><span class="n">orderRepo</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">CustomerRepository</span><span class="w"> </span><span class="n">customerRepo</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// POST - Command (modifies state)</span>
<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/orders&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">placeOrder</span><span class="p">(</span><span class="nd">@ModelAttribute</span><span class="w"> </span><span class="n">PlaceOrderForm</span><span class="w"> </span><span class="n">form</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Controller → Application Service (DDD)</span>
<span class="w">        </span><span class="n">PlaceOrderCommand</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PlaceOrderCommand</span><span class="p">(</span>
<span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">CustomerId</span><span class="p">(</span><span class="n">form</span><span class="p">.</span><span class="na">getCustomerId</span><span class="p">()),</span>
<span class="w">            </span><span class="n">form</span><span class="p">.</span><span class="na">getItems</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="n">OrderId</span><span class="w"> </span><span class="n">orderId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">placeOrderService</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;redirect:/orders/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">orderId</span><span class="p">.</span><span class="na">value</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// GET - Query (reads state)</span>
<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/orders/{id}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">viewOrder</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Controller → Repository (query side)</span>
<span class="w">        </span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderRepo</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">OrderId</span><span class="p">(</span><span class="n">id</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">orElseThrow</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderNotFoundException</span><span class="p">(</span><span class="n">id</span><span class="p">));</span>

<span class="w">        </span><span class="n">Customer</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">customerRepo</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">order</span><span class="p">.</span><span class="na">getCustomerId</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">orElseThrow</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// Domain → View Model transformation</span>
<span class="w">        </span><span class="n">OrderViewModel</span><span class="w"> </span><span class="n">viewModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OrderViewModel</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">order</span><span class="p">,</span><span class="w"> </span><span class="n">customer</span><span class="p">);</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;order&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">viewModel</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;order-detail&quot;</span><span class="p">;</span><span class="w">  </span><span class="c1">// View name</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>MVC in DDD Context:</strong><br />
- <strong>Model</strong> = Domain Model + View Models<br />
- <strong>View</strong> = Templates using View Models<br />
- <strong>Controller</strong> = Delegates to Application Services</p>
<h3 id="85-layered-architecture-integration">8.5 Layered Architecture Integration<a class="headerlink" href="#85-layered-architecture-integration" title="Permanent link">&para;</a></h3>
<p>The patterns we've explored so far—Domain Model, Service Layer, Repository, Data Mapper, and Presentation Model—don't exist in isolation. They form an integrated architecture where each pattern occupies a specific layer with defined responsibilities and dependencies. Both PoEAA and DDD organize these patterns using layered architecture, which provides the structural foundation for how patterns collaborate.</p>
<h4 id="four-layer-architecture-poeaa-ddd">Four-Layer Architecture (PoEAA + DDD)<a class="headerlink" href="#four-layer-architecture-poeaa-ddd" title="Permanent link">&para;</a></h4>
<p>Both PoEAA and DDD advocate for layered architecture with clear separation of concerns:</p>
<div class="codehilite"><pre><span></span><code>┌─────────────────────────────────────────────┐
│         PRESENTATION LAYER                  │
│  PoEAA: MVC, Presentation Model             │
│  DDD: View Models, Ubiquitous Language      │
│  - Controllers                              │
│  - View Models                              │
│  - Views / Templates                        │
├─────────────────────────────────────────────┤
│         APPLICATION LAYER                   │
│  PoEAA: Service Layer                       │
│  DDD: Application Services                  │
│  - Use Case Orchestration                   │
│  - Transaction Management                   │
│  - Command/Query Handlers                   │
│  - DTOs                                     │
├─────────────────────────────────────────────┤
│         DOMAIN LAYER                        │
│  PoEAA: Domain Model                        │
│  DDD: Rich Domain Model                     │
│  - Entities (identity-based)                │
│  - Value Objects (immutable)                │
│  - Aggregates (consistency boundaries)      │
│  - Domain Services                          │
│  - Domain Events                            │
│  - Repositories (interfaces)                │
├─────────────────────────────────────────────┤
│         INFRASTRUCTURE LAYER                │
│  PoEAA: Data Mappers, Identity Map          │
│  DDD: Technical Implementation              │
│  - Repository Implementations               │
│  - Data Mappers                             │
│  - ORM Configurations                       │
│  - External Service Clients                 │
│  - Messaging Infrastructure                 │
└─────────────────────────────────────────────┘
</code></pre></div>

<p><strong>Dependency Direction:</strong></p>
<div class="codehilite"><pre><span></span><code>Presentation → Application → Domain
                ↓
        Infrastructure ← Domain (interfaces)
</code></pre></div>

<p><strong>Key Principle:</strong> Dependencies point inward. Domain layer is independent.</p>
<h4 id="pattern-allocation-by-layer">Pattern Allocation by Layer<a class="headerlink" href="#pattern-allocation-by-layer" title="Permanent link">&para;</a></h4>
<p><strong>Presentation Layer:</strong><br />
- <strong>PoEAA Patterns</strong>: MVC, MVP, MVVM, Presentation Model, Template View<br />
- <strong>DDD Patterns</strong>: View Models using Ubiquitous Language<br />
- <strong>Responsibilities</strong>: User interface, user input handling, presentation logic</p>
<p><strong>Application Layer:</strong><br />
- <strong>PoEAA Patterns</strong>: Service Layer, Transaction Script (for simple cases)<br />
- <strong>DDD Patterns</strong>: Application Services, Command Handlers, Query Handlers<br />
- <strong>Responsibilities</strong>: Use case orchestration, transaction management, DTO transformation</p>
<p><strong>Domain Layer:</strong><br />
- <strong>PoEAA Patterns</strong>: Domain Model (general concept)<br />
- <strong>DDD Patterns</strong>: Entity, Value Object, Aggregate, Domain Service, Domain Event<br />
- <strong>Responsibilities</strong>: Business logic, invariant enforcement, domain rules</p>
<p><strong>Infrastructure Layer:</strong><br />
- <strong>PoEAA Patterns</strong>: Repository (implementation), Data Mapper, Unit of Work, Identity Map, Lazy Load<br />
- <strong>DDD Patterns</strong>: Repository implementations, Anti-Corruption Layer<br />
- <strong>Responsibilities</strong>: Persistence, external services, technical infrastructure</p>
<h3 id="86-pattern-combinations-and-best-practices">8.6 Pattern Combinations and Best Practices<a class="headerlink" href="#86-pattern-combinations-and-best-practices" title="Permanent link">&para;</a></h3>
<h4 id="repository-data-mapper">Repository + Data Mapper<a class="headerlink" href="#repository-data-mapper" title="Permanent link">&para;</a></h4>
<p><strong>Pattern Combination:</strong><br />
- <strong>Repository</strong> (interface in Domain Layer)<br />
- <strong>Data Mapper</strong> (implementation in Infrastructure Layer)</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Domain Layer: Repository interface</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">CustomerRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="n">Customer</span><span class="w"> </span><span class="n">customer</span><span class="p">);</span>
<span class="w">    </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">Customer</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findById</span><span class="p">(</span><span class="n">CustomerId</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Customer</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByEmail</span><span class="p">(</span><span class="n">Email</span><span class="w"> </span><span class="n">email</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Infrastructure Layer: Data Mapper implementation</span>
<span class="nd">@Repository</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JpaCustomerRepository</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">CustomerRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@PersistenceContext</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">EntityManager</span><span class="w"> </span><span class="n">entityManager</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="n">Customer</span><span class="w"> </span><span class="n">customer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">CustomerEntity</span><span class="w"> </span><span class="n">entity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">toEntity</span><span class="p">(</span><span class="n">customer</span><span class="p">);</span><span class="w">  </span><span class="c1">// Data Mapper</span>
<span class="w">        </span><span class="n">entityManager</span><span class="p">.</span><span class="na">merge</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">Customer</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findById</span><span class="p">(</span><span class="n">CustomerId</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">CustomerEntity</span><span class="w"> </span><span class="n">entity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entityManager</span><span class="p">.</span><span class="na">find</span><span class="p">(</span><span class="n">CustomerEntity</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">.</span><span class="na">value</span><span class="p">());</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">ofNullable</span><span class="p">(</span><span class="n">entity</span><span class="p">).</span><span class="na">map</span><span class="p">(</span><span class="k">this</span><span class="p">::</span><span class="n">toDomain</span><span class="p">);</span><span class="w">  </span><span class="c1">// Data Mapper</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Customer</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByEmail</span><span class="p">(</span><span class="n">Email</span><span class="w"> </span><span class="n">email</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ... query implementation with Data Mapper transformation</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Data Mapper methods</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">CustomerEntity</span><span class="w"> </span><span class="nf">toEntity</span><span class="p">(</span><span class="n">Customer</span><span class="w"> </span><span class="n">customer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">CustomerEntity</span><span class="w"> </span><span class="n">entity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CustomerEntity</span><span class="p">();</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setId</span><span class="p">(</span><span class="n">customer</span><span class="p">.</span><span class="na">getId</span><span class="p">().</span><span class="na">value</span><span class="p">());</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setEmail</span><span class="p">(</span><span class="n">customer</span><span class="p">.</span><span class="na">getEmail</span><span class="p">().</span><span class="na">value</span><span class="p">());</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setName</span><span class="p">(</span><span class="n">customer</span><span class="p">.</span><span class="na">getName</span><span class="p">().</span><span class="na">fullName</span><span class="p">());</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">customer</span><span class="p">.</span><span class="na">getStatus</span><span class="p">().</span><span class="na">name</span><span class="p">());</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">entity</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Customer</span><span class="w"> </span><span class="nf">toDomain</span><span class="p">(</span><span class="n">CustomerEntity</span><span class="w"> </span><span class="n">entity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Customer</span><span class="p">(</span>
<span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">CustomerId</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="na">getId</span><span class="p">()),</span>
<span class="w">            </span><span class="n">Email</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="na">getEmail</span><span class="p">()),</span>
<span class="w">            </span><span class="n">PersonName</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="na">getName</span><span class="p">()),</span>
<span class="w">            </span><span class="n">CustomerStatus</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="na">getStatus</span><span class="p">())</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="service-layer-domain-model-repository">Service Layer + Domain Model + Repository<a class="headerlink" href="#service-layer-domain-model-repository" title="Permanent link">&para;</a></h4>
<p><strong>Complete Pattern Combination:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Application Layer: Service Layer</span>
<span class="nd">@Service</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TransferMoneyService</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">AccountRepository</span><span class="w"> </span><span class="n">accountRepo</span><span class="p">;</span><span class="w">  </span><span class="c1">// Repository</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">TransferPolicy</span><span class="w"> </span><span class="n">transferPolicy</span><span class="p">;</span><span class="w">  </span><span class="c1">// Domain Service</span>

<span class="w">    </span><span class="nd">@Transactional</span><span class="w">  </span><span class="c1">// Unit of Work</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="n">TransferMoneyCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 1. Load aggregates via Repository</span>
<span class="w">        </span><span class="n">Account</span><span class="w"> </span><span class="n">fromAccount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accountRepo</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">fromAccountId</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">orElseThrow</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AccountNotFoundException</span><span class="p">());</span>
<span class="w">        </span><span class="n">Account</span><span class="w"> </span><span class="n">toAccount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accountRepo</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">toAccountId</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">orElseThrow</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AccountNotFoundException</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// 2. Validate using Domain Service</span>
<span class="w">        </span><span class="n">transferPolicy</span><span class="p">.</span><span class="na">validateTransfer</span><span class="p">(</span><span class="n">fromAccount</span><span class="p">,</span><span class="w"> </span><span class="n">toAccount</span><span class="p">,</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">amount</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// 3. Execute domain logic (Domain Model)</span>
<span class="w">        </span><span class="n">fromAccount</span><span class="p">.</span><span class="na">debit</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">amount</span><span class="p">());</span>
<span class="w">        </span><span class="n">toAccount</span><span class="p">.</span><span class="na">credit</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">amount</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// 4. Save via Repository</span>
<span class="w">        </span><span class="n">accountRepo</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">fromAccount</span><span class="p">);</span>
<span class="w">        </span><span class="n">accountRepo</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">toAccount</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Note: This violates DDD&#39;s &quot;one aggregate per transaction&quot; rule</span>
<span class="w">        </span><span class="c1">// In strict DDD, should use domain events for eventual consistency</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="complementary-patterns-summary">Complementary Patterns Summary<a class="headerlink" href="#complementary-patterns-summary" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>PoEAA Pattern</th>
<th>DDD Equivalent/Integration</th>
<th>Layer</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Domain Model</strong></td>
<td>Domain Layer (Entities, Value Objects, Aggregates)</td>
<td>Domain</td>
<td>DDD elaborates implementation</td>
</tr>
<tr>
<td><strong>Service Layer</strong></td>
<td>Application Service</td>
<td>Application</td>
<td>Same concept, DDD adds CQRS</td>
</tr>
<tr>
<td><strong>Repository</strong></td>
<td>Repository (per Aggregate)</td>
<td>Domain (interface), Infrastructure (impl)</td>
<td>DDD adds aggregate scoping</td>
</tr>
<tr>
<td><strong>Data Mapper</strong></td>
<td>Repository Implementation</td>
<td>Infrastructure</td>
<td>Implements persistence</td>
</tr>
<tr>
<td><strong>Unit of Work</strong></td>
<td>Transaction Management</td>
<td>Application</td>
<td>Often handled by ORM</td>
</tr>
<tr>
<td><strong>Identity Map</strong></td>
<td>Entity Caching</td>
<td>Infrastructure</td>
<td>ORM feature</td>
</tr>
<tr>
<td><strong>Lazy Load</strong></td>
<td>Aggregate Loading Strategy</td>
<td>Infrastructure</td>
<td>Be careful with aggregate boundaries</td>
</tr>
<tr>
<td><strong>Transaction Script</strong></td>
<td>Simple Application Service</td>
<td>Application</td>
<td>For simple cases</td>
</tr>
<tr>
<td><strong>Table Module</strong></td>
<td>Not used in DDD</td>
<td>N/A</td>
<td>DDD prefers Domain Model</td>
</tr>
<tr>
<td><strong>Presentation Model</strong></td>
<td>View Model</td>
<td>Presentation</td>
<td>Transforms domain for UI</td>
</tr>
<tr>
<td><strong>MVC / MVP / MVVM</strong></td>
<td>Presentation Patterns</td>
<td>Presentation</td>
<td>UI organization</td>
</tr>
<tr>
<td><strong>Front Controller</strong></td>
<td>API Gateway / BFF</td>
<td>Presentation</td>
<td>Entry point for requests</td>
</tr>
</tbody>
</table>
<h4 id="integration-guidelines">Integration Guidelines<a class="headerlink" href="#integration-guidelines" title="Permanent link">&para;</a></h4>
<p><strong>Use PoEAA Patterns For:</strong></p>
<ol>
<li>
<p><strong>Presentation Layer Organization</strong><br />
   - MVC, MVVM for UI structure<br />
   - Presentation Model for view logic<br />
   - Front Controller for request routing</p>
</li>
<li>
<p><strong>Persistence Strategies</strong><br />
   - Data Mapper for OR mapping<br />
   - Repository implementation patterns<br />
   - Unit of Work for transaction coordination</p>
</li>
<li>
<p><strong>Session State Management</strong><br />
   - Identity Map for caching<br />
   - Lazy Load for performance<br />
   - Optimistic Offline Lock for concurrency</p>
</li>
<li>
<p><strong>Service Layer Orchestration</strong><br />
   - Transaction coordination<br />
   - DTO patterns<br />
   - Remote Facade for distribution</p>
</li>
</ol>
<p><strong>Use DDD Patterns For:</strong></p>
<ol>
<li>
<p><strong>Domain Modeling</strong><br />
   - Entity vs. Value Object distinction<br />
   - Aggregate design<br />
   - Domain Events<br />
   - Domain Services</p>
</li>
<li>
<p><strong>Strategic Design</strong><br />
   - Bounded Contexts<br />
   - Context Mapping<br />
   - Ubiquitous Language<br />
   - Anti-Corruption Layers</p>
</li>
<li>
<p><strong>Domain Logic Organization</strong><br />
   - Where business rules live<br />
   - Invariant enforcement<br />
   - State transitions<br />
   - Domain event publication</p>
</li>
<li>
<p><strong>Team Organization</strong><br />
   - Context ownership<br />
   - Team autonomy<br />
   - Conway's Law application</p>
</li>
</ol>
<p><strong>Integration Principles:</strong></p>
<p><strong>1. Clear Separation:</strong><br />
- Domain layer knows nothing of persistence (PoEAA patterns)<br />
- Presentation uses domain model but doesn't contain business logic<br />
- Application layer coordinates: domain model + PoEAA transaction patterns</p>
<p><strong>2. Dependency Direction:</strong></p>
<div class="codehilite"><pre><span></span><code>Presentation → Application → Domain
                    ↓
            Infrastructure (PoEAA patterns)
</code></pre></div>

<p><strong>3. Pattern Selection:</strong><br />
- Start with DDD for domain modeling<br />
- Use PoEAA for infrastructure concerns<br />
- Combine naturally at integration points</p>
<p><strong>4. Avoid Conflicts:</strong><br />
- Don't use Table Module (conflicts with DDD's rich domain model)<br />
- Don't use Active Record (entities should be persistence-ignorant)<br />
- Don't put business logic in Service Layer (belongs in Domain Layer)</p>
<hr />
<h2 id="part-iv-summary-section-8">Part IV Summary (Section 8)<a class="headerlink" href="#part-iv-summary-section-8" title="Permanent link">&para;</a></h2>
<p>Section 8 covered <strong>Integration with Patterns of Enterprise Application Architecture (PoEAA)</strong>:</p>
<p><strong>Key Insights:</strong><br />
- PoEAA and DDD are complementary, not competing<br />
- PoEAA provides architectural scaffolding; DDD provides domain modeling guidance<br />
- Many patterns overlap or align naturally<br />
- Together they provide a complete architecture</p>
<p><strong>Pattern Mappings:</strong><br />
- <strong>Domain Model (PoEAA) = Domain Layer (DDD)</strong>: DDD elaborates with Entity, Value Object, Aggregate<br />
- <strong>Service Layer (PoEAA) = Application Service (DDD)</strong>: Same pattern, DDD adds CQRS and events<br />
- <strong>Repository (PoEAA) ≈ Repository (DDD)</strong>: DDD scopes to aggregate roots<br />
- <strong>Data Mapper (PoEAA)</strong>: Implements DDD Repositories<br />
- <strong>Unit of Work (PoEAA)</strong>: Handled by ORM and transaction management</p>
<p><strong>Layered Architecture:</strong><br />
- <strong>Presentation</strong>: PoEAA MVC/MVVM patterns + DDD View Models<br />
- <strong>Application</strong>: PoEAA Service Layer = DDD Application Service<br />
- <strong>Domain</strong>: PoEAA Domain Model elaborated by DDD tactical patterns<br />
- <strong>Infrastructure</strong>: PoEAA persistence patterns implement DDD repositories</p>
<p><strong>Best Practices:</strong><br />
- Use PoEAA for presentation and infrastructure concerns<br />
- Use DDD for domain modeling and strategic design<br />
- Combine naturally at integration points<br />
- Maintain clear separation of concerns<br />
- Follow dependency inversion principle</p>
<p><strong>What's Next</strong>: Section 9 covers <strong>Schema Reference</strong>—comprehensive documentation of the strategic, tactical, and domain stories schemas, including ID conventions, validation rules, and schema examples.</p>
<hr />
<h1 id="part-v-reference_1">Part V: Reference<a class="headerlink" href="#part-v-reference_1" title="Permanent link">&para;</a></h1>
<h2 id="9-schema-reference-guide">9. Schema Reference Guide<a class="headerlink" href="#9-schema-reference-guide" title="Permanent link">&para;</a></h2>
<h3 id="91-overview">9.1 Overview<a class="headerlink" href="#91-overview" title="Permanent link">&para;</a></h3>
<p>Domain-Driven Design patterns can be formalized as <strong>machine-readable definitions</strong> across three levels of modeling:</p>
<ol>
<li>
<p><strong>Strategic Schema</strong> (<code>strategic-ddd.schema.yaml</code>)<br />
   - System architecture<br />
   - Domains and Bounded Contexts<br />
   - Context Mappings<br />
   - BFF (Backend-for-Frontend) Scopes and Interfaces</p>
</li>
<li>
<p><strong>Tactical Schema</strong> (<code>tactical-ddd.schema.yaml</code>)<br />
   - Aggregates, Entities, Value Objects<br />
   - Repositories, Domain Services<br />
   - Application Services (CQRS)<br />
   - Command/Query Interfaces (Knight pattern)<br />
   - Domain Events</p>
</li>
<li>
<p><strong>Domain Stories Schema</strong> (<code>domain-stories-schema.yaml</code>)<br />
   - Domain Storytelling artifacts<br />
   - Actors, Activities, Work Objects<br />
   - Commands, Queries, Events, Policies<br />
   - Mappings to Tactical concepts</p>
</li>
</ol>
<p><strong>Purpose of Schema Formalization:</strong><br />
- <strong>Validation</strong>: Ensure models are structurally correct<br />
- <strong>Tool Support</strong>: Enable IDE assistance, code generation, LLM reasoning<br />
- <strong>Documentation</strong>: Machine-readable domain knowledge<br />
- <strong>Consistency</strong>: Codify DDD best practices in a verifiable form</p>
<h3 id="92-strategic-schema">9.2 Strategic Schema<a class="headerlink" href="#92-strategic-schema" title="Permanent link">&para;</a></h3>
<p><strong>Location</strong>: <code>/domains/ddd/schemas/strategic-ddd.schema.yaml</code></p>
<p>Having established the three-layer schema architecture, let's examine the strategic schema in detail. This schema captures system-level architecture decisions, domain boundaries, and integration patterns that shape your entire DDD implementation.</p>
<h4 id="921-root-object-system">9.2.1 Root Object: System<a class="headerlink" href="#921-root-object-system" title="Permanent link">&para;</a></h4>
<p>The <code>System</code> is the root container representing the entire software system.</p>
<p><strong>Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">system</span><span class="p">:</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sys_&lt;name&gt;</span><span class="w">           </span><span class="c1"># System identifier</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">             </span><span class="c1"># System name</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">      </span><span class="c1"># What this system does</span>
<span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">          </span><span class="c1"># System version</span>

<span class="w">  </span><span class="c1"># Full objects embedded (not just IDs)</span>
<span class="w">  </span><span class="nt">domains</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">Domain</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">bounded_contexts</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">BoundedContext</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">context_mappings</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ContextMapping</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">bff_scopes</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">BFFScope</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">bff_interfaces</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">BFFInterface</span><span class="p p-Indicator">]</span>
</code></pre></div>

<p><strong>Benefits</strong>:<br />
- <strong>Single source of truth</strong>: All strategic definitions in one structure<br />
- <strong>Validation clarity</strong>: Schema can validate cross-references<br />
- <strong>Tool support</strong>: IDEs can navigate entire system structure<br />
- <strong>Generation</strong>: Code generators have complete context</p>
<p><strong>Example</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">system</span><span class="p">:</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sys_ecommerce</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;E-Commerce</span><span class="nv"> </span><span class="s">System&quot;</span>
<span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2.0.0&quot;</span>
<span class="w">  </span><span class="nt">domains</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dom_sales</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Sales&quot;</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">core</span>
<span class="w">      </span><span class="nt">strategic_importance</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>
<span class="w">  </span><span class="nt">bounded_contexts</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_order_management</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Order</span><span class="nv"> </span><span class="s">Management&quot;</span>
<span class="w">      </span><span class="nt">domain_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dom_sales</span>
</code></pre></div>

<h4 id="922-domain-type">9.2.2 Domain Type<a class="headerlink" href="#922-domain-type" title="Permanent link">&para;</a></h4>
<p><strong>Purpose</strong>: Represents a sphere of knowledge and activity.</p>
<p><strong>Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">Domain</span><span class="p">:</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dom_&lt;name&gt;</span><span class="w">           </span><span class="c1"># Required, pattern: ^dom_[a-z0-9_]+$</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">             </span><span class="c1"># Required, from ubiquitous language</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w">                    </span><span class="c1"># Required</span>
<span class="w">    </span><span class="nt">enum</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">core</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">supporting</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">generic</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">strategic_importance</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enum</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">critical</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">important</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">standard</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">low</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">bounded_contexts</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">BcId</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># ID references</span>
<span class="w">  </span><span class="nt">investment_strategy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">  </span><span class="nt">notes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</code></pre></div>

<p><strong>Domain Types</strong>:<br />
- <strong>Core</strong>: Your competitive advantage, invest heavily<br />
- <strong>Supporting</strong>: Necessary but not differentiating<br />
- <strong>Generic</strong>: Buy off-the-shelf solutions</p>
<p><strong>Strategic Importance</strong>:<br />
- <strong>Critical</strong>: Mission-critical, best team<br />
- <strong>Important</strong>: High priority, strong team<br />
- <strong>Standard</strong>: Normal priority, adequate team<br />
- <strong>Low</strong>: Minimal investment, outsource candidate</p>
<h4 id="923-bounded-context-type">9.2.3 Bounded Context Type<a class="headerlink" href="#923-bounded-context-type" title="Permanent link">&para;</a></h4>
<p><strong>Purpose</strong>: Explicit boundary within which a domain model is defined.</p>
<p><strong>Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">BoundedContext</span><span class="p">:</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_&lt;name&gt;</span><span class="w">            </span><span class="c1"># Required, pattern: ^bc_[a-z0-9_]+$</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">             </span><span class="c1"># Required</span>
<span class="w">  </span><span class="nt">domain_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DomId</span><span class="w">        </span><span class="c1"># Required (parent domain)</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>

<span class="w">  </span><span class="nt">ubiquitous_language</span><span class="p">:</span>
<span class="w">    </span><span class="nt">glossary</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">term</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">        </span><span class="nt">definition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">        </span><span class="nt">examples</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">string</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="nt">team_ownership</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>

<span class="w">  </span><span class="c1"># ID references to tactical concepts</span>
<span class="w">  </span><span class="nt">aggregates</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">agg_*</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">repositories</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">repo_*</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">domain_services</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">svc_dom_*</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">application_services</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">svc_app_*</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">domain_events</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">evt_*</span><span class="p p-Indicator">]</span>
</code></pre></div>

<p><strong>Key Points</strong>:<br />
- Must belong to exactly one domain (<code>domain_ref</code>)<br />
- Contains ubiquitous language glossary specific to context<br />
- Lists tactical patterns (aggregates, services, etc.) by ID<br />
- Team ownership tracks Conway's Law alignment</p>
<h4 id="924-context-mapping-type">9.2.4 Context Mapping Type<a class="headerlink" href="#924-context-mapping-type" title="Permanent link">&para;</a></h4>
<p><strong>Purpose</strong>: Defines relationship between two bounded contexts.</p>
<p><strong>Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">ContextMapping</span><span class="p">:</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cm_&lt;source&gt;_to_&lt;target&gt;</span><span class="w">  </span><span class="c1"># Required, pattern: ^cm_[a-z0-9_]+_to_[a-z0-9_]+$</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">                  </span><span class="c1"># Required</span>
<span class="w">  </span><span class="nt">upstream_context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BcId</span><span class="w">        </span><span class="c1"># Required</span>
<span class="w">  </span><span class="nt">downstream_context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BcId</span><span class="w">      </span><span class="c1"># Required</span>
<span class="w">  </span><span class="nt">relationship_type</span><span class="p">:</span><span class="w">            </span><span class="c1"># Required</span>
<span class="w">    </span><span class="nt">enum</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">partnership</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">shared_kernel</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customer_supplier</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">conformist</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">anti_corruption_layer</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">open_host_service</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">published_language</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">separate_ways</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">big_ball_of_mud</span>

<span class="w">  </span><span class="nt">integration_pattern</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">  </span><span class="nt">translation_map</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">object</span>
<span class="w">  </span><span class="nt">shared_elements</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">string</span><span class="p p-Indicator">]</span><span class="w">    </span><span class="c1"># For shared_kernel</span>
<span class="w">  </span><span class="nt">acl_details</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">object</span><span class="w">          </span><span class="c1"># For anti_corruption_layer</span>
<span class="w">  </span><span class="nt">notes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</code></pre></div>

<p><strong>Relationship Types</strong> (see Section 2.5 for detailed descriptions):<br />
- <strong>Partnership</strong>: Mutual cooperation<br />
- <strong>Shared Kernel</strong>: Shared code/model<br />
- <strong>Customer/Supplier</strong>: Upstream serves downstream<br />
- <strong>Conformist</strong>: Downstream accepts upstream model<br />
- <strong>Anti-Corruption Layer</strong>: Downstream protects itself<br />
- <strong>Open Host Service</strong>: Upstream provides protocol<br />
- <strong>Published Language</strong>: Standardized exchange format<br />
- <strong>Separate Ways</strong>: No integration<br />
- <strong>Big Ball of Mud</strong>: Legacy complexity</p>
<p>The <code>name</code> field provides a descriptive name for the relationship, making context mappings easier to understand (e.g., "Order to Payment Integration", "User Profile Shared Model").</p>
<h4 id="925-bff-scope-type">9.2.5 BFF Scope Type<a class="headerlink" href="#925-bff-scope-type" title="Permanent link">&para;</a></h4>
<p><strong>Purpose</strong>: Backend-for-Frontend serving exactly ONE client type.</p>
<p><strong>Core Principle</strong>: <strong>"One Experience, One BFF"</strong> — BFFs are scoped by CLIENT TYPE (web, iOS, Android), NOT by bounded contexts.</p>
<p><strong>Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">BFFScope</span><span class="p">:</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bff_&lt;client_type&gt;</span><span class="w">    </span><span class="c1"># Required, pattern: ^bff_[a-z0-9_]+$</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">             </span><span class="c1"># Required, pattern: ^[A-Z][a-zA-Z]+BFF$</span>

<span class="w">  </span><span class="nt">client_type</span><span class="p">:</span><span class="w">             </span><span class="c1"># Required (exactly one)</span>
<span class="w">    </span><span class="nt">enum</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">web</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">mobile_ios</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">mobile_android</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">desktop</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">partner_api</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">iot</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">tablet</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="nt">serves_interface</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w"> </span><span class="c1"># Required</span>

<span class="w">  </span><span class="nt">aggregates_from_contexts</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">BcId</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># Required, minItems: 1 (multiple contexts!)</span>

<span class="w">  </span><span class="nt">owned_by_team</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">    </span><span class="c1"># Required (Conway&#39;s Law)</span>
<span class="w">  </span><span class="nt">team_type</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enum</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">frontend</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">mobile</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">partner_integration</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="nt">provides</span><span class="p">:</span>
<span class="w">    </span><span class="nt">endpoints</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">BFFEndpoint</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">data_aggregation</span><span class="p">:</span>
<span class="w">      </span><span class="nt">strategy</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">parallel</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">sequential</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">conditional</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">transformations</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">DataTransformation</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">client_optimizations</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">string</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="nt">responsibilities</span><span class="p">:</span>
<span class="w">    </span><span class="nt">data_aggregation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">           </span><span class="c1"># const: true</span>
<span class="w">    </span><span class="nt">client_specific_orchestration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># const: true</span>
<span class="w">    </span><span class="nt">presentation_logic</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">         </span><span class="c1"># const: true</span>
<span class="w">    </span><span class="nt">format_translation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">         </span><span class="c1"># const: true</span>
<span class="w">    </span><span class="nt">business_logic</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">            </span><span class="c1"># const: false (MUST NOT)</span>
<span class="w">    </span><span class="nt">transaction_management</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">    </span><span class="c1"># const: false (MUST NOT)</span>
<span class="w">    </span><span class="nt">direct_persistence</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">        </span><span class="c1"># const: false (MUST NOT)</span>
</code></pre></div>

<p><strong>Key Design Constraints</strong>:<br />
- <code>business_logic: const: false</code> — BFFs MUST NOT contain business logic<br />
- <code>transaction_management: const: false</code> — BFFs delegate to services<br />
- <code>direct_persistence: const: false</code> — BFFs call services, not databases<br />
- <code>aggregates_from_contexts: minItems: 1</code> — BFF aggregates from MULTIPLE contexts</p>
<h4 id="926-bff-interface-type">9.2.6 BFF Interface Type<a class="headerlink" href="#926-bff-interface-type" title="Permanent link">&para;</a></h4>
<p><strong>Purpose</strong>: Concrete REST API implementation for a BFF scope accessing a specific bounded context.</p>
<p><strong>Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">BFFInterface</span><span class="p">:</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bff_if_&lt;context&gt;_&lt;client_type&gt;</span><span class="w">  </span><span class="c1"># Required, pattern: ^bff_if_[a-z0-9_]+$</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">                         </span><span class="c1"># Required</span>
<span class="w">  </span><span class="nt">bff_scope_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BffId</span><span class="w">                 </span><span class="c1"># Required (belongs to which BFF)</span>
<span class="w">  </span><span class="nt">primary_bounded_context_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BcId</span><span class="w">    </span><span class="c1"># Required</span>
<span class="w">  </span><span class="nt">additional_context_refs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">BcId</span><span class="p p-Indicator">]</span><span class="w">      </span><span class="c1"># Optional (multi-context aggregation)</span>
<span class="w">  </span><span class="nt">base_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">                    </span><span class="c1"># Required, pattern: ^/[a-z0-9-/]+$</span>

<span class="w">  </span><span class="nt">endpoints</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">BFFInterfaceEndpoint</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="nt">value_object_conversion</span><span class="p">:</span>
<span class="w">    </span><span class="nt">from_string</span><span class="p">:</span><span class="w">  </span><span class="c1"># String/URN → Value Object</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">value_object_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vo_user_id</span>
<span class="w">        </span><span class="nt">from_field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;userId&quot;</span>
<span class="w">        </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;UserId.of(string)&quot;</span>
<span class="w">    </span><span class="nt">to_string</span><span class="p">:</span><span class="w">    </span><span class="c1"># Value Object → String/URN</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">value_object_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vo_user_id</span>
<span class="w">        </span><span class="nt">to_field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;userId&quot;</span>
<span class="w">        </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;userId.id()&quot;</span>

<span class="w">  </span><span class="nt">execution_model</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enum</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">blocking</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">async</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">reactive</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="nt">error_handling</span><span class="p">:</span>
<span class="w">    </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">enum</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">fail_fast</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">graceful_degradation</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">partial_response</span><span class="p p-Indicator">]</span>
</code></pre></div>

<p><strong>BFFInterfaceEndpoint</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">BFFInterfaceEndpoint</span><span class="p">:</span>
<span class="w">  </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">             </span><span class="c1"># e.g., &quot;/users/{id}&quot;</span>
<span class="w">  </span><span class="nt">method</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enum</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">GET</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">POST</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">PUT</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">PATCH</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">DELETE</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">operation_type</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enum</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">command</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">query</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">action</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># CQRS alignment</span>

<span class="w">  </span><span class="nt">delegates_to_commands</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">cmd_*</span><span class="p p-Indicator">]</span><span class="w">   </span><span class="c1"># ID references</span>
<span class="w">  </span><span class="nt">delegates_to_queries</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">qry_*</span><span class="p p-Indicator">]</span><span class="w">    </span><span class="c1"># ID references</span>

<span class="w">  </span><span class="nt">request_dto</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RequestDTO</span>
<span class="w">  </span><span class="nt">response_dto</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ResponseDTO</span>

<span class="w">  </span><span class="nt">aggregates_data_from</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">BcId</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># Multiple contexts</span>
</code></pre></div>

<p><strong>Key Points</strong>:<br />
- <strong>Value Object Conversion</strong>: BFFs convert between strings (API) and value objects (domain)<br />
- <strong>Multi-Context Aggregation</strong>: Can aggregate from multiple bounded contexts<br />
- <strong>CQRS Alignment</strong>: Endpoints marked as command/query/action<br />
- <strong>Delegation</strong>: Calls application services, doesn't implement logic</p>
<h4 id="927-strategic-schema-id-patterns">9.2.7 Strategic Schema ID Patterns<a class="headerlink" href="#927-strategic-schema-id-patterns" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Type</th>
<th>Prefix</th>
<th>Pattern</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>System</td>
<td><code>sys_</code></td>
<td><code>^sys_[a-z0-9_]+$</code></td>
<td><code>sys_ecommerce</code></td>
</tr>
<tr>
<td>Domain</td>
<td><code>dom_</code></td>
<td><code>^dom_[a-z0-9_]+$</code></td>
<td><code>dom_sales</code></td>
</tr>
<tr>
<td>Bounded Context</td>
<td><code>bc_</code></td>
<td><code>^bc_[a-z0-9_]+$</code></td>
<td><code>bc_order_management</code></td>
</tr>
<tr>
<td>Context Mapping</td>
<td><code>cm_</code></td>
<td><code>^cm_[a-z0-9_]+_to_[a-z0-9_]+$</code></td>
<td><code>cm_order_to_payment</code></td>
</tr>
<tr>
<td>BFF Scope</td>
<td><code>bff_</code></td>
<td><code>^bff_[a-z0-9_]+$</code></td>
<td><code>bff_web</code>, <code>bff_ios</code></td>
</tr>
<tr>
<td>BFF Interface</td>
<td><code>bff_if_</code></td>
<td><code>^bff_if_[a-z0-9_]+$</code></td>
<td><code>bff_if_user_web</code></td>
</tr>
</tbody>
</table>
<h4 id="928-strategic-design-rules">9.2.8 Strategic Design Rules<a class="headerlink" href="#928-strategic-design-rules" title="Permanent link">&para;</a></h4>
<p>The strategic patterns require:</p>
<ol>
<li>
<p><strong>Bounded Context Has Domain</strong>:<br />
   - Every <code>BoundedContext</code> must have a valid <code>domain_ref</code></p>
</li>
<li>
<p><strong>Context Mapping Different Contexts</strong>:<br />
   - <code>upstream_context</code> ≠ <code>downstream_context</code></p>
</li>
<li>
<p><strong>BFF Serves One Client Type</strong>:<br />
   - <code>client_type</code> is a single enum value, not an array</p>
</li>
<li>
<p><strong>BFF Aggregates Multiple Contexts</strong>:<br />
   - <code>aggregates_from_contexts</code> has <code>minItems: 1</code></p>
</li>
<li>
<p><strong>BFF No Business Logic</strong>:<br />
   - <code>responsibilities.business_logic: const: false</code> (required)</p>
</li>
</ol>
<h3 id="93-tactical-schema">9.3 Tactical Schema<a class="headerlink" href="#93-tactical-schema" title="Permanent link">&para;</a></h3>
<p><strong>Location</strong>: <code>/domains/ddd/schemas/tactical-ddd.schema.yaml</code></p>
<h4 id="931-root-object-boundedcontext">9.3.1 Root Object: BoundedContext<a class="headerlink" href="#931-root-object-boundedcontext" title="Permanent link">&para;</a></h4>
<p><code>BoundedContext</code> is the root object for tactical patterns.</p>
<p><strong>Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">bounded_context</span><span class="p">:</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bc_&lt;name&gt;</span><span class="w">            </span><span class="c1"># Required, pattern: ^bc_[a-z0-9_]+$</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">             </span><span class="c1"># Required</span>
<span class="w">  </span><span class="nt">domain_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DomId</span><span class="w">        </span><span class="c1"># Required (links to strategic schema)</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>

<span class="w">  </span><span class="c1"># Full objects embedded (not just IDs)</span>
<span class="w">  </span><span class="nt">aggregates</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">Aggregate</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">entities</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">Entity</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">value_objects</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ValueObject</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">repositories</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">Repository</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">domain_services</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">DomainService</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">application_services</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ApplicationService</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">command_interfaces</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">CommandInterface</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">query_interfaces</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">QueryInterface</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">domain_events</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">DomainEvent</span><span class="p p-Indicator">]</span>
</code></pre></div>

<p><strong>Benefits</strong>:<br />
- <strong>Scoping</strong>: All tactical patterns scoped to one bounded context<br />
- <strong>Implicit Context</strong>: Child types don't need <code>bounded_context_ref</code> (implicit from parent)<br />
- <strong>Validation</strong>: Schema can validate references within context<br />
- <strong>Generation</strong>: Code generators have context-scoped structure</p>
<h4 id="932-aggregate-type">9.3.2 Aggregate Type<a class="headerlink" href="#932-aggregate-type" title="Permanent link">&para;</a></h4>
<p><strong>Purpose</strong>: Cluster of entities and value objects with defined consistency boundary.</p>
<p><strong>Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">Aggregate</span><span class="p">:</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agg_&lt;name&gt;</span><span class="w">           </span><span class="c1"># Required, pattern: ^agg_[a-z0-9_]+$</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">             </span><span class="c1"># Required</span>
<span class="w">  </span><span class="nt">root_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">EntId</span><span class="w">          </span><span class="c1"># Required (aggregate root entity)</span>

<span class="w">  </span><span class="nt">entities</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">EntId</span><span class="p p-Indicator">]</span><span class="w">        </span><span class="c1"># ID references (including root)</span>
<span class="w">  </span><span class="nt">value_objects</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">VoId</span><span class="p p-Indicator">]</span><span class="w">    </span><span class="c1"># ID references</span>

<span class="w">  </span><span class="nt">consistency_rules</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">string</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">invariants</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">string</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="nt">size_estimate</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enum</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">small</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">medium</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">large</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># Prefer small!</span>
</code></pre></div>

<p><strong>Vaughn Vernon's 4 Rules</strong> (enforced by usage patterns):<br />
1. Protect true invariants (<code>invariants</code> array)<br />
2. Design small aggregates (<code>size_estimate: small</code>)<br />
3. Reference other aggregates by ID only (ID references, not objects)<br />
4. Update other aggregates via domain events (<code>publishes_events</code>)</p>
<p><strong>Key Points</strong>:<br />
- One aggregate root (<code>root_ref</code> must be an entity with <code>is_aggregate_root: true</code>)<br />
- Contains entities and value objects by ID reference<br />
- Defines consistency boundary (<code>invariants</code>)<br />
- Prefer small aggregates (easier to maintain invariants)</p>
<h4 id="933-entity-type">9.3.3 Entity Type<a class="headerlink" href="#933-entity-type" title="Permanent link">&para;</a></h4>
<p><strong>Purpose</strong>: Object with unique identity and lifecycle.</p>
<p><strong>Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">Entity</span><span class="p">:</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ent_&lt;name&gt;</span><span class="w">           </span><span class="c1"># Required, pattern: ^ent_[a-z0-9_]+$</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">             </span><span class="c1"># Required</span>
<span class="w">  </span><span class="nt">aggregate_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AggId</span><span class="w">     </span><span class="c1"># Required (which aggregate)</span>
<span class="w">  </span><span class="nt">is_aggregate_root</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">boolean</span><span class="w">  </span><span class="c1"># true if this is root</span>

<span class="w">  </span><span class="nt">identity_field</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">   </span><span class="c1"># Required (e.g., &quot;orderId&quot;)</span>
<span class="w">  </span><span class="nt">identity_generation</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enum</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">user_provided</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">auto_generated</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">derived</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">external</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="nt">attributes</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">Attribute</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">business_methods</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">Method</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">invariants</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">string</span><span class="p p-Indicator">]</span>
</code></pre></div>

<p><strong>Identity Generation</strong>:<br />
- <strong>user_provided</strong>: User supplies ID (e.g., email)<br />
- <strong>auto_generated</strong>: Application generates UUID<br />
- <strong>derived</strong>: Computed from other attributes<br />
- <strong>external</strong>: Provided by external system</p>
<p><strong>Key Points</strong>:<br />
- Must have unique identity (<code>identity_field</code>)<br />
- Belongs to exactly one aggregate (<code>aggregate_ref</code>)<br />
- Only one entity per aggregate can be root (<code>is_aggregate_root: true</code>)</p>
<h4 id="934-value-object-type">9.3.4 Value Object Type<a class="headerlink" href="#934-value-object-type" title="Permanent link">&para;</a></h4>
<p><strong>Purpose</strong>: Immutable object defined by its attributes.</p>
<p><strong>Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">ValueObject</span><span class="p">:</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vo_&lt;name&gt;</span><span class="w">            </span><span class="c1"># Required, pattern: ^vo_[a-z0-9_]+$</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">             </span><span class="c1"># Required</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>

<span class="w">  </span><span class="nt">attributes</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">Attribute</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">validation_rules</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">string</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">equality_criteria</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">string</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="nt">immutability</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">       </span><span class="c1"># const: true (MUST be true, schema-enforced)</span>
</code></pre></div>

<p><strong>CRITICAL</strong>: <code>immutability: const: true</code></p>
<p>This design constraint <strong>requires</strong> that all value objects MUST be immutable. Value objects with <code>immutability: false</code> violate the pattern.</p>
<p><strong>Example</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">value_objects</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vo_money</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Money&quot;</span>
<span class="w">    </span><span class="nt">attributes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">amount</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">decimal</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">currency</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">    </span><span class="nt">validation_rules</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;Amount</span><span class="nv"> </span><span class="s">must</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">non-negative&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;Currency</span><span class="nv"> </span><span class="s">must</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">valid</span><span class="nv"> </span><span class="s">ISO</span><span class="nv"> </span><span class="s">4217</span><span class="nv"> </span><span class="s">code&quot;</span>
<span class="w">    </span><span class="nt">equality_criteria</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">amount</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">currency</span>
<span class="w">    </span><span class="nt">immutability</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># Required</span>
</code></pre></div>

<h4 id="935-repository-type">9.3.5 Repository Type<a class="headerlink" href="#935-repository-type" title="Permanent link">&para;</a></h4>
<p><strong>Purpose</strong>: Persistence abstraction for aggregates.</p>
<p><strong>Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">Repository</span><span class="p">:</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">repo_&lt;name&gt;</span><span class="w">          </span><span class="c1"># Required, pattern: ^repo_[a-z0-9_]+$</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">             </span><span class="c1"># Required</span>
<span class="w">  </span><span class="nt">aggregate_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AggId</span><span class="w">     </span><span class="c1"># Required (one repo per aggregate)</span>

<span class="w">  </span><span class="nt">interface_methods</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">Method</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">persistence_strategy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</code></pre></div>

<p><strong>Key Rule</strong>: <strong>One repository per aggregate root</strong>, NOT per entity.</p>
<p><strong>Typical Interface Methods</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">interface_methods</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;save&quot;</span>
<span class="w">    </span><span class="nt">parameters</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;order&quot;</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Order&quot;</span>
<span class="w">    </span><span class="nt">returns</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;void&quot;</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;findById&quot;</span>
<span class="w">    </span><span class="nt">parameters</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;orderId&quot;</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;OrderId&quot;</span>
<span class="w">    </span><span class="nt">returns</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Optional&lt;Order&gt;&quot;</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;delete&quot;</span>
<span class="w">    </span><span class="nt">parameters</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;order&quot;</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Order&quot;</span>
<span class="w">    </span><span class="nt">returns</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;void&quot;</span>
</code></pre></div>

<h4 id="936-application-service-type">9.3.6 Application Service Type<a class="headerlink" href="#936-application-service-type" title="Permanent link">&para;</a></h4>
<p><strong>Purpose</strong>: Orchestrates use case execution, manages transactions.</p>
<p><strong>Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">ApplicationService</span><span class="p">:</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc_app_&lt;name&gt;</span><span class="w">       </span><span class="c1"># Required, pattern: ^svc_app_[a-z0-9_]+$</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">             </span><span class="c1"># Required, pattern: ^[A-Z][a-zA-Z]+ApplicationService$</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>

<span class="w">  </span><span class="nt">implements_commands</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">CmdId</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># Command interfaces</span>
<span class="w">  </span><span class="nt">implements_queries</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">QryId</span><span class="p p-Indicator">]</span><span class="w">   </span><span class="c1"># Query interfaces</span>

<span class="w">  </span><span class="nt">operations</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ApplicationServiceOperation</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="nt">dependencies</span><span class="p">:</span>
<span class="w">    </span><span class="nt">repositories</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">RepoId</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">domain_services</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">SvcDomId</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">event_publishers</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="nt">characteristics</span><span class="p">:</span>
<span class="w">    </span><span class="nt">stateless</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">                  </span><span class="c1"># const: true (MUST be stateless)</span>
<span class="w">    </span><span class="nt">contains_business_logic</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">   </span><span class="c1"># const: false (MUST NOT contain)</span>
<span class="w">    </span><span class="nt">manages_transactions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">       </span><span class="c1"># const: true</span>
<span class="w">    </span><span class="nt">coordinates_aggregates</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">     </span><span class="c1"># const: true</span>
<span class="w">    </span><span class="nt">publishes_events</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">           </span><span class="c1"># default: true</span>
<span class="w">    </span><span class="nt">performs_authorization</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">     </span><span class="c1"># default: true</span>
</code></pre></div>

<p><strong>Design Constraints</strong>:<br />
- <code>stateless: const: true</code> — Application services MUST be stateless<br />
- <code>contains_business_logic: const: false</code> — NO business logic allowed<br />
- <code>manages_transactions: const: true</code> — Transaction responsibility</p>
<p><strong>ApplicationServiceOperation</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">ApplicationServiceOperation</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">             </span><span class="c1"># e.g., &quot;createUser&quot;, &quot;placeOrder&quot;</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enum</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">command</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">query</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># CQRS separation</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">  </span><span class="nt">parameters</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">Parameter</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">returns</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>

<span class="w">  </span><span class="nt">transaction_boundary</span><span class="p">:</span>
<span class="w">    </span><span class="nt">is_transactional</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">boolean</span><span class="w">  </span><span class="c1"># true for commands, false for queries</span>
<span class="w">    </span><span class="nt">modifies_aggregates</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">AggId</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># maxItems: 1 (ONE AGGREGATE RULE)</span>
<span class="w">    </span><span class="nt">consistency_type</span><span class="p">:</span>
<span class="w">      </span><span class="nt">enum</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">transactional</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">eventual</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="nt">workflow</span><span class="p">:</span>
<span class="w">    </span><span class="nt">validates_input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">boolean</span>
<span class="w">    </span><span class="nt">loads_aggregates</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">AggId</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">invokes_domain_operations</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">string</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">invokes_domain_services</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">SvcDomId</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">persists_aggregates</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">boolean</span>
<span class="w">    </span><span class="nt">publishes_events</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">EvtId</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">returns_dto</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</code></pre></div>

<p><strong>TransactionBoundary Constraint</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">TransactionBoundary</span><span class="p">:</span>
<span class="w">  </span><span class="nt">modifies_aggregates</span><span class="p">:</span>
<span class="w">    </span><span class="nt">maxItems</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w">  </span><span class="c1"># Enforces Vaughn Vernon&#39;s &quot;one aggregate per transaction&quot; rule</span>
</code></pre></div>

<p>This design constraint ensures commands modify at most ONE aggregate per transaction.</p>
<h4 id="937-command-interface-type-knight-pattern">9.3.7 Command Interface Type (Knight Pattern)<a class="headerlink" href="#937-command-interface-type-knight-pattern" title="Permanent link">&para;</a></h4>
<p><strong>Purpose</strong>: Defines commands as nested records inside interface contracts.</p>
<p><strong>Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">CommandInterface</span><span class="p">:</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmd_&lt;name&gt;</span><span class="w">           </span><span class="c1"># Required, pattern: ^cmd_[a-z0-9_]+$</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">             </span><span class="c1"># Required, pattern: ^[A-Z][a-zA-Z]+Commands$</span>
<span class="w">  </span><span class="nt">aggregate_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AggId</span><span class="w">     </span><span class="c1"># Primary aggregate</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>

<span class="w">  </span><span class="nt">command_records</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">CommandRecord</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># Nested records</span>

<span class="w">  </span><span class="nt">immutability</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">       </span><span class="c1"># const: true (commands are immutable)</span>
<span class="w">  </span><span class="nt">layer</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;api&quot;</span><span class="w">            </span><span class="c1"># const: &quot;api&quot;</span>
</code></pre></div>

<p><strong>CommandRecord</strong> (nested inside interface):</p>
<div class="codehilite"><pre><span></span><code><span class="nt">CommandRecord</span><span class="p">:</span>
<span class="w">  </span><span class="nt">record_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">      </span><span class="c1"># Required, pattern: ^[A-Z][a-zA-Z]+Cmd$</span>
<span class="w">  </span><span class="nt">intent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">           </span><span class="c1"># Required, pattern: ^[a-z][a-zA-Z]+$ (imperative verb)</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">  </span><span class="nt">parameters</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">Parameter</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="nt">returns</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enum</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">void</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">domain_id</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">acknowledgment</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">result_status</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">return_type_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VoId</span><span class="w">    </span><span class="c1"># If returns domain_id</span>

<span class="w">  </span><span class="nt">modifies_aggregate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AggId</span><span class="w">  </span><span class="c1"># Exactly one aggregate</span>
<span class="w">  </span><span class="nt">publishes_events</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">EvtId</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">audit_fields</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">string</span><span class="p p-Indicator">]</span><span class="w">     </span><span class="c1"># e.g., &quot;reason&quot;, &quot;initiatedBy&quot;</span>
</code></pre></div>

<p><strong>Java Example</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// CommandInterface: cmd_user_commands</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">UserCommands</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// CommandRecord: CreateUserCmd</span>
<span class="w">    </span><span class="n">UserId</span><span class="w"> </span><span class="nf">createUser</span><span class="p">(</span><span class="n">CreateUserCmd</span><span class="w"> </span><span class="n">cmd</span><span class="p">);</span>

<span class="w">    </span><span class="kd">record</span> <span class="nc">CreateUserCmd</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">email</span><span class="p">,</span><span class="w">        </span><span class="c1">// Parameter</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">userType</span><span class="p">,</span><span class="w">     </span><span class="c1">// Parameter</span>
<span class="w">        </span><span class="n">ClientId</span><span class="w"> </span><span class="n">clientId</span><span class="w">    </span><span class="c1">// Parameter</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">  </span><span class="c1">// Immutable record</span>

<span class="w">    </span><span class="c1">// CommandRecord: ActivateUserCmd</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">activateUser</span><span class="p">(</span><span class="n">ActivateUserCmd</span><span class="w"> </span><span class="n">cmd</span><span class="p">);</span>

<span class="w">    </span><span class="kd">record</span> <span class="nc">ActivateUserCmd</span><span class="p">(</span>
<span class="w">        </span><span class="n">UserId</span><span class="w"> </span><span class="n">userId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">reason</span><span class="p">,</span><span class="w">       </span><span class="c1">// Audit field</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">activatedBy</span><span class="w">   </span><span class="c1">// Audit field</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="938-query-interface-type-knight-pattern">9.3.8 Query Interface Type (Knight Pattern)<a class="headerlink" href="#938-query-interface-type-knight-pattern" title="Permanent link">&para;</a></h4>
<p><strong>Purpose</strong>: Defines queries as interface methods with nested result records.</p>
<p><strong>Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">QueryInterface</span><span class="p">:</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qry_&lt;name&gt;</span><span class="w">           </span><span class="c1"># Required, pattern: ^qry_[a-z0-9_]+$</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">             </span><span class="c1"># Required, pattern: ^[A-Z][a-zA-Z]+Queries$</span>
<span class="w">  </span><span class="nt">aggregate_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AggId</span><span class="w">     </span><span class="c1"># Primary aggregate</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>

<span class="w">  </span><span class="nt">query_methods</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">QueryMethod</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="nt">result_characteristics</span><span class="p">:</span>
<span class="w">    </span><span class="nt">immutable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">        </span><span class="c1"># const: true (DTOs are immutable)</span>
<span class="w">    </span><span class="nt">flat_structure</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">   </span><span class="c1"># default: true (Knight pattern)</span>
<span class="w">    </span><span class="nt">string_serialization</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># default: true (IDs as strings)</span>

<span class="w">  </span><span class="nt">layer</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;api&quot;</span><span class="w">            </span><span class="c1"># const: &quot;api&quot;</span>
<span class="w">  </span><span class="nt">no_side_effects</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">   </span><span class="c1"># const: true</span>
</code></pre></div>

<p><strong>QueryMethod</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">QueryMethod</span><span class="p">:</span>
<span class="w">  </span><span class="nt">method_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">      </span><span class="c1"># Required, pattern: ^(get|list|find|search)[A-Z][a-zA-Z]+$</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">  </span><span class="nt">parameters</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">Parameter</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">result_record_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">  </span><span class="c1"># Required, pattern: ^[A-Z][a-zA-Z]+Summary$</span>

<span class="w">  </span><span class="nt">result_structure</span><span class="p">:</span>
<span class="w">    </span><span class="nt">fields</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">DTOField</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">aggregate_counts</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># Counts, not full collections</span>

<span class="w">  </span><span class="nt">bypasses_domain_model</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">boolean</span><span class="w">  </span><span class="c1"># CQRS: read from read model</span>

<span class="w">  </span><span class="nt">optimizations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">denormalized</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">boolean</span>
<span class="w">    </span><span class="nt">cached</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">boolean</span>
<span class="w">    </span><span class="nt">indexed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">boolean</span>
</code></pre></div>

<p><strong>Java Example</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// QueryInterface: qry_user_queries</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">UserQueries</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// QueryMethod: getUserSummary</span>
<span class="w">    </span><span class="n">UserSummary</span><span class="w"> </span><span class="nf">getUserSummary</span><span class="p">(</span><span class="n">UserId</span><span class="w"> </span><span class="n">userId</span><span class="p">);</span>

<span class="w">    </span><span class="kd">record</span> <span class="nc">UserSummary</span><span class="p">(</span><span class="w">      </span><span class="c1">// Result record (immutable)</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">userId</span><span class="p">,</span><span class="w">       </span><span class="c1">// ID as string</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">email</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w">       </span><span class="c1">// Enum as string</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">activeClientsCount</span><span class="w">  </span><span class="c1">// Count, not list</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">  </span><span class="c1">// Flat structure (no nested objects)</span>

<span class="w">    </span><span class="c1">// QueryMethod: listUsersByStatus</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">UserSummary</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">listUsersByStatus</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="939-domain-event-type">9.3.9 Domain Event Type<a class="headerlink" href="#939-domain-event-type" title="Permanent link">&para;</a></h4>
<p><strong>Purpose</strong>: Represents something that happened in the domain.</p>
<p><strong>Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">DomainEvent</span><span class="p">:</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">evt_&lt;name&gt;</span><span class="w">           </span><span class="c1"># Required, pattern: ^evt_[a-z0-9_]+$</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">             </span><span class="c1"># Required (past tense, e.g., &quot;OrderPlaced&quot;)</span>
<span class="w">  </span><span class="nt">aggregate_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AggId</span><span class="w">     </span><span class="c1"># Required (which aggregate publishes)</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>

<span class="w">  </span><span class="nt">data_carried</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">Attribute</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="nt">immutable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">          </span><span class="c1"># const: true (events are immutable facts)</span>
</code></pre></div>

<p><strong>CRITICAL</strong>: <code>immutable: const: true</code></p>
<p>Domain events MUST be immutable. Events represent facts that have already happened and cannot be changed.</p>
<p><strong>Naming Convention</strong>: Past tense (OrderPlaced, UserActivated, PaymentProcessed)</p>
<p><strong>Example</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">domain_events</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">evt_order_placed</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;OrderPlaced&quot;</span>
<span class="w">    </span><span class="nt">aggregate_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agg_order</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Customer</span><span class="nv"> </span><span class="s">has</span><span class="nv"> </span><span class="s">placed</span><span class="nv"> </span><span class="s">an</span><span class="nv"> </span><span class="s">order&quot;</span>
<span class="w">    </span><span class="nt">data_carried</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">order_id</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customer_id</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">total_amount</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">decimal</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">placed_at</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">datetime</span>
<span class="w">    </span><span class="nt">immutable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># Required</span>
</code></pre></div>

<h4 id="9310-tactical-schema-id-patterns">9.3.10 Tactical Schema ID Patterns<a class="headerlink" href="#9310-tactical-schema-id-patterns" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Type</th>
<th>Prefix</th>
<th>Pattern</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>Bounded Context</td>
<td><code>bc_</code></td>
<td><code>^bc_[a-z0-9_]+$</code></td>
<td><code>bc_order_management</code></td>
</tr>
<tr>
<td>Aggregate</td>
<td><code>agg_</code></td>
<td><code>^agg_[a-z0-9_]+$</code></td>
<td><code>agg_order</code></td>
</tr>
<tr>
<td>Entity</td>
<td><code>ent_</code></td>
<td><code>^ent_[a-z0-9_]+$</code></td>
<td><code>ent_order</code>, <code>ent_line_item</code></td>
</tr>
<tr>
<td>Value Object</td>
<td><code>vo_</code></td>
<td><code>^vo_[a-z0-9_]+$</code></td>
<td><code>vo_money</code>, <code>vo_address</code></td>
</tr>
<tr>
<td>Repository</td>
<td><code>repo_</code></td>
<td><code>^repo_[a-z0-9_]+$</code></td>
<td><code>repo_order</code></td>
</tr>
<tr>
<td>Domain Service</td>
<td><code>svc_dom_</code></td>
<td><code>^svc_dom_[a-z0-9_]+$</code></td>
<td><code>svc_dom_pricing</code></td>
</tr>
<tr>
<td>Application Service</td>
<td><code>svc_app_</code></td>
<td><code>^svc_app_[a-z0-9_]+$</code></td>
<td><code>svc_app_order_management</code></td>
</tr>
<tr>
<td>Command Interface</td>
<td><code>cmd_</code></td>
<td><code>^cmd_[a-z0-9_]+$</code></td>
<td><code>cmd_order_commands</code></td>
</tr>
<tr>
<td>Query Interface</td>
<td><code>qry_</code></td>
<td><code>^qry_[a-z0-9_]+$</code></td>
<td><code>qry_order_queries</code></td>
</tr>
<tr>
<td>Domain Event</td>
<td><code>evt_</code></td>
<td><code>^evt_[a-z0-9_]+$</code></td>
<td><code>evt_order_placed</code></td>
</tr>
</tbody>
</table>
<h4 id="9311-tactical-design-rules">9.3.11 Tactical Design Rules<a class="headerlink" href="#9311-tactical-design-rules" title="Permanent link">&para;</a></h4>
<p>The tactical patterns require:</p>
<ol>
<li>
<p><strong>Aggregate Root is Entity</strong>:<br />
   - <code>aggregate.root_ref</code> must reference an entity with <code>is_aggregate_root: true</code></p>
</li>
<li>
<p><strong>Repository Per Aggregate Root</strong>:<br />
   - <code>repository.aggregate_ref</code> must be set (not per-entity repositories)</p>
</li>
<li>
<p><strong>Value Objects Immutable</strong>:<br />
   - <code>value_object.immutability: const: true</code></p>
</li>
<li>
<p><strong>Domain Services Stateless</strong>:<br />
   - <code>domain_service.stateless</code> must be true</p>
</li>
<li>
<p><strong>Events Immutable</strong>:<br />
   - <code>domain_event.immutable: const: true</code></p>
</li>
<li>
<p><strong>Application Services Stateless</strong>:<br />
   - <code>application_service.characteristics.stateless: const: true</code></p>
</li>
<li>
<p><strong>One Aggregate Per Transaction</strong>:<br />
   - For commands: <code>transaction_boundary.modifies_aggregates</code> has <code>maxItems: 1</code></p>
</li>
<li>
<p><strong>Queries No Side Effects</strong>:<br />
   - <code>query_interface.no_side_effects: const: true</code></p>
</li>
</ol>
<h3 id="94-domain-stories-schema">9.4 Domain Stories Schema<a class="headerlink" href="#94-domain-stories-schema" title="Permanent link">&para;</a></h3>
<p><strong>Location</strong>: <code>/domain-stories/domain-stories-schema.yaml</code></p>
<h4 id="941-overview">9.4.1 Overview<a class="headerlink" href="#941-overview" title="Permanent link">&para;</a></h4>
<p>The Domain Stories schema formalizes Domain Storytelling artifacts for validation, tool support, and mapping to tactical DDD concepts.</p>
<p><strong>Root Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">domain_stories</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">domain_story_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dst_&lt;name&gt;</span>
<span class="w">    </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">    </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">string</span><span class="p p-Indicator">]</span>

<span class="w">    </span><span class="c1"># Story components</span>
<span class="w">    </span><span class="nt">actors</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">Actor</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">work_objects</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">WorkObject</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">commands</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">Command</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">queries</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">Query</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">activities</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">Activity</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">events</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">Event</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">policies</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">Policy</span><span class="p p-Indicator">]</span>

<span class="w">    </span><span class="c1"># Mappings to tactical concepts</span>
<span class="w">    </span><span class="nt">aggregates</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">Aggregate</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">repositories</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">Repository</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">application_services</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ApplicationService</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">domain_services</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">DomainService</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">read_models</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ReadModel</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">business_rules</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">BusinessRule</span><span class="p p-Indicator">]</span>
</code></pre></div>

<h4 id="942-actor-type">9.4.2 Actor Type<a class="headerlink" href="#942-actor-type" title="Permanent link">&para;</a></h4>
<p><strong>Purpose</strong>: Represents who performs actions in domain stories.</p>
<p><strong>Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">Actor</span><span class="p">:</span>
<span class="w">  </span><span class="nt">actor_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">act_&lt;name&gt;</span><span class="w">     </span><span class="c1"># Required, pattern: ^act_[a-z0-9_]+$</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">             </span><span class="c1"># Required</span>
<span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w">                    </span><span class="c1"># Required</span>
<span class="w">    </span><span class="nt">enum</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">person</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">system</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">role</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">  </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">string</span><span class="p p-Indicator">]</span>
</code></pre></div>

<p><strong>Actor Kinds</strong>:<br />
- <strong>person</strong>: Individual human (Customer, Manager, Operator)<br />
- <strong>system</strong>: Automated actor (PaymentSystem, NotificationService)<br />
- <strong>role</strong>: Generic type (Administrator, User, Guest)</p>
<h4 id="943-work-object-type">9.4.3 Work Object Type<a class="headerlink" href="#943-work-object-type" title="Permanent link">&para;</a></h4>
<p><strong>Purpose</strong>: Domain artifacts manipulated by activities.</p>
<p><strong>Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">WorkObject</span><span class="p">:</span>
<span class="w">  </span><span class="nt">work_object_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wobj_&lt;name&gt;</span><span class="w">  </span><span class="c1"># Required, pattern: ^wobj_[a-z0-9_]+$</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">                 </span><span class="c1"># Required</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">  </span><span class="nt">attributes</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">Attribute</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">aggregate_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agg_&lt;name&gt;</span><span class="w">     </span><span class="c1"># Optional mapping to aggregate</span>
</code></pre></div>

<p><strong>Mapping</strong>: Work objects can map to Entities, Value Objects, or Aggregates in tactical model.</p>
<h4 id="944-command-type">9.4.4 Command Type<a class="headerlink" href="#944-command-type" title="Permanent link">&para;</a></h4>
<p><strong>Purpose</strong>: User intent to perform state-changing operation.</p>
<p><strong>Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">Command</span><span class="p">:</span>
<span class="w">  </span><span class="nt">command_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmd_&lt;name&gt;</span><span class="w">   </span><span class="c1"># Required, pattern: ^cmd_[a-z0-9_]+$</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">             </span><span class="c1"># Required (imperative)</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">  </span><span class="nt">actor_ids</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ActId</span><span class="p p-Indicator">]</span><span class="w">       </span><span class="c1"># Required, minItems: 1 (who can issue)</span>

<span class="w">  </span><span class="nt">target_aggregate_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AggId</span><span class="w">  </span><span class="c1"># Which aggregate</span>
<span class="w">  </span><span class="nt">parameters</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">Parameter</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">preconditions</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">string</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="nt">invokes_app_services</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">AppSvcId</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">invokes_domain_services</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">DomSvcId</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">emits_events</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">EvtId</span><span class="p p-Indicator">]</span>
</code></pre></div>

<p><strong>Mapping</strong>: Commands in stories map to <code>CommandRecord</code> in tactical schema.</p>
<h4 id="945-query-type">9.4.5 Query Type<a class="headerlink" href="#945-query-type" title="Permanent link">&para;</a></h4>
<p><strong>Purpose</strong>: Request for information without side effects.</p>
<p><strong>Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">Query</span><span class="p">:</span>
<span class="w">  </span><span class="nt">query_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qry_&lt;name&gt;</span><span class="w">     </span><span class="c1"># Required, pattern: ^qry_[a-z0-9_]+$</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">             </span><span class="c1"># Required</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">  </span><span class="nt">actor_ids</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ActId</span><span class="p p-Indicator">]</span><span class="w">       </span><span class="c1"># Required, minItems: 1</span>

<span class="w">  </span><span class="nt">parameters</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">Parameter</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">returns_read_model_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RmdlId</span>
</code></pre></div>

<p><strong>Mapping</strong>: Queries in stories map to <code>QueryMethod</code> in tactical schema.</p>
<h4 id="946-activity-type">9.4.6 Activity Type<a class="headerlink" href="#946-activity-type" title="Permanent link">&para;</a></h4>
<p><strong>Purpose</strong>: Actions that change state or produce results.</p>
<p><strong>Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">Activity</span><span class="p">:</span>
<span class="w">  </span><span class="nt">activity_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actv_&lt;name&gt;</span><span class="w">   </span><span class="c1"># Required, pattern: ^actv_[a-z0-9_]+$</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">               </span><span class="c1"># Required (verb phrase)</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>

<span class="w">  </span><span class="nt">initiated_by_command_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CmdId</span>
<span class="w">  </span><span class="nt">uses_work_object_ids</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">WobjId</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">results_in_event_ids</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">EvtId</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="nt">calls_app_service_ids</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">AppSvcId</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">calls_domain_service_ids</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">DomSvcId</span><span class="p p-Indicator">]</span>
</code></pre></div>

<p><strong>Actor-Activity-Work Object Pattern</strong>:</p>
<div class="codehilite"><pre><span></span><code>[Actor] → [Activity] → [Work Object]
   ↓
 initiates
 Command → triggers Activity → produces Event
</code></pre></div>

<h4 id="947-event-type">9.4.7 Event Type<a class="headerlink" href="#947-event-type" title="Permanent link">&para;</a></h4>
<p><strong>Purpose</strong>: Facts that have occurred in domain stories.</p>
<p><strong>Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">Event</span><span class="p">:</span>
<span class="w">  </span><span class="nt">event_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">evt_&lt;name&gt;</span><span class="w">     </span><span class="c1"># Required, pattern: ^evt_[a-z0-9_]+$</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">             </span><span class="c1"># Required (past tense)</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">  </span><span class="nt">tense</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enum</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">past</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">past</span>

<span class="w">  </span><span class="nt">payload</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">Attribute</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="nt">caused_by</span><span class="p">:</span><span class="w">               </span><span class="c1"># Either command or activity</span>
<span class="w">    </span><span class="nt">oneOf</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CmdId</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">activity_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ActvId</span>

<span class="w">  </span><span class="nt">affected_aggregate_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AggId</span>
<span class="w">  </span><span class="nt">policies_triggered</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">PolId</span><span class="p p-Indicator">]</span>
</code></pre></div>

<p><strong>Mapping</strong>: Events in stories map to <code>DomainEvent</code> in tactical schema.</p>
<h4 id="948-policy-type">9.4.8 Policy Type<a class="headerlink" href="#948-policy-type" title="Permanent link">&para;</a></h4>
<p><strong>Purpose</strong>: Reactive rules ("When X happens, do Y").</p>
<p><strong>Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">Policy</span><span class="p">:</span>
<span class="w">  </span><span class="nt">policy_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pol_&lt;name&gt;</span><span class="w">    </span><span class="c1"># Required, pattern: ^pol_[a-z0-9_]+$</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">             </span><span class="c1"># Required</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>

<span class="w">  </span><span class="nt">when_event_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">EvtId</span><span class="w">     </span><span class="c1"># Required (trigger event)</span>
<span class="w">  </span><span class="nt">issues_command_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CmdId</span><span class="w"> </span><span class="c1"># Required (resulting command)</span>
</code></pre></div>

<p><strong>Pattern</strong>: "When [Event] happens, issue [Command]"</p>
<p><strong>Example</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">policies</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">policy_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pol_send_confirmation</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Send</span><span class="nv"> </span><span class="s">Order</span><span class="nv"> </span><span class="s">Confirmation&quot;</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;When</span><span class="nv"> </span><span class="s">order</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">placed,</span><span class="nv"> </span><span class="s">send</span><span class="nv"> </span><span class="s">confirmation</span><span class="nv"> </span><span class="s">email&quot;</span>
<span class="w">    </span><span class="nt">when_event_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">evt_order_placed</span>
<span class="w">    </span><span class="nt">issues_command_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmd_send_email</span>
</code></pre></div>

<h4 id="949-causal-chain-in-schema">9.4.9 Causal Chain in Schema<a class="headerlink" href="#949-causal-chain-in-schema" title="Permanent link">&para;</a></h4>
<p>The pattern captures the complete causal flow:</p>
<div class="codehilite"><pre><span></span><code>Actor → Command → Activity → Event → Policy → Command (continues...)
  ↓        ↓          ↓         ↓        ↓
Initiates  Triggers   Uses      Results  Reactive
           Work       Work       In      Automation
           Objects    Objects    Facts
</code></pre></div>

<p><strong>Example Flow</strong>:<br />
1. Actor <code>act_customer</code> initiates Command <code>cmd_place_order</code><br />
2. Command triggers Activity <code>actv_submit_order</code><br />
3. Activity uses WorkObject <code>wobj_shopping_cart</code><br />
4. Activity results in Event <code>evt_order_placed</code><br />
5. Event triggers Policy <code>pol_reserve_inventory</code><br />
6. Policy issues Command <code>cmd_reserve_inventory</code><br />
7. (Flow continues...)</p>
<h4 id="9410-domain-stories-schema-id-patterns">9.4.10 Domain Stories Schema ID Patterns<a class="headerlink" href="#9410-domain-stories-schema-id-patterns" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Type</th>
<th>Prefix</th>
<th>Pattern</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>Domain Story</td>
<td><code>dst_</code></td>
<td><code>^dst_[a-z0-9_]+$</code></td>
<td><code>dst_checkout_process</code></td>
</tr>
<tr>
<td>Actor</td>
<td><code>act_</code></td>
<td><code>^act_[a-z0-9_]+$</code></td>
<td><code>act_customer</code></td>
</tr>
<tr>
<td>Work Object</td>
<td><code>wobj_</code></td>
<td><code>^wobj_[a-z0-9_]+$</code></td>
<td><code>wobj_order</code></td>
</tr>
<tr>
<td>Activity</td>
<td><code>actv_</code></td>
<td><code>^actv_[a-z0-9_]+$</code></td>
<td><code>actv_submit_order</code></td>
</tr>
<tr>
<td>Command</td>
<td><code>cmd_</code></td>
<td><code>^cmd_[a-z0-9_]+$</code></td>
<td><code>cmd_place_order</code></td>
</tr>
<tr>
<td>Query</td>
<td><code>qry_</code></td>
<td><code>^qry_[a-z0-9_]+$</code></td>
<td><code>qry_get_order_status</code></td>
</tr>
<tr>
<td>Event</td>
<td><code>evt_</code></td>
<td><code>^evt_[a-z0-9_]+$</code></td>
<td><code>evt_order_placed</code></td>
</tr>
<tr>
<td>Policy</td>
<td><code>pol_</code></td>
<td><code>^pol_[a-z0-9_]+$</code></td>
<td><code>pol_send_confirmation</code></td>
</tr>
<tr>
<td>Read Model</td>
<td><code>rmdl_</code></td>
<td><code>^rmdl_[a-z0-9_]+$</code></td>
<td><code>rmdl_order_summary</code></td>
</tr>
<tr>
<td>Business Rule</td>
<td><code>rle_</code></td>
<td><code>^rle_[a-z0-9_]+$</code></td>
<td><code>rle_order_minimum</code></td>
</tr>
<tr>
<td>Aggregate</td>
<td><code>agg_</code></td>
<td><code>^agg_[a-z0-9_]+$</code></td>
<td><code>agg_order</code></td>
</tr>
<tr>
<td>Repository</td>
<td><code>rep_</code></td>
<td><code>^rep_[a-z0-9_]+$</code></td>
<td><code>rep_order</code></td>
</tr>
<tr>
<td>App Service</td>
<td><code>svc_app_</code></td>
<td><code>^svc_app_[a-z0-9_]+$</code></td>
<td><code>svc_app_order_management</code></td>
</tr>
<tr>
<td>Domain Service</td>
<td><code>dom_svc_</code></td>
<td><code>^dom_svc_[a-z0-9_]+$</code></td>
<td><code>dom_svc_pricing</code></td>
</tr>
</tbody>
</table>
<h3 id="95-comprehensive-id-convention-table">9.5 Comprehensive ID Convention Table<a class="headerlink" href="#95-comprehensive-id-convention-table" title="Permanent link">&para;</a></h3>
<p>All three schemas follow consistent ID naming patterns:</p>
<table>
<thead>
<tr>
<th>Concept</th>
<th>Schema</th>
<th>Prefix</th>
<th>Pattern</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>System</td>
<td>Strategic</td>
<td><code>sys_</code></td>
<td><code>^sys_[a-z0-9_]+$</code></td>
<td><code>sys_ecommerce</code></td>
</tr>
<tr>
<td>Domain</td>
<td>Strategic</td>
<td><code>dom_</code></td>
<td><code>^dom_[a-z0-9_]+$</code></td>
<td><code>dom_sales</code></td>
</tr>
<tr>
<td>Bounded Context</td>
<td>Strategic/Tactical</td>
<td><code>bc_</code></td>
<td><code>^bc_[a-z0-9_]+$</code></td>
<td><code>bc_order_management</code></td>
</tr>
<tr>
<td>Context Mapping</td>
<td>Strategic</td>
<td><code>cm_</code></td>
<td><code>^cm_[a-z0-9_]+_to_[a-z0-9_]+$</code></td>
<td><code>cm_order_to_payment</code></td>
</tr>
<tr>
<td>BFF Scope</td>
<td>Strategic</td>
<td><code>bff_</code></td>
<td><code>^bff_[a-z0-9_]+$</code></td>
<td><code>bff_web</code>, <code>bff_ios</code></td>
</tr>
<tr>
<td>BFF Interface</td>
<td>Strategic</td>
<td><code>bff_if_</code></td>
<td><code>^bff_if_[a-z0-9_]+$</code></td>
<td><code>bff_if_user_web</code></td>
</tr>
<tr>
<td>Aggregate</td>
<td>Tactical/Stories</td>
<td><code>agg_</code></td>
<td><code>^agg_[a-z0-9_]+$</code></td>
<td><code>agg_order</code></td>
</tr>
<tr>
<td>Entity</td>
<td>Tactical</td>
<td><code>ent_</code></td>
<td><code>^ent_[a-z0-9_]+$</code></td>
<td><code>ent_order</code>, <code>ent_line_item</code></td>
</tr>
<tr>
<td>Value Object</td>
<td>Tactical</td>
<td><code>vo_</code></td>
<td><code>^vo_[a-z0-9_]+$</code></td>
<td><code>vo_money</code>, <code>vo_address</code></td>
</tr>
<tr>
<td>Repository</td>
<td>Tactical</td>
<td><code>repo_</code></td>
<td><code>^repo_[a-z0-9_]+$</code></td>
<td><code>repo_order</code></td>
</tr>
<tr>
<td>Domain Service</td>
<td>Tactical</td>
<td><code>svc_dom_</code></td>
<td><code>^svc_dom_[a-z0-9_]+$</code></td>
<td><code>svc_dom_pricing</code></td>
</tr>
<tr>
<td>Application Service</td>
<td>Tactical/Stories</td>
<td><code>svc_app_</code></td>
<td><code>^svc_app_[a-z0-9_]+$</code></td>
<td><code>svc_app_order_management</code></td>
</tr>
<tr>
<td>Command Interface</td>
<td>Tactical</td>
<td><code>cmd_</code></td>
<td><code>^cmd_[a-z0-9_]+$</code></td>
<td><code>cmd_order_commands</code></td>
</tr>
<tr>
<td>Query Interface</td>
<td>Tactical</td>
<td><code>qry_</code></td>
<td><code>^qry_[a-z0-9_]+$</code></td>
<td><code>qry_order_queries</code></td>
</tr>
<tr>
<td>Domain Event</td>
<td>Tactical/Stories</td>
<td><code>evt_</code></td>
<td><code>^evt_[a-z0-9_]+$</code></td>
<td><code>evt_order_placed</code></td>
</tr>
<tr>
<td>Domain Story</td>
<td>Stories</td>
<td><code>dst_</code></td>
<td><code>^dst_[a-z0-9_]+$</code></td>
<td><code>dst_checkout_process</code></td>
</tr>
<tr>
<td>Actor</td>
<td>Stories</td>
<td><code>act_</code></td>
<td><code>^act_[a-z0-9_]+$</code></td>
<td><code>act_customer</code></td>
</tr>
<tr>
<td>Work Object</td>
<td>Stories</td>
<td><code>wobj_</code></td>
<td><code>^wobj_[a-z0-9_]+$</code></td>
<td><code>wobj_order</code></td>
</tr>
<tr>
<td>Activity</td>
<td>Stories</td>
<td><code>actv_</code></td>
<td><code>^actv_[a-z0-9_]+$</code></td>
<td><code>actv_submit_order</code></td>
</tr>
<tr>
<td>Policy</td>
<td>Stories</td>
<td><code>pol_</code></td>
<td><code>^pol_[a-z0-9_]+$</code></td>
<td><code>pol_send_confirmation</code></td>
</tr>
<tr>
<td>Read Model</td>
<td>Stories</td>
<td><code>rmdl_</code></td>
<td><code>^rmdl_[a-z0-9_]+$</code></td>
<td><code>rmdl_order_summary</code></td>
</tr>
<tr>
<td>Business Rule</td>
<td>Stories</td>
<td><code>rle_</code></td>
<td><code>^rle_[a-z0-9_]+$</code></td>
<td><code>rle_order_minimum</code></td>
</tr>
</tbody>
</table>
<p><strong>Naming Convention</strong>: All IDs use <code>lower_snake_case</code> format.</p>
<h3 id="96-design-rules-summary">9.6 Design Rules Summary<a class="headerlink" href="#96-design-rules-summary" title="Permanent link">&para;</a></h3>
<h4 id="strategic-design-rules">Strategic Design Rules<a class="headerlink" href="#strategic-design-rules" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>Bounded Context Has Domain</strong>: Every <code>BoundedContext.domain_ref</code> must be valid</li>
<li><strong>Context Mapping Different Contexts</strong>: <code>upstream_context</code> ≠ <code>downstream_context</code></li>
<li><strong>BFF One Client Type</strong>: <code>BFFScope.client_type</code> is single enum, not array</li>
<li><strong>BFF Aggregates Multiple Contexts</strong>: <code>aggregates_from_contexts</code> has <code>minItems: 1</code></li>
<li><strong>BFF No Business Logic</strong>: <code>responsibilities.business_logic: const: false</code></li>
<li><strong>BFF No Direct Persistence</strong>: <code>responsibilities.direct_persistence: const: false</code></li>
</ol>
<h4 id="tactical-design-rules">Tactical Design Rules<a class="headerlink" href="#tactical-design-rules" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>Aggregate Root is Entity</strong>: <code>aggregate.root_ref</code> → entity with <code>is_aggregate_root: true</code></li>
<li><strong>Repository Per Aggregate</strong>: <code>repository.aggregate_ref</code> must be set</li>
<li><strong>Value Objects Immutable</strong>: <code>value_object.immutability: const: true</code></li>
<li><strong>Domain Services Stateless</strong>: <code>domain_service.stateless</code> must be true</li>
<li><strong>Events Immutable</strong>: <code>domain_event.immutable: const: true</code></li>
<li><strong>Application Services Stateless</strong>: <code>application_service.characteristics.stateless: const: true</code></li>
<li><strong>One Aggregate Per Transaction</strong>: <code>transaction_boundary.modifies_aggregates</code> has <code>maxItems: 1</code></li>
<li><strong>Queries No Side Effects</strong>: <code>query_interface.no_side_effects: const: true</code></li>
<li><strong>Application Services No Business Logic</strong>: <code>contains_business_logic: const: false</code></li>
<li><strong>Commands Immutable</strong>: <code>command_interface.immutability: const: true</code></li>
</ol>
<h4 id="domain-stories-design-rules">Domain Stories Design Rules<a class="headerlink" href="#domain-stories-design-rules" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>Commands Have Actors</strong>: <code>command.actor_ids</code> has <code>minItems: 1</code></li>
<li><strong>Queries Have Actors</strong>: <code>query.actor_ids</code> has <code>minItems: 1</code></li>
<li><strong>Events Past Tense</strong>: <code>event.tense</code> defaults to <code>past</code></li>
<li><strong>Policy Links Event→Command</strong>: Both <code>when_event_id</code> and <code>issues_command_id</code> required</li>
<li><strong>Domain Stories Have Actors</strong>: <code>domain_story.actors</code> has <code>minItems: 1</code></li>
</ol>
<h3 id="97-codifying-ddd-best-practices">9.7 Codifying DDD Best Practices<a class="headerlink" href="#97-codifying-ddd-best-practices" title="Permanent link">&para;</a></h3>
<p>The schema definitions <strong>codify</strong> DDD best practices in a machine-verifiable form, making design constraints explicit:</p>
<h4 id="immutability-requirements">Immutability Requirements<a class="headerlink" href="#immutability-requirements" title="Permanent link">&para;</a></h4>
<p><strong>Value Objects</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">ValueObject</span><span class="p">:</span>
<span class="w">  </span><span class="nt">immutability</span><span class="p">:</span>
<span class="w">    </span><span class="nt">const</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># Must be immutable</span>
</code></pre></div>

<p><strong>Domain Events</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">DomainEvent</span><span class="p">:</span>
<span class="w">  </span><span class="nt">immutable</span><span class="p">:</span>
<span class="w">    </span><span class="nt">const</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># Must be immutable</span>
</code></pre></div>

<p><strong>Commands</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">CommandInterface</span><span class="p">:</span>
<span class="w">  </span><span class="nt">immutability</span><span class="p">:</span>
<span class="w">    </span><span class="nt">const</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># Must be immutable</span>
</code></pre></div>

<p><strong>Design Principle</strong>: Value objects, events, and commands must be immutable to ensure consistency and prevent unintended side effects.</p>
<h4 id="one-aggregate-per-transaction_1">One Aggregate Per Transaction<a class="headerlink" href="#one-aggregate-per-transaction_1" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="nt">TransactionBoundary</span><span class="p">:</span>
<span class="w">  </span><span class="nt">modifies_aggregates</span><span class="p">:</span>
<span class="w">    </span><span class="nt">maxItems</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w">  </span><span class="c1"># One aggregate only</span>
</code></pre></div>

<p><strong>Design Principle</strong>: Each transaction should modify at most one aggregate, following Vaughn Vernon's rule for maintaining consistency boundaries.</p>
<h4 id="bff-responsibilities">BFF Responsibilities<a class="headerlink" href="#bff-responsibilities" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="nt">BFFScope</span><span class="p">:</span>
<span class="w">  </span><span class="nt">responsibilities</span><span class="p">:</span>
<span class="w">    </span><span class="nt">business_logic</span><span class="p">:</span>
<span class="w">      </span><span class="nt">const</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># No business logic in BFFs</span>
<span class="w">    </span><span class="nt">transaction_management</span><span class="p">:</span>
<span class="w">      </span><span class="nt">const</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># No transaction management</span>
<span class="w">    </span><span class="nt">direct_persistence</span><span class="p">:</span>
<span class="w">      </span><span class="nt">const</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># No direct database access</span>
</code></pre></div>

<p><strong>Design Principle</strong>: BFFs focus on client-specific aggregation and transformation, delegating business logic and persistence to domain services.</p>
<h4 id="application-service-characteristics">Application Service Characteristics<a class="headerlink" href="#application-service-characteristics" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="nt">ApplicationService</span><span class="p">:</span>
<span class="w">  </span><span class="nt">characteristics</span><span class="p">:</span>
<span class="w">    </span><span class="nt">stateless</span><span class="p">:</span>
<span class="w">      </span><span class="nt">const</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">   </span><span class="c1"># Must be stateless</span>
<span class="w">    </span><span class="nt">contains_business_logic</span><span class="p">:</span>
<span class="w">      </span><span class="nt">const</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># No business logic</span>
<span class="w">    </span><span class="nt">manages_transactions</span><span class="p">:</span>
<span class="w">      </span><span class="nt">const</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">   </span><span class="c1"># Manages transactions</span>
</code></pre></div>

<p><strong>Design Principle</strong>: Application services orchestrate use cases without containing business logic, remaining stateless while managing transaction boundaries.</p>
<h4 id="query-side-effects">Query Side Effects<a class="headerlink" href="#query-side-effects" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="nt">QueryInterface</span><span class="p">:</span>
<span class="w">  </span><span class="nt">no_side_effects</span><span class="p">:</span>
<span class="w">    </span><span class="nt">const</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># Must have no side effects</span>
</code></pre></div>

<p><strong>Design Principle</strong>: Queries retrieve information without modifying state, ensuring CQRS separation of concerns.</p>
<h3 id="98-using-the-schemas">9.8 Using the Schemas<a class="headerlink" href="#98-using-the-schemas" title="Permanent link">&para;</a></h3>
<h4 id="validation-with-json-schema-validators">Validation with JSON Schema Validators<a class="headerlink" href="#validation-with-json-schema-validators" title="Permanent link">&para;</a></h4>
<p>The schemas use JSON Schema Draft 2020-12 and can be validated with standard tools:</p>
<p><strong>Python (jsonschema)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jsonschema</span>

<span class="c1"># Load schema</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;strategic-ddd.schema.yaml&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="c1"># Load instance</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;my-system.yaml&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="c1"># Validate</span>
<span class="n">jsonschema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">instance</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">)</span>
</code></pre></div>

<p><strong>Node.js (ajv)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">Ajv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;ajv&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">yaml</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;js-yaml&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">ajv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Ajv</span><span class="p">();</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">yaml</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;strategic-ddd.schema.yaml&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;utf8&#39;</span><span class="p">));</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">yaml</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;my-system.yaml&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;utf8&#39;</span><span class="p">));</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">validate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ajv</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">schema</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">validate</span><span class="p">(</span><span class="nx">instance</span><span class="p">);</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">valid</span><span class="p">)</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">validate</span><span class="p">.</span><span class="nx">errors</span><span class="p">);</span>
</code></pre></div>

<h4 id="ide-integration">IDE Integration<a class="headerlink" href="#ide-integration" title="Permanent link">&para;</a></h4>
<p><strong>VS Code with YAML extension</strong>:</p>
<p>Add to <code>.vscode/settings.json</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;yaml.schemas&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;./domains/ddd/schemas/strategic-ddd.schema.yaml&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="s2">&quot;*-strategic.yaml&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;*-system.yaml&quot;</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;./domains/ddd/schemas/tactical-ddd.schema.yaml&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="s2">&quot;*-tactical.yaml&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;*-bounded-context.yaml&quot;</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;./domain-stories/domain-stories-schema.yaml&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="s2">&quot;*-story.yaml&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;*-stories.yaml&quot;</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Benefits</strong>:<br />
- Autocompletion for schema properties<br />
- Inline validation errors<br />
- Documentation on hover<br />
- Pattern enforcement for IDs</p>
<h4 id="code-generation">Code Generation<a class="headerlink" href="#code-generation" title="Permanent link">&para;</a></h4>
<p>The schemas provide complete structure for code generators:</p>
<p><strong>Generate Java from Tactical Schema</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_entity</span><span class="p">(</span><span class="n">entity_spec</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate Java entity from schema.&quot;&quot;&quot;</span>
    <span class="n">code</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;public class </span><span class="si">{</span><span class="n">entity_spec</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="se">{{\n</span><span class="s2">&quot;</span>

    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">entity_spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;attributes&#39;</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="n">code</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;    private </span><span class="si">{</span><span class="n">attr</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">attr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">;</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">entity_spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;business_methods&#39;</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="n">code</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;    public </span><span class="si">{</span><span class="n">method</span><span class="p">[</span><span class="s1">&#39;returns&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">method</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">(&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">method</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parameters&#39;</span><span class="p">,</span> <span class="p">[])]</span>
        <span class="n">code</span> <span class="o">+=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) { ... }</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="n">code</span> <span class="o">+=</span> <span class="s2">&quot;}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">code</span>
</code></pre></div>

<p><strong>Generate BFF from Strategic Schema</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_bff_controller</span><span class="p">(</span><span class="n">bff_interface_spec</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate Spring Boot controller from BFF interface schema.&quot;&quot;&quot;</span>
    <span class="n">code</span> <span class="o">=</span> <span class="s2">&quot;@RestController</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">code</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;@RequestMapping(</span><span class="se">\&quot;</span><span class="si">{</span><span class="n">bff_interface_spec</span><span class="p">[</span><span class="s1">&#39;base_path&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">code</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;public class </span><span class="si">{</span><span class="n">bff_interface_spec</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="se">{{\n</span><span class="s2">&quot;</span>

    <span class="k">for</span> <span class="n">endpoint</span> <span class="ow">in</span> <span class="n">bff_interface_spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;endpoints&#39;</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">endpoint</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">endpoint</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span>
        <span class="n">code</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;    @</span><span class="si">{</span><span class="n">endpoint</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">Mapping(</span><span class="se">\&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">code</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;    public ResponseEntity&lt;?&gt; </span><span class="si">{</span><span class="n">endpoint</span><span class="p">[</span><span class="s1">&#39;operation_type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">(...) </span><span class="se">{{</span><span class="s2"> ... </span><span class="se">}}\n</span><span class="s2">&quot;</span>

    <span class="n">code</span> <span class="o">+=</span> <span class="s2">&quot;}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">code</span>
</code></pre></div>

<h4 id="llm-reasoning">LLM Reasoning<a class="headerlink" href="#llm-reasoning" title="Permanent link">&para;</a></h4>
<p>The schemas enable LLMs to:<br />
- Understand complete DDD structure<br />
- Validate domain models against patterns<br />
- Generate consistent architectures<br />
- Answer questions about relationships<br />
- Suggest refactorings based on rules</p>
<p><strong>Example Prompt</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">Given this tactical schema</span><span class="p">:</span>
<span class="p p-Indicator">[</span><span class="nv">paste tactical model YAML</span><span class="p p-Indicator">]</span>

<span class="l l-Scalar l-Scalar-Plain">1. Validate that all aggregates have exactly one root</span>
<span class="l l-Scalar l-Scalar-Plain">2. Check if any commands modify multiple aggregates</span>
<span class="l l-Scalar l-Scalar-Plain">3. Suggest improvements for aggregate boundaries</span>
</code></pre></div>

<h3 id="99-schema-best-practices">9.9 Schema Best Practices<a class="headerlink" href="#99-schema-best-practices" title="Permanent link">&para;</a></h3>
<h4 id="when-modeling-strategic-patterns">When Modeling Strategic Patterns<a class="headerlink" href="#when-modeling-strategic-patterns" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Start with System Root</strong>:<br />
   - Define <code>system</code> with ID, name, version<br />
   - Add domains progressively</p>
</li>
<li>
<p><strong>Domain Classification</strong>:<br />
   - Be honest about core vs. supporting vs. generic<br />
   - Align <code>strategic_importance</code> with investment</p>
</li>
<li>
<p><strong>Bounded Context Boundaries</strong>:<br />
   - Use linguistic boundaries (when same word means different things)<br />
   - Follow team boundaries (Conway's Law)<br />
   - Keep contexts focused (single responsibility)</p>
</li>
<li>
<p><strong>Context Mappings</strong>:<br />
   - Make all integrations explicit<br />
   - Choose relationship type carefully<br />
   - Document translation maps for ACLs</p>
</li>
<li>
<p><strong>BFF Scoping</strong>:<br />
   - <strong>One BFF per client type</strong> (not per bounded context!)<br />
   - BFF aggregates from MULTIPLE contexts<br />
   - Owned by frontend team<br />
   - NO business logic in BFF</p>
</li>
</ol>
<h4 id="when-modeling-tactical-patterns">When Modeling Tactical Patterns<a class="headerlink" href="#when-modeling-tactical-patterns" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Aggregate Design</strong>:<br />
   - Start small (single entity if possible)<br />
   - Protect true invariants only<br />
   - Reference other aggregates by ID<br />
   - Use domain events for cross-aggregate consistency</p>
</li>
<li>
<p><strong>Value Object Usage</strong>:<br />
   - Use for domain concepts (Money, Address, Email)<br />
   - Enforce immutability (design requires this)<br />
   - Include validation in constructor<br />
   - Define equality by attributes</p>
</li>
<li>
<p><strong>Repository Scope</strong>:<br />
   - One repository per aggregate root<br />
   - Not per entity (common mistake!)<br />
   - Repository interface in domain layer<br />
   - Implementation in infrastructure layer</p>
</li>
<li>
<p><strong>Application Service Design</strong>:<br />
   - One operation per use case<br />
   - NO business logic (coordination only)<br />
   - Manage transaction boundaries<br />
   - Publish domain events after success</p>
</li>
<li>
<p><strong>CQRS Implementation</strong>:<br />
   - Separate command and query interfaces<br />
   - Commands return void/ID/acknowledgment<br />
   - Queries return flat DTOs<br />
   - Use Knight pattern (nested records)</p>
</li>
</ol>
<h4 id="when-modeling-domain-stories">When Modeling Domain Stories<a class="headerlink" href="#when-modeling-domain-stories" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Actor Identification</strong>:<br />
   - Include both humans and systems<br />
   - Use <code>role</code> for generic types<br />
   - Link actors to commands they can issue</p>
</li>
<li>
<p><strong>Work Object Mapping</strong>:<br />
   - Map to aggregates where possible<br />
   - Include attributes for context<br />
   - Show relationships via activities</p>
</li>
<li>
<p><strong>Command/Query Separation</strong>:<br />
   - Commands: state-changing operations<br />
   - Queries: information retrieval<br />
   - Clear actor authorization</p>
</li>
<li>
<p><strong>Event Flow</strong>:<br />
   - Events in past tense<br />
   - Capture payload data<br />
   - Link to causing commands/activities<br />
   - Connect to policies for reactive logic</p>
</li>
<li>
<p><strong>Policy Definition</strong>:<br />
   - "When [Event] happens, do [Command]"<br />
   - Automate business rules<br />
   - Make reactive logic explicit</p>
</li>
</ol>
<hr />
<h2 id="part-v-summary-section-9">Part V Summary (Section 9)<a class="headerlink" href="#part-v-summary-section-9" title="Permanent link">&para;</a></h2>
<p>Section 9 provided <strong>comprehensive schema documentation</strong>:</p>
<p><strong>Three Schemas Covered:</strong></p>
<ol>
<li>
<p><strong>Strategic Schema</strong> (<code>strategic-ddd.schema.yaml</code>):<br />
   - <strong>System</strong> root object<br />
   - Domain, BoundedContext, ContextMapping<br />
   - BFFScope and BFFInterface (extensive BFF support)<br />
   - Schema-enforced BFF constraints</p>
</li>
<li>
<p><strong>Tactical Schema</strong> (<code>tactical-ddd.schema.yaml</code>):<br />
   - <strong>BoundedContext</strong> root object<br />
   - Aggregate, Entity, ValueObject, Repository<br />
   - ApplicationService with CQRS support<br />
   - CommandInterface and QueryInterface (Knight pattern)<br />
   - DomainEvent with immutability enforcement<br />
   - TransactionBoundary with one-aggregate rule (maxItems: 1)</p>
</li>
<li>
<p><strong>Domain Stories Schema</strong> (<code>domain-stories-schema.yaml</code>):<br />
   - Actor, WorkObject, Activity<br />
   - Command, Query, Event, Policy<br />
   - Causal chain representation<br />
   - Mappings to tactical concepts</p>
</li>
</ol>
<p><strong>Key Schema Innovations:</strong></p>
<ul>
<li><strong>Immutability Enforcement</strong>: <code>const: true</code> for ValueObject, DomainEvent, Commands</li>
<li><strong>One Aggregate Rule</strong>: <code>maxItems: 1</code> for transaction_boundary.modifies_aggregates</li>
<li><strong>BFF Constraints</strong>: Schema-enforced "no business logic" and "no direct persistence"</li>
<li><strong>Root Objects</strong>: System (strategic) and BoundedContext (tactical) as roots</li>
<li><strong>ID Patterns</strong>: Comprehensive prefixes for all concept types</li>
</ul>
<p><strong>Validation Rules</strong>:<br />
- Strategic: 6 rules (bounded context has domain, BFF constraints, etc.)<br />
- Tactical: 10 rules (immutability, statelessness, one aggregate, etc.)<br />
- Domain Stories: 5 rules (actors required, past tense events, etc.)</p>
<p><strong>Usage</strong>:<br />
- JSON Schema validation with standard tools<br />
- IDE integration for autocomplete and validation<br />
- Code generation from schema definitions<br />
- LLM reasoning about domain models</p>
<p><strong>Best Practices</strong>:<br />
- Start with System root for strategic models<br />
- Design small aggregates<br />
- One repository per aggregate root<br />
- Use Knight pattern for commands/queries<br />
- BFF aggregates from multiple contexts, owned by frontend team</p>
<p><strong>What's Next</strong>: Section 10 covers <strong>Bibliography</strong>—primary sources, BFF pattern references, CQRS resources, and Domain Storytelling literature.</p>
<hr />
<h2 id="10-bibliography-further-reading">10. Bibliography &amp; Further Reading<a class="headerlink" href="#10-bibliography-further-reading" title="Permanent link">&para;</a></h2>
<p>This section provides comprehensive references for all topics covered in this guide, organized by subject area.</p>
<h3 id="101-primary-ddd-sources">10.1 Primary DDD Sources<a class="headerlink" href="#101-primary-ddd-sources" title="Permanent link">&para;</a></h3>
<h4 id="foundational-books">Foundational Books<a class="headerlink" href="#foundational-books" title="Permanent link">&para;</a></h4>
<p><strong>Evans, Eric (2003). "Domain-Driven Design: Tackling Complexity in the Heart of Software"</strong><br />
- Publisher: Addison-Wesley Professional<br />
- ISBN: 0-321-12521-5<br />
- <strong>The</strong> foundational text that introduced DDD<br />
- <strong>Key Chapters</strong>:<br />
  - Part I: Putting the Domain Model to Work (Ch. 1-3)<br />
  - Part II: The Building Blocks of a Model-Driven Design (Ch. 4-6) — Entities, Value Objects, Services<br />
  - Part III: Refactoring Toward Deeper Insight (Ch. 7-11) — Aggregates, Factories, Repositories<br />
  - Part IV: Strategic Design (Ch. 12-15) — Bounded Contexts, Context Mapping, Distillation<br />
- <strong>Essential Concepts</strong>: Ubiquitous Language, Bounded Context, Aggregate, Entity, Value Object, Repository, Domain Event<br />
- <strong>Online</strong>: https://www.domainlanguage.com/ddd/</p>
<p><strong>Vernon, Vaughn (2013). "Implementing Domain-Driven Design"</strong><br />
- Publisher: Addison-Wesley Professional<br />
- ISBN: 0-321-83457-7<br />
- Modern, practical approach to DDD with code examples<br />
- <strong>Key Chapters</strong>:<br />
  - Ch. 1: Getting Started with DDD<br />
  - Ch. 2: Domains, Subdomains, and Bounded Contexts<br />
  - Ch. 4: Architecture (Hexagonal, Ports &amp; Adapters, CQRS)<br />
  - Ch. 5: Entities<br />
  - Ch. 6: Value Objects<br />
  - Ch. 10: Aggregates — <strong>The 4 Rules of Aggregate Design</strong><br />
  - Ch. 8: Domain Events<br />
  - Ch. 11: Factories<br />
  - Ch. 12: Repositories<br />
- <strong>Essential Concepts</strong>: Aggregate design rules, Hexagonal Architecture, Event Sourcing integration<br />
- <strong>Online</strong>: https://vaughnvernon.com/</p>
<p><strong>Evans, Eric (2015). "Domain-Driven Design Reference"</strong><br />
- Publisher: Domain Language, Inc.<br />
- Free PDF available online<br />
- Distilled reference guide extracting key patterns from the Blue Book<br />
- <strong>Sections</strong>: Pattern definitions, summaries, quick reference<br />
- <strong>Online</strong>: https://www.domainlanguage.com/ddd/reference/</p>
<h4 id="complementary-books">Complementary Books<a class="headerlink" href="#complementary-books" title="Permanent link">&para;</a></h4>
<p><strong>Fowler, Martin (2002). "Patterns of Enterprise Application Architecture"</strong><br />
- Publisher: Addison-Wesley Professional<br />
- ISBN: 0-321-12742-0<br />
- Architectural patterns that complement DDD<br />
- <strong>Key Chapters</strong>:<br />
  - Ch. 2: Organizing Domain Logic — Domain Model, Service Layer<br />
  - Ch. 9-12: Data Source Architectural Patterns — Repository, Data Mapper, Unit of Work<br />
  - Ch. 13-14: Object-Relational Behavioral/Structural Patterns<br />
  - Ch. 15-17: Web Presentation Patterns<br />
- <strong>Essential Patterns</strong>: Domain Model, Service Layer, Repository, Data Mapper, Unit of Work, Lazy Load<br />
- <strong>Online</strong>: https://martinfowler.com/eaaCatalog/</p>
<p><strong>Khononov, Vlad (2021). "Learning Domain-Driven Design: Aligning Software Architecture and Business Strategy"</strong><br />
- Publisher: O'Reilly Media<br />
- ISBN: 978-1098100131<br />
- Modern introduction to DDD with business strategy focus<br />
- <strong>Key Topics</strong>: Business domains, strategic patterns, tactical patterns, event-driven architecture<br />
- Excellent for beginners and experienced practitioners</p>
<p><strong>Millett, Scott &amp; Tune, Nick (2015). "Patterns, Principles, and Practices of Domain-Driven Design"</strong><br />
- Publisher: Wrox<br />
- ISBN: 978-1118714706<br />
- Comprehensive guide with practical examples in C#<br />
- <strong>Key Topics</strong>: Strategic design, tactical patterns, CQRS, Event Sourcing, microservices integration</p>
<h3 id="102-backend-for-frontend-bff-pattern">10.2 Backend-for-Frontend (BFF) Pattern<a class="headerlink" href="#102-backend-for-frontend-bff-pattern" title="Permanent link">&para;</a></h3>
<p><strong>Calçado, Phil (2015). "The Back-end for Front-end Pattern (BFF)"</strong><br />
- <strong>Online</strong>: https://samnewman.io/patterns/architectural/bff/<br />
- Original article introducing BFF pattern for SoundCloud<br />
- <strong>Key Concepts</strong>: One BFF per user experience, API composition, client-specific optimization<br />
- <strong>Principles</strong>:<br />
  - BFF owned by frontend team<br />
  - Each BFF serves exactly one client type<br />
  - BFFs aggregate from multiple microservices<br />
  - No shared business logic in BFFs</p>
<p><strong>Newman, Sam (2015). "Building Microservices"</strong><br />
- Publisher: O'Reilly Media<br />
- ISBN: 978-1491950357<br />
- <strong>Ch. 4</strong>: Integration patterns including BFF<br />
- <strong>Key Topics</strong>: API Gateway vs. BFF, microservice communication, UI composition<br />
- <strong>Online</strong>: https://samnewman.io/</p>
<p><strong>Newman, Sam (2019). "Monolith to Microservices"</strong><br />
- Publisher: O'Reilly Media<br />
- ISBN: 978-1492047841<br />
- <strong>Ch. 5</strong>: Growing Pains — BFF pattern in migration scenarios<br />
- <strong>Key Topics</strong>: BFF for legacy integration, progressive migration</p>
<p><strong>Kong, Inc. "BFF Pattern Implementation Guide"</strong><br />
- <strong>Online</strong>: https://konghq.com/blog/backend-for-frontend<br />
- Practical guide to implementing BFF with API Gateway<br />
- Hybrid approach: API Gateway upstream + BFFs downstream</p>
<p><strong>AWS Architecture Blog (2020). "Backend for Frontend Pattern with Amazon API Gateway"</strong><br />
- <strong>Online</strong>: https://aws.amazon.com/blogs/architecture/<br />
- Cloud implementation patterns for BFF<br />
- Integration with serverless architectures</p>
<h3 id="103-cqrs-and-event-sourcing">10.3 CQRS and Event Sourcing<a class="headerlink" href="#103-cqrs-and-event-sourcing" title="Permanent link">&para;</a></h3>
<p><strong>Young, Greg (2010). "CQRS Documents"</strong><br />
- <strong>Online</strong>: https://cqrs.files.wordpress.com/2010/11/cqrs_documents.pdf<br />
- Foundational CQRS documentation by pattern originator<br />
- <strong>Key Concepts</strong>: Command/Query separation, read models, eventual consistency<br />
- <strong>Principles</strong>: Different models for read and write, optimize independently</p>
<p><strong>Dahan, Udi (2009). "Clarified CQRS"</strong><br />
- <strong>Online</strong>: https://udidahan.com/2009/12/09/clarified-cqrs/<br />
- Clarification of CQRS misconceptions<br />
- <strong>Key Points</strong>: CQRS is not Event Sourcing, not always needed, selective application</p>
<p><strong>Microsoft (2013). "CQRS Journey"</strong><br />
- <strong>Online</strong>: https://docs.microsoft.com/en-us/previous-versions/msp-n-p/jj554200(v=pandp.10)<br />
- Comprehensive guide to CQRS implementation<br />
- Real-world case study with code examples<br />
- <strong>Key Topics</strong>: Command handlers, event handlers, read model projections, sagas</p>
<p><strong>Fowler, Martin (2011). "CQRS"</strong><br />
- <strong>Online</strong>: https://martinfowler.com/bliki/CQRS.html<br />
- Overview and analysis of CQRS pattern<br />
- <strong>Key Points</strong>: When to use, when not to use, complexity considerations</p>
<p><strong>Vernon, Vaughn (2015). "Reactive Messaging Patterns with the Actor Model"</strong><br />
- Publisher: Addison-Wesley Professional<br />
- ISBN: 978-0133846836<br />
- <strong>Ch. 4-5</strong>: Command and Event patterns<br />
- <strong>Key Topics</strong>: Message-driven architecture, event-driven systems, actor model integration</p>
<p><strong>Betts, Dominic et al. (2012). "Exploring CQRS and Event Sourcing"</strong><br />
- Publisher: Microsoft patterns &amp; practices<br />
- ISBN: 978-1621140160<br />
- Free online: https://docs.microsoft.com/en-us/previous-versions/msp-n-p/jj554200(v=pandp.10)<br />
- <strong>Key Topics</strong>: CQRS journey, event sourcing, eventual consistency, sagas</p>
<h3 id="104-domain-storytelling">10.4 Domain Storytelling<a class="headerlink" href="#104-domain-storytelling" title="Permanent link">&para;</a></h3>
<p><strong>Hofer, Stefan &amp; Schwentner, Henning (2021). "Domain Storytelling: A Collaborative, Visual, and Agile Way to Build Domain-Driven Software"</strong><br />
- Publisher: Addison-Wesley Professional<br />
- ISBN: 978-0137458912<br />
- <strong>The</strong> definitive book on Domain Storytelling<br />
- <strong>Key Chapters</strong>:<br />
  - Ch. 1-2: Introduction and notation<br />
  - Ch. 3: Workshop facilitation<br />
  - Ch. 4-5: From stories to bounded contexts<br />
  - Ch. 6: Integration with DDD<br />
  - Ch. 7-8: Practical examples and case studies<br />
- <strong>Essential Concepts</strong>: Actor-Activity-Work Object, pictographic language, collaborative modeling<br />
- <strong>Online</strong>: https://domainstorytelling.org/</p>
<p><strong>Schwentner, Henning (2019). "Domain Storytelling Workshop Guide"</strong><br />
- <strong>Online</strong>: https://domainstorytelling.org/resources<br />
- Practical workshop facilitation techniques<br />
- <strong>Key Topics</strong>: Preparing workshops, facilitation tips, common pitfalls</p>
<p><strong>Domain Storytelling Tool</strong><br />
- <strong>Online</strong>: https://www.wps.de/modeler/<br />
- Free online tool for creating domain stories<br />
- Visual editor with Actor-Activity-Work Object notation<br />
- Export to SVG, PNG, PDF</p>
<p><strong>Brandolini, Alberto (2013). "Introducing EventStorming"</strong><br />
- Publisher: Leanpub<br />
- ISBN: 978-1387133130<br />
- <strong>Related Technique</strong>: Event Storming complements Domain Storytelling<br />
- <strong>Key Topics</strong>: Collaborative modeling, domain events, big picture exploration<br />
- <strong>Online</strong>: https://www.eventstorming.com/</p>
<p><strong>Brandolini, Alberto (2018). "EventStorming Recipes"</strong><br />
- <strong>Online</strong>: https://leanpub.com/eventstorming-recipes<br />
- Practical patterns for EventStorming workshops<br />
- Integration with Domain Storytelling</p>
<h3 id="105-the-knight-pattern-commandquery-with-nested-records">10.5 The Knight Pattern (Command/Query with Nested Records)<a class="headerlink" href="#105-the-knight-pattern-commandquery-with-nested-records" title="Permanent link">&para;</a></h3>
<p><strong>Knight, James (2020). "Command Objects as Nested Records in Java 14+"</strong><br />
- <strong>Online</strong>: https://medium.com/@jamesknightcs/<br />
- Pattern of defining command records inside interface contracts<br />
- <strong>Key Concepts</strong>: Immutable commands, nested records, API design</p>
<p><strong>Oracle Java Documentation (2020). "Java Records"</strong><br />
- <strong>Online</strong>: https://docs.oracle.com/en/java/javase/14/language/records.html<br />
- Language feature enabling Knight pattern<br />
- <strong>Key Features</strong>: Immutability, concise syntax, value semantics</p>
<p><strong>Fowler, Martin (2005). "Value Object"</strong><br />
- <strong>Online</strong>: https://martinfowler.com/bliki/ValueObject.html<br />
- Foundation for command/query as value objects<br />
- <strong>Key Concepts</strong>: Immutability, equality by value, no identity</p>
<p><strong>Parnas, David (1972). "On the Criteria To Be Used in Decomposing Systems into Modules"</strong><br />
- <strong>Source</strong>: Communications of the ACM, Vol. 15, No. 12<br />
- <strong>Key Principle</strong>: Information hiding — interfaces hide implementation<br />
- <strong>Application</strong>: Command interfaces hide aggregate operations</p>
<h3 id="106-ubiquitous-language-and-knowledge-crunching">10.6 Ubiquitous Language and Knowledge Crunching<a class="headerlink" href="#106-ubiquitous-language-and-knowledge-crunching" title="Permanent link">&para;</a></h3>
<p><strong>Evans, Eric (2003). "Domain-Driven Design" — Part I</strong><br />
- Chapters 1-3: Ubiquitous Language, Knowledge Crunching, Model-Driven Design<br />
- <strong>Essential Reading</strong> for understanding DDD philosophy</p>
<p><strong>Evans, Eric (2006). "Getting Started with DDD When Surrounded by Legacy Systems"</strong><br />
- <strong>Talk</strong>: Domain-Driven Design Europe<br />
- <strong>Online</strong>: https://www.domainlanguage.com/<br />
- <strong>Key Topics</strong>: Bubble Context, Anti-Corruption Layer, gradual migration</p>
<p><strong>Fowler, Martin (2004). "Ubiquitous Language"</strong><br />
- <strong>Online</strong>: https://martinfowler.com/bliki/UbiquitousLanguage.html<br />
- Overview and importance of shared language<br />
- <strong>Key Points</strong>: Language evolution, consistency across team</p>
<h3 id="107-aggregates-and-consistency">10.7 Aggregates and Consistency<a class="headerlink" href="#107-aggregates-and-consistency" title="Permanent link">&para;</a></h3>
<p><strong>Vernon, Vaughn (2011). "Effective Aggregate Design" (3-part series)</strong><br />
- <strong>Online</strong>: https://vaughnvernon.com/<br />
- <strong>Part I</strong>: Aggregate boundaries and invariants<br />
- <strong>Part II</strong>: Making aggregates work together<br />
- <strong>Part III</strong>: Gaining insight through discovery<br />
- <strong>The 4 Rules</strong>:<br />
  1. Protect true invariants through consistency boundaries<br />
  2. Design small aggregates<br />
  3. Reference other aggregates by identity only<br />
  4. Update other aggregates via eventual consistency (domain events)</p>
<p><strong>Fowler, Martin (2015). "DDD Aggregate"</strong><br />
- <strong>Online</strong>: https://martinfowler.com/bliki/DDD_Aggregate.html<br />
- Overview of aggregate pattern<br />
- <strong>Key Points</strong>: Consistency boundary, transaction scope, reference by ID</p>
<p><strong>Evans, Eric (2003). "Domain-Driven Design" — Ch. 6</strong><br />
- "The Life Cycle of a Domain Object"<br />
- Aggregates, Factories, Repositories<br />
- <strong>Essential Reading</strong> for understanding aggregate design</p>
<h3 id="108-architecture-and-layering">10.8 Architecture and Layering<a class="headerlink" href="#108-architecture-and-layering" title="Permanent link">&para;</a></h3>
<p><strong>Cockburn, Alistair (2005). "Hexagonal Architecture (Ports and Adapters)"</strong><br />
- <strong>Online</strong>: https://alistair.cockburn.us/hexagonal-architecture/<br />
- Architectural pattern complementing DDD<br />
- <strong>Key Concepts</strong>: Ports (interfaces), Adapters (implementations), domain isolation</p>
<p><strong>Martin, Robert C. (2012). "The Clean Architecture"</strong><br />
- <strong>Online</strong>: https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html<br />
- Layered architecture with dependency inversion<br />
- <strong>Key Concepts</strong>: Dependency rule, entities, use cases, adapters</p>
<p><strong>Fowler, Martin (2015). "PresentationDomainDataLayering"</strong><br />
- <strong>Online</strong>: https://martinfowler.com/bliki/PresentationDomainDataLayering.html<br />
- Classic 3-layer architecture<br />
- <strong>Layers</strong>: Presentation, Domain, Data Source<br />
- <strong>Integration</strong>: Maps naturally to DDD layers</p>
<p><strong>Richardson, Chris (2018). "Microservices Patterns"</strong><br />
- Publisher: Manning Publications<br />
- ISBN: 978-1617294549<br />
- <strong>Key Chapters</strong>: Saga pattern, API composition, CQRS, Event Sourcing<br />
- <strong>Key Topics</strong>: DDD in microservices context, strategic design for microservices</p>
<h3 id="109-value-objects-and-immutability">10.9 Value Objects and Immutability<a class="headerlink" href="#109-value-objects-and-immutability" title="Permanent link">&para;</a></h3>
<p><strong>Fowler, Martin (2005). "Value Object"</strong><br />
- <strong>Online</strong>: https://martinfowler.com/bliki/ValueObject.html<br />
- Canonical definition of value objects<br />
- <strong>Key Concepts</strong>: Equality by value, immutability, no identity</p>
<p><strong>Evans, Eric (2003). "Domain-Driven Design" — Ch. 5</strong><br />
- "A Model Expressed in Software"<br />
- Entities and Value Objects distinction<br />
- <strong>Essential Reading</strong> for understanding when to use each</p>
<p><strong>Bloch, Joshua (2018). "Effective Java" — Third Edition</strong><br />
- Publisher: Addison-Wesley Professional<br />
- ISBN: 978-0134685991<br />
- <strong>Item 17</strong>: Minimize mutability<br />
- <strong>Item 10</strong>: Obey the general contract when overriding equals<br />
- <strong>Application</strong>: Implementing value objects correctly in Java</p>
<h3 id="1010-domain-events">10.10 Domain Events<a class="headerlink" href="#1010-domain-events" title="Permanent link">&para;</a></h3>
<p><strong>Fowler, Martin (2005). "Event Sourcing"</strong><br />
- <strong>Online</strong>: https://martinfowler.com/eaaDev/EventSourcing.html<br />
- Event Sourcing pattern overview<br />
- <strong>Key Concepts</strong>: Event log, event replay, temporal queries</p>
<p><strong>Young, Greg (2007). "Event Sourcing Basics"</strong><br />
- <strong>Online</strong>: https://www.eventstore.com/blog/event-sourcing-basics<br />
- Introduction to Event Sourcing<br />
- <strong>Key Topics</strong>: Event store, projections, snapshots</p>
<p><strong>Vernon, Vaughn (2013). "Implementing Domain-Driven Design" — Ch. 8</strong><br />
- Domain Events chapter<br />
- <strong>Key Topics</strong>: Event publication, subscribers, eventual consistency</p>
<p><strong>Hohpe, Gregor &amp; Woolf, Bobby (2003). "Enterprise Integration Patterns"</strong><br />
- Publisher: Addison-Wesley Professional<br />
- ISBN: 978-0321200686<br />
- <strong>Key Patterns</strong>: Message Channel, Publish-Subscribe, Event Message<br />
- <strong>Online</strong>: https://www.enterpriseintegrationpatterns.com/</p>
<h3 id="1011-repositories-and-persistence">10.11 Repositories and Persistence<a class="headerlink" href="#1011-repositories-and-persistence" title="Permanent link">&para;</a></h3>
<p><strong>Fowler, Martin (2002). "Repository"</strong><br />
- <strong>Online</strong>: https://martinfowler.com/eaaCatalog/repository.html<br />
- Repository pattern from PoEAA<br />
- <strong>Key Concepts</strong>: Collection-like interface, query encapsulation</p>
<p><strong>Fowler, Martin (2002). "Data Mapper"</strong><br />
- <strong>Online</strong>: https://martinfowler.com/eaaCatalog/dataMapper.html<br />
- Implementing repositories with Data Mapper<br />
- <strong>Key Concepts</strong>: Separation of domain and persistence, bidirectional mapping</p>
<p><strong>Fowler, Martin (2002). "Unit of Work"</strong><br />
- <strong>Online</strong>: https://martinfowler.com/eaaCatalog/unitOfWork.html<br />
- Transaction management pattern<br />
- <strong>Key Concepts</strong>: Change tracking, commit/rollback, object registration</p>
<p><strong>Evans, Eric (2003). "Domain-Driven Design" — Ch. 6</strong><br />
- Repositories in DDD context<br />
- <strong>Key Points</strong>: One repository per aggregate root, domain-centric queries</p>
<h3 id="1012-strategic-design-and-context-mapping">10.12 Strategic Design and Context Mapping<a class="headerlink" href="#1012-strategic-design-and-context-mapping" title="Permanent link">&para;</a></h3>
<p><strong>Evans, Eric (2003). "Domain-Driven Design" — Part IV</strong><br />
- Strategic Design chapters (12-15)<br />
- <strong>Ch. 14</strong>: Context Mapping — <strong>Essential reading</strong> for integration patterns<br />
- <strong>Key Concepts</strong>: Partnership, Shared Kernel, Customer/Supplier, Conformist, ACL, OHS, PL</p>
<p><strong>Fowler, Martin (2014). "Bounded Context"</strong><br />
- <strong>Online</strong>: https://martinfowler.com/bliki/BoundedContext.html<br />
- Overview of bounded context concept<br />
- <strong>Key Points</strong>: Linguistic boundaries, context autonomy, explicit relationships</p>
<p><strong>Vernon, Vaughn (2013). "Implementing Domain-Driven Design" — Ch. 2-3</strong><br />
- Ch. 2: Domains, Subdomains, and Bounded Contexts<br />
- Ch. 3: Context Maps<br />
- <strong>Key Topics</strong>: Core domain identification, context relationship patterns</p>
<p><strong>Tune, Nick &amp; Millett, Scott (2017). "Domain-Driven Design Distilled"</strong><br />
- Publisher: Addison-Wesley Professional<br />
- ISBN: 978-0134434421<br />
- <strong>Focus</strong>: Strategic design patterns<br />
- <strong>Key Topics</strong>: Core domain charts, context mapping, organizational patterns</p>
<h3 id="1013-schemas-and-formal-methods">10.13 Schemas and Formal Methods<a class="headerlink" href="#1013-schemas-and-formal-methods" title="Permanent link">&para;</a></h3>
<p><strong>JSON Schema Specification (Draft 2020-12)</strong><br />
- <strong>Online</strong>: https://json-schema.org/draft/2020-12/json-schema-core.html<br />
- JSON Schema standard used for formalizing DDD patterns<br />
- <strong>Key Features</strong>: Schema validation, type system, constraints</p>
<p><strong>YAML Specification v1.2</strong><br />
- <strong>Online</strong>: https://yaml.org/spec/1.2/spec.html<br />
- YAML format for schema definitions<br />
- <strong>Key Features</strong>: Human-readable, structured data, JSON superset</p>
<p><strong>OpenAPI Specification v3.1</strong><br />
- <strong>Online</strong>: https://spec.openapis.org/oas/v3.1.0<br />
- API specification standard (complementary to schemas)<br />
- <strong>Key Features</strong>: REST API documentation, code generation, validation</p>
<h3 id="1014-conways-law-and-team-topologies">10.14 Conway's Law and Team Topologies<a class="headerlink" href="#1014-conways-law-and-team-topologies" title="Permanent link">&para;</a></h3>
<p><strong>Conway, Melvin E. (1968). "How Do Committees Invent?"</strong><br />
- <strong>Source</strong>: Datamation, Vol. 14, No. 4<br />
- <strong>Online</strong>: http://www.melconway.com/Home/Committees_Paper.html<br />
- <strong>Key Principle</strong>: "Organizations design systems that mirror their communication structure"<br />
- <strong>Application</strong>: BFF team ownership, bounded context ownership</p>
<p><strong>Skelton, Matthew &amp; Pais, Manuel (2019). "Team Topologies"</strong><br />
- Publisher: IT Revolution Press<br />
- ISBN: 978-1942788812<br />
- <strong>Key Concepts</strong>: Stream-aligned teams, platform teams, enabling teams<br />
- <strong>Application</strong>: Organizing teams around bounded contexts and BFFs</p>
<p><strong>Evans, Eric (2003). "Domain-Driven Design" — Ch. 14</strong><br />
- "Maintaining Model Integrity"<br />
- <strong>Key Topics</strong>: Team organization, continuous integration, context boundaries</p>
<h3 id="1015-ddd-schema-references">10.15 DDD Schema References<a class="headerlink" href="#1015-ddd-schema-references" title="Permanent link">&para;</a></h3>
<p><strong>Strategic DDD Schema</strong><br />
- <strong>Location</strong>: <code>/domains/ddd/schemas/strategic-ddd.schema.yaml</code><br />
- <strong>Author</strong>: Marina Music<br />
- <strong>Updated</strong>: 2025-10-24<br />
- <strong>Concepts</strong>: System, Domain, BoundedContext, ContextMapping, BFFScope, BFFInterface<br />
- <strong>Key Features</strong>: System root object, BFF constraints, context mapping relationships</p>
<p><strong>Tactical DDD Schema</strong><br />
- <strong>Location</strong>: <code>/domains/ddd/schemas/tactical-ddd.schema.yaml</code><br />
- <strong>Author</strong>: Marina Music<br />
- <strong>Updated</strong>: 2025-10-24<br />
- <strong>Concepts</strong>: BoundedContext (root), Aggregate, Entity, ValueObject, Repository, ApplicationService, CommandInterface, QueryInterface, DomainEvent<br />
- <strong>Key Features</strong>: BoundedContext root object, immutability enforcement, one aggregate per transaction rule</p>
<p><strong>Domain Stories Schema</strong><br />
- <strong>Location</strong>: <code>/domain-stories/domain-stories-schema.yaml</code><br />
- <strong>Author</strong>: Marina Music<br />
- <strong>Updated</strong>: 2025-10-24<br />
- <strong>Concepts</strong>: DomainStory, Actor, WorkObject, Activity, Command, Query, Event, Policy<br />
- <strong>Key Features</strong>: Causal chain representation, mapping to tactical concepts</p>
<p><strong>Schema Validation Tools</strong><br />
- <strong>jsonschema (Python)</strong>: https://python-jsonschema.readthedocs.io/<br />
- <strong>ajv (Node.js)</strong>: https://ajv.js.org/<br />
- <strong>VS Code YAML Extension</strong>: https://marketplace.visualstudio.com/items?itemName=redhat.vscode-yaml</p>
<h3 id="1016-online-communities-and-resources">10.16 Online Communities and Resources<a class="headerlink" href="#1016-online-communities-and-resources" title="Permanent link">&para;</a></h3>
<p><strong>Domain-Driven Design Community</strong><br />
- <strong>Online</strong>: https://dddcommunity.org/<br />
- Active DDD community with resources, events, and discussions<br />
- <strong>Key Resources</strong>: Patterns catalog, book recommendations, conference talks</p>
<p><strong>DDD Europe</strong><br />
- <strong>Online</strong>: https://dddeurope.com/<br />
- Annual European DDD conference<br />
- <strong>Key Resources</strong>: Conference videos, workshops, community events</p>
<p><strong>Virtual DDD</strong><br />
- <strong>Online</strong>: https://virtualddd.com/<br />
- Online DDD community and meetups<br />
- <strong>Key Resources</strong>: Recorded sessions, open-space discussions</p>
<p><strong>Martin Fowler's Website</strong><br />
- <strong>Online</strong>: https://martinfowler.com/<br />
- Extensive pattern catalog and articles<br />
- <strong>Key Sections</strong>: Bliki (blog), PoEAA catalog, microservices resources</p>
<p><strong>InfoQ Domain-Driven Design</strong><br />
- <strong>Online</strong>: https://www.infoq.com/domaindrivendesign/<br />
- Articles, presentations, and case studies<br />
- <strong>Key Topics</strong>: Strategic design, microservices, CQRS, Event Sourcing</p>
<p><strong>GitHub - DDD Sample Applications</strong><br />
- <strong>Spring PetClinic (DDD)</strong>: https://github.com/spring-petclinic/spring-petclinic-microservices<br />
- <strong>DDD Sample (Java)</strong>: https://github.com/citerus/dddsample-core<br />
- <strong>Microsoft eShopOnContainers</strong>: https://github.com/dotnet-architecture/eShopOnContainers</p>
<h3 id="1017-related-patterns-and-practices">10.17 Related Patterns and Practices<a class="headerlink" href="#1017-related-patterns-and-practices" title="Permanent link">&para;</a></h3>
<p><strong>Gamma, Erich et al. (1994). "Design Patterns: Elements of Reusable Object-Oriented Software"</strong><br />
- Publisher: Addison-Wesley Professional<br />
- ISBN: 0-201-63361-2<br />
- <strong>Relevant Patterns</strong>: Factory, Strategy, Observer, Composite<br />
- <strong>Application</strong>: Implementing DDD tactical patterns</p>
<p><strong>Beck, Kent (2002). "Test Driven Development: By Example"</strong><br />
- Publisher: Addison-Wesley Professional<br />
- ISBN: 0-321-14653-0<br />
- <strong>Key Topics</strong>: TDD with domain models, testing aggregates</p>
<p><strong>Freeman, Steve &amp; Pryce, Nat (2009). "Growing Object-Oriented Software, Guided by Tests"</strong><br />
- Publisher: Addison-Wesley Professional<br />
- ISBN: 978-0321503626<br />
- <strong>Key Topics</strong>: Outside-in TDD, testing domain logic, mock objects</p>
<p><strong>Martin, Robert C. (2008). "Clean Code"</strong><br />
- Publisher: Prentice Hall<br />
- ISBN: 978-0132350884<br />
- <strong>Key Chapters</strong>: Ch. 2 (Meaningful Names), Ch. 3 (Functions), Ch. 10 (Classes)<br />
- <strong>Application</strong>: Writing clean domain code</p>
<h3 id="1018-additional-reading">10.18 Additional Reading<a class="headerlink" href="#1018-additional-reading" title="Permanent link">&para;</a></h3>
<p><strong>Buschmann, Frank et al. (1996). "Pattern-Oriented Software Architecture, Volume 1"</strong><br />
- Publisher: Wiley<br />
- ISBN: 978-0471958697<br />
- <strong>Key Patterns</strong>: Layers, Pipes and Filters, Broker<br />
- <strong>Application</strong>: Architectural patterns complementing DDD</p>
<p><strong>Bass, Len et al. (2012). "Software Architecture in Practice" — Third Edition</strong><br />
- Publisher: Addison-Wesley Professional<br />
- ISBN: 978-0321815736<br />
- <strong>Key Topics</strong>: Architectural styles, quality attributes, design decisions</p>
<p><strong>Evans, Eric &amp; Evans, Robert (2009). "Domain-Driven Design Quickly"</strong><br />
- Publisher: InfoQ<br />
- Free online minibook<br />
- <strong>Online</strong>: https://www.infoq.com/minibooks/domain-driven-design-quickly/<br />
- Quick overview of DDD concepts</p>
<h3 id="1019-historical-context">10.19 Historical Context<a class="headerlink" href="#1019-historical-context" title="Permanent link">&para;</a></h3>
<p><strong>Dijkstra, Edsger W. (1968). "A Case against the GO TO Statement"</strong><br />
- <strong>Source</strong>: Communications of the ACM, Vol. 11, No. 3<br />
- <strong>Historical Context</strong>: Structured programming foundation for DDD's emphasis on clarity</p>
<p><strong>Parnas, David (1972). "On the Criteria To Be Used in Decomposing Systems into Modules"</strong><br />
- <strong>Source</strong>: Communications of the ACM, Vol. 15, No. 12<br />
- <strong>Key Principle</strong>: Information hiding — foundation for bounded contexts</p>
<p><strong>Brooks, Frederick P. (1975). "The Mythical Man-Month"</strong><br />
- Publisher: Addison-Wesley Professional<br />
- ISBN: 0-201-00650-2<br />
- <strong>Key Essay</strong>: "No Silver Bullet" — complexity management, relevant to DDD philosophy</p>
<p><strong>Jackson, Michael (1995). "Software Requirements &amp; Specifications"</strong><br />
- Publisher: ACM Press<br />
- <strong>Key Concepts</strong>: Problem frames, domain modeling precursors to DDD</p>
<h3 id="1020-recommended-reading-order">10.20 Recommended Reading Order<a class="headerlink" href="#1020-recommended-reading-order" title="Permanent link">&para;</a></h3>
<p>For practitioners <strong>new to DDD</strong>, recommended reading order:</p>
<ol>
<li>
<p><strong>Start Here</strong>:<br />
   - Evans, Eric (2003). "Domain-Driven Design" (Blue Book) — Chapters 1-6<br />
   - Fowler, Martin (2002). "Patterns of Enterprise Application Architecture" — Domain Logic chapters</p>
</li>
<li>
<p><strong>Strategic Design</strong>:<br />
   - Evans, Eric (2003). "Domain-Driven Design" — Chapters 12-15<br />
   - Vernon, Vaughn (2013). "Implementing Domain-Driven Design" — Chapters 2-3<br />
   - Hofer &amp; Schwentner (2021). "Domain Storytelling"</p>
</li>
<li>
<p><strong>Tactical Patterns</strong>:<br />
   - Vernon, Vaughn (2013). "Implementing Domain-Driven Design" — Chapters 5-6, 10-12<br />
   - Vernon, Vaughn (2011). "Effective Aggregate Design" (3-part series)</p>
</li>
<li>
<p><strong>Application Layer &amp; CQRS</strong>:<br />
   - Fowler, Martin (2002). "Patterns of Enterprise Application Architecture" — Service Layer<br />
   - Young, Greg (2010). "CQRS Documents"<br />
   - Microsoft (2013). "CQRS Journey"</p>
</li>
<li>
<p><strong>BFF Pattern</strong>:<br />
   - Calçado, Phil (2015). "The Back-end for Front-end Pattern"<br />
   - Newman, Sam (2015). "Building Microservices" — Chapter 4</p>
</li>
<li>
<p><strong>Schemas &amp; Formalization</strong>:<br />
   - DDD Schemas (this guide, Section 9)<br />
   - JSON Schema Specification</p>
</li>
</ol>
<p>For practitioners <strong>experienced with DDD</strong>, focus on:<br />
- Vernon's aggregate design series<br />
- CQRS/Event Sourcing resources<br />
- Domain Storytelling<br />
- DDD Schemas for formalization</p>
<hr />
<h2 id="guide-summary-and-conclusion">Guide Summary and Conclusion<a class="headerlink" href="#guide-summary-and-conclusion" title="Permanent link">&para;</a></h2>
<p>This guide has covered <strong>Domain-Driven Design</strong> comprehensively across 10 sections spanning ~58,000 words.</p>
<h3 id="what-weve-covered">What We've Covered<a class="headerlink" href="#what-weve-covered" title="Permanent link">&para;</a></h3>
<p><strong>Part I: Foundations (Sections 1-3)</strong><br />
- DDD philosophy and principles<br />
- System root object<br />
- Strategic patterns: Domain, Subdomain, Bounded Context, Context Mapping<br />
- Ubiquitous Language and knowledge crunching</p>
<p><strong>Part II: Discovery (Section 4)</strong><br />
- Domain Storytelling technique<br />
- Actor-Activity-Work Object notation<br />
- Workshop facilitation<br />
- From stories to bounded contexts</p>
<p><strong>Part III: Tactical Implementation (Sections 5-7)</strong><br />
- Tactical patterns: Aggregate, Entity, Value Object, Repository, Domain Service, Domain Event<br />
- Application Layer: Application Services, CQRS, Transaction Boundaries<br />
- BFF Pattern: "One Experience, One BFF", multi-context aggregation</p>
<p><strong>Part IV: Integration (Section 8)</strong><br />
- PoEAA integration: Domain Model, Service Layer, Repository, Data Mapper<br />
- Layered architecture<br />
- Pattern combinations</p>
<p><strong>Part V: Reference (Sections 9-10)</strong><br />
- Comprehensive schema documentation (Strategic, Tactical, Domain Stories)<br />
- ID conventions and validation rules<br />
- Bibliography and resources</p>
<h3 id="key-ddd-patterns-covered">Key DDD Patterns Covered<a class="headerlink" href="#key-ddd-patterns-covered" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Root Objects</strong>: System (strategic) and BoundedContext (tactical)</li>
<li><strong>Design Constraints</strong>: Immutability, one aggregate per transaction, BFF responsibilities</li>
<li><strong>Knight Pattern</strong>: Commands/Queries as nested records in interfaces</li>
<li><strong>BFF Pattern</strong>: "One Experience, One BFF", multi-context aggregation</li>
<li><strong>Domain Storytelling</strong>: Collaborative discovery and modeling technique</li>
</ol>
<h3 id="using-this-guide">Using This Guide<a class="headerlink" href="#using-this-guide" title="Permanent link">&para;</a></h3>
<p><strong>As a Learning Resource</strong>:<br />
- Read sequentially from Part I → Part V<br />
- Work through examples<br />
- Refer to bibliography for deeper understanding</p>
<p><strong>As a Reference</strong>:<br />
- Jump to specific sections for pattern details<br />
- Use Section 9 (Schema Reference) for schema definitions<br />
- Use Section 10 (Bibliography) for source materials</p>
<p><strong>As a Schema Guide</strong>:<br />
- Section 9 provides complete schema documentation<br />
- Use schemas for validation, code generation, LLM reasoning<br />
- Follow ID conventions and validation rules</p>
<h3 id="next-steps">Next Steps<a class="headerlink" href="#next-steps" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Apply Strategic Design</strong>: Use System root, identify domains, define bounded contexts</li>
<li><strong>Conduct Domain Storytelling</strong>: Workshop with domain experts, create domain stories</li>
<li><strong>Model Tactical Patterns</strong>: Design aggregates, define entities/value objects, implement repositories</li>
<li><strong>Implement Application Layer</strong>: Create application services, separate commands/queries</li>
<li><strong>Add BFF Layer</strong>: Define BFF scopes per client type, aggregate from multiple contexts</li>
<li><strong>Formalize Your Design</strong>: Use the schemas for structural validation and documentation</li>
</ol>
<h3 id="final-thoughts">Final Thoughts<a class="headerlink" href="#final-thoughts" title="Permanent link">&para;</a></h3>
<p>Domain-Driven Design is not just a set of patterns — it's a <strong>philosophy</strong> of software development that puts the <strong>domain model</strong> at the center of the system. The schemas provide a way to formalize DDD patterns, making them <strong>machine-readable</strong>, <strong>validatable</strong>, and verifiable.</p>
<p><strong>Key Principles to Remember</strong>:<br />
- <strong>Ubiquitous Language</strong>: Speak the domain expert's language<br />
- <strong>Bounded Contexts</strong>: Explicit boundaries for models<br />
- <strong>Aggregates</strong>: Consistency boundaries, keep them small<br />
- <strong>Domain Events</strong>: Communication across boundaries<br />
- <strong>CQRS</strong>: Separate reads from writes when beneficial<br />
- <strong>BFF Pattern</strong>: One BFF per client experience</p>
<p><strong>Success with DDD requires</strong>:<br />
- Close collaboration with domain experts<br />
- Iterative refinement of models<br />
- Attention to linguistic boundaries<br />
- Disciplined application of patterns<br />
- Continuous learning and improvement</p>
<p>Thank you for reading this comprehensive DDD guide. May your domain models be rich, your aggregates small, your bounded contexts clear, and your software aligned with business needs.</p>
</body>
</html>
